var sl=Object.defineProperty;var rl=(rt,ot,d)=>ot in rt?sl(rt,ot,{enumerable:!0,configurable:!0,writable:!0,value:d}):rt[ot]=d;var ne=(rt,ot,d)=>(rl(rt,typeof ot!="symbol"?ot+"":ot,d),d);(function(){const ot=document.createElement("link").relList;if(ot&&ot.supports&&ot.supports("modulepreload"))return;for(const q of document.querySelectorAll('link[rel="modulepreload"]'))W(q);new MutationObserver(q=>{for(const Z of q)if(Z.type==="childList")for(const Y of Z.addedNodes)Y.tagName==="LINK"&&Y.rel==="modulepreload"&&W(Y)}).observe(document,{childList:!0,subtree:!0});function d(q){const Z={};return q.integrity&&(Z.integrity=q.integrity),q.referrerPolicy&&(Z.referrerPolicy=q.referrerPolicy),q.crossOrigin==="use-credentials"?Z.credentials="include":q.crossOrigin==="anonymous"?Z.credentials="omit":Z.credentials="same-origin",Z}function W(q){if(q.ep)return;q.ep=!0;const Z=d(q);fetch(q.href,Z)}})();/*!
 * excalibur - 0.29.2 - 2024-4-7
 * https://github.com/excaliburjs/Excalibur
 * Copyright (c) 2024 Excalibur.js <https://github.com/excaliburjs/Excalibur/graphs/contributors>
 * Licensed BSD-2-Clause
 * @preserve
 */var nl={8851:(rt,ot,d)=>{d.d(ot,{A:()=>X});var W=d(2001),q=d.n(W),Z=d(935),Y=d.n(Z),et=Y()(q());et.push([rt.id,`/* Buttons styles start */

button#excalibur-play {
  display: inline-block;
  position: relative;
  z-index: 999;
  border-radius: 6px;
  border: none;
  /*border: 3px solid;
    border-color: white;
    box-shadow: 0 0 10px #ccc;*/
  padding: 1rem 1.5rem 1rem 4rem;
  margin: 0;
  text-decoration: none;
  background: #00b233;
  color: #ffffff;
  font-family: sans-serif;
  font-size: 2rem;
  white-space: nowrap;
  line-height: 1;
  cursor: pointer;
  text-align: center;
  transition: background 250ms ease-in-out, transform 150ms ease;
  -webkit-appearance: none;
  -moz-appearance: none;

  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */
  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */
  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */
  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */
  animation: excalibur-button-fadein 200ms;
}

/*
button#excalibur-play {
  display: none;
}*/

button#excalibur-play:after {
  position: absolute;
  content: '';
  border: 8px solid;
  border-color: transparent transparent transparent white;
  left: 35px;
  top: 24px;
  width: 0;
  height: 0;
}

button#excalibur-play:before {
  position: absolute;
  content: '';
  border: 3px solid;
  left: 19px;
  top: 14px;
  border-radius: 20px;
  width: 30px;
  height: 30px;
}

button#excalibur-play:hover,
button#excalibur-play:focus {
  background: #00982c;
}

button#excalibur-play:focus {
  outline: 1px solid #fff;
  outline-offset: -4px;
}

button#excalibur-play:active {
  transform: scale(0.99);
}

@keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Firefox < 16 */
@-moz-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Internet Explorer */
@-ms-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Opera < 12.1 */
@-o-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}
`,"",{version:3,sources:["webpack://./Director/Loader.css"],names:[],mappings:"AAAA,yBAAyB;;AAEzB;EACE,qBAAqB;EACrB,kBAAkB;EAClB,YAAY;EACZ,kBAAkB;EAClB,YAAY;EACZ;;+BAE6B;EAC7B,8BAA8B;EAC9B,SAAS;EACT,qBAAqB;EACrB,mBAAmB;EACnB,cAAc;EACd,uBAAuB;EACvB,eAAe;EACf,mBAAmB;EACnB,cAAc;EACd,eAAe;EACf,kBAAkB;EAClB,8DAA8D;EAC9D,wBAAwB;EACxB,qBAAqB;;EAErB,gDAAgD,EAAE,oCAAoC;EACtF,6CAA6C,EAAE,iBAAiB;EAChE,4CAA4C,EAAE,sBAAsB;EACpE,2CAA2C,EAAE,iBAAiB;EAC9D,wCAAwC;AAC1C;;AAEA;;;EAGE;;AAEF;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,uDAAuD;EACvD,UAAU;EACV,SAAS;EACT,QAAQ;EACR,SAAS;AACX;;AAEA;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,UAAU;EACV,SAAS;EACT,mBAAmB;EACnB,WAAW;EACX,YAAY;AACd;;AAEA;;EAEE,mBAAmB;AACrB;;AAEA;EACE,uBAAuB;EACvB,oBAAoB;AACtB;;AAEA;EACE,sBAAsB;AACxB;;AAEA;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,oCAAoC;AACpC;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,sBAAsB;AACtB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF",sourcesContent:[`/* Buttons styles start */\r
\r
button#excalibur-play {\r
  display: inline-block;\r
  position: relative;\r
  z-index: 999;\r
  border-radius: 6px;\r
  border: none;\r
  /*border: 3px solid;\r
    border-color: white;\r
    box-shadow: 0 0 10px #ccc;*/\r
  padding: 1rem 1.5rem 1rem 4rem;\r
  margin: 0;\r
  text-decoration: none;\r
  background: #00b233;\r
  color: #ffffff;\r
  font-family: sans-serif;\r
  font-size: 2rem;\r
  white-space: nowrap;\r
  line-height: 1;\r
  cursor: pointer;\r
  text-align: center;\r
  transition: background 250ms ease-in-out, transform 150ms ease;\r
  -webkit-appearance: none;\r
  -moz-appearance: none;\r
\r
  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\r
  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\r
  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\r
  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\r
  animation: excalibur-button-fadein 200ms;\r
}\r
\r
/*\r
button#excalibur-play {\r
  display: none;\r
}*/\r
\r
button#excalibur-play:after {\r
  position: absolute;\r
  content: '';\r
  border: 8px solid;\r
  border-color: transparent transparent transparent white;\r
  left: 35px;\r
  top: 24px;\r
  width: 0;\r
  height: 0;\r
}\r
\r
button#excalibur-play:before {\r
  position: absolute;\r
  content: '';\r
  border: 3px solid;\r
  left: 19px;\r
  top: 14px;\r
  border-radius: 20px;\r
  width: 30px;\r
  height: 30px;\r
}\r
\r
button#excalibur-play:hover,\r
button#excalibur-play:focus {\r
  background: #00982c;\r
}\r
\r
button#excalibur-play:focus {\r
  outline: 1px solid #fff;\r
  outline-offset: -4px;\r
}\r
\r
button#excalibur-play:active {\r
  transform: scale(0.99);\r
}\r
\r
@keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
\r
/* Firefox < 16 */\r
@-moz-keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
\r
/* Safari, Chrome and Opera > 12.1 */\r
@-webkit-keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
\r
/* Internet Explorer */\r
@-ms-keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
\r
/* Opera < 12.1 */\r
@-o-keyframes excalibur-button-fadein {\r
  from {\r
    opacity: 0;\r
  }\r
  to {\r
    opacity: 1;\r
  }\r
}\r
`],sourceRoot:""}]);const X=et},4296:(rt,ot,d)=>{d.d(ot,{A:()=>X});var W=d(2001),q=d.n(W),Z=d(935),Y=d.n(Z),et=Y()(q());et.push([rt.id,`
#ex-toast-container {
  position: absolute;
  height: 0;
  min-width: 50%;
  left: 50%;
  top: 0;
}

.ex-toast-message {
  left: -50%;
  position: relative;
  display: flex;
  justify-content: space-between;


  padding: 10px;
  margin-top: 5px;
  font-size: 18px;
  font-family: sans-serif;
  border-radius: 6px;
  border: 3px solid #b7b779;
  background-color: rgb(253, 253, 192);
}


.ex-toast-message button {
  align-self: flex-start;
}`,"",{version:3,sources:["webpack://./Util/Toaster.css"],names:[],mappings:";AACA;EACE,kBAAkB;EAClB,SAAS;EACT,cAAc;EACd,SAAS;EACT,MAAM;AACR;;AAEA;EACE,UAAU;EACV,kBAAkB;EAClB,aAAa;EACb,8BAA8B;;;EAG9B,aAAa;EACb,eAAe;EACf,eAAe;EACf,uBAAuB;EACvB,kBAAkB;EAClB,yBAAyB;EACzB,oCAAoC;AACtC;;;AAGA;EACE,sBAAsB;AACxB",sourcesContent:[`\r
#ex-toast-container {\r
  position: absolute;\r
  height: 0;\r
  min-width: 50%;\r
  left: 50%;\r
  top: 0;\r
}\r
\r
.ex-toast-message {\r
  left: -50%;\r
  position: relative;\r
  display: flex;\r
  justify-content: space-between;\r
\r
\r
  padding: 10px;\r
  margin-top: 5px;\r
  font-size: 18px;\r
  font-family: sans-serif;\r
  border-radius: 6px;\r
  border: 3px solid #b7b779;\r
  background-color: rgb(253, 253, 192);\r
}\r
\r
\r
.ex-toast-message button {\r
  align-self: flex-start;\r
}`],sourceRoot:""}]);const X=et},935:rt=>{rt.exports=function(ot){var d=[];return d.toString=function(){return this.map(function(q){var Z="",Y=typeof q[5]<"u";return q[4]&&(Z+="@supports (".concat(q[4],") {")),q[2]&&(Z+="@media ".concat(q[2]," {")),Y&&(Z+="@layer".concat(q[5].length>0?" ".concat(q[5]):""," {")),Z+=ot(q),Y&&(Z+="}"),q[2]&&(Z+="}"),q[4]&&(Z+="}"),Z}).join("")},d.i=function(q,Z,Y,et,X){typeof q=="string"&&(q=[[null,q,void 0]]);var k={};if(Y)for(var b=0;b<this.length;b++){var l=this[b][0];l!=null&&(k[l]=!0)}for(var S=0;S<q.length;S++){var C=[].concat(q[S]);Y&&k[C[0]]||(typeof X<"u"&&(typeof C[5]>"u"||(C[1]="@layer".concat(C[5].length>0?" ".concat(C[5]):""," {").concat(C[1],"}")),C[5]=X),Z&&(C[2]&&(C[1]="@media ".concat(C[2]," {").concat(C[1],"}")),C[2]=Z),et&&(C[4]?(C[1]="@supports (".concat(C[4],") {").concat(C[1],"}"),C[4]=et):C[4]="".concat(et)),d.push(C))}},d}},2001:rt=>{rt.exports=function(ot){var d=ot[1],W=ot[3];if(!W)return d;if(typeof btoa=="function"){var q=btoa(unescape(encodeURIComponent(JSON.stringify(W)))),Z="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(q),Y="/*# ".concat(Z," */");return[d].concat([Y]).join(`
`)}return[d].join(`
`)}},9493:(rt,ot,d)=>{d(3975);var W=d(2564);rt.exports=W("Array","sort")},311:(rt,ot,d)=>{d(8291);var W=d(9120);rt.exports=W.Object.keys},4977:(rt,ot,d)=>{var W=d(4188),q=d(3174),Z=TypeError;rt.exports=function(Y){if(W(Y))return Y;throw new Z(q(Y)+" is not a function")}},3770:(rt,ot,d)=>{var W=d(831),q=String,Z=TypeError;rt.exports=function(Y){if(W(Y))return Y;throw new Z(q(Y)+" is not an object")}},1458:(rt,ot,d)=>{var W=d(380),q=d(675),Z=d(9389),Y=function(et){return function(X,k,b){var l=W(X),S=Z(l);if(S===0)return!et&&-1;var C=q(b,S),Q;if(et&&k!==k){for(;S>C;)if(Q=l[C++],Q!==Q)return!0}else for(;S>C;C++)if((et||C in l)&&l[C]===k)return et||C||0;return!et&&-1}};rt.exports={includes:Y(!0),indexOf:Y(!1)}},5397:(rt,ot,d)=>{var W=d(5234);rt.exports=function(q,Z){var Y=[][q];return!!Y&&W(function(){Y.call(null,Z||function(){return 1},1)})}},7825:(rt,ot,d)=>{var W=d(6881);rt.exports=W([].slice)},9295:(rt,ot,d)=>{var W=d(7825),q=Math.floor,Z=function(Y,et){var X=Y.length;if(X<8)for(var k=1,b,l;k<X;){for(l=k,b=Y[k];l&&et(Y[l-1],b)>0;)Y[l]=Y[--l];l!==k++&&(Y[l]=b)}else for(var S=q(X/2),C=Z(W(Y,0,S),et),Q=Z(W(Y,S),et),B=C.length,D=Q.length,O=0,V=0;O<B||V<D;)Y[O+V]=O<B&&V<D?et(C[O],Q[V])<=0?C[O++]:Q[V++]:O<B?C[O++]:Q[V++];return Y};rt.exports=Z},8689:(rt,ot,d)=>{var W=d(6881),q=W({}.toString),Z=W("".slice);rt.exports=function(Y){return Z(q(Y),8,-1)}},5438:(rt,ot,d)=>{var W=d(9345),q=d(4188),Z=d(8689),Y=d(4282),et=Y("toStringTag"),X=Object,k=Z(function(){return arguments}())==="Arguments",b=function(l,S){try{return l[S]}catch{}};rt.exports=W?Z:function(l){var S,C,Q;return l===void 0?"Undefined":l===null?"Null":typeof(C=b(S=X(l),et))=="string"?C:k?Z(S):(Q=Z(S))==="Object"&&q(S.callee)?"Arguments":Q}},8657:(rt,ot,d)=>{var W=d(4418),q=d(3168),Z=d(9304),Y=d(4466);rt.exports=function(et,X,k){for(var b=q(X),l=Y.f,S=Z.f,C=0;C<b.length;C++){var Q=b[C];!W(et,Q)&&!(k&&W(k,Q))&&l(et,Q,S(X,Q))}}},8088:(rt,ot,d)=>{var W=d(6893),q=d(4466),Z=d(9123);rt.exports=W?function(Y,et,X){return q.f(Y,et,Z(1,X))}:function(Y,et,X){return Y[et]=X,Y}},9123:rt=>{rt.exports=function(ot,d){return{enumerable:!(ot&1),configurable:!(ot&2),writable:!(ot&4),value:d}}},7509:(rt,ot,d)=>{var W=d(4188),q=d(4466),Z=d(4530),Y=d(4798);rt.exports=function(et,X,k,b){b||(b={});var l=b.enumerable,S=b.name!==void 0?b.name:X;if(W(k)&&Z(k,S,b),b.global)l?et[X]=k:Y(X,k);else{try{b.unsafe?et[X]&&(l=!0):delete et[X]}catch{}l?et[X]=k:q.f(et,X,{value:k,enumerable:!1,configurable:!b.nonConfigurable,writable:!b.nonWritable})}return et}},4798:(rt,ot,d)=>{var W=d(1488),q=Object.defineProperty;rt.exports=function(Z,Y){try{q(W,Z,{value:Y,configurable:!0,writable:!0})}catch{W[Z]=Y}return Y}},1305:(rt,ot,d)=>{var W=d(3174),q=TypeError;rt.exports=function(Z,Y){if(!delete Z[Y])throw new q("Cannot delete property "+W(Y)+" of "+W(Z))}},6893:(rt,ot,d)=>{var W=d(5234);rt.exports=!W(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7})},5926:(rt,ot,d)=>{var W=d(1488),q=d(831),Z=W.document,Y=q(Z)&&q(Z.createElement);rt.exports=function(et){return Y?Z.createElement(et):{}}},8807:(rt,ot,d)=>{var W=d(4109),q=W.match(/firefox\/(\d+)/i);rt.exports=!!q&&+q[1]},5661:(rt,ot,d)=>{var W=d(4109);rt.exports=/MSIE|Trident/.test(W)},4109:rt=>{rt.exports=typeof navigator<"u"&&String(navigator.userAgent)||""},3749:(rt,ot,d)=>{var W=d(1488),q=d(4109),Z=W.process,Y=W.Deno,et=Z&&Z.versions||Y&&Y.version,X=et&&et.v8,k,b;X&&(k=X.split("."),b=k[0]>0&&k[0]<4?1:+(k[0]+k[1])),!b&&q&&(k=q.match(/Edge\/(\d+)/),(!k||k[1]>=74)&&(k=q.match(/Chrome\/(\d+)/),k&&(b=+k[1]))),rt.exports=b},3589:(rt,ot,d)=>{var W=d(4109),q=W.match(/AppleWebKit\/(\d+)\./);rt.exports=!!q&&+q[1]},2564:(rt,ot,d)=>{var W=d(1488),q=d(6881);rt.exports=function(Z,Y){return q(W[Z].prototype[Y])}},1274:rt=>{rt.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},5613:(rt,ot,d)=>{var W=d(1488),q=d(9304).f,Z=d(8088),Y=d(7509),et=d(4798),X=d(8657),k=d(8489);rt.exports=function(b,l){var S=b.target,C=b.global,Q=b.stat,B,D,O,V,M,L;if(C?D=W:Q?D=W[S]||et(S,{}):D=W[S]&&W[S].prototype,D)for(O in l){if(M=l[O],b.dontCallGetSet?(L=q(D,O),V=L&&L.value):V=D[O],B=k(C?O:S+(Q?".":"#")+O,b.forced),!B&&V!==void 0){if(typeof M==typeof V)continue;X(M,V)}(b.sham||V&&V.sham)&&Z(M,"sham",!0),Y(D,O,M,b)}}},5234:rt=>{rt.exports=function(ot){try{return!!ot()}catch{return!0}}},9055:(rt,ot,d)=>{var W=d(5234);rt.exports=!W(function(){var q=(function(){}).bind();return typeof q!="function"||q.hasOwnProperty("prototype")})},9944:(rt,ot,d)=>{var W=d(9055),q=Function.prototype.call;rt.exports=W?q.bind(q):function(){return q.apply(q,arguments)}},2735:(rt,ot,d)=>{var W=d(6893),q=d(4418),Z=Function.prototype,Y=W&&Object.getOwnPropertyDescriptor,et=q(Z,"name"),X=et&&(function(){}).name==="something",k=et&&(!W||W&&Y(Z,"name").configurable);rt.exports={EXISTS:et,PROPER:X,CONFIGURABLE:k}},6881:(rt,ot,d)=>{var W=d(9055),q=Function.prototype,Z=q.call,Y=W&&q.bind.bind(Z,Z);rt.exports=W?Y:function(et){return function(){return Z.apply(et,arguments)}}},5604:(rt,ot,d)=>{var W=d(1488),q=d(4188),Z=function(Y){return q(Y)?Y:void 0};rt.exports=function(Y,et){return arguments.length<2?Z(W[Y]):W[Y]&&W[Y][et]}},2913:(rt,ot,d)=>{var W=d(4977),q=d(4318);rt.exports=function(Z,Y){var et=Z[Y];return q(et)?void 0:W(et)}},1488:function(rt,ot,d){var W=function(q){return q&&q.Math===Math&&q};rt.exports=W(typeof globalThis=="object"&&globalThis)||W(typeof window=="object"&&window)||W(typeof self=="object"&&self)||W(typeof d.g=="object"&&d.g)||W(typeof this=="object"&&this)||function(){return this}()||Function("return this")()},4418:(rt,ot,d)=>{var W=d(6881),q=d(3628),Z=W({}.hasOwnProperty);rt.exports=Object.hasOwn||function(et,X){return Z(q(et),X)}},7588:rt=>{rt.exports={}},9622:(rt,ot,d)=>{var W=d(6893),q=d(5234),Z=d(5926);rt.exports=!W&&!q(function(){return Object.defineProperty(Z("div"),"a",{get:function(){return 7}}).a!==7})},7568:(rt,ot,d)=>{var W=d(6881),q=d(5234),Z=d(8689),Y=Object,et=W("".split);rt.exports=q(function(){return!Y("z").propertyIsEnumerable(0)})?function(X){return Z(X)==="String"?et(X,""):Y(X)}:Y},3029:(rt,ot,d)=>{var W=d(6881),q=d(4188),Z=d(2694),Y=W(Function.toString);q(Z.inspectSource)||(Z.inspectSource=function(et){return Y(et)}),rt.exports=Z.inspectSource},3086:(rt,ot,d)=>{var W=d(5945),q=d(1488),Z=d(831),Y=d(8088),et=d(4418),X=d(2694),k=d(168),b=d(7588),l="Object already initialized",S=q.TypeError,C=q.WeakMap,Q,B,D,O=function(f){return D(f)?B(f):Q(f,{})},V=function(f){return function(v){var h;if(!Z(v)||(h=B(v)).type!==f)throw new S("Incompatible receiver, "+f+" required");return h}};if(W||X.state){var M=X.state||(X.state=new C);M.get=M.get,M.has=M.has,M.set=M.set,Q=function(f,v){if(M.has(f))throw new S(l);return v.facade=f,M.set(f,v),v},B=function(f){return M.get(f)||{}},D=function(f){return M.has(f)}}else{var L=k("state");b[L]=!0,Q=function(f,v){if(et(f,L))throw new S(l);return v.facade=f,Y(f,L,v),v},B=function(f){return et(f,L)?f[L]:{}},D=function(f){return et(f,L)}}rt.exports={set:Q,get:B,has:D,enforce:O,getterFor:V}},4188:rt=>{var ot=typeof document=="object"&&document.all;rt.exports=typeof ot>"u"&&ot!==void 0?function(d){return typeof d=="function"||d===ot}:function(d){return typeof d=="function"}},8489:(rt,ot,d)=>{var W=d(5234),q=d(4188),Z=/#|\.prototype\./,Y=function(l,S){var C=X[et(l)];return C===b?!0:C===k?!1:q(S)?W(S):!!S},et=Y.normalize=function(l){return String(l).replace(Z,".").toLowerCase()},X=Y.data={},k=Y.NATIVE="N",b=Y.POLYFILL="P";rt.exports=Y},4318:rt=>{rt.exports=function(ot){return ot==null}},831:(rt,ot,d)=>{var W=d(4188);rt.exports=function(q){return typeof q=="object"?q!==null:W(q)}},1942:rt=>{rt.exports=!1},6032:(rt,ot,d)=>{var W=d(5604),q=d(4188),Z=d(4578),Y=d(9809),et=Object;rt.exports=Y?function(X){return typeof X=="symbol"}:function(X){var k=W("Symbol");return q(k)&&Z(k.prototype,et(X))}},9389:(rt,ot,d)=>{var W=d(7611);rt.exports=function(q){return W(q.length)}},4530:(rt,ot,d)=>{var W=d(6881),q=d(5234),Z=d(4188),Y=d(4418),et=d(6893),X=d(2735).CONFIGURABLE,k=d(3029),b=d(3086),l=b.enforce,S=b.get,C=String,Q=Object.defineProperty,B=W("".slice),D=W("".replace),O=W([].join),V=et&&!q(function(){return Q(function(){},"length",{value:8}).length!==8}),M=String(String).split("String"),L=rt.exports=function(f,v,h){B(C(v),0,7)==="Symbol("&&(v="["+D(C(v),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),h&&h.getter&&(v="get "+v),h&&h.setter&&(v="set "+v),(!Y(f,"name")||X&&f.name!==v)&&(et?Q(f,"name",{value:v,configurable:!0}):f.name=v),V&&h&&Y(h,"arity")&&f.length!==h.arity&&Q(f,"length",{value:h.arity});try{h&&Y(h,"constructor")&&h.constructor?et&&Q(f,"prototype",{writable:!1}):f.prototype&&(f.prototype=void 0)}catch{}var A=l(f);return Y(A,"source")||(A.source=O(M,typeof v=="string"?v:"")),f};Function.prototype.toString=L(function(){return Z(this)&&S(this).source||k(this)},"toString")},142:rt=>{var ot=Math.ceil,d=Math.floor;rt.exports=Math.trunc||function(q){var Z=+q;return(Z>0?d:ot)(Z)}},4466:(rt,ot,d)=>{var W=d(6893),q=d(9622),Z=d(3315),Y=d(3770),et=d(2344),X=TypeError,k=Object.defineProperty,b=Object.getOwnPropertyDescriptor,l="enumerable",S="configurable",C="writable";ot.f=W?Z?function(B,D,O){if(Y(B),D=et(D),Y(O),typeof B=="function"&&D==="prototype"&&"value"in O&&C in O&&!O[C]){var V=b(B,D);V&&V[C]&&(B[D]=O.value,O={configurable:S in O?O[S]:V[S],enumerable:l in O?O[l]:V[l],writable:!1})}return k(B,D,O)}:k:function(B,D,O){if(Y(B),D=et(D),Y(O),q)try{return k(B,D,O)}catch{}if("get"in O||"set"in O)throw new X("Accessors not supported");return"value"in O&&(B[D]=O.value),B}},9304:(rt,ot,d)=>{var W=d(6893),q=d(9944),Z=d(4416),Y=d(9123),et=d(380),X=d(2344),k=d(4418),b=d(9622),l=Object.getOwnPropertyDescriptor;ot.f=W?l:function(C,Q){if(C=et(C),Q=X(Q),b)try{return l(C,Q)}catch{}if(k(C,Q))return Y(!q(Z.f,C,Q),C[Q])}},5629:(rt,ot,d)=>{var W=d(1843),q=d(1274),Z=q.concat("length","prototype");ot.f=Object.getOwnPropertyNames||function(et){return W(et,Z)}},156:(rt,ot)=>{ot.f=Object.getOwnPropertySymbols},4578:(rt,ot,d)=>{var W=d(6881);rt.exports=W({}.isPrototypeOf)},1843:(rt,ot,d)=>{var W=d(6881),q=d(4418),Z=d(380),Y=d(1458).indexOf,et=d(7588),X=W([].push);rt.exports=function(k,b){var l=Z(k),S=0,C=[],Q;for(Q in l)!q(et,Q)&&q(l,Q)&&X(C,Q);for(;b.length>S;)q(l,Q=b[S++])&&(~Y(C,Q)||X(C,Q));return C}},7137:(rt,ot,d)=>{var W=d(1843),q=d(1274);rt.exports=Object.keys||function(Y){return W(Y,q)}},4416:(rt,ot)=>{var d={}.propertyIsEnumerable,W=Object.getOwnPropertyDescriptor,q=W&&!d.call({1:2},1);ot.f=q?function(Y){var et=W(this,Y);return!!et&&et.enumerable}:d},2287:(rt,ot,d)=>{var W=d(9944),q=d(4188),Z=d(831),Y=TypeError;rt.exports=function(et,X){var k,b;if(X==="string"&&q(k=et.toString)&&!Z(b=W(k,et))||q(k=et.valueOf)&&!Z(b=W(k,et))||X!=="string"&&q(k=et.toString)&&!Z(b=W(k,et)))return b;throw new Y("Can't convert object to primitive value")}},3168:(rt,ot,d)=>{var W=d(5604),q=d(6881),Z=d(5629),Y=d(156),et=d(3770),X=q([].concat);rt.exports=W("Reflect","ownKeys")||function(b){var l=Z.f(et(b)),S=Y.f;return S?X(l,S(b)):l}},9120:(rt,ot,d)=>{var W=d(1488);rt.exports=W},9509:(rt,ot,d)=>{var W=d(4318),q=TypeError;rt.exports=function(Z){if(W(Z))throw new q("Can't call method on "+Z);return Z}},168:(rt,ot,d)=>{var W=d(746),q=d(6209),Z=W("keys");rt.exports=function(Y){return Z[Y]||(Z[Y]=q(Y))}},2694:(rt,ot,d)=>{var W=d(1942),q=d(1488),Z=d(4798),Y="__core-js_shared__",et=rt.exports=q[Y]||Z(Y,{});(et.versions||(et.versions=[])).push({version:"3.36.1",mode:W?"pure":"global",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.36.1/LICENSE",source:"https://github.com/zloirock/core-js"})},746:(rt,ot,d)=>{var W=d(2694);rt.exports=function(q,Z){return W[q]||(W[q]=Z||{})}},8944:(rt,ot,d)=>{var W=d(3749),q=d(5234),Z=d(1488),Y=Z.String;rt.exports=!!Object.getOwnPropertySymbols&&!q(function(){var et=Symbol("symbol detection");return!Y(et)||!(Object(et)instanceof Symbol)||!Symbol.sham&&W&&W<41})},675:(rt,ot,d)=>{var W=d(6744),q=Math.max,Z=Math.min;rt.exports=function(Y,et){var X=W(Y);return X<0?q(X+et,0):Z(X,et)}},380:(rt,ot,d)=>{var W=d(7568),q=d(9509);rt.exports=function(Z){return W(q(Z))}},6744:(rt,ot,d)=>{var W=d(142);rt.exports=function(q){var Z=+q;return Z!==Z||Z===0?0:W(Z)}},7611:(rt,ot,d)=>{var W=d(6744),q=Math.min;rt.exports=function(Z){var Y=W(Z);return Y>0?q(Y,9007199254740991):0}},3628:(rt,ot,d)=>{var W=d(9509),q=Object;rt.exports=function(Z){return q(W(Z))}},290:(rt,ot,d)=>{var W=d(9944),q=d(831),Z=d(6032),Y=d(2913),et=d(2287),X=d(4282),k=TypeError,b=X("toPrimitive");rt.exports=function(l,S){if(!q(l)||Z(l))return l;var C=Y(l,b),Q;if(C){if(S===void 0&&(S="default"),Q=W(C,l,S),!q(Q)||Z(Q))return Q;throw new k("Can't convert object to primitive value")}return S===void 0&&(S="number"),et(l,S)}},2344:(rt,ot,d)=>{var W=d(290),q=d(6032);rt.exports=function(Z){var Y=W(Z,"string");return q(Y)?Y:Y+""}},9345:(rt,ot,d)=>{var W=d(4282),q=W("toStringTag"),Z={};Z[q]="z",rt.exports=String(Z)==="[object z]"},2618:(rt,ot,d)=>{var W=d(5438),q=String;rt.exports=function(Z){if(W(Z)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return q(Z)}},3174:rt=>{var ot=String;rt.exports=function(d){try{return ot(d)}catch{return"Object"}}},6209:(rt,ot,d)=>{var W=d(6881),q=0,Z=Math.random(),Y=W(1 .toString);rt.exports=function(et){return"Symbol("+(et===void 0?"":et)+")_"+Y(++q+Z,36)}},9809:(rt,ot,d)=>{var W=d(8944);rt.exports=W&&!Symbol.sham&&typeof Symbol.iterator=="symbol"},3315:(rt,ot,d)=>{var W=d(6893),q=d(5234);rt.exports=W&&q(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42})},5945:(rt,ot,d)=>{var W=d(1488),q=d(4188),Z=W.WeakMap;rt.exports=q(Z)&&/native code/.test(String(Z))},4282:(rt,ot,d)=>{var W=d(1488),q=d(746),Z=d(4418),Y=d(6209),et=d(8944),X=d(9809),k=W.Symbol,b=q("wks"),l=X?k.for||k:k&&k.withoutSetter||Y;rt.exports=function(S){return Z(b,S)||(b[S]=et&&Z(k,S)?k[S]:l("Symbol."+S)),b[S]}},3975:(rt,ot,d)=>{var W=d(5613),q=d(6881),Z=d(4977),Y=d(3628),et=d(9389),X=d(1305),k=d(2618),b=d(5234),l=d(9295),S=d(5397),C=d(8807),Q=d(5661),B=d(3749),D=d(3589),O=[],V=q(O.sort),M=q(O.push),L=b(function(){O.sort(void 0)}),f=b(function(){O.sort(null)}),v=S("sort"),h=!b(function(){if(B)return B<70;if(!(C&&C>3)){if(Q)return!0;if(D)return D<603;var y="",x,I,w,U;for(x=65;x<76;x++){switch(I=String.fromCharCode(x),x){case 66:case 69:case 70:case 72:w=3;break;case 68:case 71:w=4;break;default:w=2}for(U=0;U<47;U++)O.push({k:I+U,v:w})}for(O.sort(function(R,E){return E.v-R.v}),U=0;U<O.length;U++)I=O[U].k.charAt(0),y.charAt(y.length-1)!==I&&(y+=I);return y!=="DGBEFHACIJK"}}),A=L||!f||!v||!h,p=function(y){return function(x,I){return I===void 0?-1:x===void 0?1:y!==void 0?+y(x,I)||0:k(x)>k(I)?1:-1}};W({target:"Array",proto:!0,forced:A},{sort:function(x){x!==void 0&&Z(x);var I=Y(this);if(h)return x===void 0?V(I):V(I,x);var w=[],U=et(I),R,E;for(E=0;E<U;E++)E in I&&M(w,I[E]);for(l(w,p(x)),R=et(w),E=0;E<R;)I[E]=w[E++];for(;E<U;)X(I,E++);return I}})},8291:(rt,ot,d)=>{var W=d(5613),q=d(3628),Z=d(7137),Y=d(5234),et=Y(function(){Z(1)});W({target:"Object",stat:!0,forced:et},{keys:function(k){return Z(q(k))}})}},jo={};function fe(rt){var ot=jo[rt];if(ot!==void 0)return ot.exports;var d=jo[rt]={id:rt,exports:{}};return nl[rt].call(d.exports,d,d.exports,fe),d.exports}fe.n=rt=>{var ot=rt&&rt.__esModule?()=>rt.default:()=>rt;return fe.d(ot,{a:ot}),ot};fe.d=(rt,ot)=>{for(var d in ot)fe.o(ot,d)&&!fe.o(rt,d)&&Object.defineProperty(rt,d,{enumerable:!0,get:ot[d]})};fe.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}();fe.o=(rt,ot)=>Object.prototype.hasOwnProperty.call(rt,ot);fe.r=rt=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(rt,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(rt,"__esModule",{value:!0})};var H={};(()=>{fe.d(H,{eKr:()=>Wr,yVm:()=>Xs,a7j:()=>kn,U_w:()=>fn,JF2:()=>Hr,htg:()=>bs,HXL:()=>po,mcg:()=>zr,Agj:()=>Ye,u6S:()=>ua,x7M:()=>It,X55:()=>vi,m3M:()=>qs,aE5:()=>_a,YJU:()=>ui,eZi:()=>on,GNv:()=>Ei,Y56:()=>Ts,_0v:()=>kr,vhs:()=>Ir,Z8b:()=>Un,Yfw:()=>Vt,IcQ:()=>E,Rl2:()=>vr,kgJ:()=>An,GTT:()=>Io,ypY:()=>Bs,i7d:()=>eo,fQ3:()=>va,HlI:()=>Zi,jlt:()=>xr,VQc:()=>Qe,zD7:()=>gn,I0I:()=>yr,AUF:()=>mi,JoF:()=>zi,MlA:()=>ye,PZh:()=>es,qA:()=>Ws,CrD:()=>$i,dQK:()=>fi,D3r:()=>di,Qpo:()=>fr,D9n:()=>Ri,b6v:()=>Hs,mvh:()=>ln,Bpo:()=>$t,Q1f:()=>p,IKv:()=>bo,fcV:()=>ns,Glf:()=>xo,uAl:()=>ci,ElT:()=>De,MPu:()=>co,Z8r:()=>w,QSL:()=>ho,sPV:()=>hi,nAn:()=>ts,zCU:()=>ue,QrV:()=>be,fF9:()=>Ja,xI8:()=>Or,yar:()=>Ce,SP7:()=>Co,oRy:()=>Sr,f5X:()=>go,V1c:()=>oe,Mlx:()=>Eo,ZCo:()=>Zs,Vy3:()=>_i,J5p:()=>Bo,mL_:()=>Ue,Guw:()=>Hn,VKx:()=>$r,N5j:()=>In,pgY:()=>Wn,OP3:()=>Br,rl5:()=>Do,eod:()=>ka,q5Z:()=>we,YUC:()=>Kr,saR:()=>mr,hvr:()=>yn,Qol:()=>Gn,Wf4:()=>Nn,JCs:()=>pe,gJV:()=>Ze,fWD:()=>Kn,Va_:()=>Is,N$8:()=>He,_jQ:()=>Pa,rxj:()=>Ur,rhv:()=>Gr,wCu:()=>Fe,HAp:()=>fa,Zy1:()=>so,Qev:()=>Fa,bkB:()=>k,wfL:()=>qi,sVA:()=>ot,$Gs:()=>As,CJ0:()=>Wi,NWh:()=>ni,tWi:()=>jr,xAj:()=>Nr,zWh:()=>jn,i_4:()=>Xa,iIx:()=>Y,c9e:()=>sn,KQV:()=>is,weH:()=>ce,jXp:()=>qa,zzY:()=>Er,yRQ:()=>br,MtE:()=>To,rPj:()=>nr,KLc:()=>X,Fir:()=>te,V5f:()=>ps,Xj7:()=>fs,Wud:()=>ir,FVg:()=>Pt,g5Y:()=>tt,YQB:()=>_,KPb:()=>z,nHK:()=>er,TX_:()=>Za,r3n:()=>sr,vYh:()=>it,hnk:()=>Ie,D2R:()=>xs,n1o:()=>Ao,RLG:()=>mt,fBU:()=>Tn,Adb:()=>F,bEs:()=>vt,wCy:()=>ct,CbD:()=>gt,x_C:()=>ys,pde:()=>W,pGf:()=>un,ibQ:()=>vo,QlN:()=>wr,shR:()=>tr,Yjk:()=>fo,_u1:()=>La,OBI:()=>Qo,klh:()=>ks,s3S:()=>hn,D$R:()=>Ss,xth:()=>Vi,JU7:()=>Ma,h9x:()=>to,N1A:()=>vn,e_k:()=>Ge,aHM:()=>Ji,tlv:()=>na,Vi9:()=>Jn,ieR:()=>Xn,$bb:()=>x,VyI:()=>I,imn:()=>Gs,uqu:()=>At,QnL:()=>Ut,vnc:()=>Zr,wk_:()=>rn,GH0:()=>me,_1r:()=>lo,l0X:()=>Pn,HHX:()=>Fn,tjk:()=>Di,rWe:()=>Xi,j9l:()=>xn,NVp:()=>Sn,cPK:()=>ze,XoL:()=>_o,RmF:()=>ti,DXI:()=>Tr,tCD:()=>Ra,oGn:()=>Fo,J3D:()=>Dr,vCJ:()=>uo,f9l:()=>Es,AQx:()=>Xt,v9m:()=>Pr,yRJ:()=>mo,EU6:()=>dn,m3O:()=>xi,Ryz:()=>wi,OxP:()=>Ds,LEs:()=>rr,Ec:()=>b,Pi5:()=>Qr,gmH:()=>bi,tS:()=>wn,XxX:()=>Te,bCz:()=>Os,nYS:()=>Nt,yiT:()=>ws,NHl:()=>Si,mO8:()=>c,PXI:()=>Li,bn5:()=>ms,Ywr:()=>li,cMd:()=>Lt,Bs6:()=>vs,G0k:()=>Ti,pyn:()=>j,QeM:()=>gs,aPX:()=>Ea,ITP:()=>_s,BY0:()=>ai,MFw:()=>Ys,sBn:()=>Fi,S3L:()=>Qs,XKQ:()=>Ks,ESI:()=>ro,uxz:()=>$n,o8N:()=>S,u_r:()=>Bi,RlV:()=>ki,gVA:()=>an,M_G:()=>Vs,GRB:()=>ga,kM6:()=>Dn,dO8:()=>Qn,jgM:()=>ds,FWq:()=>zt,s3j:()=>ie,hlw:()=>Ln,B7e:()=>Mn,H_X:()=>ei,S_d:()=>zn,U7E:()=>Rn,Z58:()=>Ai,yh2:()=>Ba,ff$:()=>us,cWi:()=>U,NBt:()=>nn,oNz:()=>gr,QlU:()=>yo,Xey:()=>Gi,jft:()=>el,Mtr:()=>Ae,ypk:()=>Pe,mnM:()=>R,bAZ:()=>Oi,ABN:()=>bn,VK6:()=>ra,kxk:()=>ut,DT1:()=>Qt,FLG:()=>bt,qN_:()=>pn,Z37:()=>Yi,FtL:()=>Vn,Z6X:()=>Po,iQT:()=>oi,ziO:()=>oo,OEF:()=>yi,uuE:()=>qe,tiv:()=>$s,T$Y:()=>So,EYj:()=>Js,nOB:()=>Cr,Tap:()=>ht,FAs:()=>qn,B_P:()=>Yn,aA5:()=>ma,M4G:()=>ss,l$l:()=>ko,dLy:()=>Ki,WZP:()=>Ot,eB6:()=>mn,nFK:()=>Jr,l9z:()=>io,YOF:()=>wa,yhB:()=>C,J0N:()=>q,Miz:()=>h,Bj4:()=>Xr,Rcs:()=>ke,vJ4:()=>xe,TqC:()=>Bn,nM0:()=>kt,X1u:()=>pi,SpZ:()=>js,DX8:()=>rs,Yx$:()=>cn,HK4:()=>ao,SE$:()=>O,qE8:()=>D,Pz7:()=>Lo,sX_:()=>et,JuI:()=>Q,Nl$:()=>en,OwT:()=>Oa,P$G:()=>ja,mHV:()=>Ga,Fx_:()=>Wa,WFC:()=>Ha,aDq:()=>za,jIg:()=>Ua,UH3:()=>Na,K6X:()=>Aa,C1Y:()=>En,Aw1:()=>Yr,A8$:()=>pa,hsx:()=>Ni,l9E:()=>Zn,aSf:()=>no,Zex:()=>Ro,mXP:()=>$a,vt$:()=>St,hCA:()=>pt,pjR:()=>ee,U43:()=>f,pSZ:()=>v,y17:()=>L,jVr:()=>Ka,_SZ:()=>B,xWn:()=>V,ehJ:()=>M,t6s:()=>A,Eyn:()=>rt});var rt={};fe.r(rt),fe.d(rt,{getAttributeComponentSize:()=>ii,getAttributePointerType:()=>si,getGLTypeFromSource:()=>$e,getGlTypeSizeBytes:()=>Oe,isAttributeInSource:()=>Ke});var ot={};fe.r(ot),fe.d(ot,{ActionCompleteEvent:()=>Wr,ActionStartEvent:()=>Hr,ActivateEvent:()=>zr,CollisionEndEvent:()=>Ws,CollisionPostSolveEvent:()=>fr,CollisionPreSolveEvent:()=>Ri,CollisionStartEvent:()=>Hs,ContactEndEvent:()=>hi,ContactStartEvent:()=>ue,DeactivateEvent:()=>Or,EnterTriggerEvent:()=>Ur,EnterViewPortEvent:()=>Gr,EventTypes:()=>qi,ExitTriggerEvent:()=>jr,ExitViewPortEvent:()=>Nr,GameEvent:()=>te,GameStartEvent:()=>ps,GameStopEvent:()=>fs,GamepadAxisEvent:()=>Pt,GamepadButtonEvent:()=>tt,GamepadConnectEvent:()=>_,GamepadDisconnectEvent:()=>z,HiddenEvent:()=>mt,InitializeEvent:()=>ys,KillEvent:()=>Vi,PostCollisionEvent:()=>Nt,PostDebugDrawEvent:()=>ws,PostDrawEvent:()=>Si,PostFrameEvent:()=>c,PostKillEvent:()=>Li,PostTransformDrawEvent:()=>ms,PostUpdateEvent:()=>li,PreCollisionEvent:()=>Lt,PreDebugDrawEvent:()=>vs,PreDrawEvent:()=>Ti,PreFrameEvent:()=>j,PreKillEvent:()=>gs,PreTransformDrawEvent:()=>_s,PreUpdateEvent:()=>ai,VisibleEvent:()=>kt});var d={};fe.r(d),fe.d(d,{circle:()=>la,line:()=>qr,point:()=>oa,roundRect:()=>Vr,vector:()=>aa});var W={};fe.r(W),fe.d(W,{Axes:()=>Ts,Buttons:()=>Bs,Gamepad:()=>ir,Gamepads:()=>er,KeyEvent:()=>ks,Keyboard:()=>hn,Keys:()=>Ss,NativePointerButton:()=>Di,PointerButton:()=>xi,PointerComponent:()=>wi,PointerEvent:()=>Ds,PointerEventReceiver:()=>rr,PointerScope:()=>b,PointerSystem:()=>Qr,PointerType:()=>bi,WheelDeltaMode:()=>rs,WheelEvent:()=>cn});var q={};fe.r(q),fe.d(q,{ConsoleAppender:()=>w,DrawUtil:()=>d,EasingFunctions:()=>pe,LogLevel:()=>x,Logger:()=>I,Observable:()=>ze,ScreenAppender:()=>U,addItemToArray:()=>G,contains:()=>m,delay:()=>Et,fail:()=>lt,getPosition:()=>$,omit:()=>dt,removeItemFromArray:()=>K}),fe(9493),fe(311);function Z(){if(typeof window>"u"&&(window={audioContext:function(){}}),typeof window<"u"&&!window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(n){window.setInterval(n,1e3/60)}),typeof window<"u"&&!window.cancelAnimationFrame&&(window.cancelAnimationFrame=window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(){}),typeof window<"u"&&!window.AudioContext){if(window.webkitAudioContext){const t=window.webkitAudioContext.prototype.decodeAudioData;window.webkitAudioContext.prototype.decodeAudioData=function(e){return new Promise((i,s)=>{t.call(this,e,i,s)})}}window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext}typeof window<"u"&&!window.devicePixelRatio&&(window.devicePixelRatio=window.devicePixelRatio||1)}class Y{static useCanvasGraphicsContext(){Y.enable("use-canvas-context")}static freeze(){Y._FROZEN=!0}static _reset(){Y._FROZEN=!1,Y._FLAGS={}}static enable(t){if(this._FROZEN)throw Error("Feature flags can only be enabled before Engine constructor time");Y._FLAGS[t]=!0}static disable(t){if(this._FROZEN)throw Error("Feature flags can only be disabled before Engine constructor time");Y._FLAGS[t]=!1}static isEnabled(t){return!!Y._FLAGS[t]}static show(){return Object.keys(Y._FLAGS)}}Y._FROZEN=!1,Y._FLAGS={};function et(n,t){return{type:n,value:t}}class X{constructor(){this._isCompleted=!1,this.promise=new Promise((t,e)=>{this._resolver=t,this._rejecter=e})}get isCompleted(){return this._isCompleted}resolve(t){this._isCompleted||(this._isCompleted=!0,this._resolver(t))}reject(t){this._isCompleted||(this._isCompleted=!0,this._rejecter(t))}}class k{constructor(){this._paused=!1,this._listeners={},this._listenersOnce={},this._pipes=[]}clear(){this._listeners={},this._listenersOnce={},this._pipes.length=0}on(t,e){var i;return this._listeners[t]=(i=this._listeners[t])!==null&&i!==void 0?i:[],this._listeners[t].push(e),{close:()=>this.off(t,e)}}once(t,e){var i;return this._listenersOnce[t]=(i=this._listenersOnce[t])!==null&&i!==void 0?i:[],this._listenersOnce[t].push(e),{close:()=>this.off(t,e)}}off(t,e){var i,s;if(e){const r=(i=this._listeners[t])===null||i===void 0?void 0:i.filter(a=>a!==e);this._listeners[t]=r;const o=(s=this._listenersOnce[t])===null||s===void 0?void 0:s.filter(a=>a!==e);this._listenersOnce[t]=o}else delete this._listeners[t]}emit(t,e){var i;if(this._paused)return;(i=this._listeners[t])===null||i===void 0||i.forEach(r=>r(e));const s=this._listenersOnce[t];this._listenersOnce[t]=[],s&&s.forEach(r=>r(e)),this._pipes.forEach(r=>{r.emit(t,e)})}pipe(t){if(this===t)throw Error("Cannot pipe to self");return this._pipes.push(t),{close:()=>{const e=this._pipes.indexOf(t);e>-1&&this._pipes.splice(e,1)}}}unpipe(t){const e=this._pipes.indexOf(t);e>-1&&this._pipes.splice(e,1)}pause(){this._paused=!0}unpause(){this._paused=!1}}var b;(function(n){n.Canvas="Canvas",n.Document="Document"})(b||(b={}));const l=4294967295;class S{constructor(t){this.seed=t,this._lowerMask=2147483647,this._upperMask=2147483648,this._w=32,this._n=624,this._m=397,this._a=2567483615,this._u=11,this._s=7,this._b=2636928640,this._t=15,this._c=4022730752,this._l=18,this._f=1812433253,this._mt=new Array(this._n),this._mt[0]=(t||Date.now())>>>0;for(let e=1;e<this._n;e++){const i=this._mt[e-1]^this._mt[e-1]>>>this._w-2;this._mt[e]=(this._f*((i&4294901760)>>>16)<<16)+this._f*(i&65535)+e>>>0}this._index=this._n}_twist(){const t=[0,this._a];let e=0,i=0;for(;i<this._n-this._m;i++)e=this._mt[i]&this._upperMask|this._mt[i+1]&this._lowerMask,this._mt[i]=this._mt[i+this._m]^e>>>1^t[e&1]&l;for(;i<this._n-1;i++)e=this._mt[i]&this._upperMask|this._mt[i+1]&this._lowerMask,this._mt[i]=this._mt[i+(this._m-this._n)]^e>>>1^t[e&1]&l;e=this._mt[this._n-1]&this._upperMask|this._mt[0]&this._lowerMask,this._mt[this._n-1]=this._mt[this._m-1]^e>>>1^t[e&1]&l,this._index=0}nextInt(){this._index>=this._n&&this._twist();let t=this._mt[this._index++];return t^=t>>>this._u,t^=t<<this._s&this._b,t^=t<<this._t&this._c,t^=t>>>this._l,t>>>0}next(){return this.nextInt()*(1/4294967296)}floating(t,e){return(e-t)*this.next()+t}integer(t,e){return Math.floor((e-t+1)*this.next()+t)}bool(t=.5){return this.next()<=t}pickOne(t){return t[this.integer(0,t.length-1)]}pickSet(t,e,i=!1){return i?this._pickSetWithDuplicates(t,e):this._pickSetWithoutDuplicates(t,e)}_pickSetWithoutDuplicates(t,e){if(e>t.length||e<0)throw new Error("Invalid number of elements to pick, must pick a value 0 < n <= length");if(e===t.length)return t;const i=new Array(e);let s=0;const r=t.slice(0);for(;s<e;){const o=this.integer(0,r.length-1);i[s++]=r[o],r.splice(o,1)}return i}_pickSetWithDuplicates(t,e){if(e<0)throw new Error("Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT");const i=new Array(e);for(let s=0;s<e;s++)i[s]=this.pickOne(t);return i}shuffle(t){const e=t.slice(0);let i=null;for(let s=0;s<e.length-2;s++){const r=this.integer(s,e.length-1);i=e[s],e[s]=e[r],e[r]=i}return e}range(t,e,i){const s=new Array(t);for(let r=0;r<t;r++)s[r]=this.integer(e,i);return s}d4(){return this.integer(1,4)}d6(){return this.integer(1,6)}d8(){return this.integer(1,8)}d10(){return this.integer(1,10)}d12(){return this.integer(1,12)}d20(){return this.integer(1,20)}}const C=Math.PI*2;function Q(n){return n>=0?n-Math.floor(n):n-Math.ceil(n)}function B(n){return n===0?0:n<0?-1:1}function D(n,t,e){return Math.min(Math.max(t,n),e)}function O(n){let t=n;if(n>C)for(;t>C;)t-=C;if(n<0)for(;t<0;)t+=C;return t}function V(n){return 180/Math.PI*n}function M(n){return n/180*Math.PI}const L=(n,t)=>Array.from(new Array(t-n+1),(e,i)=>i+n);function f(n,t,e=new S){return e?e.floating(n,t):n+Math.random()*(t-n)}function v(n,t,e=new S){return e?e.integer(n,t):Math.round(f(n,t))}class h{static get Zero(){return new h(0,0)}static get One(){return new h(1,1)}static get Half(){return new h(.5,.5)}static get Up(){return new h(0,-1)}static get Down(){return new h(0,1)}static get Left(){return new h(-1,0)}static get Right(){return new h(1,0)}static fromAngle(t){return new h(Math.cos(t),Math.sin(t))}static isValid(t){return!(t==null||isNaN(t.x)||isNaN(t.y)||t.x===1/0||t.y===1/0||t.x===-1/0||t.y===-1/0)}static distance(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}static min(t,e){return new h(Math.min(t.x,e.x),Math.min(t.y,e.y))}static max(t,e){return new h(Math.max(t.x,e.x),Math.max(t.y,e.y))}constructor(t,e){this._x=0,this._y=0,this._x=t,this._y=e}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}setTo(t,e){this.x=t,this.y=e}equals(t,e=h.EQUALS_EPSILON){return Math.abs(this.x-t.x)<=e&&Math.abs(this.y-t.y)<=e}distance(t){if(!t)return Math.sqrt(this.x*this.x+this.y*this.y);const e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)}squareDistance(t){t||(t=h.Zero);const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}clampMagnitude(t){const e=this.size,i=D(e,0,t);return this.size=i,this}get size(){return this.distance()}set size(t){const e=this.normalize().scale(t);this.setTo(e.x,e.y)}normalize(){const t=this.distance();return t>0?new h(this.x/t,this.y/t):new h(0,1)}average(t){return this.add(t).scale(.5)}scale(t,e){const i=e||new h(0,0);return t instanceof h?(i.x=this.x*t.x,i.y=this.y*t.y):(i.x=this.x*t,i.y=this.y*t),i}add(t,e){return e?(e.x=this.x+t.x,e.y=this.y+t.y,e):new h(this.x+t.x,this.y+t.y)}sub(t){return new h(this.x-t.x,this.y-t.y)}addEqual(t){return this.setTo(this.x+t.x,this.y+t.y),this}subEqual(t){return this.setTo(this.x-t.x,this.y-t.y),this}scaleEqual(t){return this.setTo(this.x*t,this.y*t),this}dot(t){return this.x*t.x+this.y*t.y}cross(t){if(t instanceof h)return this.x*t.y-this.y*t.x;if(typeof t=="number")return new h(t*this.y,-t*this.x)}static cross(t,e){return new h(-t*e.y,t*e.x)}perpendicular(){return new h(this.y,-this.x)}normal(){return this.perpendicular().normalize()}negate(){return this.scale(-1)}toAngle(){return Math.atan2(this.y,this.x)}rotate(t,e){e||(e=new h(0,0));const i=Math.sin(t),s=Math.cos(t),r=s*(this.x-e.x)-i*(this.y-e.y)+e.x,o=i*(this.x-e.x)+s*(this.y-e.y)+e.y;return new h(r,o)}clone(t){const e=t??new h(0,0);return e.x=this.x,e.y=this.y,e}toString(t){return t?`(${this.x.toFixed(t)}, ${this.y.toFixed(t)})`:`(${this.x}, ${this.y})`}}h.EQUALS_EPSILON=.001;function A(n,t){return new h(n,t)}class p{constructor(t,e,i,s){this.r=t,this.g=e,this.b=i,this.a=s??1}static fromRGB(t,e,i,s){return new p(t,e,i,s)}static fromRGBString(t){const e=/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)/i;let i=null;if(i=t.match(e)){const s=parseInt(i[1],10),r=parseInt(i[2],10),o=parseInt(i[3],10);let a=1;return i[4]&&(a=parseFloat(i[4])),new p(s,r,o,a)}else throw new Error("Invalid rgb/a string: "+t)}static fromHex(t){const e=/^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i;let i=null;if(i=t.match(e)){const s=parseInt(i[1],16),r=parseInt(i[2],16),o=parseInt(i[3],16);let a=1;return i[4]&&(a=parseInt(i[4],16)/255),new p(s,r,o,a)}else throw new Error("Invalid hex string: "+t)}static fromHSL(t,e,i,s=1){return new y(t,e,i,s).toRGBA()}lighten(t=.1){const e=y.fromRGBA(this.r,this.g,this.b,this.a);return e.l+=(1-e.l)*t,e.toRGBA()}darken(t=.1){const e=y.fromRGBA(this.r,this.g,this.b,this.a);return e.l-=e.l*t,e.toRGBA()}saturate(t=.1){const e=y.fromRGBA(this.r,this.g,this.b,this.a);return e.s+=e.s*t,e.toRGBA()}desaturate(t=.1){const e=y.fromRGBA(this.r,this.g,this.b,this.a);return e.s-=e.s*t,e.toRGBA()}multiply(t){const e=t.r/255*this.r/255*255,i=t.g/255*this.g/255*255,s=t.b/255*this.b/255*255,r=t.a*this.a;return new p(e,i,s,r)}screen(t){const e=t.invert(),i=t.invert();return e.multiply(i).invert()}invert(){return new p(255-this.r,255-this.g,255-this.b,1-this.a)}average(t){const e=(t.r+this.r)/2,i=(t.g+this.g)/2,s=(t.b+this.b)/2,r=(t.a+this.a)/2;return new p(e,i,s,r)}equal(t){return this.toString()===t.toString()}toString(t="rgb"){switch(t){case"rgb":return this.toRGBA();case"hsl":return this.toHSLA();case"hex":return this.toHex();default:throw new Error("Invalid Color format")}}_componentToHex(t){const e=Math.max(Math.round(t),0).toString(16);return e.length===1?"0"+e:e}toHex(){let t="#"+this._componentToHex(this.r)+this._componentToHex(this.g)+this._componentToHex(this.b);return this.a!==1&&(t+=this._componentToHex(this.a*255)),t}toRGBA(){const t=String(this.r.toFixed(0))+", "+String(this.g.toFixed(0))+", "+String(this.b.toFixed(0));return this.a!==void 0||this.a!==null?"rgba("+t+", "+String(this.a)+")":"rgb("+t+")"}toHSLA(){return y.fromRGBA(this.r,this.g,this.b,this.a).toString()}fillStyle(){return this.toString()}clone(){return new p(this.r,this.g,this.b,this.a)}static get Black(){return p.fromHex("#000000")}static get White(){return p.fromHex("#FFFFFF")}static get Gray(){return p.fromHex("#808080")}static get LightGray(){return p.fromHex("#D3D3D3")}static get DarkGray(){return p.fromHex("#A9A9A9")}static get Yellow(){return p.fromHex("#FFFF00")}static get Orange(){return p.fromHex("#FFA500")}static get Red(){return p.fromHex("#FF0000")}static get Vermilion(){return p.fromHex("#FF5B31")}static get Rose(){return p.fromHex("#FF007F")}static get Magenta(){return p.fromHex("#FF00FF")}static get Violet(){return p.fromHex("#7F00FF")}static get Blue(){return p.fromHex("#0000FF")}static get Azure(){return p.fromHex("#007FFF")}static get Cyan(){return p.fromHex("#00FFFF")}static get Viridian(){return p.fromHex("#59978F")}static get Green(){return p.fromHex("#00FF00")}static get Chartreuse(){return p.fromHex("#7FFF00")}static get Transparent(){return p.fromHex("#FFFFFF00")}static get ExcaliburBlue(){return p.fromHex("#176BAA")}}class y{constructor(t,e,i,s){this.h=t,this.s=e,this.l=i,this.a=s}static hue2rgb(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+(e-t)*6*i:i<1/2?e:i<2/3?t+(e-t)*(2/3-i)*6:t}static fromRGBA(t,e,i,s){t/=255,e/=255,i/=255;const r=Math.max(t,e,i),o=Math.min(t,e,i);let a,u;const T=(r+o)/2;if(r===o)a=u=0;else{const P=r-o;switch(u=T>.5?P/(2-r-o):P/(r+o),r){case t:a=(e-i)/P+(e<i?6:0);break;case e:a=(i-t)/P+2;break;case i:a=(t-e)/P+4;break}a/=6}return new y(a,u,T,s)}toRGBA(){let t,e,i;if(this.s===0)t=e=i=this.l;else{const s=this.l<.5?this.l*(1+this.s):this.l+this.s-this.l*this.s,r=2*this.l-s;t=y.hue2rgb(r,s,this.h+1/3),e=y.hue2rgb(r,s,this.h),i=y.hue2rgb(r,s,this.h-1/3)}return new p(t*255,e*255,i*255,this.a)}toString(){const t=this.h.toFixed(0),e=this.s.toFixed(0),i=this.l.toFixed(0),s=this.a.toFixed(0);return`hsla(${t}, ${e}, ${i}, ${s})`}}var x;(function(n){n[n.Debug=0]="Debug",n[n.Info=1]="Info",n[n.Warn=2]="Warn",n[n.Error=3]="Error",n[n.Fatal=4]="Fatal"})(x||(x={}));class I{constructor(){if(this._appenders=[],this.defaultLevel=x.Info,this._logOnceSet=new Set,I._INSTANCE)throw new Error("Logger is a singleton");return I._INSTANCE=this,I._INSTANCE.addAppender(new w),I._INSTANCE}static getInstance(){return I._INSTANCE==null&&(I._INSTANCE=new I),I._INSTANCE}addAppender(t){this._appenders.push(t)}clearAppenders(){this._appenders.length=0}_log(t,e){t==null&&(t=this.defaultLevel);const i=this._appenders.length;for(let s=0;s<i;s++)t>=this.defaultLevel&&this._appenders[s].log(t,e)}_logOnce(t,e){const i=t+e.join("+");this._logOnceSet.has(i)||(this._logOnceSet.add(i),this._log(t,e))}debug(...t){this._log(x.Debug,t)}debugOnce(...t){this._logOnce(x.Debug,t)}info(...t){this._log(x.Info,t)}infoOnce(...t){this._logOnce(x.Info,t)}warn(...t){this._log(x.Warn,t)}warnOnce(...t){this._logOnce(x.Warn,t)}error(...t){this._log(x.Error,t)}errorOnce(...t){this._logOnce(x.Error,t)}fatal(...t){this._log(x.Fatal,t)}fatalOnce(...t){this._logOnce(x.Fatal,t)}}I._INSTANCE=null;class w{log(t,e){if(!console&&!console.log&&console.warn&&console.error)return;const i=[];i.unshift.apply(i,e),i.unshift("["+x[t]+"] : "),t<x.Warn?console.log.apply?console.log.apply(console,i):console.log(i.join(" ")):t<x.Error?console.warn.apply?console.warn.apply(console,i):console.warn(i.join(" ")):console.error.apply?console.error.apply(console,i):console.error(i.join(" "))}}class U{constructor(t){var e,i;this._messages=[],this._pos=10,this._color=p.Black,this._options=t,this.canvas=document.createElement("canvas"),this._ctx=this.canvas.getContext("2d"),this.canvas.style.position="absolute",this.canvas.style.zIndex=(i=(e=t.zIndex)===null||e===void 0?void 0:e.toString())!==null&&i!==void 0?i:"99",document.body.appendChild(this.canvas),this._positionScreenAppenderCanvas(),t.engine.screen.events.on("resize",()=>{this._positionScreenAppenderCanvas()})}_positionScreenAppenderCanvas(){var t,e,i,s;const r=this._options;this.canvas.width=(t=r.width)!==null&&t!==void 0?t:r.engine.screen.resolution.width,this.canvas.height=(e=r.height)!==null&&e!==void 0?e:r.engine.screen.resolution.height,this.canvas.style.position="absolute";const o=r.engine.screen.screenToPageCoordinates(A(0,0));this.canvas.style.left=o.x+"px",this.canvas.style.top=o.y+"px",this._pos=(i=r.xPos)!==null&&i!==void 0?i:this._pos,this._color=(s=r.color)!==null&&s!==void 0?s:this._color}log(t,e){const i=e.join(",");this._ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this._messages.unshift("["+x[t]+"] : "+i);let s=10;this._messages=this._messages.slice(0,1e3);for(let r=0;r<this._messages.length;r++)this._ctx.fillStyle=this._color.toRGBA(),this._ctx.fillText(this._messages[r],this._pos,s),s+=10}}var R;(function(n){n.None="None",n.Top="Top",n.Bottom="Bottom",n.Left="Left",n.Right="Right"})(R||(R={})),function(n){function t(i){return i===n.Top?n.Bottom:i===n.Bottom?n.Top:i===n.Left?n.Right:i===n.Right?n.Left:n.None}n.getOpposite=t;function e(i){const s=[h.Left,h.Right,h.Up,h.Down],r=[n.Left,n.Right,n.Top,n.Bottom];let o=-Number.MAX_VALUE,a=-1;for(let u=0;u<s.length;u++)s[u].dot(i)>o&&(o=s[u].dot(i),a=u);return r[a]}n.fromDirection=e}(R||(R={}));class E{constructor(t=0,e=0,i=0,s=0){this._points=[],typeof t=="object"?(this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom):typeof t=="number"&&(this.left=t,this.top=e,this.right=i,this.bottom=s)}clone(){return new E(this.left,this.top,this.right,this.bottom)}static getSideFromIntersection(t){return t&&t?Math.abs(t.x)>Math.abs(t.y)?t.x<0?R.Right:R.Left:t.y<0?R.Bottom:R.Top:R.None}static fromPoints(t){let e=1/0,i=1/0,s=-1/0,r=-1/0;for(let o=0;o<t.length;o++)t[o].x<e&&(e=t[o].x),t[o].x>s&&(s=t[o].x),t[o].y<i&&(i=t[o].y),t[o].y>r&&(r=t[o].y);return new E(e,i,s,r)}static fromDimension(t,e,i=h.Half,s=h.Zero){return new E(-t*i.x+s.x,-e*i.y+s.y,t-t*i.x+s.x,e-e*i.y+s.y)}get width(){return this.right-this.left}get height(){return this.bottom-this.top}hasZeroDimensions(){return this.width===0||this.height===0}get center(){return new h((this.left+this.right)/2,(this.top+this.bottom)/2)}get topLeft(){return new h(this.left,this.top)}get bottomRight(){return new h(this.right,this.bottom)}get topRight(){return new h(this.right,this.top)}get bottomLeft(){return new h(this.left,this.bottom)}translate(t){return new E(this.left+t.x,this.top+t.y,this.right+t.x,this.bottom+t.y)}rotate(t,e=h.Zero){const i=this.getPoints().map(s=>s.rotate(t,e));return E.fromPoints(i)}scale(t,e=h.Zero){const i=this.translate(e);return new E(i.left*t.x,i.top*t.y,i.right*t.x,i.bottom*t.y)}transform(t){const e=t.data[0]*this.left,i=t.data[1]*this.left,s=t.data[0]*this.right,r=t.data[1]*this.right,o=t.data[2]*this.top,a=t.data[3]*this.top,u=t.data[2]*this.bottom,T=t.data[3]*this.bottom,P=t.getPosition(),N=Math.min(e,s)+Math.min(o,u)+P.x,J=Math.min(i,r)+Math.min(a,T)+P.y,nt=Math.max(e,s)+Math.max(o,u)+P.x,at=Math.max(i,r)+Math.max(a,T)+P.y;return new E({left:N,top:J,right:nt,bottom:at})}getPerimeter(){const t=this.width,e=this.height;return 2*(t+e)}getPoints(){return(this._left!==this.left||this._right!==this.right||this._top!==this.top||this._bottom!==this.bottom)&&(this._points.length=0,this._points.push(new h(this.left,this.top)),this._points.push(new h(this.right,this.top)),this._points.push(new h(this.right,this.bottom)),this._points.push(new h(this.left,this.bottom)),this._left=this.left,this._right=this.right,this._top=this.top,this._bottom=this.bottom),this._points}rayCast(t,e=1/0){let i=-1/0,s=1/0;const r=t.dir.x===0?Number.MAX_VALUE:1/t.dir.x,o=t.dir.y===0?Number.MAX_VALUE:1/t.dir.y,a=(this.left-t.pos.x)*r,u=(this.right-t.pos.x)*r;i=Math.min(a,u),s=Math.max(a,u);const T=(this.top-t.pos.y)*o,P=(this.bottom-t.pos.y)*o;return i=Math.max(i,Math.min(T,P)),s=Math.min(s,Math.max(T,P)),s>=Math.max(0,i)&&i<e}rayCastTime(t,e=1/0){let i=-1/0,s=1/0;const r=t.dir.x===0?Number.MAX_VALUE:1/t.dir.x,o=t.dir.y===0?Number.MAX_VALUE:1/t.dir.y,a=(this.left-t.pos.x)*r,u=(this.right-t.pos.x)*r;i=Math.min(a,u),s=Math.max(a,u);const T=(this.top-t.pos.y)*o,P=(this.bottom-t.pos.y)*o;return i=Math.max(i,Math.min(T,P)),s=Math.min(s,Math.max(T,P)),s>=Math.max(0,i)&&i<e?i:-1}contains(t){return t instanceof h?this.left<=t.x&&this.top<=t.y&&this.bottom>=t.y&&this.right>=t.x:t instanceof E?this.left<=t.left&&this.top<=t.top&&t.bottom<=this.bottom&&t.right<=this.right:!1}combine(t){return new E(Math.min(this.left,t.left),Math.min(this.top,t.top),Math.max(this.right,t.right),Math.max(this.bottom,t.bottom))}get dimensions(){return new h(this.width,this.height)}overlaps(t,e){const i=e||0;if(t.hasZeroDimensions())return this.contains(t);if(this.hasZeroDimensions())return t.contains(this);const s=this.combine(t);return s.width+i<t.width+this.width&&s.height+i<t.height+this.height}intersect(t){const e=this.combine(t);if(e.width<t.width+this.width&&e.height<t.height+this.height&&!e.dimensions.equals(t.dimensions)&&!e.dimensions.equals(this.dimensions)){let i=0;this.right>=t.left&&this.right<=t.right?i=t.left-this.right:i=t.right-this.left;let s=0;return this.top<=t.bottom&&this.top>=t.top?s=t.bottom-this.top:s=t.top-this.bottom,Math.abs(i)<Math.abs(s)?new h(i,0):new h(0,s)}else if(e.dimensions.equals(t.dimensions)||e.dimensions.equals(this.dimensions)){let i=0;this.width-t.width>=0?this.right-t.right<=t.left-this.left?i=t.left-this.right:i=t.right-this.left:t.right-this.right<=this.left-t.left?i=this.left-t.right:i=this.right-t.left;let s=0;return this.height-t.height>=0?this.bottom-t.bottom<=t.top-this.top?s=t.top-this.bottom:s=t.bottom-this.top:t.bottom-this.bottom<=this.top-t.top?s=this.top-t.bottom:s=this.bottom-t.top,Math.abs(i)<Math.abs(s)?new h(i,0):new h(0,s)}else return null}intersectWithSide(t){const e=this.intersect(t);return E.getSideFromIntersection(e)}draw(t,e=p.Yellow){t.debug.drawRect(this.left,this.top,this.width,this.height,{color:e})}}function $(n){if(n){const t=n.getBoundingClientRect();return A(t.x+window.scrollX,t.y+window.scrollY)}return h.Zero}function G(n,t){return t.indexOf(n)===-1?(t.push(n),!0):!1}function K(n,t){let e=-1;return(e=t.indexOf(n))>-1?(t.splice(e,1),!0):!1}function m(n,t){for(let e=0;e<n.length;e++)if(n[e]===t)return!0;return!1}function lt(n){throw new Error(n)}function Et(n,t){var e;const i=new X;return((e=t==null?void 0:t.schedule.bind(t))!==null&&e!==void 0?e:setTimeout)(()=>{i.resolve()},n),i.promise}function dt(n,t){const e={};for(const i in n)t.includes(i)||(e[i]=n[i]);return e}var Ut;(function(n){n[n.X=12]="X",n[n.Y=13]="Y"})(Ut||(Ut={}));class At{constructor(){this.data=new Float32Array(16),this._scaleX=1,this._scaleSignX=1,this._scaleY=1,this._scaleSignY=1}static ortho(t,e,i,s,r,o){const a=new At;return a.data[0]=2/(e-t),a.data[1]=0,a.data[2]=0,a.data[3]=0,a.data[4]=0,a.data[5]=2/(s-i),a.data[6]=0,a.data[7]=0,a.data[8]=0,a.data[9]=0,a.data[10]=-2/(o-r),a.data[11]=0,a.data[12]=-(e+t)/(e-t),a.data[13]=-(s+i)/(s-i),a.data[14]=-(o+r)/(o-r),a.data[15]=1,a}clone(t){const e=t||new At;return e.data[0]=this.data[0],e.data[1]=this.data[1],e.data[2]=this.data[2],e.data[3]=this.data[3],e.data[4]=this.data[4],e.data[5]=this.data[5],e.data[6]=this.data[6],e.data[7]=this.data[7],e.data[8]=this.data[8],e.data[9]=this.data[9],e.data[10]=this.data[10],e.data[11]=this.data[11],e.data[12]=this.data[12],e.data[13]=this.data[13],e.data[14]=this.data[14],e.data[15]=this.data[15],e}toDOMMatrix(){return new DOMMatrix([...this.data])}static fromFloat32Array(t){const e=new At;return e.data=t,e}static identity(){const t=new At;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=0,t.data[4]=0,t.data[5]=1,t.data[6]=0,t.data[7]=0,t.data[8]=0,t.data[9]=0,t.data[10]=1,t.data[11]=0,t.data[12]=0,t.data[13]=0,t.data[14]=0,t.data[15]=1,t}reset(){const t=this;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=0,t.data[4]=0,t.data[5]=1,t.data[6]=0,t.data[7]=0,t.data[8]=0,t.data[9]=0,t.data[10]=1,t.data[11]=0,t.data[12]=0,t.data[13]=0,t.data[14]=0,t.data[15]=1,t}static translation(t,e){const i=At.identity();return i.data[12]=t,i.data[13]=e,i}static scale(t,e){const i=At.identity();return i.data[0]=t,i.data[5]=e,i.data[10]=1,i.data[15]=1,i}static rotation(t){const e=At.identity();return e.data[0]=Math.cos(t),e.data[4]=-Math.sin(t),e.data[1]=Math.sin(t),e.data[5]=Math.cos(t),e}multiply(t,e){if(t instanceof h){const i=e||new h(0,0),s=t,r=s.x*this.data[0]+s.y*this.data[4]+this.data[12],o=s.x*this.data[1]+s.y*this.data[5]+this.data[13];return i.x=r,i.y=o,i}else{const i=e||new At,s=t,r=this.data[0],o=this.data[1],a=this.data[2],u=this.data[3],T=this.data[4],P=this.data[5],N=this.data[6],J=this.data[7],nt=this.data[8],at=this.data[9],xt=this.data[10],Bt=this.data[11],ft=this.data[12],_t=this.data[13],Tt=this.data[14],Ct=this.data[15],Rt=s.data[0],se=s.data[1],Dt=s.data[2],re=s.data[3],ve=s.data[4],Se=s.data[5],Ve=s.data[6],Xe=s.data[7],Je=s.data[8],We=s.data[9],Me=s.data[10],Le=s.data[11],Ht=s.data[12],os=s.data[13],as=s.data[14],ls=s.data[15];i.data[0]=r*Rt+T*se+nt*Dt+ft*re,i.data[1]=o*Rt+P*se+at*Dt+_t*re,i.data[2]=a*Rt+N*se+xt*Dt+Tt*re,i.data[3]=u*Rt+J*se+Bt*Dt+Ct*re,i.data[4]=r*ve+T*Se+nt*Ve+ft*Xe,i.data[5]=o*ve+P*Se+at*Ve+_t*Xe,i.data[6]=a*ve+N*Se+xt*Ve+Tt*Xe,i.data[7]=u*ve+J*Se+Bt*Ve+Ct*Xe,i.data[8]=r*Je+T*We+nt*Me+ft*Le,i.data[9]=o*Je+P*We+at*Me+_t*Le,i.data[10]=a*Je+N*We+xt*Me+Tt*Le,i.data[11]=u*Je+J*We+Bt*Me+Ct*Le,i.data[12]=r*Ht+T*os+nt*as+ft*ls,i.data[13]=o*Ht+P*os+at*as+_t*ls,i.data[14]=a*Ht+N*os+xt*as+Tt*ls,i.data[15]=u*Ht+J*os+Bt*as+Ct*ls;const Fs=this.getScale();return i._scaleSignX=B(Fs.x)*B(i._scaleSignX),i._scaleSignY=B(Fs.y)*B(i._scaleSignY),i}}translate(t,e){const i=this.data[0],s=this.data[1],r=this.data[2],o=this.data[3],a=this.data[4],u=this.data[5],T=this.data[6],P=this.data[7],N=this.data[8],J=this.data[9],nt=this.data[10],at=this.data[11],xt=this.data[12],Bt=this.data[13],ft=this.data[14],_t=this.data[15],Tt=0,Ct=1;return this.data[12]=i*t+a*e+N*Tt+xt*Ct,this.data[13]=s*t+u*e+J*Tt+Bt*Ct,this.data[14]=r*t+T*e+nt*Tt+ft*Ct,this.data[15]=o*t+P*e+at*Tt+_t*Ct,this}setPosition(t,e){this.data[12]=t,this.data[13]=e}getPosition(){return A(this.data[12],this.data[13])}rotate(t){const e=this.data[0],i=this.data[1],s=this.data[2],r=this.data[3],o=this.data[4],a=this.data[5],u=this.data[6],T=this.data[7],P=Math.sin(t),N=Math.cos(t);return this.data[0]=N*e+P*o,this.data[1]=N*i+P*a,this.data[2]=N*s+P*u,this.data[3]=N*r+P*T,this.data[4]=N*o-P*e,this.data[5]=N*a-P*i,this.data[6]=N*u-P*s,this.data[7]=N*T-P*r,this}scale(t,e){const i=this.data[0],s=this.data[1],r=this.data[2],o=this.data[3],a=this.data[4],u=this.data[5],T=this.data[6],P=this.data[7];return this.data[0]=i*t,this.data[1]=s*t,this.data[2]=r*t,this.data[3]=o*t,this.data[4]=a*e,this.data[5]=u*e,this.data[6]=T*e,this.data[7]=P*e,this}setRotation(t){const e=this.getScale(),i=Math.sin(t),s=Math.cos(t);this.data[0]=s*e.x,this.data[1]=i*e.y,this.data[4]=-i*e.x,this.data[5]=s*e.y}getRotation(){const t=Math.atan2(this.data[1]/this.getScaleY(),this.data[0]/this.getScaleX());return O(t)}getScaleX(){const t=A(this.data[0],this.data[4]).size;return this._scaleSignX*t}getScaleY(){const t=A(this.data[1],this.data[5]).size;return this._scaleSignY*t}getScale(){return A(this.getScaleX(),this.getScaleY())}setScaleX(t){if(this._scaleX===t)return;this._scaleSignX=B(t);const e=A(this.data[0]*this._scaleSignX,this.data[4]*this._scaleSignX).normalize();this.data[0]=e.x*t,this.data[4]=e.y*t,this._scaleX=t}setScaleY(t){if(this._scaleY===t)return;this._scaleSignY=B(t);const e=A(this.data[1]*this._scaleSignY,this.data[5]*this._scaleSignY).normalize();this.data[1]=e.x*t,this.data[5]=e.y*t,this._scaleY=t}setScale(t){this.setScaleX(t.x),this.setScaleY(t.y)}getBasisDeterminant(){return this.data[0]*this.data[5]-this.data[1]*this.data[4]}getAffineInverse(t){const i=1/this.getBasisDeterminant(),s=this.data[0],r=this.data[4],o=this.data[1],a=this.data[5],u=t||At.identity();u.data[0]=a*i,u.data[1]=-o*i,u.data[4]=-r*i,u.data[5]=s*i;const T=this.data[12],P=this.data[13];return u.data[12]=-(T*u.data[0]+P*u.data[4]),u.data[13]=-(T*u.data[1]+P*u.data[5]),u}isIdentity(){return this.data[0]===1&&this.data[1]===0&&this.data[2]===0&&this.data[3]===0&&this.data[4]===0&&this.data[5]===1&&this.data[6]===0&&this.data[7]===0&&this.data[8]===0&&this.data[9]===0&&this.data[10]===1&&this.data[11]===0&&this.data[12]===0&&this.data[13]===0&&this.data[14]===0&&this.data[15]===1}toString(){return`
[${this.data[0]} ${this.data[4]} ${this.data[8]} ${this.data[12]}]
[${this.data[1]} ${this.data[5]} ${this.data[9]} ${this.data[13]}]
[${this.data[2]} ${this.data[6]} ${this.data[10]} ${this.data[14]}]
[${this.data[3]} ${this.data[7]} ${this.data[11]} ${this.data[15]}]
`}}class It{constructor(){this.data=new Float64Array(6),this._scale=new Float64Array([1,1]),this._scaleSignX=1,this._scaleSignY=1}toDOMMatrix(){return new DOMMatrix([...this.data])}static identity(){const t=new It;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=1,t.data[4]=0,t.data[5]=0,t}static translation(t,e){const i=It.identity();return i.data[4]=t,i.data[5]=e,i}static scale(t,e){const i=It.identity();return i.data[0]=t,i.data[3]=e,i._scale[0]=t,i._scale[1]=e,i}static rotation(t){const e=It.identity();return e.data[0]=Math.cos(t),e.data[1]=Math.sin(t),e.data[2]=-Math.sin(t),e.data[3]=Math.cos(t),e}setPosition(t,e){this.data[4]=t,this.data[5]=e}getPosition(){return A(this.data[4],this.data[5])}rotate(t){const e=this.data[0],i=this.data[1],s=this.data[2],r=this.data[3],o=Math.sin(t),a=Math.cos(t);return this.data[0]=a*e+o*s,this.data[1]=a*i+o*r,this.data[2]=a*s-o*e,this.data[3]=a*r-o*i,this}translate(t,e){const i=this.data[0],s=this.data[1],r=this.data[2],o=this.data[3],a=this.data[4],u=this.data[5];return this.data[4]=i*t+r*e+a,this.data[5]=s*t+o*e+u,this}scale(t,e){const i=this.data[0],s=this.data[1],r=this.data[2],o=this.data[3];return this.data[0]=i*t,this.data[1]=s*t,this.data[2]=r*e,this.data[3]=o*e,this._scale[0]=t,this._scale[1]=e,this}determinant(){return this.data[0]*this.data[3]-this.data[1]*this.data[2]}inverse(t){const i=1/this.determinant(),s=this.data[0],r=this.data[2],o=this.data[1],a=this.data[3],u=t||It.identity();u.data[0]=a*i,u.data[1]=-o*i,u.data[2]=-r*i,u.data[3]=s*i;const T=this.data[4],P=this.data[5];return u.data[4]=-(T*u.data[0]+P*u.data[2]),u.data[5]=-(T*u.data[1]+P*u.data[3]),u}multiply(t,e){if(t instanceof h){const i=e||new h(0,0),s=t,r=s.x*this.data[0]+s.y*this.data[2]+this.data[4],o=s.x*this.data[1]+s.y*this.data[3]+this.data[5];return i.x=r,i.y=o,i}else{const i=e||new It,s=t,r=this.data[0],o=this.data[1],a=this.data[2],u=this.data[3],T=this.data[4],P=this.data[5],N=s.data[0],J=s.data[1],nt=s.data[2],at=s.data[3],xt=s.data[4],Bt=s.data[5];i.data[0]=r*N+a*J,i.data[1]=o*N+u*J,i.data[2]=r*nt+a*at,i.data[3]=o*nt+u*at,i.data[4]=r*xt+a*Bt+T,i.data[5]=o*xt+u*Bt+P;const ft=this.getScale();return i._scaleSignX=B(ft.x)*B(i._scaleSignX),i._scaleSignY=B(ft.y)*B(i._scaleSignY),i}}multiplyQuadInPlace(t){const e=t[0]*this.data[0]+t[1]*this.data[2]+this.data[4],i=t[0]*this.data[1]+t[1]*this.data[3]+this.data[5];t[0]=e,t[1]=i;const s=t[2]*this.data[0]+t[3]*this.data[2]+this.data[4],r=t[2]*this.data[1]+t[3]*this.data[3]+this.data[5];t[2]=s,t[3]=r;const o=t[4]*this.data[0]+t[5]*this.data[2]+this.data[4],a=t[4]*this.data[1]+t[5]*this.data[3]+this.data[5];t[4]=o,t[5]=a;const u=t[6]*this.data[0]+t[7]*this.data[2]+this.data[4],T=t[6]*this.data[1]+t[7]*this.data[3]+this.data[5];t[6]=u,t[7]=T}to4x4(){const t=new At;return t.data[0]=this.data[0],t.data[1]=this.data[1],t.data[2]=0,t.data[3]=0,t.data[4]=this.data[2],t.data[5]=this.data[3],t.data[6]=0,t.data[7]=0,t.data[8]=0,t.data[9]=0,t.data[10]=1,t.data[11]=0,t.data[12]=this.data[4],t.data[13]=this.data[5],t.data[14]=0,t.data[15]=1,t}setRotation(t){const e=this.getScale(),i=Math.sin(t),s=Math.cos(t);this.data[0]=s*e.x,this.data[1]=i*e.y,this.data[2]=-i*e.x,this.data[3]=s*e.y}getRotation(){const t=Math.atan2(this.data[1]/this.getScaleY(),this.data[0]/this.getScaleX());return O(t)}getScaleX(){const t=A(this.data[0],this.data[2]).distance();return this._scaleSignX*t}getScaleY(){const t=A(this.data[1],this.data[3]).distance();return this._scaleSignY*t}getScale(){return A(this.getScaleX(),this.getScaleY())}setScaleX(t){if(t===this._scale[0])return;this._scaleSignX=B(t);const e=A(this.data[0]*this._scaleSignX,this.data[2]*this._scaleSignX).normalize();this.data[0]=e.x*t,this.data[2]=e.y*t,this._scale[0]=t}setScaleY(t){if(t===this._scale[1])return;this._scaleSignY=B(t);const e=A(this.data[1]*this._scaleSignY,this.data[3]*this._scaleSignY).normalize();this.data[1]=e.x*t,this.data[3]=e.y*t,this._scale[1]=t}setScale(t){this.setScaleX(t.x),this.setScaleY(t.y)}isIdentity(){return this.data[0]===1&&this.data[1]===0&&this.data[2]===0&&this.data[3]===1&&this.data[4]===0&&this.data[5]===0}reset(){const t=this;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=1,t.data[4]=0,t.data[5]=0,t}clone(t){const e=t||new It;return e.data.set(this.data),e}toString(){return`
[${this.data[0]} ${this.data[2]} ${this.data[4]}]
[${this.data[1]} ${this.data[3]} ${this.data[5]}]
[0 0 1]
`}}class yt{constructor(){this._transforms=[],this._currentTransform=It.identity()}save(){this._transforms.push(this._currentTransform),this._currentTransform=this._currentTransform.clone()}restore(){this._currentTransform=this._transforms.pop()}translate(t,e){return this._currentTransform.translate(t,e)}rotate(t){return this._currentTransform.rotate(t)}scale(t,e){return this._currentTransform.scale(t,e)}set current(t){this._currentTransform=t}get current(){return this._currentTransform}}class wt{constructor(){this.current=this._getDefaultState(),this._states=[]}_getDefaultState(){return{opacity:1,z:0,tint:p.White,material:null}}_cloneState(){return{opacity:this.current.opacity,z:this.current.z,tint:this.current.tint.clone(),material:this.current.material}}save(){this._states.push(this.current),this.current=this._cloneState()}restore(){this.current=this._states.pop()}}const ie={Complete:"complete",Load:"load",LoadStart:"loadstart",Progress:"progress",Error:"error"};class zt{constructor(t,e,i=!1){this.path=t,this.responseType=e,this.bustCache=i,this.data=null,this.logger=I.getInstance(),this.events=new k}isLoaded(){return this.data!==null}_cacheBust(t){return/\?\w*=\w*/.test(t)?t+="&__="+Date.now():t+="?__="+Date.now(),t}load(){return new Promise((t,e)=>{if(this.data!==null){this.logger.debug("Already have data for resource",this.path),this.events.emit("complete",this.data),t(this.data);return}const i=new XMLHttpRequest;i.open("GET",this.bustCache?this._cacheBust(this.path):this.path,!0),i.responseType=this.responseType,i.addEventListener("loadstart",s=>this.events.emit("loadstart",s)),i.addEventListener("progress",s=>this.events.emit("progress",s)),i.addEventListener("error",s=>this.events.emit("error",s)),i.addEventListener("load",s=>this.events.emit("load",s)),i.addEventListener("load",()=>{if(i.status!==0&&i.status!==200){this.logger.error("Failed to load resource ",this.path," server responded with error code",i.status),this.events.emit("error",i.response),e(new Error(i.statusText));return}this.data=i.response,this.events.emit("complete",this.data),this.logger.debug("Completed loading resource",this.path),t(this.data)}),i.send()})}}function Mt(n,t){return n&&(n.__isProxy===void 0?new Proxy(n,{set:(e,i,s)=>(e[i]!==s&&(e[i]=s,typeof i=="string"&&i[0]!=="_"&&t(e)),!0),get:(e,i)=>i!=="__isProxy"?e[i]:!0}):n)}const ae=(n=[],t,e)=>({get:(i,s)=>s==="__isProxy"?!0:typeof i[s]=="object"&&i[s]!=null?new Proxy(i[s],ae([...n,s],t,e)):i[s],set:(i,s,r)=>(typeof s=="string"&&s[0]!=="_"&&t(e),i[s]=r,!0)});function st(n,t){return n&&(n.__isProxy===void 0?new Proxy(n,ae([],t,n)):n)}function g(n,t){return n&&(n.__isProxy===void 0?new Proxy(n,{set:(e,i,s)=>(e[i]=s,typeof i=="string"&&i[0]!=="_"&&t(e),!0),get:(e,i)=>i!=="__isProxy"?e[i]:!0}):n)}class it{isStale(){return this._transformStale}get flipHorizontal(){return this._flipHorizontal}set flipHorizontal(t){this._flipHorizontal=t,this._transformStale=!0}get flipVertical(){return this._flipVertical}set flipVertical(t){this._flipVertical=t,this._transformStale=!0}get rotation(){return this._rotation}set rotation(t){this._rotation=t,this._transformStale=!0}get scale(){return this._scale}set scale(t){this._scale=Mt(t,()=>{this._transformStale=!0}),this._transformStale=!0}get origin(){return this._origin}set origin(t){this._origin=Mt(t,()=>{this._transformStale=!0}),this._transformStale=!0}constructor(t){var e,i,s,r,o,a,u;this.id=it._ID++,this.transform=It.identity(),this.tint=null,this._transformStale=!0,this.showDebug=!1,this._flipHorizontal=!1,this._flipVertical=!1,this._rotation=0,this.opacity=1,this._scale=h.One,this._origin=null,this._width=0,this._height=0,t&&(this.origin=(e=t.origin)!==null&&e!==void 0?e:this.origin,this.flipHorizontal=(i=t.flipHorizontal)!==null&&i!==void 0?i:this.flipHorizontal,this.flipVertical=(s=t.flipVertical)!==null&&s!==void 0?s:this.flipVertical,this.rotation=(r=t.rotation)!==null&&r!==void 0?r:this.rotation,this.opacity=(o=t.opacity)!==null&&o!==void 0?o:this.opacity,this.scale=(a=t.scale)!==null&&a!==void 0?a:this.scale,this.tint=(u=t.tint)!==null&&u!==void 0?u:this.tint)}cloneGraphicOptions(){return{width:this.width/this.scale.x,height:this.height/this.scale.y,origin:this.origin?this.origin.clone():null,flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical,rotation:this.rotation,opacity:this.opacity,scale:this.scale?this.scale.clone():null,tint:this.tint?this.tint.clone():null}}get width(){return Math.abs(this._width*this.scale.x)}get height(){return Math.abs(this._height*this.scale.y)}set width(t){this._width=t,this._transformStale=!0}set height(t){this._height=t,this._transformStale=!0}get localBounds(){return E.fromDimension(this.width,this.height,h.Zero)}draw(t,e,i){this._preDraw(t,e,i),this._drawImage(t,0,0),this._postDraw(t)}_preDraw(t,e,i){t.save(),t.translate(e,i),this._transformStale&&(this.transform.reset(),this.transform.scale(Math.abs(this.scale.x),Math.abs(this.scale.y)),this._rotate(this.transform),this._flip(this.transform),this._transformStale=!1),t.multiply(this.transform),t.opacity=t.opacity*this.opacity,this.tint&&(t.tint=this.tint)}_rotate(t){var e;const i=this.scale.x>0?1:-1,s=this.scale.y>0?1:-1,r=(e=this.origin)!==null&&e!==void 0?e:A(this.width/2,this.height/2);t.translate(r.x,r.y),t.rotate(this.rotation),t.scale(i,s),t.translate(-r.x,-r.y)}_flip(t){this.flipHorizontal&&(t.translate(this.width/this.scale.x,0),t.scale(-1,1)),this.flipVertical&&(t.translate(0,this.height/this.scale.y),t.scale(1,-1))}_postDraw(t){this.showDebug&&t.debug.drawRect(0,0,this.width,this.height),t.restore()}}it._ID=0;class ut extends it{static from(t){return new ut({image:t})}constructor(t){var e,i;super(t),this._logger=I.getInstance(),this._dirty=!0,this.image=t.image;const{width:s,height:r}=t;this.sourceView=(e=t.sourceView)!==null&&e!==void 0?e:{x:0,y:0,width:s??0,height:r??0},this.destSize=(i=t.destSize)!==null&&i!==void 0?i:{width:s??0,height:r??0},this._updateSpriteDimensions(),this.image.ready.then(()=>{this._updateSpriteDimensions()})}get width(){return Math.abs(this.destSize.width*this.scale.x)}get height(){return Math.abs(this.destSize.height*this.scale.y)}set width(t){t/=Math.abs(this.scale.x),this.destSize.width=t,super.width=Math.ceil(this.destSize.width)}set height(t){t/=Math.abs(this.scale.y),this.destSize.height=t,super.height=Math.ceil(this.destSize.height)}_updateSpriteDimensions(){var t,e,i,s,r,o;const{width:a,height:u}=this.image;this.sourceView.width=((t=this.sourceView)===null||t===void 0?void 0:t.width)||a,this.sourceView.height=((e=this.sourceView)===null||e===void 0?void 0:e.height)||u,this.destSize.width=((i=this.destSize)===null||i===void 0?void 0:i.width)||((s=this.sourceView)===null||s===void 0?void 0:s.width)||a,this.destSize.height=((r=this.destSize)===null||r===void 0?void 0:r.height)||((o=this.sourceView)===null||o===void 0?void 0:o.height)||u,this.width=Math.ceil(this.destSize.width)*this.scale.x,this.height=Math.ceil(this.destSize.height)*this.scale.y}_preDraw(t,e,i){this.image.isLoaded()&&this._dirty&&(this._dirty=!1,this._updateSpriteDimensions()),super._preDraw(t,e,i)}_drawImage(t,e,i){this.image.isLoaded()?t.drawImage(this.image.image,this.sourceView.x,this.sourceView.y,this.sourceView.width,this.sourceView.height,e,i,this.destSize.width,this.destSize.height):this._logger.warnOnce(`ImageSource ${this.image.path} is not yet loaded and won't be drawn. Please call .load() or include in a Loader.

Read https://excaliburjs.com/docs/imagesource for more information.`)}clone(){return new ut({image:this.image,sourceView:{...this.sourceView},destSize:{...this.destSize},...this.cloneGraphicOptions()})}}var F;(function(n){n.Pixel="Pixel",n.Blended="Blended"})(F||(F={}));function St(n){switch(n){case F.Pixel:return F.Pixel;case F.Blended:return F.Blended;default:return null}}var gt;(function(n){n.Clamp="Clamp",n.Repeat="Repeat",n.Mirror="Mirror"})(gt||(gt={}));function pt(n){switch(n){case gt.Clamp:return gt.Clamp;case gt.Repeat:return gt.Repeat;case gt.Mirror:return gt.Mirror;default:return gt.Clamp}}class ht{constructor(t){this._textureMap=new Map,this._gl=t,ht._MAX_TEXTURE_SIZE=t.getParameter(t.MAX_TEXTURE_SIZE)}dispose(){for(const[t]of this._textureMap)this.delete(t);this._textureMap.clear(),this._gl=null}get(t){return this._textureMap.get(t)}has(t){return this._textureMap.has(t)}load(t,e,i=!1){const s=this._gl;if(!s)return null;const{filtering:r,wrapping:o}={...e};let a=null;if(this.has(t)&&(a=this.get(t)),a)return i&&(s.bindTexture(s.TEXTURE_2D,a),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,t)),a;a=s.createTexture(),ht.checkImageSizeSupportedAndLog(t),s.bindTexture(s.TEXTURE_2D,a),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);let u;o&&(typeof o=="string"?u={x:o,y:o}:u={x:o.x,y:o.y});const{x:T,y:P}=u??ht.wrapping;switch(T){case gt.Clamp:s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE);break;case gt.Repeat:s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT);break;case gt.Mirror:s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.MIRRORED_REPEAT);break;default:s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE)}switch(P){case gt.Clamp:s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE);break;case gt.Repeat:s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT);break;case gt.Mirror:s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.MIRRORED_REPEAT);break;default:s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE)}const N=r??ht.filtering;return s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,N===F.Pixel?s.NEAREST:s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,N===F.Pixel?s.NEAREST:s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,t),this._textureMap.set(t,a),a}delete(t){const e=this._gl;if(!e)return null;let i=null;this.has(t)&&(i=this.get(t),e.deleteTexture(i))}static checkImageSizeSupportedAndLog(t){var e;const i=(e=t.dataset.originalSrc)!==null&&e!==void 0?e:"internal canvas bitmap";return t.width>ht._MAX_TEXTURE_SIZE||t.height>ht._MAX_TEXTURE_SIZE?(ht._LOGGER.error(`The image [${i}] provided to Excalibur is too large for the device's maximum texture size of (${ht._MAX_TEXTURE_SIZE}x${ht._MAX_TEXTURE_SIZE}) please resize to an image for excalibur to render properly.

Images will likely render as black rectangles.

Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`),!1):((t.width>4096||t.height>4096)&&ht._LOGGER.warn(`The image [${i}] provided to excalibur is too large may not work on all mobile devices, it is recommended you resize images to a maximum (4096x4096).

Images will likely render as black rectangles on some mobile platforms.

Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`),!0)}}ht._LOGGER=I.getInstance(),ht.filtering=F.Blended,ht.wrapping={x:gt.Clamp,y:gt.Clamp},ht._MAX_TEXTURE_SIZE=4096;const ct={Filtering:"filtering",WrappingX:"wrapping-x",WrappingY:"wrapping-y"};class vt{get width(){return this.image.naturalWidth}get height(){return this.image.naturalHeight}isLoaded(){return this._src||(this._src=this.data.src),!!this._src}get image(){return this.data}constructor(t,e,i){this._logger=I.getInstance(),this.data=new Image,this._readyFuture=new X,this.ready=this._readyFuture.promise,this.path=t;let s=!1,r;typeof e=="boolean"?s=e:{filtering:i,wrapping:r,bustCache:s}={...e},this._resource=new zt(t,"blob",s),this.filtering=i??this.filtering,typeof r=="string"?this.wrapping={x:r,y:r}:this.wrapping=r??this.wrapping,(t.endsWith(".svg")||t.endsWith(".gif"))&&this._logger.warn(`Image type is not fully supported, you may have mixed results ${t}. Fully supported: jpg, bmp, and png`)}static fromHtmlImageElement(t,e){const i=new vt("");if(i._src="image-element",i.data=t,i.data.setAttribute("data-original-src","image-element"),e!=null&&e.filtering?i.data.setAttribute(ct.Filtering,e==null?void 0:e.filtering):i.data.setAttribute(ct.Filtering,F.Blended),e!=null&&e.wrapping){let s;typeof e.wrapping=="string"?s={x:e.wrapping,y:e.wrapping}:s={x:e.wrapping.x,y:e.wrapping.y},i.data.setAttribute(ct.WrappingX,s.x),i.data.setAttribute(ct.WrappingY,s.y)}else i.data.setAttribute(ct.WrappingX,gt.Clamp),i.data.setAttribute(ct.WrappingY,gt.Clamp);return ht.checkImageSizeSupportedAndLog(t),i._readyFuture.resolve(t),i}get bustCache(){return this._resource.bustCache}set bustCache(t){this._resource.bustCache=t}async load(){var t,e,i,s;if(this.isLoaded())return this.data;try{let r;if(this.path.includes("data:image/"))r=this.path;else{const u=await this._resource.load();r=URL.createObjectURL(u)}const o=new Image,a=new X;o.onload=()=>a.resolve(),o.src=r,o.setAttribute("data-original-src",this.path),await a.promise,this.data=o,ht.checkImageSizeSupportedAndLog(this.data)}catch(r){throw`Error loading ImageSource from path '${this.path}' with error [${r.message}]`}return this.data.setAttribute(ct.Filtering,this.filtering),this.data.setAttribute(ct.WrappingX,(e=(t=this.wrapping)===null||t===void 0?void 0:t.x)!==null&&e!==void 0?e:gt.Clamp),this.data.setAttribute(ct.WrappingY,(s=(i=this.wrapping)===null||i===void 0?void 0:i.y)!==null&&s!==void 0?s:gt.Clamp),this._readyFuture.resolve(this.data),this.data}toSprite(){return ut.from(this)}unload(){this.data=new Image}}class Qt extends it{constructor(t){super(t),this._text="",this.alphabet="",this.shadow=null,this.caseInsensitive=!1,this.spacing=0,this.lineHeight=void 0,this._logger=I.getInstance();const{alphabet:e,spriteSheet:i,caseInsensitive:s,spacing:r,shadow:o,lineHeight:a}=t;this.alphabet=e,this.spriteSheet=i,this.caseInsensitive=s??this.caseInsensitive,this.spacing=r??this.spacing,this.shadow=o??this.shadow,this.lineHeight=a??this.lineHeight}_getCharacterSprites(t){const e=[],i=this.caseInsensitive?t.toLocaleLowerCase():t,s=this.caseInsensitive?this.alphabet.toLocaleLowerCase():this.alphabet;for(let r=0;r<i.length;r++){const o=i[r];let a=s.indexOf(o);a===-1&&(a=0,this._logger.warnOnce(`SpriteFont - Cannot find letter '${o}' in configured alphabet '${s}'.`),this._logger.warnOnce("There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged."));const u=this.spriteSheet.sprites[a];u?e.push(u):(this._logger.warnOnce(`SpriteFont - Cannot find sprite for '${o}' at index '${a}' in configured SpriteSheet`),this._logger.warnOnce("There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged."))}return e}measureText(t,e){const i=this._getLinesFromText(t,e),s=i.reduce((u,T)=>u.length>T.length?u:T),r=this._getCharacterSprites(s);let o=0,a=0;for(const u of r)o+=u.width+this.spacing,a=Math.max(a,u.height);return E.fromDimension(o,a*i.length,h.Zero)}_drawImage(t,e,i,s){var r;let o=0,a=0,u=0;const T=this._getLinesFromText(this._text,s);for(const P of T){for(const N of this._getCharacterSprites(P))N.draw(t,e+o,i+a),o+=N.width+this.spacing,u=Math.max(u,N.height);o=0,a+=(r=this.lineHeight)!==null&&r!==void 0?r:u}}render(t,e,i,s,r,o){this._text=e;const a=this.measureText(e,o);this.width=a.width,this.height=a.height,this.shadow&&(t.save(),t.translate(this.shadow.offset.x,this.shadow.offset.y),this._preDraw(t,s,r),this._drawImage(t,0,0,o),this._postDraw(t),t.restore()),this._preDraw(t,s,r),this._drawImage(t,0,0,o),this._postDraw(t)}clone(){return new Qt({alphabet:this.alphabet,spriteSheet:this.spriteSheet,spacing:this.spacing})}_getLinesFromText(t,e){if(this._cachedText===t&&this._cachedRenderWidth===e)return this._cachedLines;const i=t.split(`
`);if(e==null)return i;for(let s=0;s<i.length;s++){let r=i[s],o="";if(this.measureText(r).width>e){for(;this.measureText(r).width>e;)o=r[r.length-1]+o,r=r.slice(0,-1);i[s]=r,i[s+1]=o}}return this._cachedText=t,this._cachedLines=i,this._cachedRenderWidth=e,i}}class bt{constructor(t){this.sprites=[];const{sprites:e,rows:i,columns:s}=t;this.sprites=e,this.rows=i??1,this.columns=s??this.sprites.length}getSprite(t,e,i){var s,r,o,a,u,T,P,N,J;if(t>=this.columns||t<0)throw Error(`No sprite exists in the SpriteSheet at (${t}, ${e}), x: ${t} should be between 0 and ${this.columns-1}`);if(e>=this.rows||e<0)throw Error(`No sprite exists in the SpriteSheet at (${t}, ${e}), y: ${e} should be between 0 and ${this.rows-1}`);const nt=t+e*this.columns,at=this.sprites[nt];if(at){if(i){const xt=at.clone();return xt.flipHorizontal=(s=i.flipHorizontal)!==null&&s!==void 0?s:xt.flipHorizontal,xt.flipVertical=(r=i.flipVertical)!==null&&r!==void 0?r:xt.flipVertical,xt.width=(o=i.width)!==null&&o!==void 0?o:xt.width,xt.height=(a=i.height)!==null&&a!==void 0?a:xt.height,xt.rotation=(u=i.rotation)!==null&&u!==void 0?u:xt.rotation,xt.scale=(T=i.scale)!==null&&T!==void 0?T:xt.scale,xt.opacity=(P=i.opacity)!==null&&P!==void 0?P:xt.opacity,xt.tint=(N=i.tint)!==null&&N!==void 0?N:xt.tint,xt.origin=(J=i.origin)!==null&&J!==void 0?J:xt.origin,xt}return at}throw Error(`Invalid sprite coordinates (${t}, ${e}`)}static fromImageSourceWithSourceViews(t){const e=t.sourceViews.map(i=>new ut({image:t.image,sourceView:i}));return new bt({sprites:e})}static fromImageSource(t){var e;const i=[];t.spacing=(e=t.spacing)!==null&&e!==void 0?e:{};const{image:s,grid:{rows:r,columns:o,spriteWidth:a,spriteHeight:u},spacing:{originOffset:T,margin:P}}=t,N={x:0,y:0,...T},J={x:0,y:0,...P};for(let nt=0;nt<o;nt++)for(let at=0;at<r;at++)i[nt+at*o]=new ut({image:s,sourceView:{x:nt*a+J.x*nt+N.x,y:at*u+J.y*at+N.y,width:a,height:u},destSize:{height:u,width:a}});return new bt({sprites:i,rows:r,columns:o})}clone(){return new bt({sprites:this.sprites.map(t=>t.clone()),rows:this.rows,columns:this.columns})}}const Gt="data:image/png;base64,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";class oe{constructor(){this.fontSheet=Gt,this.size=16,this.load()}load(){return this._imageSource=new vt(this.fontSheet),this._imageSource.load().then(()=>{this._spriteSheet=bt.fromImageSource({image:this._imageSource,grid:{rows:4,columns:16,spriteWidth:16,spriteHeight:16}}),this._spriteFont=new Qt({alphabet:`0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ,!'&."?-()+# `,caseInsensitive:!0,spriteSheet:this._spriteSheet,spacing:-6})})}write(t,e,i){this._imageSource.isLoaded()&&this._spriteFont.render(t,e,null,i.x,i.y)}}class jt{constructor(t,e){this._gl=t,this._texture=e}use(){const t=this._gl;t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this._texture)}disable(){const t=this._gl;t.bindTexture(t.TEXTURE_2D,null)}}class le{constructor(t){var e,i;this.antialias=!1,this.samples=1,this._gl=t.gl,this.width=t.width,this.height=t.height,this.transparency=t.transparency,this.antialias=(e=t.antialias)!==null&&e!==void 0?e:this.antialias,this.samples=(i=t.samples)!==null&&i!==void 0?i:this._gl.getParameter(this._gl.MAX_SAMPLES);const s=this._gl;s.drawingBufferFormat?this.bufferFormat=s.drawingBufferFormat:this.transparency?this.bufferFormat=s.RGBA8:this.bufferFormat=s.RGB8,this._setupRenderBuffer(),this._setupFramebuffer()}setResolution(t,e){const i=this._gl;this.width=t,this.height=e,i.bindTexture(i.TEXTURE_2D,this._frameTexture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,this.width,this.height,0,i.RGBA,i.UNSIGNED_BYTE,null),this._renderBuffer&&(i.bindRenderbuffer(i.RENDERBUFFER,this._renderBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,Math.min(this.samples,i.getParameter(i.MAX_SAMPLES)),this.bufferFormat,this.width,this.height))}get renderBuffer(){return this._renderBuffer}get renderFrameBuffer(){return this._renderFrameBuffer}get frameBuffer(){return this._frameBuffer}get frameTexture(){return this._frameTexture}_setupRenderBuffer(){if(this.antialias){const t=this._gl;this._renderBuffer=t.createRenderbuffer(),this._renderFrameBuffer=t.createFramebuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this._renderBuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,Math.min(this.samples,t.getParameter(t.MAX_SAMPLES)),this.bufferFormat,this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,this._renderFrameBuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,this._renderBuffer)}}_setupFramebuffer(){const t=this._gl;this._frameTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this._frameTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const e=t.COLOR_ATTACHMENT0;this._frameBuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,e,t.TEXTURE_2D,this._frameTexture,0),this.disable()}toRenderSource(){return this.renderBuffer&&this.blitRenderBufferToFrameBuffer(),new jt(this._gl,this._frameTexture)}blitToScreen(){const t=this._gl;this._renderBuffer?(t.bindFramebuffer(t.READ_FRAMEBUFFER,this.renderFrameBuffer),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.clearBufferfv(t.COLOR,0,[0,0,1,1]),t.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,t.COLOR_BUFFER_BIT,t.LINEAR)):(t.bindFramebuffer(t.READ_FRAMEBUFFER,this.frameBuffer),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.clearBufferfv(t.COLOR,0,[0,0,1,1]),t.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,t.COLOR_BUFFER_BIT,t.LINEAR))}blitRenderBufferToFrameBuffer(){if(this._renderBuffer){const t=this._gl;t.bindFramebuffer(t.READ_FRAMEBUFFER,this.renderFrameBuffer),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.frameBuffer),t.clearBufferfv(t.COLOR,0,[0,0,1,1]),t.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,t.COLOR_BUFFER_BIT,t.LINEAR)}}copyToTexture(t){const e=this._gl;this._renderBuffer&&this.blitRenderBufferToFrameBuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this._frameBuffer),e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,this.width,this.height,0)}use(){const t=this._gl;this.antialias?t.bindFramebuffer(t.FRAMEBUFFER,this._renderFrameBuffer):t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),t.viewport(0,0,this.width,this.height)}disable(){const t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null)}}const _e=`#version 300 es\r
in vec2 a_position;\r
in vec4 a_color;\r
\r
out lowp vec4 v_color;\r
\r
uniform mat4 u_matrix;\r
\r
void main() {\r
   // Set the vertex position using the ortho transform matrix\r
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\r
\r
   // Passthrough the color\r
   v_color = a_color;\r
}`,de=`#version 300 es\r
precision mediump float;\r
\r
// Color\r
in lowp vec4 v_color;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
  fragColor = v_color;\r
}`;function Oe(n,t){switch(t){case n.FLOAT:return 4;case n.SHORT:return 2;case n.UNSIGNED_SHORT:return 2;case n.BYTE:return 1;case n.UNSIGNED_BYTE:return 1;default:return 1}}function Ke(n,t){const e=`(?<type>[a-z0-9]+)\\s+${t};`,s=new RegExp(e,"g").exec(n);return(s==null?void 0:s.length)>0}function $e(n,t,e){var i;const s=`(?<type>[a-z0-9]+)\\s+${e};`,o=new RegExp(s,"g").exec(t);switch((i=o==null?void 0:o.groups)===null||i===void 0?void 0:i.type){case"float":case"vec2":case"vec3":case"vec4":return n.FLOAT;case"int":case"ivec2":case"ivec3":case"ivec4":return n.INT;case"uint":case"uvec2":case"uvec3":case"uvec4":return n.UNSIGNED_INT;case"bool":case"bvec2":case"bvec3":case"bvec4":return n.BOOL;case"short":return n.SHORT;case"ushort":return n.UNSIGNED_SHORT;case"ubyte":return n.UNSIGNED_BYTE;case"byte":return n.BYTE;default:return n.FLOAT}}function ii(n,t){switch(t){case n.LOW_FLOAT:case n.HIGH_FLOAT:case n.FLOAT:return 1;case n.FLOAT_VEC2:return 2;case n.FLOAT_VEC3:return 3;case n.FLOAT_VEC4:return 4;case n.BYTE:return 1;case n.UNSIGNED_BYTE:return 1;case n.UNSIGNED_SHORT:case n.SHORT:return 1;default:return 1}}function si(n,t){switch(t){case n.LOW_FLOAT:case n.HIGH_FLOAT:case n.FLOAT:case n.FLOAT_VEC2:case n.FLOAT_VEC3:case n.FLOAT_VEC4:return n.FLOAT;case n.BYTE:return n.BYTE;case n.UNSIGNED_BYTE:return n.UNSIGNED_BYTE;case n.SHORT:return n.SHORT;case n.UNSIGNED_SHORT:return n.UNSIGNED_SHORT;default:return n.FLOAT}}class Ae{get compiled(){return this._compiled}constructor(t){this._logger=I.getInstance(),this.uniforms={},this.attributes={},this._compiled=!1;const{gl:e,vertexSource:i,fragmentSource:s}=t;this._gl=e,this.vertexSource=i,this.fragmentSource=s}dispose(){this._gl.deleteProgram(this.program),this._gl=null}use(){this._gl.useProgram(this.program),Ae._ACTIVE_SHADER_INSTANCE=this}isCurrentlyBound(){return Ae._ACTIVE_SHADER_INSTANCE===this}compile(){const t=this._gl,e=this._compileShader(t,this.vertexSource,t.VERTEX_SHADER),i=this._compileShader(t,this.fragmentSource,t.FRAGMENT_SHADER);this.program=this._createProgram(t,e,i);const s=this.getAttributes();for(const o of s)this.attributes[o.name]=o;const r=this.getUniforms();for(const o of r)this.uniforms[o.name]=o;return this._compiled=!0,this.program}getUniforms(){const t=this._gl,e=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS),i=[];for(let s=0;s<e;s++){const r=t.getActiveUniform(this.program,s),o=t.getUniformLocation(this.program,r.name);i.push({name:r.name,glType:r.type,location:o})}return i}getAttributes(){const t=this._gl,e=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES),i=[];for(let s=0;s<e;s++){const r=t.getActiveAttrib(this.program,s),o=t.getAttribLocation(this.program,r.name);i.push({name:r.name,glType:si(t,r.type),size:ii(t,r.type),location:o,normalized:!1})}return i}setTexture(t,e){const i=this._gl;i.activeTexture(i.TEXTURE0+t),i.bindTexture(i.TEXTURE_2D,e)}setUniformInt(t,e){this.setUniform("uniform1i",t,~~e)}trySetUniformInt(t,e){return this.trySetUniform("uniform1i",t,~~e)}setUniformIntArray(t,e){this.setUniform("uniform1iv",t,e)}trySetUniformIntArray(t,e){return this.trySetUniform("uniform1iv",t,e)}setUniformBoolean(t,e){this.setUniform("uniform1i",t,e?1:0)}trySetUniformBoolean(t,e){return this.trySetUniform("uniform1i",t,e?1:0)}setUniformFloat(t,e){this.setUniform("uniform1f",t,e)}trySetUniformFloat(t,e){return this.trySetUniform("uniform1f",t,e)}setUniformFloatArray(t,e){this.setUniform("uniform1fv",t,e)}trySetUniformFloatArray(t,e){return this.trySetUniform("uniform1fv",t,e)}setUniformFloatVector(t,e){this.setUniform("uniform2f",t,e.x,e.y)}trySetUniformFloatVector(t,e){return this.trySetUniform("uniform2f",t,e.x,e.y)}setUniformFloatColor(t,e){this.setUniform("uniform4f",t,e.r/255,e.g/255,e.b/255,e.a)}trySetUniformFloatColor(t,e){return this.trySetUniform("uniform4f",t,e.r/255,e.g/255,e.b/255,e.a)}setUniformMatrix(t,e){this.setUniform("uniformMatrix4fv",t,!1,e.data)}trySetUniformMatrix(t,e){return this.trySetUniform("uniformMatrix4fv",t,!1,e.data)}setUniform(t,e,...i){if(!this._compiled)throw Error(`Must compile shader before setting a uniform ${t}:${e}`);if(!this.isCurrentlyBound())throw Error("Currently accessed shader instance is not the current active shader in WebGL, must call `shader.use()` before setting uniforms");const r=this._gl.getUniformLocation(this.program,e);if(r){const o=[r,...i];this._gl[t].apply(this._gl,o)}else throw Error(`Uniform ${t}:${e} doesn't exist or is not used in the shader source code, unused uniforms are optimized away by most browsers`)}trySetUniform(t,e,...i){if(!this._compiled)return this._logger.warn(`Must compile shader before setting a uniform ${t}:${e}`),!1;if(!this.isCurrentlyBound())return this._logger.warn("Currently accessed shader instance is not the current active shader in WebGL, must call `shader.use()` before setting uniforms"),!1;const r=this._gl.getUniformLocation(this.program,e);if(r){const o=[r,...i];this._gl[t].apply(this._gl,o)}else return!1;return!0}_createProgram(t,e,i){const s=t.createProgram();if(s===null)throw Error("Could not create graphics shader program");if(t.attachShader(s,e),t.attachShader(s,i),t.linkProgram(s),!t.getProgramParameter(s,t.LINK_STATUS))throw Error(`Could not link the program: [${t.getProgramInfoLog(s)}]`);return s}_compileShader(t,e,i){const s=t.VERTEX_SHADER===i?"vertex":"fragment",r=t.createShader(i);if(r===null)throw Error(`Could not build shader: [${e}]`);if(t.shaderSource(r,e),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS)){const a=t.getShaderInfoLog(r);throw Error(`Could not compile ${s} shader:

${a}${this._processSourceForError(e,a)}`)}return r}_processSourceForError(t,e){if(!t)return e;const i=t.split(`
`),s=e.search(/\d:\d/),r=e.indexOf(" ",s),[o,a]=e.slice(s,r).split(":").map(u=>Number(u));for(let u=0;u<i.length;u++)i[u]=`${u+1}: ${i[u]}${a===u+1?" <----- ERROR!":""}`;return`

Source:
`+i.join(`
`)}}Ae._ACTIVE_SHADER_INSTANCE=null;class ke{constructor(t){this.type="dynamic";const{gl:e,size:i,type:s,data:r}=t;if(this._gl=e,this.buffer=this._gl.createBuffer(),!r&&!i)throw Error("Must either provide data or a size to the VertexBuffer");r?this.bufferData=r:this.bufferData=new Float32Array(i),this.type=s??this.type,e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,this.bufferData,this.type==="static"?e.STATIC_DRAW:e.DYNAMIC_DRAW)}bind(){const t=this._gl;t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}unbind(){const t=this._gl;t.bindBuffer(t.ARRAY_BUFFER,null)}upload(t){const e=this._gl;e.bindBuffer(e.ARRAY_BUFFER,this.buffer),t?e.bufferSubData(e.ARRAY_BUFFER,0,this.bufferData,0,t):e.bufferData(e.ARRAY_BUFFER,this.bufferData,this.type==="static"?e.STATIC_DRAW:e.DYNAMIC_DRAW)}dispose(){this._gl.deleteBuffer(this.buffer),this._gl=null}}class xe{get vertexBuffer(){return this._vertexBuffer}get attributes(){return this._attributes}constructor(t){this._logger=I.getInstance(),this._suppressWarnings=!1,this._layout=[],this._attributes=[],this._vertexTotalSizeBytes=0,this._initialized=!1;const{gl:e,shader:i,vertexBuffer:s,attributes:r,suppressWarnings:o}=t;this._gl=e,this._vertexBuffer=s,this._attributes=r,this._shader=i,this._suppressWarnings=o,i&&this.initialize()}get totalVertexSizeBytes(){return this._vertexTotalSizeBytes}set shader(t){t&&this._shader!==t&&(this._shader=t,this.initialize())}get shader(){return this._shader}initialize(){if(this._initialized||!this._shader)return;if(!this._shader.compiled)throw Error("Shader not compiled, shader must be compiled before defining a vertex layout");this._vertexTotalSizeBytes=0,this._layout.length=0;const t=this._shader.attributes;for(const r of this._attributes){const o=t[r[0]];if(!o){if(!Ke(this._shader.vertexSource,r[0]))throw Error(`The attribute named: ${r[0]} size ${r[1]} not found in the shader source code:
 ${this._shader.vertexSource}`);this._suppressWarnings||this._logger.warn(`The attribute named: ${r[0]} size ${r[1]} not found in the compiled shader. This is possibly a bug:
 1. Not a bug, but should remove unused code - attribute "${r[0]}" is unused in vertex/fragment and has been automatically removed by glsl compiler.
 2. Definitely a bug, attribute "${r[0]}" in layout has been mistyped or is missing in shader, check vertex/fragment source.`);const a=$e(this._gl,this._shader.vertexSource,r[0]);this._layout.push({name:r[0],glType:a,size:r[1],location:-1,normalized:!1})}if(o){if(o.size!==r[1])throw Error(`VertexLayout size definition for attribute: [${r[0]}, ${r[1]}], doesn't match shader source size ${o.size}:
 ${this._shader.vertexSource}`);this._layout.push(o)}}let e=0;for(const r of this._layout){const o=Oe(this._gl,r.glType);this._vertexTotalSizeBytes+=o*r.size,e+=r.size}this._vertexBuffer.bufferData.length%e!==0&&this._logger.warn(`The vertex component size (${e})  does NOT divide evenly into the specified vertex buffer (${this._vertexBuffer.bufferData.length})`);const i=this._gl;this._vao=i.createVertexArray(),i.bindVertexArray(this._vao),this._vertexBuffer.bind();let s=0;for(const r of this._layout)r.location!==-1&&(i.vertexAttribPointer(r.location,r.size,r.glType,r.normalized,this.totalVertexSizeBytes,s),i.enableVertexAttribArray(r.location)),s+=Oe(i,r.glType)*r.size;i.bindVertexArray(null),this._vertexBuffer.unbind(),this._initialized=!0}use(t=!1,e){if(!this._shader)throw Error("No shader is associated with this vertex layout, a shader must be set");const i=this._gl;if(!this._shader.isCurrentlyBound())throw Error("Shader associated with this vertex layout is not active! Call shader.use() before layout.use()");this._vertexBuffer.bind(),t&&this._vertexBuffer.upload(e),i.bindVertexArray(this._vao)}}class he{static clear(){he.DrawCallCount=0,he.DrawnImagesCount=0}}he.DrawCallCount=0,he.DrawnImagesCount=0;class Ii{constructor(){this.type="ex.line",this.priority=0,this._maxLines=10922,this._vertexIndex=0,this._lineCount=0}initialize(t,e){this._gl=t,this._context=e,this._shader=new Ae({gl:t,vertexSource:_e,fragmentSource:de}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._vertexBuffer=new ke({gl:t,size:6*2*this._maxLines,type:"dynamic"}),this._layout=new xe({gl:t,vertexBuffer:this._vertexBuffer,shader:this._shader,attributes:[["a_position",2],["a_color",4]]})}dispose(){this._vertexBuffer.dispose(),this._shader.dispose(),this._context=null,this._gl=null}draw(t,e,i){this._isFull()&&this.flush(),this._lineCount++;const s=this._context.getTransform(),r=s.multiply(t),o=s.multiply(e),a=this._vertexBuffer.bufferData;a[this._vertexIndex++]=r.x,a[this._vertexIndex++]=r.y,a[this._vertexIndex++]=i.r/255,a[this._vertexIndex++]=i.g/255,a[this._vertexIndex++]=i.b/255,a[this._vertexIndex++]=i.a,a[this._vertexIndex++]=o.x,a[this._vertexIndex++]=o.y,a[this._vertexIndex++]=i.r/255,a[this._vertexIndex++]=i.g/255,a[this._vertexIndex++]=i.b/255,a[this._vertexIndex++]=i.a}_isFull(){return this._lineCount>=this._maxLines}hasPendingDraws(){return this._lineCount!==0}flush(){if(this._lineCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),t.drawArrays(t.LINES,0,this._lineCount*2),he.DrawnImagesCount+=this._lineCount,he.DrawCallCount++,this._vertexIndex=0,this._lineCount=0}}const Ne=`#version 300 es\r
in vec2 a_position;\r
in vec4 a_color;\r
in float a_size;\r
out lowp vec4 v_color;\r
uniform mat4 u_matrix;\r
\r
void main() {\r
  gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\r
  gl_PointSize = a_size * 2.0;\r
  v_color = a_color;\r
}`,ri=`#version 300 es\r
\r
precision mediump float;\r
in lowp vec4 v_color;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
  float r = 0.0, delta = 0.0, alpha = 1.0;\r
  vec2 cxy = 2.0 * gl_PointCoord - 1.0;\r
  r = dot(cxy, cxy);\r
\r
  delta = fwidth(r);\r
  alpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\r
  // "premultiply" the color by alpha\r
  vec4 color = v_color;\r
  color.a = color.a * alpha;\r
  color.rgb = color.rgb * color.a;\r
  fragColor = color;\r
}`;class gi{constructor(){this.type="ex.point",this.priority=0,this._maxPoints=10922,this._pointCount=0,this._vertexIndex=0}initialize(t,e){this._gl=t,this._context=e,this._shader=new Ae({gl:t,vertexSource:Ne,fragmentSource:ri}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._buffer=new ke({gl:t,size:7*this._maxPoints,type:"dynamic"}),this._layout=new xe({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_color",4],["a_size",1]]})}dispose(){this._buffer.dispose(),this._shader.dispose(),this._context=null,this._gl=null}draw(t,e,i){this._isFull()&&this.flush(),this._pointCount++;const s=this._context.getTransform(),r=this._context.opacity,o=this._context.snapToPixel,a=s.multiply(t);o&&(a.x=~~(a.x+ee),a.y=~~(a.y+ee));const u=this._buffer.bufferData;u[this._vertexIndex++]=a.x,u[this._vertexIndex++]=a.y,u[this._vertexIndex++]=e.r/255,u[this._vertexIndex++]=e.g/255,u[this._vertexIndex++]=e.b/255,u[this._vertexIndex++]=e.a*r,u[this._vertexIndex++]=i*Math.max(s.getScaleX(),s.getScaleY())}_isFull(){return this._pointCount>=this._maxPoints}hasPendingDraws(){return this._pointCount!==0}flush(){if(this._pointCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),t.drawArrays(t.POINTS,0,this._pointCount),he.DrawnImagesCount+=this._pointCount,he.DrawCallCount++,this._pointCount=0,this._vertexIndex=0}}const Pi=`#version 300 es\r
in vec2 a_position;\r
\r
in vec2 a_texcoord;\r
out vec2 v_texcoord;\r
\r
void main() {\r
  gl_Position = vec4(a_position, 0.0, 1.0);\r
\r
  // Pass the texcoord to the fragment shader.\r
  v_texcoord = a_texcoord;\r
}`,Ui=`#version 300 es\r
precision mediump float;\r
\r
// Passed in from the vertex shader.\r
in vec2 v_texcoord;\r
\r
// The texture.\r
uniform sampler2D u_texture;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
   fragColor = texture(u_texture, v_texcoord);\r
}`;class ji{constructor(t){this._gl=t,this._shader=new Ae({gl:t,vertexSource:Pi,fragmentSource:Ui}),this._shader.compile(),this._buffer=new ke({gl:t,type:"static",data:new Float32Array([-1,-1,0,0,-1,1,0,1,1,-1,1,0,1,-1,1,0,-1,1,0,1,1,1,1,1])}),this._layout=new xe({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_texcoord",2]]}),this._buffer.upload()}renderWithPostProcessor(t){const e=this._gl;t.getShader().use(),t.getLayout().use(),e.drawArrays(e.TRIANGLES,0,6)}renderToScreen(){const t=this._gl;this._shader.use(),this._layout.use(),t.drawArrays(t.TRIANGLES,0,6)}}class Fi{constructor(t,e,i){this._logger=I.getInstance(),this._gl=t,this.buffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer);const s=e*6;if(!i)this.bufferData=new Uint32Array(s);else{const a=Math.floor(16383.5);this.bufferGlType=t.UNSIGNED_SHORT,this.bufferData=new Uint16Array(s),e>a&&this._logger.warn(`Total quads exceeds hardware index buffer limit (uint16), max(${a}) requested quads(${e})`)}let r=0;for(let o=0;o<s;o+=6)this.bufferData[o+0]=r+0,this.bufferData[o+1]=r+1,this.bufferData[o+2]=r+2,this.bufferData[o+3]=r+2,this.bufferData[o+4]=r+1,this.bufferData[o+5]=r+3,r+=4;t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.bufferData,t.STATIC_DRAW)}get size(){return this.bufferData.length}upload(){const t=this._gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.bufferData,t.STATIC_DRAW)}bind(){const t=this._gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer)}dispose(){this._gl.deleteBuffer(this.buffer),this._gl=null}}const Ms=`#version 300 es\r
precision mediump float;\r
\r
// UV coord\r
in vec2 v_texcoord;\r
\r
// Texture index\r
in lowp float v_textureIndex;\r
\r
// Textures in the current draw\r
uniform sampler2D u_textures[%%count%%];\r
\r
uniform bool u_pixelart;\r
\r
// Opacity\r
in float v_opacity;\r
\r
in vec4 v_tint;\r
\r
in vec2 v_res;\r
\r
out vec4 fragColor;\r
\r
// Inigo Quilez pixel art filter https://jorenjoestar.github.io/post/pixel_art_filtering/\r
vec2 uv_iq(in vec2 uv, in vec2 texture_size) {\r
  vec2 pixel = uv * texture_size;\r
  \r
  vec2 seam=floor(pixel+.5);\r
  vec2 dudv=fwidth(pixel);\r
  pixel=seam+clamp((pixel-seam)/dudv,-.5,.5);\r
  \r
  return pixel/texture_size;\r
}\r
\r
void main(){\r
  // In order to support the most efficient sprite batching, we have multiple\r
  // textures loaded into the gpu (usually 8) this picker logic skips over textures\r
  // that do not apply to a particular sprite.\r
  \r
  vec4 color=vec4(1.,0,0,1.);\r
  \r
  // GLSL is templated out to pick the right texture and set the vec4 color\r
  %%texture_picker%%\r
  \r
  color.rgb=color.rgb*v_opacity;\r
  color.a=color.a*v_opacity;\r
  fragColor=color*v_tint;\r
}`,Mi=`#version 300 es\r
in vec2 a_position;\r
\r
// Opacity\r
in float a_opacity;\r
out float v_opacity;\r
\r
// UV coordinate\r
in vec2 a_texcoord;\r
out vec2 v_texcoord;\r
\r
// Texture res\r
in vec2 a_res;\r
out vec2 v_res;\r
\r
// Texture number\r
in lowp float a_textureIndex;\r
out lowp float v_textureIndex;\r
\r
in vec4 a_tint;\r
out vec4 v_tint;\r
\r
uniform mat4 u_matrix;\r
\r
void main(){\r
  // Set the vertex position using the ortho transform matrix\r
  gl_Position=u_matrix*vec4(a_position,0.,1.);\r
  \r
  // Pass through the Opacity to the fragment shader\r
  v_opacity=a_opacity;\r
  // Pass through the UV coord to the fragment shader\r
  v_texcoord=a_texcoord;\r
\r
  v_res = a_res;\r
\r
  // Pass through the texture number to the fragment shader\r
  v_textureIndex=a_textureIndex;\r
  // Pass through the tint\r
  v_tint=a_tint;\r
}`;class Hi{constructor(t){this.type="ex.image",this.priority=0,this._maxImages=10922,this._maxTextures=0,this._imageCount=0,this._textures=[],this._textureIndex=0,this._textureToIndex=new Map,this._images=new Set,this._vertexIndex=0,this._imageToWidth=new Map,this._imageToHeight=new Map,this._view=[0,0,0,0],this._dest=[0,0],this._quad=[0,0,0,0,0,0,0,0],this.pixelArtSampler=t.pixelArtSampler,this.uvPadding=t.uvPadding}initialize(t,e){this._gl=t,this._context=e,this._maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),125);const i=this._transformFragmentSource(Ms,this._maxTextures);this._shader=new Ae({gl:t,fragmentSource:i,vertexSource:Mi}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",e.ortho),this._shader.setUniformIntArray("u_textures",[...Array(this._maxTextures)].map((s,r)=>r)),this._buffer=new ke({gl:t,size:12*4*this._maxImages,type:"dynamic"}),this._layout=new xe({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_opacity",1],["a_res",2],["a_texcoord",2],["a_textureIndex",1],["a_tint",4]]}),this._quads=new Fi(t,this._maxImages,!0)}dispose(){this._buffer.dispose(),this._quads.dispose(),this._shader.dispose(),this._textures.length=0,this._context=null,this._gl=null}_transformFragmentSource(t,e){let i=t.replace("%%count%%",e.toString()),s="";for(let r=0;r<e;r++)r===0?s+=`if (v_textureIndex <= ${r}.5) {
`:s+=`   else if (v_textureIndex <= ${r}.5) {
`,s+=`      vec2 uv = u_pixelart ? uv_iq(v_texcoord, v_res) : v_texcoord;
`,s+=`      color = texture(u_textures[${r}], uv);
`,s+=`   }
`;return i=i.replace("%%texture_picker%%",s),i}_addImageAsTexture(t){if(this._images.has(t))return;const e=t.getAttribute(ct.Filtering),i=e?St(e):null,s=pt(t.getAttribute(ct.WrappingX)),r=pt(t.getAttribute(ct.WrappingY)),o=t.getAttribute("forceUpload")==="true",a=this._context.textureLoader.load(t,{filtering:i,wrapping:{x:s,y:r}},o);t.removeAttribute("forceUpload"),this._textures.indexOf(a)===-1&&(this._textures.push(a),this._textureToIndex.set(a,this._textureIndex++),this._images.add(t))}_bindTextures(t){for(let e=0;e<this._maxTextures;e++)t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_2D,this._textures[e]||this._textures[0])}_getTextureIdForImage(t){var e;if(t){const i=this._context.textureLoader.get(t);return(e=this._textureToIndex.get(i))!==null&&e!==void 0?e:-1}return-1}_isFull(){return this._imageCount>=this._maxImages||this._textures.length>=this._maxTextures}_getImageWidth(t){let e=this._imageToWidth.get(t);return e===void 0&&(e=t.width,this._imageToWidth.set(t,e)),e}_getImageHeight(t){let e=this._imageToHeight.get(t);return e===void 0&&(e=t.height,this._imageToHeight.set(t,e)),e}draw(t,e,i,s,r,o,a,u,T){var P,N,J,nt;this._isFull()&&this.flush(),this._imageCount++,this._addImageAsTexture(t);const at=this._getImageWidth(t),xt=this._getImageHeight(t);let Bt=at||s||0,ft=xt||r||0;this._view[2]=(P=s??at)!==null&&P!==void 0?P:0,this._view[3]=(N=r??xt)!==null&&N!==void 0?N:0,this._dest[0]=e??1,this._dest[1]=i??1,o!==void 0&&a!==void 0&&u!==void 0&&T!==void 0&&(this._view[0]=e??1,this._view[1]=i??1,this._view[2]=(J=s??at)!==null&&J!==void 0?J:0,this._view[3]=(nt=r??xt)!==null&&nt!==void 0?nt:0,this._dest[0]=o,this._dest[1]=a,Bt=u,ft=T),e=this._view[0],i=this._view[1];const _t=this._view[2],Tt=this._view[3],Ct=this._context.getTransform(),Rt=this._context.opacity,se=this._context.snapToPixel;this._quad[0]=this._dest[0],this._quad[1]=this._dest[1],this._quad[2]=this._dest[0]+Bt,this._quad[3]=this._dest[1],this._quad[4]=this._dest[0],this._quad[5]=this._dest[1]+ft,this._quad[6]=this._dest[0]+Bt,this._quad[7]=this._dest[1]+ft,Ct.multiplyQuadInPlace(this._quad),se&&(this._quad[0]=~~(this._quad[0]+B(this._quad[0])*ee),this._quad[1]=~~(this._quad[1]+B(this._quad[1])*ee),this._quad[2]=~~(this._quad[2]+B(this._quad[2])*ee),this._quad[3]=~~(this._quad[3]+B(this._quad[3])*ee),this._quad[4]=~~(this._quad[4]+B(this._quad[4])*ee),this._quad[5]=~~(this._quad[5]+B(this._quad[5])*ee),this._quad[6]=~~(this._quad[6]+B(this._quad[6])*ee),this._quad[7]=~~(this._quad[7]+B(this._quad[7])*ee));const Dt=this._context.tint,re=this._getTextureIdForImage(t),ve=at||Bt,Se=xt||ft,Ve=(e+this.uvPadding)/ve,Xe=(i+this.uvPadding)/Se,Je=(e+_t-this.uvPadding)/ve,We=(i+Tt-this.uvPadding)/Se,Me=at,Le=xt,Ht=this._layout.vertexBuffer.bufferData;Ht[this._vertexIndex++]=this._quad[0],Ht[this._vertexIndex++]=this._quad[1],Ht[this._vertexIndex++]=Rt,Ht[this._vertexIndex++]=Me,Ht[this._vertexIndex++]=Le,Ht[this._vertexIndex++]=Ve,Ht[this._vertexIndex++]=Xe,Ht[this._vertexIndex++]=re,Ht[this._vertexIndex++]=Dt.r/255,Ht[this._vertexIndex++]=Dt.g/255,Ht[this._vertexIndex++]=Dt.b/255,Ht[this._vertexIndex++]=Dt.a,Ht[this._vertexIndex++]=this._quad[4],Ht[this._vertexIndex++]=this._quad[5],Ht[this._vertexIndex++]=Rt,Ht[this._vertexIndex++]=Me,Ht[this._vertexIndex++]=Le,Ht[this._vertexIndex++]=Ve,Ht[this._vertexIndex++]=We,Ht[this._vertexIndex++]=re,Ht[this._vertexIndex++]=Dt.r/255,Ht[this._vertexIndex++]=Dt.g/255,Ht[this._vertexIndex++]=Dt.b/255,Ht[this._vertexIndex++]=Dt.a,Ht[this._vertexIndex++]=this._quad[2],Ht[this._vertexIndex++]=this._quad[3],Ht[this._vertexIndex++]=Rt,Ht[this._vertexIndex++]=Me,Ht[this._vertexIndex++]=Le,Ht[this._vertexIndex++]=Je,Ht[this._vertexIndex++]=Xe,Ht[this._vertexIndex++]=re,Ht[this._vertexIndex++]=Dt.r/255,Ht[this._vertexIndex++]=Dt.g/255,Ht[this._vertexIndex++]=Dt.b/255,Ht[this._vertexIndex++]=Dt.a,Ht[this._vertexIndex++]=this._quad[6],Ht[this._vertexIndex++]=this._quad[7],Ht[this._vertexIndex++]=Rt,Ht[this._vertexIndex++]=Me,Ht[this._vertexIndex++]=Le,Ht[this._vertexIndex++]=Je,Ht[this._vertexIndex++]=We,Ht[this._vertexIndex++]=re,Ht[this._vertexIndex++]=Dt.r/255,Ht[this._vertexIndex++]=Dt.g/255,Ht[this._vertexIndex++]=Dt.b/255,Ht[this._vertexIndex++]=Dt.a}hasPendingDraws(){return this._imageCount!==0}flush(){if(this._imageCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0,4*12*this._imageCount),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._shader.setUniformBoolean("u_pixelart",this.pixelArtSampler),this._bindTextures(t),this._quads.bind(),t.drawElements(t.TRIANGLES,this._imageCount*6,this._quads.bufferGlType,0),he.DrawnImagesCount+=this._imageCount,he.DrawCallCount++,this._imageCount=0,this._vertexIndex=0,this._textures.length=0,this._textureIndex=0,this._textureToIndex.clear(),this._images.clear(),this._imageToWidth.clear(),this._imageToHeight.clear()}}const Ls=`#version 300 es\r
\r
precision mediump float;\r
\r
// UV coord\r
in vec2 v_uv;\r
\r
in vec2 v_size; // in pixels\r
\r
// Color coord to blend with image\r
in lowp vec4 v_color;\r
\r
// Stroke color if used\r
in lowp vec4 v_strokeColor;\r
\r
// Stroke thickness if used\r
in lowp float v_strokeThickness; // in pixels\r
\r
// Opacity\r
in float v_opacity;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
    // modified from https://stackoverflow.com/questions/59197671/glsl-rounded-rectangle-with-variable-border\r
    vec2 uv = v_uv;\r
    vec2 fragCoord = uv * v_size;\r
    float maxX = v_size.x - v_strokeThickness;\r
    float minX = v_strokeThickness;\r
    float maxY = v_size.y - v_strokeThickness;\r
    float minY = v_strokeThickness;\r
\r
    if (fragCoord.x < maxX && fragCoord.x > minX &&\r
        fragCoord.y < maxY && fragCoord.y > minY) {\r
      fragColor = v_color;\r
    } else {\r
      fragColor = v_strokeColor;\r
    }\r
    fragColor.a *= v_opacity;\r
    fragColor.rgb *= fragColor.a;\r
\r
    // vec2 v2CenteredPos     = abs(fragCoord - v_size.xy / 2.0);\r
    // vec2 v2HalfShapeSizePx = v_size.xy/2.0 - v_strokeThickness/2.0;\r
\r
    // float fHalfBorderDist      = 0.0;\r
    // float fHalfBorderThickness = 0.0;\r
\r
    // if (fragCoord.x > max(v_radius, v_strokeThickness) && \r
    //     fragCoord.x < v_size.x - max(v_radius, v_strokeThickness))\r
    // {\r
    //     fHalfBorderDist      = v2CenteredPos.y - v2HalfShapeSizePx.y;\r
    //     fHalfBorderThickness = v_strokeThickness / 2.0;\r
    // }\r
    // else if (fragCoord.y > max(v_radius, v_strokeThickness) && \r
    //          fragCoord.y < v_size.y - max(v_radius, v_strokeThickness))\r
    // {\r
    //     fHalfBorderDist      = v2CenteredPos.x - v2HalfShapeSizePx.x;\r
    //     fHalfBorderThickness = v_strokeThickness / 2.0;\r
    // }\r
    // else\r
    // {\r
    //     vec2 edgeVec = max(vec2(0.0), v_radius - vec2(\r
    //         uv.x > 0.5 ? v_size.x - fragCoord.x : fragCoord.x,\r
    //         uv.y > 0.5 ? v_size.y - fragCoord.y : fragCoord.y));\r
        \r
    //     float ellipse_ab    = v_radius-v_strokeThickness;\r
    //     vec2 ellipse_isect = (v_strokeThickness > v_radius || v_strokeThickness > v_radius) ? vec2(0.0) :\r
    //                             edgeVec.xy * ellipse_ab*ellipse_ab / length(ellipse_ab*edgeVec.yx); \r
            \r
    //     fHalfBorderThickness = (v_radius - length(ellipse_isect)) / 2.0;\r
    //     fHalfBorderDist      = length(edgeVec) - (v_radius - fHalfBorderThickness);\r
    // }\r
\r
    // vec4 v4FromColor = v_strokeColor;\r
    // v4FromColor.rgb *= v4FromColor.a;\r
    // vec4 v4ToColor   = vec4(0.0); // background color is transparent\r
    // if (fHalfBorderDist < 0.0) {\r
    //     v4ToColor = v_color;\r
    //     v4ToColor.rgb *= v4ToColor.a;\r
    // }\r
\r
    // float mixPct = abs(fHalfBorderDist) - fHalfBorderThickness;\r
\r
    // vec4 finalColor = mix(v4FromColor, v4ToColor, mixPct);\r
    // gl_FragColor = finalColor;\r
}`,hr=`#version 300 es\r
in vec2 a_position;\r
\r
// UV coordinate\r
in vec2 a_uv;\r
out vec2 v_uv;\r
\r
in vec2 a_size;\r
out vec2 v_size;\r
\r
// Opacity \r
in float a_opacity;\r
out float v_opacity;\r
\r
in vec4 a_color;\r
out vec4 v_color;\r
\r
in vec4 a_strokeColor;\r
out vec4 v_strokeColor;\r
\r
in float a_strokeThickness;\r
out float v_strokeThickness;\r
\r
uniform mat4 u_matrix;\r
\r
\r
void main() {\r
   // Set the vertex position using the ortho transform matrix\r
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\r
\r
   // Pass through UV coords\r
   v_uv = a_uv;\r
   // Pass through size\r
   v_size = a_size;\r
   // Pass through the Opacity to the fragment shader\r
   v_opacity = a_opacity;\r
   // Pass through the color to the fragment shader\r
   v_color = a_color;\r
   // Pass through the stroke color to the fragment shader\r
   v_strokeColor = a_strokeColor;\r
   // Pass through the stroke thickenss to the fragment shader\r
   v_strokeThickness = a_strokeThickness;\r
}`;class Zt{constructor(){this.type="ex.rectangle",this.priority=0,this._maxRectangles=10922,this._rectangleCount=0,this._vertexIndex=0}initialize(t,e){this._gl=t,this._context=e,this._shader=new Ae({gl:t,fragmentSource:Ls,vertexSource:hr}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",e.ortho),this._buffer=new ke({gl:t,size:16*4*this._maxRectangles,type:"dynamic"}),this._layout=new xe({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2],["a_size",2],["a_opacity",1],["a_color",4],["a_strokeColor",4],["a_strokeThickness",1]]}),this._quads=new Fi(t,this._maxRectangles,!0)}dispose(){this._buffer.dispose(),this._quads.dispose(),this._shader.dispose(),this._context=null,this._gl=null}_isFull(){return this._rectangleCount>=this._maxRectangles}draw(...t){t[0]instanceof h&&t[1]instanceof h?this.drawLine.apply(this,t):this.drawRectangle.apply(this,t)}drawLine(t,e,i,s=1){this._isFull()&&this.flush(),this._rectangleCount++;const r=this._context.getTransform(),o=this._context.opacity,a=this._context.snapToPixel,u=e.sub(t),T=u.size,P=u.normalize().perpendicular(),N=s/2,J=r.multiply(P.scale(N).add(t)),nt=r.multiply(P.scale(-N).add(t)),at=r.multiply(P.scale(N).add(e)),xt=r.multiply(P.scale(-N).add(e));a&&(J.x=~~(J.x+ee),J.y=~~(J.y+ee),at.x=~~(at.x+ee),at.y=~~(at.y+ee),nt.x=~~(nt.x+ee),nt.y=~~(nt.y+ee),xt.x=~~(xt.x+ee),xt.y=~~(xt.y+ee));const Bt=0,ft=0,_t=1,Tt=1,Ct=p.Transparent,Rt=0,se=1,Dt=this._layout.vertexBuffer.bufferData;Dt[this._vertexIndex++]=J.x,Dt[this._vertexIndex++]=J.y,Dt[this._vertexIndex++]=Bt,Dt[this._vertexIndex++]=ft,Dt[this._vertexIndex++]=T,Dt[this._vertexIndex++]=s,Dt[this._vertexIndex++]=o,Dt[this._vertexIndex++]=i.r/255,Dt[this._vertexIndex++]=i.g/255,Dt[this._vertexIndex++]=i.b/255,Dt[this._vertexIndex++]=i.a,Dt[this._vertexIndex++]=Ct.r/255,Dt[this._vertexIndex++]=Ct.g/255,Dt[this._vertexIndex++]=Ct.b/255,Dt[this._vertexIndex++]=Ct.a,Dt[this._vertexIndex++]=Rt/se,Dt[this._vertexIndex++]=nt.x,Dt[this._vertexIndex++]=nt.y,Dt[this._vertexIndex++]=Bt,Dt[this._vertexIndex++]=Tt,Dt[this._vertexIndex++]=T,Dt[this._vertexIndex++]=s,Dt[this._vertexIndex++]=o,Dt[this._vertexIndex++]=i.r/255,Dt[this._vertexIndex++]=i.g/255,Dt[this._vertexIndex++]=i.b/255,Dt[this._vertexIndex++]=i.a,Dt[this._vertexIndex++]=Ct.r/255,Dt[this._vertexIndex++]=Ct.g/255,Dt[this._vertexIndex++]=Ct.b/255,Dt[this._vertexIndex++]=Ct.a,Dt[this._vertexIndex++]=Rt/se,Dt[this._vertexIndex++]=at.x,Dt[this._vertexIndex++]=at.y,Dt[this._vertexIndex++]=_t,Dt[this._vertexIndex++]=ft,Dt[this._vertexIndex++]=T,Dt[this._vertexIndex++]=s,Dt[this._vertexIndex++]=o,Dt[this._vertexIndex++]=i.r/255,Dt[this._vertexIndex++]=i.g/255,Dt[this._vertexIndex++]=i.b/255,Dt[this._vertexIndex++]=i.a,Dt[this._vertexIndex++]=Ct.r/255,Dt[this._vertexIndex++]=Ct.g/255,Dt[this._vertexIndex++]=Ct.b/255,Dt[this._vertexIndex++]=Ct.a,Dt[this._vertexIndex++]=Rt/se,Dt[this._vertexIndex++]=xt.x,Dt[this._vertexIndex++]=xt.y,Dt[this._vertexIndex++]=_t,Dt[this._vertexIndex++]=Tt,Dt[this._vertexIndex++]=T,Dt[this._vertexIndex++]=s,Dt[this._vertexIndex++]=o,Dt[this._vertexIndex++]=i.r/255,Dt[this._vertexIndex++]=i.g/255,Dt[this._vertexIndex++]=i.b/255,Dt[this._vertexIndex++]=i.a,Dt[this._vertexIndex++]=Ct.r/255,Dt[this._vertexIndex++]=Ct.g/255,Dt[this._vertexIndex++]=Ct.b/255,Dt[this._vertexIndex++]=Ct.a,Dt[this._vertexIndex++]=Rt/se}drawRectangle(t,e,i,s,r=p.Transparent,o=0){this._isFull()&&this.flush(),this._rectangleCount++;const a=this._context.getTransform(),u=this._context.opacity,T=this._context.snapToPixel,P=a.multiply(t.add(A(0,0))),N=a.multiply(t.add(A(e,0))),J=a.multiply(t.add(A(e,i))),nt=a.multiply(t.add(A(0,i)));T&&(P.x=~~(P.x+ee),P.y=~~(P.y+ee),N.x=~~(N.x+ee),N.y=~~(N.y+ee),nt.x=~~(nt.x+ee),nt.y=~~(nt.y+ee),J.x=~~(J.x+ee),J.y=~~(J.y+ee));const at=0,xt=0,Bt=1,ft=1,_t=this._layout.vertexBuffer.bufferData;_t[this._vertexIndex++]=P.x,_t[this._vertexIndex++]=P.y,_t[this._vertexIndex++]=at,_t[this._vertexIndex++]=xt,_t[this._vertexIndex++]=e,_t[this._vertexIndex++]=i,_t[this._vertexIndex++]=u,_t[this._vertexIndex++]=s.r/255,_t[this._vertexIndex++]=s.g/255,_t[this._vertexIndex++]=s.b/255,_t[this._vertexIndex++]=s.a,_t[this._vertexIndex++]=r.r/255,_t[this._vertexIndex++]=r.g/255,_t[this._vertexIndex++]=r.b/255,_t[this._vertexIndex++]=r.a,_t[this._vertexIndex++]=o,_t[this._vertexIndex++]=nt.x,_t[this._vertexIndex++]=nt.y,_t[this._vertexIndex++]=at,_t[this._vertexIndex++]=ft,_t[this._vertexIndex++]=e,_t[this._vertexIndex++]=i,_t[this._vertexIndex++]=u,_t[this._vertexIndex++]=s.r/255,_t[this._vertexIndex++]=s.g/255,_t[this._vertexIndex++]=s.b/255,_t[this._vertexIndex++]=s.a,_t[this._vertexIndex++]=r.r/255,_t[this._vertexIndex++]=r.g/255,_t[this._vertexIndex++]=r.b/255,_t[this._vertexIndex++]=r.a,_t[this._vertexIndex++]=o,_t[this._vertexIndex++]=N.x,_t[this._vertexIndex++]=N.y,_t[this._vertexIndex++]=Bt,_t[this._vertexIndex++]=xt,_t[this._vertexIndex++]=e,_t[this._vertexIndex++]=i,_t[this._vertexIndex++]=u,_t[this._vertexIndex++]=s.r/255,_t[this._vertexIndex++]=s.g/255,_t[this._vertexIndex++]=s.b/255,_t[this._vertexIndex++]=s.a,_t[this._vertexIndex++]=r.r/255,_t[this._vertexIndex++]=r.g/255,_t[this._vertexIndex++]=r.b/255,_t[this._vertexIndex++]=r.a,_t[this._vertexIndex++]=o,_t[this._vertexIndex++]=J.x,_t[this._vertexIndex++]=J.y,_t[this._vertexIndex++]=Bt,_t[this._vertexIndex++]=ft,_t[this._vertexIndex++]=e,_t[this._vertexIndex++]=i,_t[this._vertexIndex++]=u,_t[this._vertexIndex++]=s.r/255,_t[this._vertexIndex++]=s.g/255,_t[this._vertexIndex++]=s.b/255,_t[this._vertexIndex++]=s.a,_t[this._vertexIndex++]=r.r/255,_t[this._vertexIndex++]=r.g/255,_t[this._vertexIndex++]=r.b/255,_t[this._vertexIndex++]=r.a,_t[this._vertexIndex++]=o}hasPendingDraws(){return this._rectangleCount!==0}flush(){if(this._rectangleCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._quads.bind(),t.drawElements(t.TRIANGLES,this._rectangleCount*6,this._quads.bufferGlType,0),he.DrawnImagesCount+=this._rectangleCount,he.DrawCallCount++,this._rectangleCount=0,this._vertexIndex=0}}const cr=`#version 300 es\r
precision highp float;\r
\r
// UV coord\r
in vec2 v_uv;\r
\r
// Color coord to blend with image\r
in lowp vec4 v_color;\r
\r
// Stroke color if used\r
in lowp vec4 v_strokeColor;\r
\r
// Stroke thickness if used\r
in lowp float v_strokeThickness;\r
\r
// Opacity\r
in float v_opacity;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
  // make (0, 0) the center the uv \r
  vec2 uv = v_uv * 2.0 - 1.0;\r
\r
  vec4 color = v_color;\r
  vec4 strokeColor = v_strokeColor;\r
\r
  // circle border is at radius 1.0 \r
  // dist is > 0 when inside the circle \r
  float d = length(uv);\r
  float dist = 1.0 - length(uv);\r
\r
  // Fade based on fwidth\r
  float fade = fwidth(dot(uv, uv));\r
\r
  // if dist is greater than 0 step to 1;\r
  // when we cross this 0 threshold add a smooth fade\r
  float fill = smoothstep(-fade/2.0, fade/2.0, dist);\r
\r
  // if dist is greater than the stroke thickness step to 1\r
  float stroke = 1.0 - smoothstep(v_strokeThickness, v_strokeThickness + fade, dist);\r
\r
  strokeColor.a *= fill * stroke;\r
  strokeColor.rgb *= strokeColor.a;\r
\r
  color.a *= fill * (1.0 - stroke);\r
  color.rgb *= color.a;\r
\r
  vec4 finalColor = mix(vec4(0.0), (color + strokeColor), fill);\r
  finalColor.rgb = finalColor.rgb * v_opacity;\r
  finalColor.a = finalColor.a * v_opacity;\r
  fragColor = finalColor;\r
}`,Rs=`#version 300 es\r
in vec2 a_position;\r
\r
// UV coordinate\r
in vec2 a_uv;\r
out vec2 v_uv;\r
\r
// Opacity \r
in float a_opacity;\r
out float v_opacity;\r
\r
in vec4 a_color;\r
out vec4 v_color;\r
\r
in vec4 a_strokeColor;\r
out vec4 v_strokeColor;\r
\r
in float a_strokeThickness;\r
out float v_strokeThickness;\r
\r
uniform mat4 u_matrix;\r
\r
\r
void main() {\r
   // Set the vertex position using the ortho transform matrix\r
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);\r
\r
   // Pass through UV coords\r
   v_uv = a_uv;\r
   // Pass through the Opacity to the fragment shader\r
   v_opacity = a_opacity;\r
   // Pass through the color to the fragment shader\r
   v_color = a_color;\r
   // Pass through the stroke color to the fragment shader\r
   v_strokeColor = a_strokeColor;\r
   // Pass through the stroke thickenss to the fragment shader\r
   v_strokeThickness = a_strokeThickness;\r
}`;class zs{constructor(){this.type="ex.circle",this.priority=0,this._maxCircles=10922,this._circleCount=0,this._vertexIndex=0}initialize(t,e){this._gl=t,this._context=e,this._shader=new Ae({gl:t,fragmentSource:cr,vertexSource:Rs}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",e.ortho),this._buffer=new ke({gl:t,size:14*4*this._maxCircles,type:"dynamic"}),this._layout=new xe({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2],["a_opacity",1],["a_color",4],["a_strokeColor",4],["a_strokeThickness",1]]}),this._quads=new Fi(t,this._maxCircles,!0)}dispose(){this._buffer.dispose(),this._quads.dispose(),this._shader.dispose(),this._context=null,this._gl=null}_isFull(){return this._circleCount>=this._maxCircles}draw(t,e,i,s=p.Transparent,r=0){this._isFull()&&this.flush(),this._circleCount++;const o=this._context.getTransform(),a=this._context.opacity,u=this._context.snapToPixel,T=o.multiply(t.add(A(-e,-e))),P=o.multiply(t.add(A(e,-e))),N=o.multiply(t.add(A(e,e))),J=o.multiply(t.add(A(-e,e)));u&&(T.x=~~(T.x+ee),T.y=~~(T.y+ee),P.x=~~(P.x+ee),P.y=~~(P.y+ee),J.x=~~(J.x+ee),J.y=~~(J.y+ee),N.x=~~(N.x+ee),N.y=~~(N.y+ee));const nt=0,at=0,xt=1,Bt=1,ft=this._layout.vertexBuffer.bufferData;ft[this._vertexIndex++]=T.x,ft[this._vertexIndex++]=T.y,ft[this._vertexIndex++]=nt,ft[this._vertexIndex++]=at,ft[this._vertexIndex++]=a,ft[this._vertexIndex++]=i.r/255,ft[this._vertexIndex++]=i.g/255,ft[this._vertexIndex++]=i.b/255,ft[this._vertexIndex++]=i.a,ft[this._vertexIndex++]=s.r/255,ft[this._vertexIndex++]=s.g/255,ft[this._vertexIndex++]=s.b/255,ft[this._vertexIndex++]=s.a,ft[this._vertexIndex++]=r/e,ft[this._vertexIndex++]=J.x,ft[this._vertexIndex++]=J.y,ft[this._vertexIndex++]=nt,ft[this._vertexIndex++]=Bt,ft[this._vertexIndex++]=a,ft[this._vertexIndex++]=i.r/255,ft[this._vertexIndex++]=i.g/255,ft[this._vertexIndex++]=i.b/255,ft[this._vertexIndex++]=i.a,ft[this._vertexIndex++]=s.r/255,ft[this._vertexIndex++]=s.g/255,ft[this._vertexIndex++]=s.b/255,ft[this._vertexIndex++]=s.a,ft[this._vertexIndex++]=r/e,ft[this._vertexIndex++]=P.x,ft[this._vertexIndex++]=P.y,ft[this._vertexIndex++]=xt,ft[this._vertexIndex++]=at,ft[this._vertexIndex++]=a,ft[this._vertexIndex++]=i.r/255,ft[this._vertexIndex++]=i.g/255,ft[this._vertexIndex++]=i.b/255,ft[this._vertexIndex++]=i.a,ft[this._vertexIndex++]=s.r/255,ft[this._vertexIndex++]=s.g/255,ft[this._vertexIndex++]=s.b/255,ft[this._vertexIndex++]=s.a,ft[this._vertexIndex++]=r/e,ft[this._vertexIndex++]=N.x,ft[this._vertexIndex++]=N.y,ft[this._vertexIndex++]=xt,ft[this._vertexIndex++]=Bt,ft[this._vertexIndex++]=a,ft[this._vertexIndex++]=i.r/255,ft[this._vertexIndex++]=i.g/255,ft[this._vertexIndex++]=i.b/255,ft[this._vertexIndex++]=i.a,ft[this._vertexIndex++]=s.r/255,ft[this._vertexIndex++]=s.g/255,ft[this._vertexIndex++]=s.b/255,ft[this._vertexIndex++]=s.a,ft[this._vertexIndex++]=r/e}hasPendingDraws(){return this._circleCount!==0}flush(){if(this._circleCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._quads.bind(),t.drawElements(t.TRIANGLES,this._circleCount*6,this._quads.bufferGlType,0),he.DrawnImagesCount+=this._circleCount,he.DrawCallCount++,this._circleCount=0,this._vertexIndex=0}}class Os{constructor(t,e,i=100){this.builder=t,this.recycler=e,this.maxObjects=i,this.totalAllocations=0,this.index=0,this.objects=[],this.disableWarnings=!1,this._logger=I.getInstance()}dispose(){this.objects.length=0}preallocate(){for(let t=0;t<this.maxObjects;t++)this.objects[t]=this.builder()}using(t){const e=t(this);return e?this.done(...e):this.done()}borrow(t){const e=this.get();t(e),this.index--}get(){return this.index===this.maxObjects&&(this.disableWarnings||this._logger.warn("Max pooled objects reached, possible memory leak? Doubling"),this.maxObjects=this.maxObjects*2),this.objects[this.index]?this.recycler(this.objects[this.index++]):(this.totalAllocations++,this.objects[this.index++]=this.builder())}done(...t){this.index=0;for(const e of t){const i=this.objects.indexOf(e);this.objects[i]=this.builder(),this.totalAllocations++}return t}}class dr{constructor(){this.z=0,this.priority=0,this.transform=It.identity(),this.state={z:0,opacity:1,tint:p.White,material:null}}}const Ns=`#version 300 es
in vec2 a_position;

in vec2 a_uv;
out vec2 v_uv;

in vec2 a_screenuv;
out vec2 v_screenuv;

uniform mat4 u_matrix;
uniform mat4 u_transform;

void main() {
  // Set the vertex position using the ortho & transform matrix
  gl_Position = u_matrix * u_transform * vec4(a_position, 0.0, 1.0);

  // Pass through the UV coord to the fragment shader
  v_uv = a_uv;
  v_screenuv = a_screenuv;
}
`;class Gs{constructor(t){this._logger=I.getInstance(),this._color=p.Transparent,this._initialized=!1,this._images=new Map,this._textures=new Map;const{color:e,name:i,vertexSource:s,fragmentSource:r,graphicsContext:o,images:a}=t;if(this._name=i??"anonymous material",this._vertexSource=s??Ns,this._fragmentSource=r,this._color=e??this._color,!o)throw Error(`Material ${i} must be provided an excalibur webgl graphics context`);if(o instanceof ni?(this._graphicsContext=o,this._initialize(o)):this._logger.warn(`Material ${i} was created in 2D Canvas mode, currently only WebGL is supported`),a)for(const u in a)this.addImageSource(u,a[u])}_initialize(t){if(this._initialized)return;const e=t.__gl;this._maxTextureSlots=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)-2,this._shader=t.createShader({vertexSource:this._vertexSource,fragmentSource:this._fragmentSource}),this._shader.compile(),this._initialized=!0}get name(){var t;return(t=this._name)!==null&&t!==void 0?t:"anonymous material"}get isUsingScreenTexture(){return this._fragmentSource.includes("u_screen_texture")}update(t){this._shader&&(this._shader.use(),t(this._shader))}getShader(){return this._shader}addImageSource(t,e){this._images.size<this._maxTextureSlots?this._images.set(t,e):this._logger.warn(`Max number texture slots ${this._maxTextureSlots} have been reached for material "${this.name}", no more textures will be uploaded due to hardware constraints.`)}removeImageSource(t){const e=this._images.get(t);this._graphicsContext.textureLoader.delete(e.image),this._images.delete(t)}_loadImageSource(t){const e=t.image,i=e.getAttribute(ct.Filtering),s=i?St(i):null,r=pt(e.getAttribute(ct.WrappingX)),o=pt(e.getAttribute(ct.WrappingY)),a=e.getAttribute("forceUpload")==="true",u=this._graphicsContext.textureLoader.load(e,{filtering:s,wrapping:{x:r,y:o}},a);return e.removeAttribute("forceUpload"),this._textures.has(t)||this._textures.set(t,u),u}uploadAndBind(t,e=2){let i=e;for(const[s,r]of this._images.entries()){if(!r.isLoaded()){this._logger.warnOnce(`Image named ${s} in material ${this.name} not loaded, nothing will be uploaded to the shader. Did you forget to add this to a loader? https://excaliburjs.com/docs/loaders/`);continue}const o=this._loadImageSource(r);t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_2D,o),this._shader.trySetUniformInt(s,i),i++}}use(){if(this._initialized)this._shader.use(),this._shader.trySetUniformFloatColor("u_color",this._color);else throw Error(`Material ${this.name} not yet initialized, use the ExcaliburGraphicsContext.createMaterial() to work around this.`)}}class Us{constructor(){this.type="ex.material",this.priority=0,this._textures=[]}initialize(t,e){this._gl=t,this._context=e,this._buffer=new ke({gl:t,size:6*4,type:"dynamic"}),this._layout=new xe({gl:t,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2],["a_screenuv",2]],suppressWarnings:!0}),this._quads=new Fi(t,1,!0)}dispose(){this._buffer.dispose(),this._quads.dispose(),this._textures.length=0,this._context=null,this._gl=null}draw(t,e,i,s,r,o,a,u,T){var P,N,J,nt;const at=this._gl,xt=this._context.material,Bt=this._context.getTransform(),ft=this._context.opacity,_t=xt.getShader(),Tt=this._layout.vertexBuffer.bufferData;let Ct=0,Rt=(t==null?void 0:t.width)||s||0,se=(t==null?void 0:t.height)||r||0,Dt=[0,0,(P=s??(t==null?void 0:t.width))!==null&&P!==void 0?P:0,(N=r??(t==null?void 0:t.height))!==null&&N!==void 0?N:0],re=[e??1,i??1];o!==void 0&&a!==void 0&&u!==void 0&&T!==void 0&&(Dt=[e??1,i??1,(J=s??(t==null?void 0:t.width))!==null&&J!==void 0?J:0,(nt=r??(t==null?void 0:t.height))!==null&&nt!==void 0?nt:0],re=[o,a],Rt=u,se=T),e=Dt[0],i=Dt[1];const ve=Dt[2],Se=Dt[3],Ve=A(re[0],re[1]),Xe=A(re[0]+Rt,re[1]),Je=A(re[0],re[1]+se),We=A(re[0]+Rt,re[1]+se),Me=t.width||Rt,Le=t.height||se,Ht=e/Me,os=i/Le,as=(e+ve-.01)/Me,ls=(i+Se-.01)/Le,Fs=Bt.getPosition(),zo=Fs.add(We),Oo=Fs.x/this._context.width,No=Fs.y/this._context.height,Go=zo.x/this._context.width,Uo=zo.y/this._context.height;Tt[Ct++]=Ve.x,Tt[Ct++]=Ve.y,Tt[Ct++]=Ht,Tt[Ct++]=os,Tt[Ct++]=Oo,Tt[Ct++]=No,Tt[Ct++]=Je.x,Tt[Ct++]=Je.y,Tt[Ct++]=Ht,Tt[Ct++]=ls,Tt[Ct++]=Oo,Tt[Ct++]=Uo,Tt[Ct++]=Xe.x,Tt[Ct++]=Xe.y,Tt[Ct++]=as,Tt[Ct++]=os,Tt[Ct++]=Go,Tt[Ct++]=No,Tt[Ct++]=We.x,Tt[Ct++]=We.y,Tt[Ct++]=as,Tt[Ct++]=ls,Tt[Ct++]=Go,Tt[Ct++]=Uo;const il=this._addImageAsTexture(t);xt.use(),this._layout.shader=_t,this._layout.use(!0),_t.trySetUniformFloat("u_time_ms",performance.now()),_t.trySetUniformFloat("u_opacity",ft),_t.trySetUniformFloatVector("u_resolution",A(this._context.width,this._context.height)),_t.trySetUniformFloatVector("u_graphic_resolution",A(Me,Le)),_t.trySetUniformFloatVector("u_size",A(ve,Se)),_t.trySetUniformMatrix("u_matrix",this._context.ortho),_t.trySetUniformMatrix("u_transform",Bt.to4x4()),at.activeTexture(at.TEXTURE0+0),at.bindTexture(at.TEXTURE_2D,il),_t.trySetUniformInt("u_graphic",0),at.activeTexture(at.TEXTURE0+1),at.bindTexture(at.TEXTURE_2D,this._context.materialScreenTexture),_t.trySetUniformInt("u_screen_texture",1),xt.uploadAndBind(at),this._quads.bind(),at.drawElements(at.TRIANGLES,6,this._quads.bufferGlType,0),he.DrawnImagesCount++,he.DrawCallCount++}_addImageAsTexture(t){const e=t.getAttribute(ct.Filtering),i=e?St(e):null,s=pt(t.getAttribute(ct.WrappingX)),r=pt(t.getAttribute(ct.WrappingY)),o=t.getAttribute("forceUpload")==="true",a=this._context.textureLoader.load(t,{filtering:i,wrapping:{x:s,y:r}},o);return t.removeAttribute("forceUpload"),this._textures.indexOf(a)===-1&&this._textures.push(a),a}hasPendingDraws(){return!1}flush(){}}const ee=1e-4;class ur{constructor(t){this._webglCtx=t,this._debugText=new oe}drawRect(t,e,i,s,r={color:p.Black}){this.drawLine(A(t,e),A(t+i,e),{...r}),this.drawLine(A(t+i,e),A(t+i,e+s),{...r}),this.drawLine(A(t+i,e+s),A(t,e+s),{...r}),this.drawLine(A(t,e+s),A(t,e),{...r})}drawLine(t,e,i={color:p.Black}){this._webglCtx.draw("ex.line",t,e,i.color)}drawPoint(t,e={color:p.Black,size:5}){this._webglCtx.draw("ex.point",t,e.color,e.size)}drawText(t,e){this._debugText.write(this._webglCtx,t,e)}}class ni{get z(){return this._state.current.z}set z(t){this._state.current.z=t}get opacity(){return this._state.current.opacity}set opacity(t){this._state.current.opacity=t}get tint(){return this._state.current.tint}set tint(t){this._state.current.tint=t}get width(){return this.__gl.canvas.width}get height(){return this.__gl.canvas.height}get ortho(){return this._ortho}checkIfResolutionSupported(t){let e=!0;return(t.width>4096||t.height>4096)&&(e=!1),e}constructor(t){this._logger=I.getInstance(),this._renderers=new Map,this._isDrawLifecycle=!1,this.useDrawSorting=!0,this._drawCallPool=new Os(()=>new dr,xt=>(xt.priority=0,xt.z=0,xt.renderer=void 0,xt.args=void 0,xt),4e3),this._drawCallIndex=0,this._drawCalls=new Array(4e3).fill(null),this._postProcessTargets=[],this._postprocessors=[],this._transform=new yt,this._state=new wt,this.snapToPixel=!1,this.smoothing=!1,this.pixelArtSampler=!1,this.uvPadding=.01,this.backgroundColor=p.ExcaliburBlue,this.multiSampleAntialiasing=!0,this.transparency=!0,this._isContextLost=!1,this._disposed=!1,this._imageToWidth=new Map,this._imageToHeight=new Map,this.debug=new ur(this),this._totalPostProcessorTime=0;const{canvasElement:e,context:i,enableTransparency:s,antialiasing:r,uvPadding:o,multiSampleAntialiasing:a,pixelArtSampler:u,powerPreference:T,snapToPixel:P,backgroundColor:N,useDrawSorting:J,handleContextLost:nt,handleContextRestored:at}=t;if(this.__gl=i??e.getContext("webgl2",{antialias:r??this.smoothing,premultipliedAlpha:!1,alpha:s??this.transparency,depth:!1,powerPreference:T??"high-performance"}),!this.__gl)throw Error("Failed to retrieve webgl context from browser");nt&&this.__gl.canvas.addEventListener("webglcontextlost",nt,!1),at&&this.__gl.canvas.addEventListener("webglcontextrestored",at,!1),this.__gl.canvas.addEventListener("webglcontextlost",()=>{this._isContextLost=!0}),this.__gl.canvas.addEventListener("webglcontextrestored",()=>{this._isContextLost=!1}),this.textureLoader=new ht(this.__gl),this.snapToPixel=P??this.snapToPixel,this.smoothing=r??this.smoothing,this.transparency=s??this.transparency,this.pixelArtSampler=u??this.pixelArtSampler,this.uvPadding=o??this.uvPadding,this.multiSampleAntialiasing=typeof a=="boolean"?a:this.multiSampleAntialiasing,this.samples=typeof a=="object"?a.samples:void 0,this.backgroundColor=N??this.backgroundColor,this.useDrawSorting=J??this.useDrawSorting,this._drawCallPool.disableWarnings=!0,this._drawCallPool.preallocate(),this._init()}dispose(){if(!this._disposed){this._disposed=!0,this.textureLoader.dispose();for(const t of this._renderers.values())t.dispose();this._renderers.clear(),this._drawCallPool.dispose(),this._drawCalls.length=0,this.__gl=null}}_init(){const t=this.__gl;this._ortho=At.ortho(0,t.canvas.width,t.canvas.height,0,400,-400),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clearColor(this.backgroundColor.r/255,this.backgroundColor.g/255,this.backgroundColor.b/255,this.backgroundColor.a),t.clear(t.COLOR_BUFFER_BIT),t.enable(t.BLEND),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),this.register(new Hi({uvPadding:this.uvPadding,pixelArtSampler:this.pixelArtSampler})),this.register(new Us),this.register(new Zt),this.register(new zs),this.register(new gi),this.register(new Ii),this.materialScreenTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.materialScreenTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.bindTexture(t.TEXTURE_2D,null),this._screenRenderer=new ji(t),this._renderTarget=new le({gl:t,transparency:this.transparency,width:t.canvas.width,height:t.canvas.height}),this._postProcessTargets=[new le({gl:t,transparency:this.transparency,width:t.canvas.width,height:t.canvas.height}),new le({gl:t,transparency:this.transparency,width:t.canvas.width,height:t.canvas.height})],this._msaaTarget=new le({gl:t,transparency:this.transparency,width:t.canvas.width,height:t.canvas.height,antialias:this.multiSampleAntialiasing,samples:this.samples})}register(t){this._renderers.set(t.type,t),t.initialize(this.__gl,this)}get(t){return this._renderers.get(t)}_isCurrentRenderer(t){return!this._currentRenderer||this._currentRenderer===t}beginDrawLifecycle(){this._isDrawLifecycle=!0}endDrawLifecycle(){this._isDrawLifecycle=!1}draw(t,...e){if(this._isDrawLifecycle||this._logger.warnOnce(`Attempting to draw outside the the drawing lifecycle (preDraw/postDraw) is not supported and is a source of bugs/errors.
If you want to do custom drawing, use Actor.graphics, or any onPreDraw or onPostDraw handler.`),this._isContextLost){this._logger.errorOnce(`Unable to draw ${t}, the webgl context is lost`);return}const i=this._renderers.get(t);if(i)if(this.useDrawSorting){const s=this._drawCallPool.get();s.z=this._state.current.z,s.priority=i.priority,s.renderer=t,this.getTransform().clone(s.transform),s.state.z=this._state.current.z,s.state.opacity=this._state.current.opacity,s.state.tint=this._state.current.tint,s.state.material=this._state.current.material,s.args=e,this._drawCalls[this._drawCallIndex++]=s}else this._currentRenderer||(this._currentRenderer=i),this._isCurrentRenderer(i)||this._currentRenderer.flush(),i.draw(...e),this._currentRenderer=i;else throw Error(`No renderer with name ${t} has been registered`)}resetTransform(){this._transform.current=It.identity()}updateViewport(t){const e=this.__gl;this._ortho=this._ortho=At.ortho(0,t.width,t.height,0,400,-400),this._renderTarget.setResolution(e.canvas.width,e.canvas.height),this._msaaTarget.setResolution(e.canvas.width,e.canvas.height),this._postProcessTargets[0].setResolution(e.canvas.width,e.canvas.height),this._postProcessTargets[1].setResolution(e.canvas.width,e.canvas.height)}_getImageWidth(t){let e=this._imageToWidth.get(t);return e===void 0&&(e=t.width,this._imageToWidth.set(t,e)),e}_getImageHeight(t){let e=this._imageToHeight.get(t);return e===void 0&&(e=t.height,this._imageToHeight.set(t,e)),e}drawImage(t,e,i,s,r,o,a,u,T){if(!(s===0||r===0)){{if(u===0||T===0)return;if(this._getImageWidth(t)===0||this._getImageHeight(t)===0)return}if(!t){I.getInstance().warn("Cannot draw a null or undefined image"),console.trace&&console.trace();return}this._state.current.material?this.draw("ex.material",t,e,i,s,r,o,a,u,T):this.draw("ex.image",t,e,i,s,r,o,a,u,T)}}drawLine(t,e,i,s=1){this.draw("ex.rectangle",t,e,i,s)}drawRectangle(t,e,i,s,r,o){this.draw("ex.rectangle",t,e,i,s,r,o)}drawCircle(t,e,i,s,r){this.draw("ex.circle",t,e,i,s,r)}save(){this._transform.save(),this._state.save()}restore(){this._transform.restore(),this._state.restore()}translate(t,e){this._transform.translate(this.snapToPixel?~~(t+ee):t,this.snapToPixel?~~(e+ee):e)}rotate(t){this._transform.rotate(t)}scale(t,e){this._transform.scale(t,e)}transform(t){this._transform.current=t}getTransform(){return this._transform.current}multiply(t){this._transform.current.multiply(t,this._transform.current)}addPostProcessor(t){this._postprocessors.push(t),t.initialize(this.__gl)}removePostProcessor(t){const e=this._postprocessors.indexOf(t);e!==-1&&this._postprocessors.splice(e,1)}clearPostProcessors(){this._postprocessors.length=0}updatePostProcessors(t){for(const e of this._postprocessors){const i=e.getShader();i.use();const s=i.getUniforms();this._totalPostProcessorTime+=t,s.find(r=>r.name==="u_time_ms")&&i.setUniformFloat("u_time_ms",this._totalPostProcessorTime),s.find(r=>r.name==="u_elapsed_ms")&&i.setUniformFloat("u_elapsed_ms",t),s.find(r=>r.name==="u_resolution")&&i.setUniformFloatVector("u_resolution",A(this.width,this.height)),e.onUpdate&&e.onUpdate(t)}}set material(t){this._state.current.material=t}get material(){return this._state.current.material}createMaterial(t){return new Gs({...t,graphicsContext:this})}createShader(t){const e=this.__gl,{vertexSource:i,fragmentSource:s}=t,r=new Ae({gl:e,vertexSource:i,fragmentSource:s});return r.compile(),r}clear(){const t=this.__gl;(this.multiSampleAntialiasing?this._msaaTarget:this._renderTarget).use(),t.clearColor(this.backgroundColor.r/255,this.backgroundColor.g/255,this.backgroundColor.b/255,this.backgroundColor.a),t.clear(t.COLOR_BUFFER_BIT)}flush(){if(this._isContextLost){this._logger.errorOnce("Unable to flush the webgl context is lost");return}let t=this.multiSampleAntialiasing?this._msaaTarget:this._renderTarget;if(t.use(),this.useDrawSorting){for(let r=this._drawCallIndex;r<this._drawCalls.length;r++)this._drawCalls[r]=null;const e=new Map;for(const[r]of this._renderers){let o=0;for(o=0;o<this._drawCallIndex&&this._drawCalls[o].renderer!==r;o++);e.set(r,o)}this._drawCalls.sort((r,o)=>{if(r===null||o===null)return 0;const a=r.z-o.z,u=e.get(r.renderer)-e.get(o.renderer),T=r.priority-o.priority;return a===0?T===0?u:T:a});const i=this._transform.current,s=this._state.current;if(this._drawCalls.length&&this._drawCallIndex){let r=this._drawCalls[0].renderer,o=this._renderers.get(r);for(let a=0;a<this._drawCallIndex;a++)this._transform.current=this._drawCalls[a].transform,this._state.current=this._drawCalls[a].state,this._drawCalls[a].renderer!==r&&(o.flush(),r=this._drawCalls[a].renderer,o=this._renderers.get(r)),o instanceof Us&&this.material.isUsingScreenTexture&&(t.copyToTexture(this.materialScreenTexture),t.use()),o.draw(...this._drawCalls[a].args);o.hasPendingDraws()&&o.flush()}this._transform.current=i,this._state.current=s,this._drawCallPool.done(),this._drawCallIndex=0,this._imageToHeight.clear(),this._imageToWidth.clear()}else for(const e of this._renderers.values())e.hasPendingDraws()&&e.flush();t.disable(),this._postprocessors.length>0&&t.toRenderSource().use();for(let e=0;e<this._postprocessors.length;e++)t=this._postProcessTargets[e%2],this._postProcessTargets[e%2].use(),this._screenRenderer.renderWithPostProcessor(this._postprocessors[e]),this._postProcessTargets[e%2].toRenderSource().use();t.blitToScreen()}}const ge=1e-4;class Ar{constructor(t){this._ex=t,this._debugText=new oe}drawRect(t,e,i,s){this._ex.__ctx.save(),this._ex.__ctx.strokeStyle="red",this._ex.__ctx.strokeRect(this._ex.snapToPixel?~~(t+ge):t,this._ex.snapToPixel?~~(e+ge):e,this._ex.snapToPixel?~~(i+ge):i,this._ex.snapToPixel?~~(s+ge):s),this._ex.__ctx.restore()}drawLine(t,e,i={color:p.Black}){this._ex.__ctx.save(),this._ex.__ctx.beginPath(),this._ex.__ctx.strokeStyle=i.color.toString(),this._ex.__ctx.moveTo(this._ex.snapToPixel?~~(t.x+ge):t.x,this._ex.snapToPixel?~~(t.y+ge):t.y),this._ex.__ctx.lineTo(this._ex.snapToPixel?~~(e.x+ge):e.x,this._ex.snapToPixel?~~(e.y+ge):e.y),this._ex.__ctx.lineWidth=2,this._ex.__ctx.stroke(),this._ex.__ctx.closePath(),this._ex.__ctx.restore()}drawPoint(t,e={color:p.Black,size:5}){this._ex.__ctx.save(),this._ex.__ctx.beginPath(),this._ex.__ctx.fillStyle=e.color.toString(),this._ex.__ctx.arc(this._ex.snapToPixel?~~(t.x+ge):t.x,this._ex.snapToPixel?~~(t.y+ge):t.y,e.size,0,Math.PI*2),this._ex.__ctx.fill(),this._ex.__ctx.closePath(),this._ex.__ctx.restore()}drawText(t,e){this._debugText.write(this._ex,t,e)}}class Wi{get width(){return this.__ctx.canvas.width}get height(){return this.__ctx.canvas.height}get opacity(){return this._state.current.opacity}set opacity(t){this._state.current.opacity=t}get tint(){return this._state.current.tint}set tint(t){this._state.current.tint=t}get smoothing(){return this.__ctx.imageSmoothingEnabled}set smoothing(t){this.__ctx.imageSmoothingEnabled=t}constructor(t){this.useDrawSorting=!1,this.z=0,this.backgroundColor=p.ExcaliburBlue,this._state=new wt,this.snapToPixel=!1,this.debug=new Ar(this);const{canvasElement:e,context:i,enableTransparency:s,snapToPixel:r,antialiasing:o,backgroundColor:a}=t;if(this.__ctx=i??e.getContext("2d",{alpha:s??!0}),!this.__ctx)throw new Error("Cannot build new ExcaliburGraphicsContext2D for some reason!");this.backgroundColor=a??this.backgroundColor,this.snapToPixel=r??this.snapToPixel,this.smoothing=o??this.smoothing}resetTransform(){this.__ctx.resetTransform()}updateViewport(t){}drawImage(t,e,i,s,r,o,a,u,T){if(s===0||r===0)return;if(u===0||T===0)return;if(t.width===0||t.height===0)return;this.__ctx.globalAlpha=this.opacity;const P=[t,e,i,s,r,o,a,u,T].filter(N=>N!==void 0).map(N=>typeof N=="number"&&this.snapToPixel?~~N:N);this.__ctx.drawImage.apply(this.__ctx,P),he.DrawCallCount++,he.DrawnImagesCount=1}drawLine(t,e,i,s=1){this.__ctx.save(),this.__ctx.beginPath(),this.__ctx.strokeStyle=i.toString(),this.__ctx.moveTo(this.snapToPixel?~~(t.x+ge):t.x,this.snapToPixel?~~(t.y+ge):t.y),this.__ctx.lineTo(this.snapToPixel?~~(e.x+ge):e.x,this.snapToPixel?~~(e.y+ge):e.y),this.__ctx.lineWidth=s,this.__ctx.stroke(),this.__ctx.closePath(),this.__ctx.restore()}drawRectangle(t,e,i,s){this.__ctx.save(),this.__ctx.fillStyle=s.toString(),this.__ctx.fillRect(this.snapToPixel?~~(t.x+ge):t.x,this.snapToPixel?~~(t.y+ge):t.y,this.snapToPixel?~~(e+ge):e,this.snapToPixel?~~(i+ge):i),this.__ctx.restore()}drawCircle(t,e,i,s,r){this.__ctx.save(),this.__ctx.beginPath(),s&&(this.__ctx.strokeStyle=s.toString()),r&&(this.__ctx.lineWidth=r),this.__ctx.fillStyle=i.toString(),this.__ctx.arc(this.snapToPixel?~~(t.x+ge):t.x,this.snapToPixel?~~(t.y+ge):t.y,e,0,Math.PI*2),this.__ctx.fill(),s&&this.__ctx.stroke(),this.__ctx.closePath(),this.__ctx.restore()}save(){this.__ctx.save(),this._state.save()}restore(){this.__ctx.restore(),this._state.restore()}translate(t,e){this.__ctx.translate(this.snapToPixel?~~(t+ge):t,this.snapToPixel?~~(e+ge):e)}rotate(t){this.__ctx.rotate(t)}scale(t,e){this.__ctx.scale(t,e)}getTransform(){throw new Error("Not implemented")}multiply(t){this.__ctx.setTransform(this.__ctx.getTransform().multiply(t.toDOMMatrix()))}addPostProcessor(t){}removePostProcessor(t){}clearPostProcessors(){}updatePostProcessors(t){}beginDrawLifecycle(){}endDrawLifecycle(){}set material(t){this._state.current.material=t}get material(){return this._state.current.material}createMaterial(t){return null}clear(){this.__ctx.clearRect(0,0,this.width,this.height),this.__ctx.fillStyle=this.backgroundColor.toString(),this.__ctx.fillRect(0,0,this.width,this.height),he.clear()}flush(){}dispose(){this.__ctx=null}}var we;(function(n){n.Fixed="Fixed",n.FitContainerAndFill="FitContainerAndFill",n.FitScreenAndFill="FitScreenAndFill",n.FitContainerAndZoom="FitContainerAndZoom",n.FitScreenAndZoom="FitScreenAndZoom",n.FitScreen="FitScreen",n.FillScreen="FillScreen",n.FitContainer="FitContainer",n.FillContainer="FillContainer"})(we||(we={}));class ds{static get SVGA(){return{width:800,height:600}}static get Standard(){return{width:1920,height:1080}}static get Atari2600(){return{width:160,height:192}}static get GameBoy(){return{width:160,height:144}}static get GameBoyAdvance(){return{width:240,height:160}}static get NintendoDS(){return{width:256,height:192}}static get NES(){return{width:256,height:224}}static get SNES(){return{width:256,height:244}}}const gr={ScreenResize:"resize",PixelRatioChange:"pixelratio",FullScreenChange:"fullscreen"};class us{constructor(t){var e,i,s,r;this.events=new k,this._antialiasing=!0,this._canvasImageRendering="auto",this._resolutionStack=[],this._viewportStack=[],this._pixelRatioOverride=null,this._isFullScreen=!1,this._isDisposed=!1,this._logger=I.getInstance(),this._fullscreenChangeHandler=()=>{this._isDisposed||(this._isFullScreen=!this._isFullScreen,this._logger.debug("Fullscreen Change",this._isFullScreen),this.events.emit("fullscreen",{fullscreen:this.isFullScreen}))},this._pixelRatioChangeHandler=()=>{this._isDisposed||(this._logger.debug("Pixel Ratio Change",window.devicePixelRatio),this._listenForPixelRatio(),this._devicePixelRatio=this._calculateDevicePixelRatio(),this.applyResolutionAndViewport(),this.events.emit("pixelratio",{pixelRatio:this.pixelRatio}))},this._resizeHandler=()=>{if(this._isDisposed)return;const o=this.parent;this._logger.debug("View port resized"),this._setResolutionAndViewportByDisplayMode(o),this.applyResolutionAndViewport(),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})},this._devicePixelRatio=this._calculateDevicePixelRatio(),this._contentArea=new E,this._unsafeArea=new E,this.viewport=t.viewport,this.resolution=(e=t.resolution)!==null&&e!==void 0?e:{...this.viewport},this._contentResolution=this.resolution,this._displayMode=(i=t.displayMode)!==null&&i!==void 0?i:we.Fixed,this._canvas=t.canvas,this.graphicsContext=t.context,this._antialiasing=(s=t.antialiasing)!==null&&s!==void 0?s:this._antialiasing,this._canvasImageRendering=(r=t.canvasImageRendering)!==null&&r!==void 0?r:this._canvasImageRendering,this._browser=t.browser,this._pixelRatioOverride=t.pixelRatio,this._applyDisplayMode(),this._listenForPixelRatio(),this._canvas.addEventListener("fullscreenchange",this._fullscreenChangeHandler),this.applyResolutionAndViewport()}_listenForPixelRatio(){this._mediaQueryList&&!this._mediaQueryList.addEventListener&&this._mediaQueryList.removeListener(this._pixelRatioChangeHandler),this._mediaQueryList=this._browser.window.nativeComponent.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`),this._mediaQueryList.addEventListener?this._mediaQueryList.addEventListener("change",this._pixelRatioChangeHandler,{once:!0}):this._mediaQueryList.addListener(this._pixelRatioChangeHandler)}dispose(){this._isDisposed||(this._isDisposed=!0,this.events.clear(),this._browser.window.off("resize",this._resizeHandler),this._browser.window.clear(),this._resizeObserver&&this._resizeObserver.disconnect(),this.parent.removeEventListener("resize",this._resizeHandler),this._mediaQueryList.removeEventListener?this._mediaQueryList.removeEventListener("change",this._pixelRatioChangeHandler):this._mediaQueryList.removeListener(this._pixelRatioChangeHandler),this._canvas.removeEventListener("fullscreenchange",this._fullscreenChangeHandler),this._canvas=null)}_calculateDevicePixelRatio(){return window.devicePixelRatio<1?1:window.devicePixelRatio||1}get pixelRatio(){return this._pixelRatioOverride?this._pixelRatioOverride:this._devicePixelRatio}get pixelRatioOverride(){return this._pixelRatioOverride}set pixelRatioOverride(t){this._pixelRatioOverride=t}get isHiDpi(){return this.pixelRatio!==1}get displayMode(){return this._displayMode}get canvas(){return this._canvas}get parent(){switch(this.displayMode){case we.FillContainer:case we.FitContainer:case we.FitContainerAndFill:case we.FitContainerAndZoom:return this.canvas.parentElement||document.body;default:return window}}get resolution(){return this._resolution}set resolution(t){this._resolution=t}get viewport(){return this._viewport?this._viewport:this._resolution}set viewport(t){this._viewport=t}get aspectRatio(){return this._resolution.width/this._resolution.height}get scaledWidth(){return this._resolution.width*this.pixelRatio}get scaledHeight(){return this._resolution.height*this.pixelRatio}setCurrentCamera(t){this._camera=t}pushResolutionAndViewport(){this._resolutionStack.push(this.resolution),this._viewportStack.push(this.viewport),this.resolution={...this.resolution},this.viewport={...this.viewport}}peekViewport(){return this._viewportStack[this._viewportStack.length-1]}peekResolution(){return this._resolutionStack[this._resolutionStack.length-1]}popResolutionAndViewport(){this._resolutionStack.length&&this._viewportStack.length&&(this.resolution=this._resolutionStack.pop(),this.viewport=this._viewportStack.pop())}applyResolutionAndViewport(){if(this.graphicsContext instanceof ni&&!this.graphicsContext.checkIfResolutionSupported({width:this.scaledWidth,height:this.scaledHeight})&&(this._logger.warnOnce(`The currently configured resolution (${this.resolution.width}x${this.resolution.height}) and pixel ratio (${this.pixelRatio}) are too large for the platform WebGL implementation, this may work but cause WebGL rendering to behave oddly. Try reducing the resolution or disabling Hi DPI scaling to avoid this (read more here https://excaliburjs.com/docs/screens#understanding-viewport--resolution).`),!this.pixelRatioOverride)){let s=Math.max(1,this.pixelRatio-.5),r=!1;for(;s>1&&!r;){s=Math.max(1,s-.5);const o=this._resolution.width*s,a=this._resolution.height*s;r=this.graphicsContext.checkIfResolutionSupported({width:o,height:a})}this.pixelRatioOverride=s,this._logger.warnOnce(`Scaled resolution too big attempted recovery! Pixel ratio was automatically reduced to (${this.pixelRatio}) to avoid 4k texture limit. Setting \`ex.Engine({pixelRatio: ...}) will override any automatic recalculation, do so at your own risk.\`  (read more here https://excaliburjs.com/docs/screens#understanding-viewport--resolution).`)}this._canvas.width=this.scaledWidth,this._canvas.height=this.scaledHeight,this._canvasImageRendering==="auto"?this._canvas.style.imageRendering="auto":(this._canvas.style.imageRendering="pixelated",this._canvas.style.imageRendering===""&&(this._canvas.style.imageRendering="crisp-edges"));const t=this.viewport.widthUnit==="percent"?"%":"px",e=this.viewport.heightUnit==="percent"?"%":"px";this._canvas.style.width=this.viewport.width+t,this._canvas.style.height=this.viewport.height+e,this.graphicsContext.updateViewport(this.resolution),this.graphicsContext.resetTransform(),this.graphicsContext.smoothing=this._antialiasing,this.graphicsContext instanceof Wi&&this.graphicsContext.scale(this.pixelRatio,this.pixelRatio)}get antialiasing(){return this._antialiasing}set antialiasing(t){this._antialiasing=t,this.graphicsContext.smoothing=this._antialiasing}get isFullScreen(){return this._isFullScreen}goFullScreen(t){if(t){const e=document.getElementById(t);if(e)return e.getAttribute("ex-fullscreen-listener")||(e.setAttribute("ex-fullscreen-listener","true"),e.addEventListener("fullscreenchange",this._fullscreenChangeHandler)),e.requestFullscreen()}return this._canvas.requestFullscreen()}exitFullScreen(){return document.exitFullscreen()}_viewportToPixels(t){return{width:t.widthUnit==="percent"?this.canvas.offsetWidth:t.width,height:t.heightUnit==="percent"?this.canvas.offsetHeight:t.height}}pageToScreenCoordinates(t){let e=t.x,i=t.y;this._isFullScreen||(e-=$(this._canvas).x,i-=$(this._canvas).y);const s=this._viewportToPixels(this.viewport);if(this._isFullScreen)if(window.innerWidth/this.aspectRatio<window.innerHeight){const r=window.innerWidth/this.aspectRatio,o=(window.innerHeight-r)/2;i=(i-o)/r*s.height,e=e/window.innerWidth*s.width}else{const r=window.innerHeight*this.aspectRatio,o=(window.innerWidth-r)/2;e=(e-o)/r*s.width,i=i/window.innerHeight*s.height}return e=e/s.width*this.resolution.width,i=i/s.height*this.resolution.height,e=e-this.contentArea.left,i=i-this.contentArea.top,new h(e,i)}screenToPageCoordinates(t){let e=t.x,i=t.y;const s=this._viewportToPixels(this.viewport);if(e=e/this.resolution.width*s.width,i=i/this.resolution.height*s.height,this._isFullScreen)if(window.innerWidth/this.aspectRatio<window.innerHeight){const r=window.innerWidth/this.aspectRatio,o=(window.innerHeight-r)/2;i=i/s.height*r+o,e=e/s.width*window.innerWidth}else{const r=window.innerHeight*this.aspectRatio,o=(window.innerWidth-r)/2;e=e/s.width*r+o,i=i/s.height*window.innerHeight}return this._isFullScreen||(e+=$(this._canvas).x,i+=$(this._canvas).y),new h(e,i)}screenToWorldCoordinates(t){return t=t.add(A(this.contentArea.left,this.contentArea.top)),this._camera?this._camera.inverse.multiply(t):t.sub(A(this.resolution.width/2,this.resolution.height/2))}worldToScreenCoordinates(t){return this._camera?this._camera.transform.multiply(t):t.add(A(this.resolution.width/2,this.resolution.height/2))}pageToWorldCoordinates(t){const e=this.pageToScreenCoordinates(t);return this.screenToWorldCoordinates(e)}worldToPageCoordinates(t){const e=this.worldToScreenCoordinates(t);return this.screenToPageCoordinates(e)}getWorldBounds(){return E.fromDimension(this.resolution.width,this.resolution.height,h.Half).scale(A(1/this._camera.zoom,1/this._camera.zoom)).rotate(this._camera.rotation).translate(this._camera.drawPos)}getScreenBounds(){return E.fromDimension(this.resolution.width,this.resolution.height,h.Zero,h.Zero)}get canvasWidth(){return this.canvas.width}get halfCanvasWidth(){return this.canvas.width/2}get canvasHeight(){return this.canvas.height}get halfCanvasHeight(){return this.canvas.height/2}get drawWidth(){return this._camera?this.resolution.width/this._camera.zoom:this.resolution.width}get halfDrawWidth(){return this.drawWidth/2}get drawHeight(){return this._camera?this.resolution.height/this._camera.zoom:this.resolution.height}get halfDrawHeight(){return this.drawHeight/2}get center(){return A(this.halfDrawWidth,this.halfDrawHeight)}get contentArea(){return this._contentArea}get unsafeArea(){return this._unsafeArea}_computeFit(){document.body.style.margin="0px",document.body.style.overflow="hidden";const t=this.aspectRatio;let e=0,i=0;window.innerWidth/t<window.innerHeight?(e=window.innerWidth,i=window.innerWidth/t):(e=window.innerHeight*t,i=window.innerHeight),this.viewport={width:e,height:i},this._contentArea=E.fromDimension(this.resolution.width,this.resolution.height,h.Zero),this._unsafeArea=E.fromDimension(this.resolution.width,this.resolution.height,h.Zero),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitScreenAndFill(){document.body.style.margin="0px",document.body.style.overflow="hidden";const t=window.innerWidth,e=window.innerHeight;this._computeFitAndFill(t,e),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitContainerAndFill(){this.canvas.style.width="100%",this.canvas.style.height="100%",this._computeFitAndFill(this.canvas.offsetWidth,this.canvas.offsetHeight,{width:100,widthUnit:"percent",height:100,heightUnit:"percent"}),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitAndFill(t,e,i){if(this.viewport=i??{width:t,height:e},t/e<=this._contentResolution.width/this._contentResolution.height){this.resolution={width:t*this._contentResolution.width/t,height:t*this._contentResolution.width/t*e/t};const s=(this.resolution.height-this._contentResolution.height)/2;this._contentArea=new E({top:s,left:0,right:this._contentResolution.width,bottom:this.resolution.height-s}),this._unsafeArea=new E({top:-s,left:0,right:this._contentResolution.width,bottom:this.resolution.height+s})}else{this.resolution={width:e*this._contentResolution.height/e*t/e,height:e*this._contentResolution.height/e};const s=(this.resolution.width-this._contentResolution.width)/2;this._contentArea=new E({top:0,left:s,right:this.resolution.width-s,bottom:this._contentResolution.height}),this._unsafeArea=new E({top:0,left:-s,right:this.resolution.width+s,bottom:this._contentResolution.height})}}_computeFitScreenAndZoom(){document.body.style.margin="0px",document.body.style.overflow="hidden",this.canvas.style.position="absolute";const t=window.innerWidth,e=window.innerHeight;this._computeFitAndZoom(t,e),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitContainerAndZoom(){this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="relative";const t=this.canvas.parentElement;t.style.overflow="hidden";const{offsetWidth:e,offsetHeight:i}=this.canvas;this._computeFitAndZoom(e,i),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_computeFitAndZoom(t,e){const i=this.aspectRatio;let s=0,r=0;t/i<e?(s=t,r=t/i):(s=e*i,r=e);const o=t/s,a=e/r,u=Math.max(o,a),T=s*u,P=r*u;T>t?this.canvas.style.left=-(T-t)/2+"px":this.canvas.style.left="",P>e?this.canvas.style.top=-(P-e)/2+"px":this.canvas.style.top="",this.viewport={width:T,height:P};const N=E.fromDimension(this.viewport.width,this.viewport.height,h.Zero);if(this.viewport.width>t){const J=(this.viewport.width-t)/this.viewport.width*this.resolution.width;N.top=0,N.left=J/2,N.right=this.resolution.width-J/2,N.bottom=this.resolution.height}if(this.viewport.height>e){const J=(this.viewport.height-e)/this.viewport.height*this.resolution.height;N.top=J/2,N.left=0,N.bottom=this.resolution.height-J/2,N.right=this.resolution.width}this._contentArea=N}_computeFitContainer(){const t=this.aspectRatio;let e=0,i=0,s="pixel",r="pixel";const o=this.canvas.parentElement;o.clientWidth/t<o.clientHeight?(this.canvas.style.width="100%",e=100,s="percent",i=this.canvas.offsetWidth/t):(this.canvas.style.height="100%",i=100,r="percent",e=this.canvas.offsetHeight*t),this.viewport={width:e,widthUnit:s,height:i,heightUnit:r},this._contentArea=E.fromDimension(this.resolution.width,this.resolution.height,h.Zero),this.events.emit("resize",{resolution:this.resolution,viewport:this.viewport})}_applyDisplayMode(){this._setResolutionAndViewportByDisplayMode(this.parent),this.parent instanceof Window?this._browser.window.on("resize",this._resizeHandler):(this._resizeObserver=new ResizeObserver(()=>{this._resizeHandler()}),this._resizeObserver.observe(this.parent)),this.parent.addEventListener("resize",this._resizeHandler)}_setResolutionAndViewportByDisplayMode(t){this.displayMode===we.FillContainer&&(this.canvas.style.width="100%",this.canvas.style.height="100%",this.viewport={width:100,widthUnit:"percent",height:100,heightUnit:"percent"},this.resolution={width:this.canvas.offsetWidth,height:this.canvas.offsetHeight}),this.displayMode===we.FillScreen&&(document.body.style.margin="0px",document.body.style.overflow="hidden",this.resolution={width:t.innerWidth,height:t.innerHeight},this.viewport=this.resolution),this._contentArea=E.fromDimension(this.resolution.width,this.resolution.height,h.Zero),this.displayMode===we.FitScreen&&this._computeFit(),this.displayMode===we.FitContainer&&this._computeFitContainer(),this.displayMode===we.FitScreenAndFill&&this._computeFitScreenAndFill(),this.displayMode===we.FitContainerAndFill&&this._computeFitContainerAndFill(),this.displayMode===we.FitScreenAndZoom&&this._computeFitScreenAndZoom(),this.displayMode===we.FitContainerAndZoom&&this._computeFitContainerAndZoom()}}class Ei{static create(){return this._INSTANCE||(window.AudioContext||window.webkitAudioContext)&&(this._INSTANCE=new AudioContext),this._INSTANCE}}Ei._INSTANCE=null;function pr(n){return!!n.playbackState}class pi{static unlock(){return new Promise((e,i)=>{if(pi._UNLOCKED||!Ei.create())return e(!0);const s=setTimeout(()=>{I.getInstance().warn("Excalibur was unable to unlock the audio context, audio probably will not play in this browser."),e(!1)},200),r=Ei.create();r.resume().then(()=>{const o=r.createBuffer(1,1,22050),a=r.createBufferSource();let u=!1;a.buffer=o,a.connect(r.destination),a.onended=()=>u=!0,a.start(0),setTimeout(()=>{pr(a)?(a.playbackState===a.PLAYING_STATE||a.playbackState===a.FINISHED_STATE)&&(pi._UNLOCKED=!0):(r.currentTime>0||u)&&(pi._UNLOCKED=!0)},0),clearTimeout(s),e(!0)},()=>{i()})})}static isUnlocked(){return this._UNLOCKED}}pi._UNLOCKED=!1;class Bi extends it{constructor(t){var e,i,s,r,o,a,u,T,P,N;super(dt(t,["width","height"])),this.filtering=null,this.lineCap="butt",this.quality=1,this._dirty=!0,this._smoothing=!1,this._color=Mt(p.Black,()=>this.flagDirty()),this._lineWidth=1,this._lineDash=[],this._padding=0,t&&(this.quality=(e=t.quality)!==null&&e!==void 0?e:this.quality,this.color=(i=t.color)!==null&&i!==void 0?i:p.Black,this.strokeColor=t==null?void 0:t.strokeColor,this.smoothing=(s=t.smoothing)!==null&&s!==void 0?s:this.smoothing,this.lineWidth=(r=t.lineWidth)!==null&&r!==void 0?r:this.lineWidth,this.lineDash=(o=t.lineDash)!==null&&o!==void 0?o:this.lineDash,this.lineCap=(a=t.lineCap)!==null&&a!==void 0?a:this.lineCap,this.padding=(u=t.padding)!==null&&u!==void 0?u:this.padding,this.filtering=(T=t.filtering)!==null&&T!==void 0?T:this.filtering),this._bitmap=document.createElement("canvas");const J=(P=t==null?void 0:t.width)!==null&&P!==void 0?P:this._bitmap.width,nt=(N=t==null?void 0:t.height)!==null&&N!==void 0?N:this._bitmap.height;this.width=J,this.height=nt;const at=this._bitmap.getContext("2d");if(at)this._ctx=at;else throw new Error("Browser does not support 2d canvas drawing, cannot create Raster graphic")}cloneRasterOptions(){return{color:this.color?this.color.clone():null,strokeColor:this.strokeColor?this.strokeColor.clone():null,smoothing:this.smoothing,lineWidth:this.lineWidth,lineDash:this.lineDash,lineCap:this.lineCap,quality:this.quality,padding:this.padding}}get dirty(){return this._dirty}flagDirty(){this._dirty=!0}get width(){return Math.abs(this._getTotalWidth()*this.scale.x)}set width(t){t/=Math.abs(this.scale.x),this._bitmap.width=t,this._originalWidth=t,this.flagDirty()}get height(){return Math.abs(this._getTotalHeight()*this.scale.y)}set height(t){t/=Math.abs(this.scale.y),this._bitmap.height=t,this._originalHeight=t,this.flagDirty()}_getTotalWidth(){var t;return(((t=this._originalWidth)!==null&&t!==void 0?t:this._bitmap.width)+this.padding*2)*1}_getTotalHeight(){var t;return(((t=this._originalHeight)!==null&&t!==void 0?t:this._bitmap.height)+this.padding*2)*1}get localBounds(){return E.fromDimension(this._getTotalWidth()*this.scale.x,this._getTotalHeight()*this.scale.y,h.Zero)}get smoothing(){return this._smoothing}set smoothing(t){this._smoothing=t,this.flagDirty()}get color(){return this._color}set color(t){this.flagDirty(),this._color=Mt(t,()=>this.flagDirty())}get strokeColor(){return this._strokeColor}set strokeColor(t){this.flagDirty(),this._strokeColor=Mt(t,()=>this.flagDirty())}get lineWidth(){return this._lineWidth}set lineWidth(t){this._lineWidth=t,this.flagDirty()}get lineDash(){return this._lineDash}set lineDash(t){this._lineDash=t,this.flagDirty()}get padding(){return this._padding}set padding(t){this._padding=t,this.flagDirty()}rasterize(){this._dirty=!1,this._ctx.clearRect(0,0,this._getTotalWidth(),this._getTotalHeight()),this._ctx.save(),this._applyRasterProperties(this._ctx),this.execute(this._ctx),this._ctx.restore()}_applyRasterProperties(t){var e,i,s;this._bitmap.width=this._getTotalWidth()*this.quality,this._bitmap.height=this._getTotalHeight()*this.quality,this._bitmap.setAttribute("filtering",this.filtering),this._bitmap.setAttribute("forceUpload","true"),t.scale(this.quality,this.quality),t.translate(this.padding,this.padding),t.imageSmoothingEnabled=this.smoothing,t.lineWidth=this.lineWidth,t.setLineDash((e=this.lineDash)!==null&&e!==void 0?e:t.getLineDash()),t.lineCap=this.lineCap,t.strokeStyle=(i=this.strokeColor)===null||i===void 0?void 0:i.toString(),t.fillStyle=(s=this.color)===null||s===void 0?void 0:s.toString()}_drawImage(t,e,i){this._dirty&&this.rasterize(),t.scale(1/this.quality,1/this.quality),t.drawImage(this._bitmap,e,i)}}class Zi extends Bi{get ctx(){return this._ctx}constructor(t){super(t),this._options=t}clone(){return new Zi({...this._options,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){var e,i;!((e=this._options)===null||e===void 0)&&e.draw&&((i=this._options)===null||i===void 0||i.draw(t)),this._options.cache||this.flagDirty()}}class As{}As.type={any:"",blob:"blob",json:"json",text:"text",document:"document",arraybuffer:"arraybuffer"};class Yi{constructor(){this.states=new Map}get currentState(){return this._currentState}set currentState(t){this._currentState=t}static create(t,e){const i=new Yi;i.data=e;for(const s in t.states)i.states.set(s,{name:s,...t.states[s]});for(const s of i.states.values())for(const r of s.transitions)if(r!=="*"&&!i.states.has(r))throw Error(`Invalid state machine, state [${s.name}] has a transition to another state that doesn't exist [${r}]`);return i.currentState=i.startState=i.states.get(t.start),i}in(t){return this.currentState.name===t}go(t,e){var i,s;if(this.currentState.transitions.includes(t)||this.currentState.transitions.includes("*")){const r=this.states.get(t);return this.currentState.onExit&&((i=this.currentState)===null||i===void 0?void 0:i.onExit({to:r.name,data:this.data}))===!1||r!=null&&r.onEnter&&(r==null?void 0:r.onEnter({from:this.currentState.name,eventData:e,data:this.data}))===!1?!1:(this.currentState=r,!((s=this.currentState)===null||s===void 0)&&s.onState&&this.currentState.onState(),!0)}return!1}update(t){this.currentState.onUpdate&&this.currentState.onUpdate(this.data,t)}save(t){localStorage.setItem(t,JSON.stringify({currentState:this.currentState.name,data:this.data}))}restore(t){const e=JSON.parse(localStorage.getItem(t));this.currentState=this.states.get(e.currentState),this.data=e.data}}class js{_createNewBufferSource(){this._instance=this._audioContext.createBufferSource(),this._instance.buffer=this._src,this._instance.loop=this.loop,this._instance.playbackRate.value=this._playbackRate,this._instance.connect(this._volumeNode),this._volumeNode.connect(this._audioContext.destination)}_handleEnd(){this.loop||(this._instance.onended=()=>{this._playingFuture.resolve(!0)})}set loop(t){this._loop=t,this._instance&&(this._instance.loop=t,this.loop||(this._instance.onended=()=>{this._playingFuture.resolve(!0)}))}get loop(){return this._loop}set volume(t){t=D(t,0,1),this._volume=t,this._stateMachine.in("PLAYING")&&this._volumeNode.gain.setTargetAtTime?this._volumeNode.gain.setTargetAtTime(t,this._audioContext.currentTime,.1):this._volumeNode.gain.value=t}get volume(){return this._volume}get duration(){var t;return(t=this._duration)!==null&&t!==void 0?t:this.getTotalPlaybackDuration()}set duration(t){this._duration=t}constructor(t){this._src=t,this._audioContext=Ei.create(),this._volumeNode=this._audioContext.createGain(),this._playingFuture=new X,this._stateMachine=Yi.create({start:"STOPPED",states:{PLAYING:{onEnter:({data:e})=>{this._createNewBufferSource(),this._handleEnd(),this.loop?this._instance.start(0,e.pausedAt*this._playbackRate):this._instance.start(0,e.pausedAt*this._playbackRate,this.duration),e.startedAt=this._audioContext.currentTime-e.pausedAt,e.pausedAt=0},onState:()=>this._playStarted(),onExit:({to:e})=>{e==="STOPPED"&&this._playingFuture.resolve(!0),this._instance.onended=null,this._instance.disconnect(),this._instance.stop(0),this._instance=null},transitions:["STOPPED","PAUSED","SEEK"]},SEEK:{onEnter:({eventData:e,data:i})=>{i.pausedAt=(e??0)/this._playbackRate,i.startedAt=0},transitions:["*"]},STOPPED:{onEnter:({data:e})=>{e.pausedAt=0,e.startedAt=0,this._playingFuture.resolve(!0)},transitions:["PLAYING","PAUSED","SEEK"]},PAUSED:{onEnter:({data:e})=>{e.pausedAt=this._audioContext.currentTime-e.startedAt},transitions:["PLAYING","STOPPED","SEEK"]}}},{startedAt:0,pausedAt:0}),this._volume=1,this._loop=!1,this._playStarted=()=>{},this._playbackRate=1,this._createNewBufferSource()}isPlaying(){return this._stateMachine.in("PLAYING")}isPaused(){return this._stateMachine.in("PAUSED")||this._stateMachine.in("SEEK")}isStopped(){return this._stateMachine.in("STOPPED")}play(t=()=>{}){return this._playStarted=t,this._stateMachine.go("PLAYING"),this._playingFuture.promise}pause(){this._stateMachine.go("PAUSED")}stop(){this._stateMachine.go("STOPPED")}seek(t){this._stateMachine.go("PAUSED"),this._stateMachine.go("SEEK",t)}getTotalPlaybackDuration(){return this._src.duration}getPlaybackPosition(){const{pausedAt:t,startedAt:e}=this._stateMachine.data;return t?t*this._playbackRate:e?(this._audioContext.currentTime-e)*this._playbackRate:0}set playbackRate(t){this._instance.playbackRate.value=this._playbackRate=t}get playbackRate(){return this._instance.playbackRate.value}}var qi;(function(n){n.Kill="kill",n.PreKill="prekill",n.PostKill="postkill",n.PreDraw="predraw",n.PostDraw="postdraw",n.PreDebugDraw="predebugdraw",n.PostDebugDraw="postdebugdraw",n.PreUpdate="preupdate",n.PostUpdate="postupdate",n.PreFrame="preframe",n.PostFrame="postframe",n.PreCollision="precollision",n.CollisionStart="collisionstart",n.CollisionEnd="collisionend",n.PostCollision="postcollision",n.Initialize="initialize",n.Activate="activate",n.Deactivate="deactivate",n.ExitViewport="exitviewport",n.EnterViewport="enterviewport",n.ExitTrigger="exit",n.EnterTrigger="enter",n.Connect="connect",n.Disconnect="disconnect",n.Button="button",n.Axis="axis",n.Visible="visible",n.Hidden="hidden",n.Start="start",n.Stop="stop",n.PointerUp="pointerup",n.PointerDown="pointerdown",n.PointerMove="pointermove",n.PointerEnter="pointerenter",n.PointerLeave="pointerleave",n.PointerCancel="pointercancel",n.PointerWheel="pointerwheel",n.Up="up",n.Down="down",n.Move="move",n.Enter="enter",n.Leave="leave",n.Cancel="cancel",n.Wheel="wheel",n.Press="press",n.Release="release",n.Hold="hold",n.PointerDragStart="pointerdragstart",n.PointerDragEnd="pointerdragend",n.PointerDragEnter="pointerdragenter",n.PointerDragLeave="pointerdragleave",n.PointerDragMove="pointerdragmove",n.ActionStart="actionstart",n.ActionComplete="actioncomplete"})(qi||(qi={}));class te{constructor(){this._bubbles=!0}get bubbles(){return this._bubbles}set bubbles(t){this._bubbles=t}stopPropagation(){this.bubbles=!1}}class Vi extends te{constructor(t){super(),this.target=t}}class gs extends te{constructor(t){super(),this.target=t}}class Li extends te{constructor(t){super(),this.target=t}}class ps extends te{constructor(t){super(),this.target=t}}class fs extends te{constructor(t){super(),this.target=t}}class Ti extends te{constructor(t,e,i){super(),this.ctx=t,this.delta=e,this.target=i}}class Si extends te{constructor(t,e,i){super(),this.ctx=t,this.delta=e,this.target=i}}class _s extends te{constructor(t,e,i){super(),this.ctx=t,this.delta=e,this.target=i}}class ms extends te{constructor(t,e,i){super(),this.ctx=t,this.delta=e,this.target=i}}class vs extends te{constructor(t,e){super(),this.ctx=t,this.target=e}}class ws extends te{constructor(t,e){super(),this.ctx=t,this.target=e}}class ai extends te{constructor(t,e,i){super(),this.engine=t,this.delta=e,this.target=i}}class li extends te{constructor(t,e,i){super(),this.engine=t,this.delta=e,this.target=i}}class j extends te{constructor(t,e){super(),this.engine=t,this.prevStats=e,this.target=t}}class c extends te{constructor(t,e){super(),this.engine=t,this.stats=e,this.target=t}}class _ extends te{constructor(t,e){super(),this.index=t,this.gamepad=e,this.target=e}}class z extends te{constructor(t,e){super(),this.index=t,this.gamepad=e,this.target=e}}class tt extends te{constructor(t,e,i){super(),this.button=t,this.value=e,this.target=i}}class Pt extends te{constructor(t,e,i){super(),this.axis=t,this.value=e,this.target=i}}class kt extends te{constructor(t){super(),this.target=t}}class mt extends te{constructor(t){super(),this.target=t}}class Lt extends te{constructor(t,e,i,s,r){super(),this.other=e,this.side=i,this.intersection=s,this.contact=r,this.target=t}}class Nt extends te{constructor(t,e,i,s,r){super(),this.other=e,this.side=i,this.intersection=s,this.contact=r,this.target=t}get actor(){return this.target}set actor(t){this.target=t}}class ue{constructor(t,e,i,s){this.target=t,this.other=e,this.side=i,this.contact=s}}class hi{constructor(t,e,i,s){this.target=t,this.other=e,this.side=i,this.lastContact=s}}class Ri{constructor(t,e,i,s,r){this.target=t,this.other=e,this.side=i,this.intersection=s,this.contact=r}}class fr{constructor(t,e,i,s,r){this.target=t,this.other=e,this.side=i,this.intersection=s,this.contact=r}}class Hs extends te{constructor(t,e,i,s){super(),this.other=e,this.side=i,this.contact=s,this.target=t}get actor(){return this.target}set actor(t){this.target=t}}class Ws extends te{constructor(t,e,i,s){super(),this.other=e,this.side=i,this.lastContact=s,this.target=t}get actor(){return this.target}set actor(t){this.target=t}}class ys extends te{constructor(t,e){super(),this.engine=t,this.target=e}}class zr extends te{constructor(t,e){super(),this.context=t,this.target=e}}class Or extends te{constructor(t,e){super(),this.context=t,this.target=e}}class Nr extends te{constructor(t){super(),this.target=t}}class Gr extends te{constructor(t){super(),this.target=t}}class Ur extends te{constructor(t,e){super(),this.target=t,this.actor=e}}class jr extends te{constructor(t,e){super(),this.target=t,this.actor=e}}class Hr extends te{constructor(t,e){super(),this.action=t,this.target=e}}class Wr extends te{constructor(t,e){super(),this.action=t,this.target=e}}class Zr extends te{set bubbles(t){}get bubbles(){return!1}get _path(){return null}set _path(t){}constructor(t,e="MediaEvent"){super(),this.target=t,this._name=e}stopPropagation(){}action(){}propagate(){}layPath(t){}}class Xi extends Zr{constructor(t,e){super(t,"NativeSoundEvent"),this.track=e}}class xn extends Zr{constructor(t,e){super(t,"NativeSoundProcessedEvent"),this._processedData=e,this.data=this._processedData}}function sa(n){try{const t=new Audio,e=/.*\.([A-Za-z0-9]+)(?:(?:\?|\#).*)*$/,i=n.match(e)[1];return!!t.canPlayType("audio/"+i)}catch(t){return I.getInstance().warn("Cannot determine audio support, assuming no support for the Audio Tag",t),!1}}const ra={VolumeChange:"volumechange",Processed:"processed",Pause:"pause",Stop:"stop",PlaybackEnd:"playbackend",Resume:"resume",PlaybackStart:"playbackstart"};class bn{set loop(t){this._loop=t;for(const e of this._tracks)e.loop=this._loop;this.logger.debug("Set loop for all instances of sound",this.path,"to",this._loop)}get loop(){return this._loop}set volume(t){this._volume=t;for(const e of this._tracks)e.volume=this._volume;this.events.emit("volumechange",new Xi(this)),this.logger.debug("Set loop for all instances of sound",this.path,"to",this._volume)}get volume(){return this._volume}get duration(){return this._duration}set duration(t){this._duration=t}get instances(){return this._tracks}get path(){return this._resource.path}set path(t){this._resource.path=t}get bustCache(){return this._resource.bustCache}set bustCache(t){this._resource.bustCache=t}constructor(...t){this.events=new k,this.logger=I.getInstance(),this._loop=!1,this._volume=1,this._isStopped=!1,this._tracks=[],this._wasPlayingOnHidden=!1,this._playbackRate=1,this._audioContext=Ei.create(),this._resource=new zt("",As.type.arraybuffer);for(const e of t)if(sa(e)){this.path=e;break}this.path||(this.logger.warn("This browser does not support any of the audio files specified:",t.join(", ")),this.logger.warn("Attempting to use",t[0]),this.path=t[0])}isLoaded(){return!!this.data}async load(){var t,e;if(this.data)return this.data;const i=await this._resource.load(),s=await this.decodeAudio(i.slice(0));return this._duration=(e=(t=this._duration)!==null&&t!==void 0?t:s==null?void 0:s.duration)!==null&&e!==void 0?e:void 0,this.events.emit("processed",new xn(this,s)),this.data=s}async decodeAudio(t){try{return await this._audioContext.decodeAudioData(t.slice(0))}catch{return this.logger.error("Unable to decode  this browser may not fully support this format, or the file may be corrupt, if this is an mp3 try removing id3 tags and album art from the file."),await Promise.reject()}}wireEngine(t){t&&(this._engine=t,this._engine.on("hidden",()=>{t.pauseAudioWhenHidden&&this.isPlaying()&&(this._wasPlayingOnHidden=!0,this.pause())}),this._engine.on("visible",()=>{t.pauseAudioWhenHidden&&this._wasPlayingOnHidden&&(this.play(),this._wasPlayingOnHidden=!1)}),this._engine.on("start",()=>{this._isStopped=!1}),this._engine.on("stop",()=>{this.stop(),this._isStopped=!0}))}instanceCount(){return this._tracks.length}isPlaying(){return this._tracks.some(t=>t.isPlaying())}isPaused(){return this._tracks.some(t=>t.isPaused())}isStopped(){return this._tracks.some(t=>t.isStopped())}play(t){return this.isLoaded()?this._isStopped?(this.logger.warn("Cannot start playing. Engine is in a stopped state."),Promise.resolve(!1)):(this.volume=t||this.volume,this.isPaused()?this._resumePlayback():this._startPlayback()):(this.logger.warn("Cannot start playing. Resource",this.path,"is not loaded yet"),Promise.resolve(!0))}pause(){if(this.isPlaying()){for(const t of this._tracks)t.pause();this.events.emit("pause",new Xi(this)),this.logger.debug("Paused all instances of sound",this.path)}}stop(){for(const t of this._tracks)t.stop();this.events.emit("stop",new Xi(this)),this._tracks.length=0,this.logger.debug("Stopped all instances of sound",this.path)}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._tracks.forEach(e=>{e.playbackRate=this._playbackRate})}seek(t,e=0){this._tracks.length===0&&this._getTrackInstance(this.data),this._tracks[e].seek(t)}getTotalPlaybackDuration(){return this.isLoaded()?this.data.duration:(this.logger.warnOnce(`Sound from ${this.path} is not loaded, cannot return total playback duration.Did you forget to add Sound to a loader? https://excaliburjs.com/docs/loaders/`),0)}getPlaybackPosition(t=0){return this._tracks.length?this._tracks[t].getPlaybackPosition():0}getTrackId(t){return this._tracks.indexOf(t)}async _resumePlayback(){if(this.isPaused){const t=[];for(const e of this._tracks)t.push(e.play().then(()=>(this._tracks.splice(this.getTrackId(e),1),!0)));this.events.emit("resume",new Xi(this)),this.logger.debug("Resuming paused instances for sound",this.path,this._tracks),await Promise.all(t)}return!0}async _startPlayback(){const t=this._getTrackInstance(this.data),e=await t.play(()=>{this.events.emit("playbackstart",new Xi(this,t)),this.logger.debug("Playing new instance for sound",this.path)});this.events.emit("playbackend",new Xi(this,t));const i=this.getTrackId(t);return i!==-1&&this._tracks.splice(i,1),e}_getTrackInstance(t){const e=new js(t);return e.loop=this.loop,e.volume=this.volume,e.duration=this.duration,e.playbackRate=this._playbackRate,this._tracks.push(e),e}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}}const na={BeforeLoad:"beforeload",AfterLoad:"afterload",UserAction:"useraction",LoadResourceStart:"loadresourcestart",LoadResourceEnd:"loadresourceend"};function Yr(n){var t,e;return!!(n!=null&&n.prototype)&&!!(!((e=(t=n==null?void 0:n.prototype)===null||t===void 0?void 0:t.constructor)===null||e===void 0)&&e.name)}class Zs{get resources(){return this._resources}constructor(t){var e;this.events=new k,this.canvas=new Zi({filtering:F.Blended,smoothing:!0,cache:!1,draw:this.onDraw.bind(this)}),this._resources=[],this._numLoaded=0,this._totalTimeMs=0,this._loadingFuture=new X,t&&(!((e=t.loadables)===null||e===void 0)&&e.length)&&this.addResources(t.loadables)}onInitialize(t){this.engine=t,this.canvas.width=this.engine.screen.resolution.width,this.canvas.height=this.engine.screen.resolution.height}async onUserAction(){return await Promise.resolve()}async onBeforeLoad(){}async onAfterLoad(){await Et(500,this.engine.clock)}addResource(t){this._resources.push(t)}addResources(t){let e=0;const i=t.length;for(e;e<i;e++)this.addResource(t[e])}markResourceComplete(){this._numLoaded++}get progress(){const t=this._resources.length;return t>0?D(this._numLoaded,0,t)/t:1}isLoaded(){return this._numLoaded===this._resources.length}onUpdate(t,e){this._totalTimeMs+=e}onDraw(t){const e=this._totalTimeMs/1e3;t.fillStyle=p.Black.toRGBA(),t.fillRect(0,0,this.engine.screen.resolution.width,this.engine.screen.resolution.height),t.save(),t.translate(this.engine.screen.resolution.width/2,this.engine.screen.resolution.height/2);const i=e*10;t.strokeStyle="white",t.lineWidth=10,t.lineCap="round",t.arc(0,0,40,i,i+Math.PI*3/2),t.stroke(),t.fillStyle="white",t.font="16px sans-serif";const s=(this.progress*100).toFixed(0)+"%",r=t.measureText(s),o=Math.abs(r.actualBoundingBoxLeft)+Math.abs(r.actualBoundingBoxRight),a=Math.abs(r.actualBoundingBoxAscent)+Math.abs(r.actualBoundingBoxDescent);t.fillText(s,-o/2,a/2),t.restore()}areResourcesLoaded(){return this._loadingFuture.promise}async load(){await this.onBeforeLoad(),this.events.emit("beforeload"),this.canvas.flagDirty(),await Promise.all(this._resources.map(async t=>{this.events.emit("loadresourcestart",t),await t.load().finally(()=>{this._numLoaded++,this.canvas.flagDirty(),this.events.emit("loadresourceend",t)})}));for(const t of this._resources)t instanceof bn&&t.wireEngine(this.engine);return this._loadingFuture.resolve(),this.canvas.flagDirty(),await this.onUserAction(),this.events.emit("useraction"),await pi.unlock(),await this.onAfterLoad(),this.events.emit("afterload"),this.data=this._resources}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}}function qr(n,t=p.Red,e,i,s,r,o=1,a="butt"){n.save(),n.beginPath(),n.lineWidth=o,n.lineCap=a,n.strokeStyle=t.toString(),n.moveTo(e,i),n.lineTo(s,r),n.closePath(),n.stroke(),n.restore()}function oa(n,t=p.Red,e){n.beginPath(),n.strokeStyle=t.toString(),n.arc(e.x,e.y,5,0,Math.PI*2),n.closePath(),n.stroke()}function aa(n,t,e,i,s=1){const r=t?t.toString():"blue",o=i.scale(s);n.beginPath(),n.strokeStyle=r,n.moveTo(e.x,e.y),n.lineTo(e.x+o.x,e.y+o.y),n.closePath(),n.stroke()}function Vr(n,t,e,i,s,r=5,o=p.White,a=null){let u;if(typeof r=="number")u={tl:r,tr:r,br:r,bl:r};else{const T={tl:0,tr:0,br:0,bl:0};for(const P in T)if(T.hasOwnProperty(P)){const N=P;u[N]=r[N]||T[N]}}n.beginPath(),n.moveTo(t+u.tl,e),n.lineTo(t+i-u.tr,e),n.quadraticCurveTo(t+i,e,t+i,e+u.tr),n.lineTo(t+i,e+s-u.br),n.quadraticCurveTo(t+i,e+s,t+i-u.br,e+s),n.lineTo(t+u.bl,e+s),n.quadraticCurveTo(t,e+s,t,e+s-u.bl),n.lineTo(t,e+u.tl),n.quadraticCurveTo(t,e,t+u.tl,e),n.closePath(),a&&(n.fillStyle=a.toString(),n.fill()),o&&(n.strokeStyle=o.toString(),n.stroke())}function la(n,t,e,i,s=p.White,r=null){n.beginPath(),n.arc(t,e,i,0,Math.PI*2),n.closePath(),r&&(n.fillStyle=r.toString(),n.fill()),s&&(n.strokeStyle=s.toString(),n.stroke())}const ha="data:image/png;base64,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";var ca=fe(8851);class Ji extends Zs{get _image(){return this._imageElement||(this._imageElement=new Image,this._imageElement.onload=()=>this._imageLoaded.resolve(),this._imageElement.src=this.logo),this._imageElement}get playButtonRootElement(){return this._playButtonRootElement}get playButtonElement(){return this._playButtonElement}get _playButton(){const t=document.getElementById("excalibur-play-root");return t&&(this._playButtonRootElement=t),this._playButtonRootElement||(this._playButtonRootElement=document.createElement("div"),this._playButtonRootElement.id="excalibur-play-root",this._playButtonRootElement.style.position="absolute",document.body.appendChild(this._playButtonRootElement)),this._styleBlock||(this._styleBlock=document.createElement("style"),this._styleBlock.textContent=this._playButtonStyles,document.head.appendChild(this._styleBlock)),this._playButtonElement||(this._playButtonElement=this.startButtonFactory(),this._playButtonRootElement.appendChild(this._playButtonElement)),this._playButtonElement}constructor(t){const e=Array.isArray(t)?{loadables:t}:t;super(e),this._logger=I.getInstance(),this._originalOptions={loadables:[]},this.events=new k,this._playButtonShown=!1,this.logo=ha,this.logoWidth=468,this.logoHeight=118,this.loadingBarColor=p.White,this.backgroundColor="#176BAA",this._imageLoaded=new X,this.suppressPlayButton=!1,this._playButtonStyles=ca.A.toString(),this.playButtonText="Play game",this.startButtonFactory=()=>{let i=document.getElementById("excalibur-play");return i||(i=document.createElement("button")),i.id="excalibur-play",i.textContent=this.playButtonText,i.style.display="none",i},this._configuredPixelRatio=null,this._originalOptions={...Ji._DEFAULT_LOADER_OPTIONS,...e}}onInitialize(t){this.engine=t,this.screen=t.screen,this.canvas.width=this.engine.canvas.width,this.canvas.height=this.engine.canvas.height,this.screen.events.on("resize",()=>{this.canvas.width=this.engine.canvas.width,this.canvas.height=this.engine.canvas.height})}async showPlayButton(){var t,e;if(this.suppressPlayButton)this.hidePlayButton(),await Et(500,(t=this.engine)===null||t===void 0?void 0:t.clock);else{const i=()=>{try{this._positionPlayButton()}catch{}};return!((e=this.engine)===null||e===void 0)&&e.browser&&this.engine.browser.window.on("resize",i),this._playButtonShown=!0,this._playButton.style.display="block",document.body.addEventListener("keyup",r=>{r.key==="Enter"&&this._playButton.click()}),this._positionPlayButton(),await new Promise(r=>{const o=a=>{var u;if(a.stopPropagation(),this.hidePlayButton(),!((u=this.engine)===null||u===void 0)&&u.browser&&this.engine.browser.window.off("resize",i),this._originalOptions.fullscreenAfterLoad)try{this._logger.info("requesting fullscreen"),this._originalOptions.fullscreenContainer instanceof HTMLElement?this._originalOptions.fullscreenContainer.requestFullscreen():this.engine.screen.goFullScreen(this._originalOptions.fullscreenContainer)}catch(T){this._logger.error("could not go fullscreen",T)}r()};this._playButton.addEventListener("click",o),this._playButton.addEventListener("touchend",o),this._playButton.addEventListener("pointerup",o)})}}hidePlayButton(){this._playButtonShown=!1,this._playButton.style.display="none"}dispose(){this._playButtonRootElement.parentElement&&(this._playButtonRootElement.removeChild(this._playButtonElement),document.body.removeChild(this._playButtonRootElement),document.head.removeChild(this._styleBlock),this._playButtonRootElement=null,this._playButtonElement=null,this._styleBlock=null)}async onUserAction(){var t;await Et(200,(t=this.engine)===null||t===void 0?void 0:t.clock),this.canvas.flagDirty(),await this.showPlayButton()}async onBeforeLoad(){const t=this._image;await this._imageLoaded.promise,await(t==null?void 0:t.decode())}async onAfterLoad(){this.screen.pixelRatioOverride=this._configuredPixelRatio,this.screen.popResolutionAndViewport(),this.screen.applyResolutionAndViewport(),this.dispose()}_positionPlayButton(){if(this.engine){const{x:t,y:e,width:i,height:s}=this.engine.canvas.getBoundingClientRect();if(this._playButtonRootElement){const r=this._playButton.clientWidth,o=this._playButton.clientHeight;this.playButtonPosition?(this._playButtonRootElement.style.left=`${this.playButtonPosition.x}px`,this._playButtonRootElement.style.top=`${this.playButtonPosition.y}px`):(this._playButtonRootElement.style.left=`${t+i/2-r/2}px`,this._playButtonRootElement.style.top=`${e+s/2-o/2+100}px`)}}}onDraw(t){const e=this.engine.canvasHeight/this.engine.pixelRatio,i=this.engine.canvasWidth/this.engine.pixelRatio;this._positionPlayButton(),t.fillStyle=this.backgroundColor,t.fillRect(0,0,i,e);let s=e/2;const r=Math.min(this.logoWidth,i*.75);let o=i/2-r/2;this.logoPosition&&(o=this.logoPosition.x,s=this.logoPosition.y);const a=Math.floor(r*(this.logoHeight/this.logoWidth)),u=this.engine.getAntialiasing();if(this.engine.setAntialiasing(!0),this.logoPosition?t.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,o,s,r,a):t.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,o,s-a-20,r,a),!this.suppressPlayButton&&this._playButtonShown){this.engine.setAntialiasing(u);return}let T=o,P=s;this.loadingBarPosition&&(T=this.loadingBarPosition.x,P=this.loadingBarPosition.y),t.lineWidth=2,Vr(t,T,P,r,20,10,this.loadingBarColor);const N=r*this.progress,J=5,nt=N-J*2,at=20-J*2;Vr(t,T+J,P+J,nt>10?nt:10,at,5,null,this.loadingBarColor),this.engine.setAntialiasing(u)}}Ji._DEFAULT_LOADER_OPTIONS={loadables:[],fullscreenAfterLoad:!1,fullscreenContainer:void 0};const Cn={webgl:"WebGL",webaudio:"WebAudio",gamepadapi:"Gamepad API"};class In{constructor(){this._features=null,this.failedTests=[],this._criticalTests={canvasSupport:function(){const t=document.createElement("canvas");return!!(t.getContext&&t.getContext("2d"))},arrayBufferSupport:function(){const t=new XMLHttpRequest;t.open("GET","/");try{t.responseType="arraybuffer"}catch{return!1}return t.responseType==="arraybuffer"},dataUrlSupport:function(){return document.createElement("canvas").toDataURL("image/png").indexOf("data:image/png")===0},objectUrlSupport:function(){return"URL"in window&&"revokeObjectURL"in URL&&"createObjectURL"in URL},rgbaSupport:function(){const t=document.createElement("a").style;return t.cssText="background-color:rgba(150,255,150,.5)",(""+t.backgroundColor).indexOf("rgba")>-1}},this._warningTest={webAudioSupport:function(){return!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext)},webglSupport:function(){const t=document.createElement("canvas");return!!(t.getContext&&t.getContext("webgl"))}},this._features=this._loadBrowserFeatures()}getBrowserFeatures(){return this._features===null&&(this._features=this._loadBrowserFeatures()),this._features}logBrowserFeatures(){let t=`%cSUPPORTED BROWSER FEATURES
==========================%c
`;const e=["font-weight: bold; color: navy","font-weight: normal; color: inherit"],i=this.getBrowserFeatures();for(const s of Object.keys(Cn))i[s]?(t+="(%c✓%c)",e.push("font-weight: bold; color: green"),e.push("font-weight: normal; color: inherit")):(t+="(%c✗%c)",e.push("font-weight: bold; color: red"),e.push("font-weight: normal; color: inherit")),t+=" "+Cn[s]+`
`;e.unshift(t),console.log.apply(console,e)}_loadBrowserFeatures(){return{canvas:this._criticalTests.canvasSupport(),arraybuffer:this._criticalTests.arrayBufferSupport(),dataurl:this._criticalTests.dataUrlSupport(),objecturl:this._criticalTests.objectUrlSupport(),rgba:this._criticalTests.rgbaSupport(),webaudio:this._warningTest.webAudioSupport(),webgl:this._warningTest.webglSupport(),gamepadapi:!!navigator.getGamepads}}test(){let t=!1;for(const e in this._criticalTests)this._criticalTests[e].call(this)||(this.failedTests.push(e),I.getInstance().error("Critical browser feature missing, Excalibur requires:",e),t=!0);if(t)return!1;for(const e in this._warningTest)this._warningTest[e]()||I.getInstance().warn("Warning browser feature missing, Excalibur will have reduced performance:",e);return!0}}var $t;(function(n){n.PreventCollision="PreventCollision",n.Passive="Passive",n.Active="Active",n.Fixed="Fixed"})($t||($t={}));var be;(function(n){n.World="world",n.Screen="screen"})(be||(be={}));class Xr extends h{constructor(t){super(0,0),this._getX=t.getX,this._getY=t.getY,this._setX=t.setX,this._setY=t.setY}get x(){return this._x=this._getX()}set x(t){this._setX(t),this._x=t}get y(){return this._y=this._getY()}set y(t){this._setY(t),this._y=t}}class _r extends h{constructor(t,e){super(t.x,t.y),this.original=t,this.change=e}get x(){return this._x=this.original.x}set x(t){this.change(t,this._y),this._x=this.original.x=t}get y(){return this._y=this.original.y}set y(t){this.change(this._x,t),this._y=this.original.y=t}}class Ki{constructor(){this._parent=null,this._children=[],this._pos=A(0,0),this._rotation=0,this._scale=A(1,1),this._isDirty=!1,this._isInverseDirty=!1,this._matrix=It.identity(),this._inverse=It.identity()}get parent(){return this._parent}set parent(t){if(this._parent){const e=this._parent._children.indexOf(this);e>-1&&this._parent._children.splice(e,1)}this._parent=t,this._parent&&this._parent._children.push(this),this.flagDirty()}get children(){return this._children}set pos(t){t.equals(this._pos)||(this._pos.x=t.x,this._pos.y=t.y,this.flagDirty())}get pos(){return new _r(this._pos,(t,e)=>{(t!==this._pos.x||e!==this._pos.y)&&this.flagDirty()})}set globalPos(t){let e=t.clone();this.parent&&(e=this.parent.inverse.multiply(t)),e.equals(this._pos)||(this._pos=e,this.flagDirty())}get globalPos(){return new Xr({getX:()=>this.matrix.data[4],getY:()=>this.matrix.data[5],setX:t=>{if(this.parent){const{x:e}=this.parent.inverse.multiply(A(t,this.pos.y));this.pos.x=e}else this.pos.x=t;t!==this.matrix.data[4]&&this.flagDirty()},setY:t=>{if(this.parent){const{y:e}=this.parent.inverse.multiply(A(this.pos.x,t));this.pos.y=e}else this.pos.y=t;t!==this.matrix.data[5]&&this.flagDirty()}})}set rotation(t){const e=O(t);e!==this._rotation&&this.flagDirty(),this._rotation=e}get rotation(){return this._rotation}set globalRotation(t){let e=0;this.parent&&(e=this.parent.globalRotation);const i=O(t+e);i!==this._rotation&&this.flagDirty(),this._rotation=i}get globalRotation(){return this.parent?this.matrix.getRotation():this.rotation}set scale(t){(t.x!==this._scale.x||t.y!==this._scale.y)&&(this._scale.x=t.x,this._scale.y=t.y,this.flagDirty())}get scale(){return new _r(this._scale,(t,e)=>{(t!==this._scale.x||e!==this._scale.y)&&this.flagDirty()})}set globalScale(t){let e=A(1,1);this.parent&&(e=this.parent.globalScale),this.scale=t.scale(A(1/e.x,1/e.y))}get globalScale(){return new Xr({getX:()=>this.parent?this.matrix.getScaleX():this.scale.x,getY:()=>this.parent?this.matrix.getScaleY():this.scale.y,setX:t=>{if(this.parent){const e=this.parent.globalScale.x;this.scale.x=t/e}else this.scale.x=t},setY:t=>{if(this.parent){const e=this.parent.globalScale.y;this.scale.y=t/e}else this.scale.y=t}})}get matrix(){return this._isDirty&&(this.parent===null?this._matrix=this._calculateMatrix():this._matrix=this.parent.matrix.multiply(this._calculateMatrix()),this._isDirty=!1),this._matrix}get inverse(){return this._isInverseDirty&&(this._inverse=this.matrix.inverse(),this._isInverseDirty=!1),this._inverse}_calculateMatrix(){return It.identity().translate(this.pos.x,this.pos.y).rotate(this.rotation).scale(this.scale.x,this.scale.y)}flagDirty(){this._isDirty=!0,this._isInverseDirty=!0;for(let t=0;t<this._children.length;t++)this._children[t].flagDirty()}apply(t){return this.matrix.multiply(t)}applyInverse(t){return this.inverse.multiply(t)}setTransform(t,e,i){this._pos.x=t.x,this._pos.y=t.y,this._rotation=O(e),this._scale.x=i.x,this._scale.y=i.y,this.flagDirty()}clone(t){const e=t??new Ki;return this._pos.clone(e._pos),e._rotation=this._rotation,this._scale.clone(e._scale),e.flagDirty(),e}}function En(n){return!!n&&!!n.prototype&&!!n.prototype.constructor}function da(n){return!!(n!=null&&n.clone)}class ci{constructor(){this.owner=void 0}clone(){const t=new this.constructor;for(const e in this)if(this.hasOwnProperty(e)){const i=this[e];da(i)&&e!=="owner"&&e!=="clone"?t[e]=i.clone():t[e]=i}return t}}class ze{constructor(){this.observers=[],this.subscriptions=[]}register(t){this.observers.push(t)}subscribe(t){this.subscriptions.push(t)}unregister(t){const e=this.observers.indexOf(t);e!==-1&&this.observers.splice(e,1)}unsubscribe(t){const e=this.subscriptions.indexOf(t);e!==-1&&this.subscriptions.splice(e,1)}notifyAll(t){const e=this.observers.length;for(let s=0;s<e;s++)this.observers[s].notify(t);const i=this.subscriptions.length;for(let s=0;s<i;s++)this.subscriptions[s](t)}clear(){this.observers.length=0,this.subscriptions.length=0}}class Ot extends ci{constructor(){super(...arguments),this._logger=I.getInstance(),this._parentComponent=null,this._transform=new Ki,this._addChildTransform=t=>{const e=t.get(Ot);e&&(e._transform.parent=this._transform,e._parentComponent=this)},this.zIndexChanged$=new ze,this._z=0,this._coordPlane=be.World}get(){return this._transform}onAdd(t){for(const e of t.children)this._addChildTransform(e);t.childrenAdded$.subscribe(e=>this._addChildTransform(e)),t.childrenRemoved$.subscribe(e=>{const i=e.get(Ot);i&&(i._transform.parent=null,i._parentComponent=null)})}onRemove(t){this._transform.parent=null,this._parentComponent=null}get z(){return this._z}set z(t){const e=this._z;this._z=t,e!==t&&this.zIndexChanged$.notifyAll(t)}get coordPlane(){return this._parentComponent?this._parentComponent.coordPlane:this._coordPlane}set coordPlane(t){var e;this._parentComponent?this._logger.warn(`Cannot set coordinate plane on child entity ${(e=this.owner)===null||e===void 0?void 0:e.name}, children inherit their coordinate plane from their parents.`):this._coordPlane=t}get pos(){return this._transform.pos}set pos(t){this._transform.pos=t}get globalPos(){return this._transform.globalPos}set globalPos(t){this._transform.globalPos=t}get rotation(){return this._transform.rotation}set rotation(t){this._transform.rotation=t}get globalRotation(){return this._transform.globalRotation}set globalRotation(t){this._transform.globalRotation=t}get scale(){return this._transform.scale}set scale(t){this._transform.scale=t}get globalScale(){return this._transform.globalScale}set globalScale(t){this._transform.globalScale=t}applyInverse(t){return this._transform.applyInverse(t)}apply(t){return this._transform.apply(t)}clone(){const t=new Ot;return t._transform=this._transform.clone(),t._z=this._z,t}}class me extends ci{constructor(){super(...arguments),this.vel=h.Zero,this.acc=h.Zero,this.scaleFactor=h.Zero,this.angularVelocity=0,this.torque=0,this.inertia=1}}class fi{static create(t,e){if(this._CURRENT_GROUP>this._MAX_GROUPS)throw new Error(`Cannot have more than ${this._MAX_GROUPS} collision groups`);if(this._GROUPS.get(t)){const s=this._GROUPS.get(t);if(s.mask===e)return s;throw new Error(`Collision group ${t} already exists with a different mask!`)}const i=new $i(t,this._CURRENT_BIT,e!==void 0?e:~this._CURRENT_BIT);return this._CURRENT_BIT=this._CURRENT_BIT<<1|0,this._CURRENT_GROUP++,this._GROUPS.set(t,i),i}static get groups(){return Array.from(this._GROUPS.values())}static groupByName(t){return this._GROUPS.get(t)}static reset(){this._GROUPS=new Map,this._CURRENT_BIT=this._STARTING_BIT,this._CURRENT_GROUP=1}}fi._STARTING_BIT=1,fi._MAX_GROUPS=32,fi._CURRENT_GROUP=1,fi._CURRENT_BIT=fi._STARTING_BIT,fi._GROUPS=new Map;class $i{constructor(t,e,i){this._name=t,this._category=e,this._mask=i}get name(){return this._name}get category(){return this._category}get mask(){return this._mask}canCollide(t){const e=this.category&t.mask,i=this.mask&t.category;return e!==0&&i!==0}invert(){const t=fi.create("~("+this.name+")",~this.mask|0);return t._category=~this.category,t}static combine(t){const e=t.map(r=>r.name).join("+"),s=~t.reduce((r,o)=>o.category|r,0);return fi.create(e,s)}static collidesWith(t){const e=`collidesWith(${t.map(s=>s.name).join("+")})`,i=t.reduce((s,r)=>r.category|s,0);return fi.create(e,i)}toString(){return`
category: ${this.category.toString(2).padStart(32,"0")}
mask:     ${(this.mask>>>0).toString(2).padStart(32,"0")}
    `}}$i.All=new $i("Collide with all groups",-1,-1);class ti{constructor(t,e){this.colliderA=t,this.colliderB=e,this.id=null,this.id=ti.calculatePairHash(t.id,e.id)}static canCollide(t,e){var i,s;const r=(i=t==null?void 0:t.owner)===null||i===void 0?void 0:i.get(Vt),o=(s=e==null?void 0:e.owner)===null||s===void 0?void 0:s.get(Vt);return!(t.id===e.id||t.owner&&e.owner&&t.owner.id===e.owner.id||t.localBounds.hasZeroDimensions()||e.localBounds.hasZeroDimensions()||!r||!o||!r.group.canCollide(o.group)||r.collisionType===$t.Fixed&&o.collisionType===$t.Fixed||o.collisionType===$t.PreventCollision||r.collisionType===$t.PreventCollision||!r.active||!o.active)}get canCollide(){const t=this.colliderA,e=this.colliderB;return ti.canCollide(t,e)}collide(){return this.colliderA.collide(this.colliderB)}hasCollider(t){return t===this.colliderA||t===this.colliderB}static calculatePairHash(t,e){return t.value<e.value?`#${t.value}+${e.value}`:`#${e.value}+${t.value}`}}class Ys{constructor(t,e){this.min=t,this.max=e}overlaps(t){return this.max>t.min&&t.max>this.min}getOverlap(t){return this.overlaps(t)?this.max>t.max?t.max-this.min:this.max-t.min:0}}class Jr{constructor(t){this.parent=t,this.parent=t||null,this.data=null,this.bounds=new E,this.left=null,this.right=null,this.height=0}isLeaf(){return!this.left&&!this.right}}class Kr{constructor(t,e=new E(-Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)){this._config=t,this.worldBounds=e,this.root=null,this.nodes={}}_insert(t){if(this.root===null){this.root=t,this.root.parent=null;return}const e=t.bounds;let i=this.root;for(;!i.isLeaf();){const a=i.left,u=i.right,T=i.bounds.getPerimeter(),N=i.bounds.combine(e).getPerimeter(),J=2*N,nt=2*(N-T);let at=0;const xt=e.combine(a.bounds);let Bt,ft;a.isLeaf()?at=xt.getPerimeter()+nt:(ft=a.bounds.getPerimeter(),Bt=xt.getPerimeter(),at=Bt-ft+nt);let _t=0;const Tt=e.combine(u.bounds);if(u.isLeaf()?_t=Tt.getPerimeter()+nt:(ft=u.bounds.getPerimeter(),Bt=Tt.getPerimeter(),_t=Bt-ft+nt),J<at&&J<_t)break;at<_t?i=a:i=u}const s=i.parent,r=new Jr(s);r.bounds=e.combine(i.bounds),r.height=i.height+1,s!==null?(s.left===i?s.left=r:s.right=r,r.left=i,r.right=t,i.parent=r,t.parent=r):(r.left=i,r.right=t,i.parent=r,t.parent=r,this.root=r);let o=t.parent;for(;o;){if(o=this._balance(o),!o.left)throw new Error("Parent of current leaf cannot have a null left child"+o);if(!o.right)throw new Error("Parent of current leaf cannot have a null right child"+o);o.height=1+Math.max(o.left.height,o.right.height),o.bounds=o.left.bounds.combine(o.right.bounds),o=o.parent}}_remove(t){if(t===this.root){this.root=null;return}const e=t.parent,i=e.parent;let s;if(e.left===t?s=e.right:s=e.left,i){i.left===e?i.left=s:i.right=s,s.parent=i;let r=i;for(;r;)r=this._balance(r),r.bounds=r.left.bounds.combine(r.right.bounds),r.height=1+Math.max(r.left.height,r.right.height),r=r.parent}else this.root=s,s.parent=null}trackCollider(t){const e=new Jr;e.data=t,e.bounds=t.bounds,e.bounds.left-=2,e.bounds.top-=2,e.bounds.right+=2,e.bounds.bottom+=2,this.nodes[t.id.value]=e,this._insert(e)}updateCollider(t){var e;const i=this.nodes[t.id.value];if(!i)return!1;const s=t.bounds;if(!this.worldBounds.contains(s))return I.getInstance().warn("Collider with id "+t.id.value+" is outside the world bounds and will no longer be tracked for physics"),this.untrackCollider(t),!1;if(i.bounds.contains(s))return!1;if(this._remove(i),s.left-=this._config.boundsPadding,s.top-=this._config.boundsPadding,s.right+=this._config.boundsPadding,s.bottom+=this._config.boundsPadding,t.owner){const r=(e=t.owner)===null||e===void 0?void 0:e.get(Vt);if(r){const o=r.vel.x*32/1e3*this._config.velocityMultiplier,a=r.vel.y*32/1e3*this._config.velocityMultiplier;o<0?s.left+=o:s.right+=o,a<0?s.top+=a:s.bottom+=a}}return i.bounds=s,this._insert(i),!0}untrackCollider(t){const e=this.nodes[t.id.value];e&&(this._remove(e),this.nodes[t.id.value]=null,delete this.nodes[t.id.value])}_balance(t){if(t===null)throw new Error("Cannot balance at null node");if(t.isLeaf()||t.height<2)return t;const e=t.left,i=t.right,s=t,r=e,o=i,a=e.left,u=e.right,T=i.left,P=i.right,N=o.height-r.height;if(N>1)return o.left=s,o.parent=s.parent,s.parent=o,o.parent?o.parent.left===s?o.parent.left=o:o.parent.right=o:this.root=o,T.height>P.height?(o.right=T,s.right=P,P.parent=s,s.bounds=r.bounds.combine(P.bounds),o.bounds=s.bounds.combine(T.bounds),s.height=1+Math.max(r.height,P.height),o.height=1+Math.max(s.height,T.height)):(o.right=P,s.right=T,T.parent=s,s.bounds=r.bounds.combine(T.bounds),o.bounds=s.bounds.combine(P.bounds),s.height=1+Math.max(r.height,T.height),o.height=1+Math.max(s.height,P.height)),o;if(N<-1){if(r.left=s,r.parent=s.parent,s.parent=r,r.parent)if(r.parent.left===s)r.parent.left=r;else{if(r.parent.right!==s)throw"Error rotating Dynamic Tree";r.parent.right=r}else this.root=r;return a.height>u.height?(r.right=a,s.left=u,u.parent=s,s.bounds=o.bounds.combine(u.bounds),r.bounds=s.bounds.combine(a.bounds),s.height=1+Math.max(o.height,u.height),r.height=1+Math.max(s.height,a.height)):(r.right=u,s.left=a,a.parent=s,s.bounds=o.bounds.combine(a.bounds),r.bounds=s.bounds.combine(u.bounds),s.height=1+Math.max(o.height,a.height),r.height=1+Math.max(s.height,u.height)),r}return t}getHeight(){return this.root===null?0:this.root.height}query(t,e){const i=t.bounds,s=r=>{if(r&&r.bounds.overlaps(i))if(r.isLeaf()&&r.data!==t){if(e.call(t,r.data))return!0}else return s(r.left)||s(r.right);return!1};s(this.root)}rayCastQuery(t,e=1/0,i){const s=r=>{if(r&&r.bounds.rayCast(t,e))if(r.isLeaf()){if(i.call(t,r.data))return!0}else return s(r.left)||s(r.right);return!1};s(this.root)}getNodes(){const t=e=>e?[e].concat(t(e.left),t(e.right)):[];return t(this.root)}debug(t){const e=i=>{i&&(i.isLeaf()?i.bounds.draw(t,p.Green):i.bounds.draw(t,p.White),i.left&&e(i.left),i.right&&e(i.right))};e(this.root)}}class ki{constructor(t,e){this.pos=t,this.dir=e.normalize()}intersect(t){const e=t.begin.sub(this.pos);if(this.dir.cross(t.getSlope())===0&&e.cross(this.dir)!==0)return-1;const i=this.dir.cross(t.getSlope());if(i===0)return-1;const s=e.cross(t.getSlope())/i;if(s>=0){const r=e.cross(this.dir)/i/t.getLength();if(r>=0&&r<=1)return s}return-1}intersectPoint(t){const e=this.intersect(t);return e<0?null:this.getPoint(e)}getPoint(t){return this.pos.add(this.dir.scale(t))}}class mr{constructor(t){this._config=t,this._pairs=new Set,this._collisionPairCache=[],this._colliders=[],this._dynamicCollisionTree=new Kr(t.dynamicTree)}getColliders(){return this._colliders}rayCast(t,e){var i,s,r;const o=[],a=(i=e==null?void 0:e.maxDistance)!==null&&i!==void 0?i:1/0,u=e==null?void 0:e.collisionGroup,T=u?u.category:(s=e==null?void 0:e.collisionMask)!==null&&s!==void 0?s:$i.All.category,P=(r=e==null?void 0:e.searchAllColliders)!==null&&r!==void 0?r:!1;return this._dynamicCollisionTree.rayCastQuery(t,a,N=>{const nt=N.owner.get(Vt);if(e!=null&&e.ignoreCollisionGroupAll&&nt.group===$i.All)return!1;const at=(T&nt.group.category)!==0;if(nt!=null&&nt.group&&!at)return!1;const xt=N.rayCast(t,a);if(xt){if(e!=null&&e.filter){if(e.filter(xt)&&(o.push(xt),!P))return!0}else if(o.push(xt),!P)return!0}return!1}),o}track(t){if(!t){I.getInstance().warn("Cannot track null collider");return}if(t instanceof De){const e=t.getColliders();for(const i of e)i.owner=t.owner,this._colliders.push(i),this._dynamicCollisionTree.trackCollider(i)}else this._colliders.push(t),this._dynamicCollisionTree.trackCollider(t)}untrack(t){if(!t){I.getInstance().warn("Cannot untrack a null collider");return}if(t instanceof De){const e=t.getColliders();for(const i of e){const s=this._colliders.indexOf(i);s!==-1&&this._colliders.splice(s,1),this._dynamicCollisionTree.untrackCollider(i)}}else{const e=this._colliders.indexOf(t);e!==-1&&this._colliders.splice(e,1),this._dynamicCollisionTree.untrackCollider(t)}}_pairExists(t,e){const i=ti.calculatePairHash(t.id,e.id);return this._pairs.has(i)}broadphase(t,e,i){const s=e/1e3,r=t.filter(a=>{var u,T;const P=(u=a.owner)===null||u===void 0?void 0:u.get(Vt);return((T=a.owner)===null||T===void 0?void 0:T.active)&&P.collisionType!==$t.PreventCollision});this._collisionPairCache=[],this._pairs.clear();let o;for(let a=0,u=r.length;a<u;a++)o=r[a],this._dynamicCollisionTree.query(o,T=>{if(!this._pairExists(o,T)&&ti.canCollide(o,T)){const P=new ti(o,T);this._pairs.add(P.id),this._collisionPairCache.push(P)}return!1});if(i&&(i.physics.pairs=this._collisionPairCache.length),this._config.continuous.checkForFastBodies)for(const a of r){const u=a.owner.get(Vt);if(u.collisionType!==$t.Active)continue;const T=u.vel.size*s+u.acc.size*.5*s*s,P=Math.min(a.bounds.height,a.bounds.width);if(this._config.continuous.disableMinimumSpeedForFastBody||T>P/2){i&&i.physics.fastBodies++;const N=u.globalPos.sub(u.oldPos),J=a.center,nt=a.getFurthestPoint(u.vel),at=nt.sub(N),xt=new ki(at,u.vel);xt.pos=xt.pos.add(xt.dir.scale(-2*this._config.continuous.surfaceEpsilon));let Bt,ft=new h(1/0,1/0);if(this._dynamicCollisionTree.rayCastQuery(xt,T+this._config.continuous.surfaceEpsilon*2,_t=>{if(!this._pairExists(a,_t)&&ti.canCollide(a,_t)){const Tt=_t.rayCast(xt,T+this._config.continuous.surfaceEpsilon*10);if(Tt){const Ct=Tt.point.sub(at);Ct.size<ft.size&&(ft=Ct,Bt=_t)}}return!1}),Bt&&h.isValid(ft)){const _t=new ti(a,Bt);this._pairs.has(_t.id)||(this._pairs.add(_t.id),this._collisionPairCache.push(_t));const Tt=J.sub(nt);u.globalPos=at.add(Tt).add(ft).add(xt.dir.scale(10*this._config.continuous.surfaceEpsilon)),a.update(u.transform.get()),i&&i.physics.fastBodyCollisions++}}}return this._collisionPairCache}narrowphase(t,e){let i=[];for(let s=0;s<t.length;s++){const r=t[s].collide();if(i=i.concat(r),e&&r.length>0)for(const o of r)e.physics.contacts.set(o.id,o)}return e&&(e.physics.collisions+=i.length),i}update(t){let e=0;const i=t.length;for(let s=0;s<i;s++)this._dynamicCollisionTree.updateCollider(t[s])&&e++;return e}debug(t){this._dynamicCollisionTree.debug(t)}}class zi{constructor(){this.id=et("collider",zi._ID++),this.composite=null,this.events=new k,this.offset=h.Zero}touching(t){return!!this.collide(t)}}zi._ID=0;var Oi;(function(n){n.Arcade="arcade",n.Realistic="realistic"})(Oi||(Oi={}));var vr;(function(n){n[n.DynamicAABBTree=0]="DynamicAABBTree"})(vr||(vr={}));var wr;(function(n){n[n.Euler=0]="Euler"})(wr||(wr={}));class Xt{static get gravity(){return Xt.acc}static set gravity(t){Xt.acc=t}static useArcadePhysics(){Xt.collisionResolutionStrategy=Oi.Arcade}static useRealisticPhysics(){Xt.collisionResolutionStrategy=Oi.Realistic}}Xt.acc=new h(0,0),Xt.enabled=!0,Xt.broadphaseStrategy=vr.DynamicAABBTree,Xt.collisionResolutionStrategy=Oi.Arcade,Xt.defaultMass=10,Xt.integrator=wr.Euler,Xt.dynamicTreeVelocityMultiplier=2,Xt.boundsPadding=5,Xt.positionIterations=3,Xt.velocityIterations=8,Xt.slop=1,Xt.steeringFactor=.2,Xt.warmStart=!0,Xt.bodiesCanSleepByDefault=!1,Xt.surfaceEpsilon=.1,Xt.sleepEpsilon=.07,Xt.wakeThreshold=Xt.sleepEpsilon*3,Xt.sleepBias=.9,Xt.checkForFastBodies=!0,Xt.disableMinimumSpeedForFastBody=!1;var ts;(function(n){n.None="none",n.VerticalFirst="vertical-first",n.HorizontalFirst="horizontal-first"})(ts||(ts={}));const Bn={vertical:1,horizontal:2},Tn={horizontal:1,vertical:2},Sn={horizontal:0,vertical:0},_i={enabled:!0,gravity:A(0,0),solver:Oi.Arcade,colliders:{compositeStrategy:"together"},continuous:{checkForFastBodies:!0,disableMinimumSpeedForFastBody:!1,surfaceEpsilon:.1},bodies:{canSleepByDefault:!1,sleepEpsilon:.07,wakeThreshold:.07*3,sleepBias:.9,defaultMass:10},dynamicTree:{boundsPadding:5,velocityMultiplier:2},arcade:{contactSolveBias:ts.None},realistic:{positionIterations:3,velocityIterations:8,slop:1,steeringFactor:.2,warmStart:!0}};function $r(){return{enabled:Xt.enabled,gravity:Xt.gravity,solver:Xt.collisionResolutionStrategy,continuous:{checkForFastBodies:Xt.checkForFastBodies,disableMinimumSpeedForFastBody:Xt.disableMinimumSpeedForFastBody,surfaceEpsilon:Xt.surfaceEpsilon},colliders:{compositeStrategy:"together"},bodies:{canSleepByDefault:Xt.bodiesCanSleepByDefault,sleepEpsilon:Xt.sleepEpsilon,wakeThreshold:Xt.wakeThreshold,sleepBias:Xt.sleepBias,defaultMass:Xt.defaultMass},dynamicTree:{boundsPadding:Xt.boundsPadding,velocityMultiplier:Xt.dynamicTreeVelocityMultiplier},arcade:{contactSolveBias:ts.None},realistic:{positionIterations:Xt.positionIterations,velocityIterations:Xt.velocityIterations,slop:Xt.slop,steeringFactor:Xt.steeringFactor,warmStart:Xt.warmStart}}}class De extends zi{set compositeStrategy(t){this._compositeStrategy=t}get compositeStrategy(){return this._compositeStrategy}constructor(t){super(),this._collisionProcessor=new mr(_i),this._dynamicAABBTree=new Kr(_i.dynamicTree),this._colliders=[];for(const e of t)this.addCollider(e)}clearColliders(){this._colliders=[]}addCollider(t){let e;t instanceof De?(e=t.getColliders(),e.forEach(i=>i.offset.addEqual(t.offset))):e=[t];for(const i of e)i.events.pipe(this.events),i.composite=this,this._colliders.push(i),this._collisionProcessor.track(i),this._dynamicAABBTree.trackCollider(i)}removeCollider(t){t.events.pipe(this.events),t.composite=null,K(t,this._colliders),this._collisionProcessor.untrack(t),this._dynamicAABBTree.untrackCollider(t)}getColliders(){return this._colliders}get worldPos(){var t,e;return((e=(t=this._transform)===null||t===void 0?void 0:t.pos)!==null&&e!==void 0?e:h.Zero).add(this.offset)}get center(){var t,e;return((e=(t=this._transform)===null||t===void 0?void 0:t.pos)!==null&&e!==void 0?e:h.Zero).add(this.offset)}get bounds(){var t,e;const i=this.getColliders();return i.reduce((r,o)=>r.combine(o.bounds),(e=(t=i[0])===null||t===void 0?void 0:t.bounds)!==null&&e!==void 0?e:new E().translate(this.worldPos)).translate(this.offset)}get localBounds(){var t,e;const i=this.getColliders();return i.reduce((r,o)=>r.combine(o.localBounds),(e=(t=i[0])===null||t===void 0?void 0:t.localBounds)!==null&&e!==void 0?e:new E)}get axes(){const t=this.getColliders();let e=[];for(const i of t)e=e.concat(i.axes);return e}getFurthestPoint(t){const e=this.getColliders(),i=[];for(const o of e)i.push(o.getFurthestPoint(t));let s=i[0],r=-Number.MAX_VALUE;for(const o of i){const a=o.dot(t);a>r&&(s=o,r=a)}return s}getInertia(t){const e=this.getColliders();let i=0;for(const s of e)i+=s.getInertia(t);return i}collide(t){let e=[t];t instanceof De&&(e=t.getColliders());const i=[];for(const r of e)this._dynamicAABBTree.query(r,o=>(i.push(new ti(r,o)),!1));let s=[];for(const r of i)s=s.concat(r.collide());return s}getClosestLineBetween(t){const e=this.getColliders(),i=[];if(t instanceof De){const s=t.getColliders();for(const r of e)for(const o of s){const a=r.getClosestLineBetween(o);a&&i.push(a)}}else for(const s of e){const r=t.getClosestLineBetween(s);r&&i.push(r)}if(i.length){let s=i[0].getLength(),r=i[0];for(const o of i){const a=o.getLength();a<s&&(s=a,r=o)}return r}return null}contains(t){const e=this.getColliders();for(const i of e)if(i.contains(t))return!0;return!1}rayCast(t,e){const i=this.getColliders(),s=[];for(const r of i){const o=r.rayCast(t,e);o&&s.push(o)}if(s.length){let r=s[0],o=r.point.dot(t.dir);for(const a of s){const u=t.dir.dot(a.point);u<o&&(r=a,o=u)}return r}return null}project(t){const e=this.getColliders(),i=[];for(const s of e){const r=s.project(t);r&&i.push(r)}if(i.length){const s=new Ys(i[0].min,i[0].max);for(const r of i)s.min=Math.min(r.min,s.min),s.max=Math.max(r.max,s.max);return s}return null}update(t){if(t){const e=this.getColliders();for(const i of e)i.owner=this.owner,i.update(t)}}debug(t,e,i){const s=this.getColliders();t.save(),t.translate(this.offset.x,this.offset.y);for(const r of s)r.debug(t,e,i);t.restore()}clone(){const t=new De(this._colliders.map(e=>e.clone()));return t.offset=this.offset.clone(),t}}class Ge{constructor(t,e){this.begin=t,this.end=e}get slope(){return(this.end.y-this.begin.y)/(this.end.x-this.begin.x)}get intercept(){return this.begin.y-this.slope*this.begin.x}normal(){return this._normal?this._normal:this._normal=this.end.sub(this.begin).normal()}dir(){return this._dir?this._dir:this._dir=this.end.sub(this.begin)}getPoints(){return[this.begin,this.end]}getSlope(){if(this._slope)return this._slope;const t=this.begin,e=this.end,i=t.distance(e);return this._slope=e.sub(t).scale(1/i)}getEdge(){const t=this.begin;return this.end.sub(t)}getLength(){if(this._length)return this._length;const t=this.begin,e=this.end,i=t.distance(e);return this._length=i}get midpoint(){return this.begin.add(this.end).scale(.5)}flip(){return new Ge(this.end,this.begin)}below(t){return(this.end.x-this.begin.x)*(t.y-this.begin.y)-(this.end.y-this.begin.y)*(t.x-this.begin.x)>=0}clip(t,e){let i=t;i=i.normalize();const s=i.dot(this.begin)-e,r=i.dot(this.end)-e,o=[];if(s<=0&&o.push(this.begin),r<=0&&o.push(this.end),s*r<0){const a=s/(s-r);o.push(this.begin.add(this.end.sub(this.begin).scale(a)))}return o.length!==2?null:new Ge(o[0],o[1])}distanceToPoint(t,e=!1){const i=t.x,s=t.y,r=this.getLength(),o=this.end.y-this.begin.y,a=this.end.x-this.begin.x,u=(o*i-a*s+this.end.x*this.begin.y-this.end.y*this.begin.x)/r;return e?u:Math.abs(u)}findVectorToPoint(t){const e=this.begin.sub(t),i=this.getSlope();return e.sub(i.scale(e.dot(i)))}findPoint(t=null,e=null){const i=this.slope,s=this.intercept;if(t!==null)return new h(t,i*t+s);if(e!==null)return new h((e-s)/i,e);throw new Error("You must provide an X or a Y value")}hasPoint(){let t,e=0;if(typeof arguments[0]=="number"&&typeof arguments[1]=="number")t=new h(arguments[0],arguments[1]),e=arguments[2]||0;else if(arguments[0]instanceof h)t=arguments[0],e=arguments[1]||0;else throw"Could not determine the arguments for Vector.hasPoint";const i=t.x-this.begin.x,s=t.y-this.begin.y,r=this.end.x-this.begin.x,o=this.end.y-this.begin.y,a=i*o-s*r;return Math.abs(a)>e?!1:Math.abs(r)>=Math.abs(o)?r>0?this.begin.x<=t.x&&t.x<=this.end.x:this.end.x<=t.x&&t.x<=this.begin.x:o>0?this.begin.y<=t.y&&t.y<=this.end.y:this.end.y<=t.y&&t.y<=this.begin.y}}function yr(n,t,e,i){const s=n.sub(e),r=t.dot(t),o=t.dot(i),a=i.dot(i),u=t.dot(s),T=i.dot(s),P=r*a-o*o;let N=P,J=P;if(P===0||P<=.01){const xt=u/o;return new Ge(n,e.add(i.scale(xt)))}let nt=o*T-a*u,at=r*T-o*u;return nt<0?(nt=0,at=T,J=a):nt>N&&(nt=N,at=T+o,J=a),at<0?(at=0,-u<0?nt=0:-u>r?nt=N:(nt=-u,N=r)):at>J&&(at=J,-u+o<0?nt=0:-u+o>r?nt=N:(nt=-u+o,N=r)),nt=Math.abs(nt)<.001?0:nt/N,at=Math.abs(at)<.001?0:at/J,new Ge(n.add(t.scale(nt)),e.add(i.scale(at)))}const mi={PolygonPolygonClosestLine(n,t){const e=t.worldPos,i=e.sub(n.worldPos),s=i.negate(),r=new ki(n.worldPos,i),o=new ki(e,s),a=n.rayCast(r).point.add(r.dir.scale(.1)),u=t.rayCast(o).point.add(o.dir.scale(.1)),T=n.getClosestFace(a),P=t.getClosestFace(u),N=T.face.begin,J=T.face.getEdge(),nt=P.face.begin,at=P.face.getEdge();return yr(N,J,nt,at)},PolygonEdgeClosestLine(n,t){const i=t.worldPos.sub(n.worldPos),s=new ki(n.worldPos,i),r=n.rayCast(s).point.add(s.dir.scale(.1)),o=n.getClosestFace(r),a=o.face.begin,u=o.face.getEdge(),T=t.asLine(),P=T.begin,N=T.getEdge();return yr(a,u,P,N)},PolygonCircleClosestLine(n,t){const e=t.worldPos,i=e.sub(n.worldPos),s=new ki(n.worldPos,i.normalize()),r=n.rayCast(s).point.add(s.dir.scale(.1)),o=n.getClosestFace(r),a=o.face.begin,u=o.face.getEdge();let T=(u.x*(e.x-a.x)+u.y*(e.y-a.y))/(u.x*u.x+u.y*u.y);T>1?T=1:T<0&&(T=0);const P=Math.sqrt(Math.pow(a.x+u.x*T-e.x,2)+Math.pow(a.y+u.y*T-e.y,2))-t.radius,N=(a.x+u.x*T-e.x)*t.radius/(t.radius+P),J=(a.y+u.y*T-e.y)*t.radius/(t.radius+P);return new Ge(u.scale(T).add(a),new h(e.x+N,e.y+J))},CircleCircleClosestLine(n,t){const i=t.worldPos.sub(n.worldPos),r=n.worldPos.sub(t.worldPos),o=new ki(n.worldPos,i),a=new ki(t.worldPos,r),u=n.rayCast(o),T=t.rayCast(a);return new Ge(u.point,T.point)},CircleEdgeClosestLine(n,t){const e=n.worldPos,i=t.asLine(),s=i.begin,r=i.getEdge(),o=s,a=r;let u=(a.x*(e.x-o.x)+a.y*(e.y-o.y))/(a.x*a.x+a.y*a.y);u>1?u=1:u<0&&(u=0);const T=Math.sqrt(Math.pow(o.x+a.x*u-e.x,2)+Math.pow(o.y+a.y*u-e.y,2))-n.radius,P=(o.x+a.x*u-e.x)*n.radius/(n.radius+T),N=(o.y+a.y*u-e.y)*n.radius/(n.radius+T);return new Ge(a.scale(u).add(o),new h(e.x+P,e.y+N))},EdgeEdgeClosestLine(n,t){const e=n.asLine(),i=e.begin,s=e.getEdge(),r=i,o=s,a=t.asLine(),u=a.begin,T=a.getEdge();return yr(r,o,u,T)}};class Qe extends zi{get worldPos(){return this._globalMatrix.getPosition()}get radius(){var t;const e=this._transform,i=(t=e==null?void 0:e.globalScale)!==null&&t!==void 0?t:h.One;return this._naturalRadius*Math.min(i.x,i.y)}set radius(t){var e;const i=this._transform,s=(e=i==null?void 0:i.globalScale)!==null&&e!==void 0?e:h.One;this._naturalRadius=t/Math.min(s.x,s.y)}constructor(t){super(),this.offset=h.Zero,this._globalMatrix=It.identity(),this.offset=t.offset||h.Zero,this.radius=t.radius||0,this._globalMatrix.translate(this.offset.x,this.offset.y)}clone(){return new Qe({offset:this.offset.clone(),radius:this.radius})}get center(){return this._globalMatrix.getPosition()}contains(t){var e,i;return((i=(e=this._transform)===null||e===void 0?void 0:e.pos)!==null&&i!==void 0?i:this.offset).distance(t)<=this.radius}rayCast(t,e=1/0){var i,s;const r=this.center,o=t.dir,a=t.pos,u=Math.sqrt(Math.pow(o.dot(a.sub(r)),2)-Math.pow(a.sub(r).distance(),2)+Math.pow(this.radius,2));if(u<0)return null;{let T=0;if(u===0){if(T=-o.dot(a.sub(r)),T>0&&T<e){const P=t.getPoint(T);return{point:P,normal:P.sub(r).normalize(),collider:this,body:(i=this.owner)===null||i===void 0?void 0:i.get(Vt),distance:T}}return null}else{const P=-o.dot(a.sub(r))+u,N=-o.dot(a.sub(r))-u,J=[];P>=0&&J.push(P),N>=0&&J.push(N);const nt=Math.min(...J);if(nt<=e){const at=t.getPoint(nt);return{point:at,normal:at.sub(r).normalize(),collider:this,body:(s=this.owner)===null||s===void 0?void 0:s.get(Vt),distance:nt}}return null}}}getClosestLineBetween(t){if(t instanceof Qe)return mi.CircleCircleClosestLine(this,t);if(t instanceof Te)return mi.PolygonCircleClosestLine(t,this).flip();if(t instanceof Ze)return mi.CircleEdgeClosestLine(this,t).flip();throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}collide(t){if(t instanceof Qe)return di.CollideCircleCircle(this,t);if(t instanceof Te)return di.CollideCirclePolygon(this,t);if(t instanceof Ze)return di.CollideCircleEdge(this,t);throw new Error(`Circle could not collide with unknown CollisionShape ${typeof t}`)}getFurthestPoint(t){return this.center.add(t.normalize().scale(this.radius))}getFurthestLocalPoint(t){return t.normalize().scale(this.radius)}get bounds(){var t,e,i;const s=this._transform,r=(t=s==null?void 0:s.globalScale)!==null&&t!==void 0?t:h.One,o=(e=s==null?void 0:s.globalRotation)!==null&&e!==void 0?e:0,a=(i=s==null?void 0:s.globalPos)!==null&&i!==void 0?i:h.Zero;return new E(this.offset.x-this._naturalRadius,this.offset.y-this._naturalRadius,this.offset.x+this._naturalRadius,this.offset.y+this._naturalRadius).rotate(o).scale(r).translate(a)}get localBounds(){return new E(this.offset.x-this._naturalRadius,this.offset.y-this._naturalRadius,this.offset.x+this._naturalRadius,this.offset.y+this._naturalRadius)}get axes(){return[]}getInertia(t){return t*this.radius*this.radius/2}update(t){var e;this._transform=t,((e=t.matrix)!==null&&e!==void 0?e:this._globalMatrix).clone(this._globalMatrix),this._globalMatrix.translate(this.offset.x,this.offset.y)}project(t){const e=[],s=this.center.dot(t);return e.push(s),e.push(s+this.radius),e.push(s-this.radius),new Ys(Math.min.apply(Math,e),Math.max.apply(Math,e))}debug(t,e,i){var s,r,o,a;const{lineWidth:u}={lineWidth:1,...i},T=this._transform,P=(s=T==null?void 0:T.globalScale)!==null&&s!==void 0?s:h.One,N=(r=T==null?void 0:T.globalRotation)!==null&&r!==void 0?r:0,J=(o=T==null?void 0:T.globalPos)!==null&&o!==void 0?o:h.Zero;t.save(),t.translate(J.x,J.y),t.rotate(N),t.scale(P.x,P.y),t.drawCircle((a=this.offset)!==null&&a!==void 0?a:h.Zero,this._naturalRadius,p.Transparent,e,u),t.restore()}}class es{constructor(t,e,i,s,r,o,a,u){var T,P,N,J,nt,at;if(this._canceled=!1,this.colliderA=t,this.colliderB=e,this.mtv=i,this.normal=s,this.tangent=r,this.points=o,this.localPoints=a,this.info=u,this.id=ti.calculatePairHash(t.id,e.id),t.composite||e.composite){const xt=((T=t.composite)===null||T===void 0?void 0:T.compositeStrategy)==="separate"?t.id:(N=(P=t.composite)===null||P===void 0?void 0:P.id)!==null&&N!==void 0?N:t.id,Bt=((J=e.composite)===null||J===void 0?void 0:J.compositeStrategy)==="separate"?e.id:(at=(nt=e.composite)===null||nt===void 0?void 0:nt.id)!==null&&at!==void 0?at:e.id;this.id+="|"+ti.calculatePairHash(xt,Bt)}}matchAwake(){const t=this.colliderA.owner.get(Vt),e=this.colliderB.owner.get(Vt);t&&e&&t.sleeping!==e.sleeping&&(t.sleeping&&t.collisionType!==$t.Fixed&&e.sleepMotion>=t.wakeThreshold&&t.setSleeping(!1),e.sleeping&&e.collisionType!==$t.Fixed&&t.sleepMotion>=e.wakeThreshold&&e.setSleeping(!1))}isCanceled(){return this._canceled}cancel(){this._canceled=!0}}class tn{static findPolygonPolygonSeparation(t,e){let i=-Number.MAX_VALUE,s=null,r=null,o=-1,a=null;const u=t.getSides(),T=t.getLocalSides();for(let P=0;P<u.length;P++){const N=u[P],J=N.normal(),nt=e.getFurthestPoint(J.negate()),at=N.distanceToPoint(nt,!0);at>i&&(i=at,s=N,r=J,o=P,a=nt)}return{collider:t,separation:r?i:99,axis:r,side:s,localSide:T[o],sideId:o,point:a,localPoint:r?e.getFurthestLocalPoint(r.negate()):null}}static findCirclePolygonSeparation(t,e){const i=e.axes,r=e.center.sub(t.worldPos),o=e.getFurthestPoint(r.negate());i.push(o.sub(t.worldPos).normalize());let a=Number.MAX_VALUE,u=null,T=-1;for(let P=0;P<i.length;P++){const N=e.project(i[P]),J=t.project(i[P]),nt=N.getOverlap(J);if(nt<=0)return null;nt<a&&(a=nt,u=i[P],T=P)}return T<0?null:u.normalize().scale(a)}}const di={CollideCircleCircle(n,t){const e=n.worldPos,i=t.worldPos,s=n.radius+t.radius,r=e.distance(i);if(r>s)return[];const o=s-r,a=i.sub(e).normalize(),u=a.perpendicular(),T=a.scale(o),P=n.getFurthestPoint(a),N=n.getFurthestLocalPoint(a),J={collider:n,separation:o,axis:a,point:P};return[new es(n,t,T,a,u,[P],[N],J)]},CollideCirclePolygon(n,t){var e,i;let s=tn.findCirclePolygonSeparation(n,t);if(!s)return[];s=s.dot(t.center.sub(n.center))<0?s.negate():s;const o=n.getFurthestPoint(s),u=((i=(e=n.owner)===null||e===void 0?void 0:e.get(Ot))!==null&&i!==void 0?i:new Ot).applyInverse(o),T=s.normalize(),P={collider:n,separation:-s.size,axis:T,point:o,localPoint:u,side:t.findSide(T.negate()),localSide:t.findLocalSide(T.negate())};return[new es(n,t,s,T,T.perpendicular(),[o],[u],P)]},CollideCircleEdge(n,t){const e=n.center,i=t.asLine(),s=i.end.sub(i.begin),r=s.dot(i.end.sub(e)),o=s.dot(e.sub(i.begin)),a=t.asLine(),u=t.asLocalLine();if(o<=0){const ft=i.begin.sub(e),_t=ft.dot(ft);if(_t>n.radius*n.radius)return[];const Tt=ft.normalize(),Ct=n.radius-Math.sqrt(_t),Rt={collider:n,separation:Ct,axis:Tt,point:a.begin,side:a,localSide:u};return[new es(n,t,Tt.scale(Ct),Tt,Tt.perpendicular(),[a.begin],[u.begin],Rt)]}if(r<=0){const ft=i.end.sub(e),_t=ft.dot(ft);if(_t>n.radius*n.radius)return[];const Tt=ft.normalize(),Ct=n.radius-Math.sqrt(_t),Rt={collider:n,separation:Ct,axis:Tt,point:a.end,side:a,localSide:u};return[new es(n,t,Tt.scale(Ct),Tt,Tt.perpendicular(),[a.end],[u.end],Rt)]}const T=s.dot(s),P=i.begin.scale(r).add(i.end.scale(o)).scale(1/T),N=e.sub(P),J=N.dot(N);if(J>n.radius*n.radius)return[];let nt=s.perpendicular();nt.dot(e.sub(i.begin))<0&&(nt.x=-nt.x,nt.y=-nt.y),nt=nt.normalize();const at=n.radius-Math.sqrt(J),xt=nt.scale(at),Bt={collider:n,separation:at,axis:nt,point:P,side:a,localSide:u};return[new es(n,t,xt,nt.negate(),nt.negate().perpendicular(),[P],[P.sub(t.worldPos)],Bt)]},CollideEdgeEdge(){return[]},CollidePolygonEdge(n,t){var e;const i=n.center,r=t.center.sub(i).normalize(),o=new Te({points:[t.begin,t.end,t.end.add(r.scale(100)),t.begin.add(r.scale(100))],offset:t.offset});o.owner=t.owner,((e=t.owner)===null||e===void 0?void 0:e.get(Ot))&&o.update(t.owner.get(Ot).get());const u=this.CollidePolygonPolygon(n,o);return u.length&&(u[0].colliderB=t,u[0].id=ti.calculatePairHash(n.id,t.id)),u},CollidePolygonPolygon(n,t){var e,i,s,r;const o=tn.findPolygonPolygonSeparation(n,t);if(o.separation>0)return[];const a=tn.findPolygonPolygonSeparation(t,n);if(a.separation>0)return[];const u=o.separation>a.separation?o:a,P=(u.collider===n?t:n).findSide(u.axis.negate()),N=u.side,J=N.dir().normalize(),nt=P.clip(J.negate(),-J.dot(N.begin));let at=null;if(nt&&(at=nt.clip(J,J.dot(N.end))),at){const xt=at.getPoints().filter(Tt=>N.below(Tt));let Bt=u.axis,ft=Bt.perpendicular();t.center.sub(n.center).dot(Bt)<0&&(Bt=Bt.negate(),ft=Bt.perpendicular());let _t=[];if(u.collider===n){const Tt=(i=(e=t.owner)===null||e===void 0?void 0:e.get(Ot))!==null&&i!==void 0?i:new Ot;_t=xt.map(Ct=>Tt.applyInverse(Ct))}else{const Tt=(r=(s=n.owner)===null||s===void 0?void 0:s.get(Ot))!==null&&r!==void 0?r:new Ot;_t=xt.map(Ct=>Tt.applyInverse(Ct))}return[new es(n,t,Bt.scale(-u.separation),Bt,ft,xt,_t,u)]}return[]},FindContactSeparation(n,t){var e,i,s,r;const o=n.colliderA,a=(i=(e=n.colliderA.owner)===null||e===void 0?void 0:e.get(Ot))!==null&&i!==void 0?i:new Ot,u=n.colliderB,T=(r=(s=n.colliderB.owner)===null||s===void 0?void 0:s.get(Ot))!==null&&r!==void 0?r:new Ot;if(o instanceof Qe&&u instanceof Qe){const P=o.radius+u.radius,N=a.pos.distance(T.pos);return-(P-N)}if(o instanceof Te&&u instanceof Te&&n.info.localSide){let P,N;return n.info.collider===o?(P=new Ge(a.apply(n.info.localSide.begin),a.apply(n.info.localSide.end)),N=T.apply(t)):(P=new Ge(T.apply(n.info.localSide.begin),T.apply(n.info.localSide.end)),N=a.apply(t)),P.distanceToPoint(N,!0)}if(o instanceof Te&&u instanceof Qe||u instanceof Te&&o instanceof Qe){const P=a.apply(t);if(n.info.side)return n.info.side.distanceToPoint(P,!0)}if(o instanceof Ze&&u instanceof Te||u instanceof Ze&&o instanceof Te){let P;if(n.info.collider===o?P=T.apply(t):P=a.apply(t),n.info.side)return n.info.side.distanceToPoint(P,!0)}if(o instanceof Qe&&u instanceof Ze||u instanceof Qe&&o instanceof Ze){const P=T.apply(t);let N;o instanceof Qe&&(N=o.getFurthestPoint(n.normal));const J=P.distance(N);if(n.info.side)return J>0?-J:0}return 0}};class Ze extends zi{constructor(t){var e;super(),this._globalMatrix=It.identity(),this.begin=t.begin||h.Zero,this.end=t.end||h.Zero,this.offset=(e=t.offset)!==null&&e!==void 0?e:h.Zero}clone(){return new Ze({begin:this.begin.clone(),end:this.end.clone()})}get worldPos(){var t;const e=this._transform;return(t=e==null?void 0:e.globalPos.add(this.offset))!==null&&t!==void 0?t:this.offset}get center(){const t=this._getTransformedBegin(),e=this._getTransformedEnd();return t.average(e)}_getTransformedBegin(){return this._globalMatrix.multiply(this.begin)}_getTransformedEnd(){return this._globalMatrix.multiply(this.end)}getSlope(){const t=this._getTransformedBegin(),e=this._getTransformedEnd(),i=t.distance(e);return e.sub(t).scale(1/i)}getLength(){const t=this._getTransformedBegin(),e=this._getTransformedEnd();return t.distance(e)}contains(){return!1}rayCast(t,e=1/0){var i;const s=this._getTransformedBegin().sub(t.pos);if(t.dir.cross(this.getSlope())===0&&s.cross(t.dir)!==0)return null;const r=t.dir.cross(this.getSlope());if(r===0)return null;const o=s.cross(this.getSlope())/r;if(o>=0&&o<=e){const a=s.cross(t.dir)/r/this.getLength();if(a>=0&&a<=1)return{distance:o,normal:this.asLine().normal(),collider:this,body:(i=this.owner)===null||i===void 0?void 0:i.get(Vt),point:t.getPoint(o)}}return null}getClosestLineBetween(t){if(t instanceof Qe)return mi.CircleEdgeClosestLine(t,this);if(t instanceof Te)return mi.PolygonEdgeClosestLine(t,this).flip();if(t instanceof Ze)return mi.EdgeEdgeClosestLine(this,t);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}collide(t){if(t instanceof Qe)return di.CollideCircleEdge(t,this);if(t instanceof Te)return di.CollidePolygonEdge(t,this);if(t instanceof Ze)return di.CollideEdgeEdge();throw new Error(`Edge could not collide with unknown CollisionShape ${typeof t}`)}getFurthestPoint(t){const e=this._getTransformedBegin(),i=this._getTransformedEnd();return t.dot(e)>0?e:i}_boundsFromBeginEnd(t,e,i=10){return new E(Math.min(t.x,e.x)-i,Math.min(t.y,e.y)-i,Math.max(t.x,e.x)+i,Math.max(t.y,e.y)+i)}get bounds(){const t=this._getTransformedBegin(),e=this._getTransformedEnd();return this._boundsFromBeginEnd(t,e)}get localBounds(){return this._boundsFromBeginEnd(this.begin,this.end)}asLine(){return new Ge(this._getTransformedBegin(),this._getTransformedEnd())}asLocalLine(){return new Ge(this.begin,this.end)}get axes(){const e=this._getTransformedEnd().sub(this._getTransformedBegin()).normal(),i=[];return i.push(e),i.push(e.negate()),i.push(e.normal()),i.push(e.normal().negate()),i}getInertia(t){const e=this.end.sub(this.begin).distance()/2;return t*e*e}update(t){var e;this._transform=t,((e=t.matrix)!==null&&e!==void 0?e:this._globalMatrix).clone(this._globalMatrix),this._globalMatrix.translate(this.offset.x,this.offset.y)}project(t){const e=[],i=[this._getTransformedBegin(),this._getTransformedEnd()],s=i.length;for(let r=0;r<s;r++)e.push(i[r].dot(t));return new Ys(Math.min.apply(Math,e),Math.max.apply(Math,e))}debug(t,e){const i=this._getTransformedBegin(),s=this._getTransformedEnd();t.drawLine(i,s,e,2),t.drawCircle(i,2,e),t.drawCircle(s,2,e)}}class Ce{static registerGraphicsContext(t){Ce._ctx=t}static draw(t){this._drawCalls.push(t)}static drawPoint(t,e){Ce.draw(i=>{i.debug.drawPoint(t,e)})}static drawLine(t,e,i){Ce.draw(s=>{s.debug.drawLine(t,e,i)})}static drawLines(t,e){t.length>1&&Ce.draw(i=>{for(let s=0;s<t.length-1;s++)i.debug.drawLine(t[s],t[s+1],e)})}static drawText(t,e){Ce.draw(i=>{i.debug.drawText(t,e)})}static drawPolygon(t,e){t.length>1&&Ce.draw(i=>{const s=t[0],r=[...t,s];for(let o=0;o<r.length-1;o++)i.debug.drawLine(r[o],r[o+1],e)})}static drawCircle(t,e,i){const{color:s,strokeColor:r,width:o}={color:p.Black,strokeColor:void 0,width:void 0,...i};Ce.draw(a=>{a.drawCircle(t,e,s,r,o)})}static drawBounds(t,e){Ce.draw(i=>{i.debug.drawRect(t.left,t.top,t.width,t.height,e)})}static drawRay(t,e){const{distance:i,color:s}={color:p.Blue,distance:10,...e};Ce.draw(r=>{const o=t.pos,a=t.pos.add(t.dir.scale(i));r.debug.drawLine(o,a,{color:s})})}static flush(t){t.save(),t.z=Ce.z;for(const e of Ce._drawCalls)e(t);t.restore(),Ce.clear()}static clear(){Ce._drawCalls.length=0}}Ce._drawCalls=[],Ce.z=1/0;class Te extends zi{flagDirty(){this._localBoundsDirty=!0,this._localSidesDirty=!0,this._transformedPointsDirty=!0,this._sidesDirty=!0}set points(t){this._points=t,this.flagDirty()}get points(){return this._points}constructor(t){var e,i;super(),this._logger=I.getInstance(),this._transformedPoints=[],this._sides=[],this._localSides=[],this._globalMatrix=It.identity(),this._transformedPointsDirty=!0,this._sidesDirty=!0,this._localSidesDirty=!0,this._localBoundsDirty=!0,this.offset=(e=t.offset)!==null&&e!==void 0?e:h.Zero,this._globalMatrix.translate(this.offset.x,this.offset.y),this.points=(i=t.points)!==null&&i!==void 0?i:[],this._isCounterClockwiseWinding(this.points)||this.points.reverse(),this.isConvex()||t.suppressConvexWarning||this._logger.warn("Excalibur only supports convex polygon colliders and will not behave properly.Call PolygonCollider.triangulate() to build a new collider composed of smaller convex triangles"),this._calculateTransformation()}_isCounterClockwiseWinding(t){let e=0;for(let i=0;i<t.length;i++)e+=(t[(i+1)%t.length].x-t[i].x)*(t[(i+1)%t.length].y+t[i].y);return e<0}isConvex(){if(this.points.length<3)return!1;let t=this.points[this.points.length-2],e=this.points[this.points.length-1],i=Math.atan2(e.y-t.y,e.x-t.x),s=0,r=0,o=0;for(const[a,u]of this.points.entries()){if(t=e,s=i,e=u,i=Math.atan2(e.y-t.y,e.x-t.x),t.equals(e))return!1;let T=i-s;if(T<=-Math.PI?T+=Math.PI*2:T>Math.PI&&(T-=Math.PI*2),a===0){if(T===0)return!1;r=T>0?1:-1}else if(r*T<=0)return!1;o+=T}return Math.abs(Math.round(o/(Math.PI*2)))===1}tessellate(){const t=[];for(let e=1;e<this.points.length-2;e++)t.push([this.points[0],this.points[e+1],this.points[e+2]]);return t.push([this.points[0],this.points[1],this.points[2]]),new De(t.map(e=>Pe.Polygon(e)))}triangulate(){if(this.points.length<3)throw Error("Invalid polygon");const t=[],e=[...this.points].reverse();let i=e.length;function s(N){return N===0?i-1:N-1}function r(N){return N===i-1?0:N+1}function o(N){const J=s(N),nt=r(N),at=e[J],xt=e[N],Bt=e[nt],ft=at.sub(xt),_t=Bt.sub(xt);return!(ft.cross(_t)<0)}const a=e.map((N,J)=>o(J));function u(N,J,nt,at){const xt=nt.sub(J),Bt=at.sub(nt),ft=J.sub(at),_t=N.sub(J),Tt=N.sub(nt),Ct=N.sub(at),Rt=xt.cross(_t),se=Bt.cross(Tt),Dt=ft.cross(Ct);return!(Rt>0||se>0||Dt>0)}function T(){for(let N=0;N<i;N++)if(a[N]){const J=s(N),nt=r(N),at=e[J],xt=e[N],Bt=e[nt];let ft=!0;for(let _t=0;_t<i;_t++){if(_t===N||_t===J||_t===nt)continue;const Tt=e[_t];if(u(Tt,at,xt,Bt)){ft=!1;break}}if(ft)return N}for(let N=0;N<i;N++)if(a[N])return N;return 0}function P(N){const J=s(N),nt=r(N),at=e[J],xt=e[N],Bt=e[nt];t.push([at,xt,Bt]),e.splice(N,1),a.splice(N,1),i--}for(;i>3;){const N=T();P(N);for(let J=0;J<i;J++)a[J]=o(J)}return t.push([e[0],e[1],e[2]]),new De(t.map(N=>Pe.Polygon(N,h.Zero,!0)))}clone(){return new Te({offset:this.offset.clone(),points:this.points.map(t=>t.clone())})}get worldPos(){return this._transform?this._transform.pos.add(this.offset):this.offset}get center(){return this.bounds.center}_calculateTransformation(){const t=this.points,e=t.length;this._transformedPoints.length=0;for(let i=0;i<e;i++)this._transformedPoints[i]=this._globalMatrix.multiply(t[i].clone())}getTransformedPoints(){return this._transformedPointsDirty&&(this._calculateTransformation(),this._transformedPointsDirty=!1),this._transformedPoints}getSides(){if(this._sidesDirty){const t=[],e=this.getTransformedPoints(),i=e.length;for(let s=0;s<i;s++)t.push(new Ge(e[s],e[(s+1)%i]));this._sides=t,this._sidesDirty=!1}return this._sides}getLocalSides(){if(this._localSidesDirty){const t=[],e=this.points,i=e.length;for(let s=0;s<i;s++)t.push(new Ge(e[s],e[(s+1)%i]));this._localSides=t,this._localSidesDirty=!1}return this._localSides}findSide(t){const e=this.getSides();let i=e[0],s=-Number.MAX_VALUE;for(let r=0;r<e.length;r++){const o=e[r],u=o.normal().dot(t);u>s&&(i=o,s=u)}return i}findLocalSide(t){const e=this.getLocalSides();let i=e[0],s=-Number.MAX_VALUE;for(let r=0;r<e.length;r++){const o=e[r],u=o.normal().dot(t);u>s&&(i=o,s=u)}return i}get axes(){const t=[],e=this.getSides();for(let i=0;i<e.length;i++)t.push(e[i].normal());return t}update(t){var e;t&&(this._transform=t,this._transformedPointsDirty=!0,this._sidesDirty=!0,((e=t.matrix)!==null&&e!==void 0?e:this._globalMatrix).clone(this._globalMatrix),this._globalMatrix.translate(this.offset.x,this.offset.y))}contains(t){const e=new ki(t,new h(1,0));return this.getSides().reduce(function(s,r){return e.intersect(r)>=0?s+1:s},0)%2!==0}getClosestLineBetween(t){if(t instanceof Qe)return mi.PolygonCircleClosestLine(this,t);if(t instanceof Te)return mi.PolygonPolygonClosestLine(this,t);if(t instanceof Ze)return mi.PolygonEdgeClosestLine(this,t);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}collide(t){if(t instanceof Qe)return di.CollideCirclePolygon(t,this);if(t instanceof Te)return di.CollidePolygonPolygon(this,t);if(t instanceof Ze)return di.CollidePolygonEdge(this,t);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}getFurthestPoint(t){const e=this.getTransformedPoints();let i=null,s=-Number.MAX_VALUE;for(let r=0;r<e.length;r++){const o=t.dot(e[r]);o>s&&(s=o,i=e[r])}return i}getFurthestLocalPoint(t){const e=this.points;let i=e[0],s=-Number.MAX_VALUE;for(let r=0;r<e.length;r++){const o=t.dot(e[r]);o>s&&(s=o,i=e[r])}return i}getClosestFace(t){const e=this.getSides();let i=Number.POSITIVE_INFINITY,s=-1,r=-1;for(let o=0;o<e.length;o++){const a=e[o].distanceToPoint(t);a<i&&(i=a,s=o,r=a)}return s!==-1?{distance:e[s].normal().scale(r),face:e[s]}:null}get bounds(){return this.localBounds.transform(this._globalMatrix)}get localBounds(){return this._localBoundsDirty&&(this._localBounds=E.fromPoints(this.points),this._localBoundsDirty=!1),this._localBounds}getInertia(t){if(this._cachedMass===t&&this._cachedInertia)return this._cachedInertia;let e=0,i=0;const s=this.points;for(let r=0;r<s.length;r++){const o=(r+1)%s.length,a=s[o].cross(s[r]);e+=a*(s[r].dot(s[r])+s[r].dot(s[o])+s[o].dot(s[o])),i+=a}return this._cachedMass=t,this._cachedInertia=t/6*(e/i)}rayCast(t,e=1/0){var i;const s=this.getSides(),r=s.length;let o=Number.MAX_VALUE,a,u=-1;for(let T=0;T<r;T++){const P=t.intersect(s[T]);P>=0&&P<o&&P<=e&&(o=P,a=s[T],u=T)}return u>=0?{collider:this,distance:o,body:(i=this.owner)===null||i===void 0?void 0:i.get(Vt),point:t.getPoint(o),normal:a.normal()}:null}project(t){const e=this.getTransformedPoints(),i=e.length;let s=Number.MAX_VALUE,r=-Number.MAX_VALUE;for(let o=0;o<i;o++){const a=e[o].dot(t);s=Math.min(s,a),r=Math.max(r,a)}return new Ys(s,r)}debug(t,e,i){const s=this.getTransformedPoints();Ce.drawPolygon(s,{color:e})}}class Pe{static Box(t,e,i=h.Half,s=h.Zero){return new Te({points:new E(-t*i.x,-e*i.y,t-t*i.x,e-e*i.y).getPoints(),offset:s})}static Polygon(t,e=h.Zero,i=!1){return new Te({points:t,offset:e,suppressConvexWarning:i})}static Circle(t,e=h.Zero){return new Qe({radius:t,offset:e})}static Edge(t,e){return new Ze({begin:t,end:e})}static Capsule(t,e,i=h.Zero){const s=I.getInstance();return t===e&&s.warn("A capsule collider with equal width and height is a circle, consider using a ex.Shape.Circle or ex.CircleCollider"),e>=t?new De([Pe.Circle(t/2,A(0,-e/2+t/2).add(i)),Pe.Box(t,e-t,h.Half,i),Pe.Circle(t/2,A(0,e/2-t/2).add(i))]):new De([Pe.Circle(e/2,A(-t/2+e/2,0).add(i)),Pe.Box(t-e,e,h.Half,i),Pe.Circle(e/2,A(t/2-e/2,0).add(i))])}}class ye extends ci{constructor(t){super(),this.events=new k,this.$colliderAdded=new ze,this.$colliderRemoved=new ze,this._collidersToRemove=[],this.set(t)}get(){return this._collider}set(t){return this.clear(),t&&(this._collider=t,this._collider.owner=this.owner,t.events.pipe(this.events),this.$colliderAdded.notifyAll(t),this.update()),t}clear(){this._collider&&(this._collidersToRemove.push(this._collider),this._collider=null)}processColliderRemoval(){for(const t of this._collidersToRemove)t.events.unpipe(this.events),this.$colliderRemoved.notifyAll(t),t.owner=null}clone(){return new ye(this._collider.clone())}get bounds(){var t,e;return(e=(t=this._collider)===null||t===void 0?void 0:t.bounds)!==null&&e!==void 0?e:new E}get localBounds(){var t,e;return(e=(t=this._collider)===null||t===void 0?void 0:t.localBounds)!==null&&e!==void 0?e:new E}update(){var t;const e=(t=this.owner)===null||t===void 0?void 0:t.get(Ot);this._collider&&(this._collider.owner=this.owner,e&&this._collider.update(e.get()))}collide(t){let e=this._collider,i=t._collider;if(!e||!i)return[];let s=!1;if(i instanceof De&&(e=i,i=this._collider,s=!0),this._collider){const r=e.collide(i);return r?(s&&r.forEach(o=>{o.mtv=o.mtv.negate(),o.normal=o.normal.negate(),o.tangent=o.normal.perpendicular(),o.colliderA=this._collider,o.colliderB=t._collider}),r):[]}return[]}onAdd(t){this._collider&&this.update(),this.events.on("precollision",e=>{const i=e;t.events.emit("precollision",new Lt(i.target.owner,i.other.owner,i.side,i.intersection,i.contact)),t instanceof Ye&&t.onPreCollisionResolve(i.target,i.other,i.side,i.contact)}),this.events.on("postcollision",e=>{const i=e;t.events.emit("postcollision",new Nt(i.target.owner,i.other.owner,i.side,i.intersection,i.contact)),t instanceof Ye&&t.onPostCollisionResolve(i.target,i.other,i.side,i.contact)}),this.events.on("collisionstart",e=>{const i=e;t.events.emit("collisionstart",new Hs(i.target.owner,i.other.owner,i.side,i.contact)),t instanceof Ye&&t.onCollisionStart(i.target,i.other,i.side,i.contact)}),this.events.on("collisionend",e=>{const i=e;t.events.emit("collisionend",new Ws(i.target.owner,i.other.owner,i.side,i.lastContact)),t instanceof Ye&&t.onCollisionEnd(i.target,i.other,i.side,i.lastContact)})}onRemove(){this.events.clear(),this.$colliderRemoved.notifyAll(this._collider)}useBoxCollider(t,e,i=h.Half,s=h.Zero){const r=Pe.Box(t,e,i,s);return this.set(r)}usePolygonCollider(t,e=h.Zero){const i=Pe.Polygon(t,e);return this.set(i)}useCircleCollider(t,e=h.Zero){const i=Pe.Circle(t,e);return this.set(i)}useEdgeCollider(t,e){const i=Pe.Edge(t,e);return this.set(i)}useCompositeCollider(t){return this.set(new De(t))}}var Ue;(function(n){n.Rotation="rotation",n.X="x",n.Y="y"})(Ue||(Ue={}));class Vt extends ci{constructor(t){var e,i,s;super(),this.dependencies=[Ot,me],this.id=et("body",Vt._ID++),this.events=new k,this.oldTransform=new Ki,this.__oldTransformCaptured=!1,this.enableFixedUpdateInterpolate=!0,this.collisionType=$t.PreventCollision,this.group=$i.All,this._sleeping=!1,this.bounciness=.2,this.friction=.99,this.useGravity=!0,this.limitDegreeOfFreedom=[],this.oldVel=new h(0,0),this.oldAcc=h.Zero,t?(this.collisionType=(e=t.type)!==null&&e!==void 0?e:this.collisionType,this.group=(i=t.group)!==null&&i!==void 0?i:this.group,this.useGravity=(s=t.useGravity)!==null&&s!==void 0?s:this.useGravity,this._bodyConfig={..._i.bodies,...t.config}):this._bodyConfig={..._i.bodies},this.updatePhysicsConfig(this._bodyConfig),this._mass=Vt._DEFAULT_CONFIG.defaultMass}get matrix(){return this.transform.get().matrix}updatePhysicsConfig(t){this._bodyConfig={..._i.bodies,...t},this.canSleep=this._bodyConfig.canSleepByDefault,this.sleepMotion=this._bodyConfig.sleepEpsilon*5,this.wakeThreshold=this._bodyConfig.wakeThreshold}static updateDefaultPhysicsConfig(t){Vt._DEFAULT_CONFIG=t}get mass(){return this._mass}set mass(t){this._mass=t,this._cachedInertia=void 0,this._cachedInverseInertia=void 0}get inverseMass(){return this.collisionType===$t.Fixed?0:1/this.mass}get sleeping(){return this._sleeping}setSleeping(t){this._sleeping=t,t?(this.vel=h.Zero,this.acc=h.Zero,this.angularVelocity=0,this.sleepMotion=0):this.sleepMotion=this._bodyConfig.sleepEpsilon*5}updateMotion(){this._sleeping&&this.setSleeping(!0);const t=this.vel.size*this.vel.size+Math.abs(this.angularVelocity*this.angularVelocity),e=this._bodyConfig.sleepBias;this.sleepMotion=e*this.sleepMotion+(1-e)*t,this.sleepMotion=D(this.sleepMotion,0,10*this._bodyConfig.sleepEpsilon),this.canSleep&&this.sleepMotion<this._bodyConfig.sleepEpsilon&&this.setSleeping(!0)}get inertia(){if(this._cachedInertia)return this._cachedInertia;const t=this.owner.get(ye);if(t){t.$colliderAdded.subscribe(()=>{this._cachedInertia=null}),t.$colliderRemoved.subscribe(()=>{this._cachedInertia=null});const e=t.get();if(e)return this._cachedInertia=e.getInertia(this.mass)}return 0}get inverseInertia(){return this._cachedInverseInertia?this._cachedInverseInertia:this._cachedInverseInertia=this.collisionType===$t.Fixed?0:1/this.inertia}get active(){var t;return!!(!((t=this.owner)===null||t===void 0)&&t.active)}get center(){return this.globalPos}get transform(){var t;return(t=this.owner)===null||t===void 0?void 0:t.get(Ot)}get motion(){var t;return(t=this.owner)===null||t===void 0?void 0:t.get(me)}get pos(){return this.transform.pos}set pos(t){this.transform.pos=t}get globalPos(){return this.transform.globalPos}set globalPos(t){this.transform.globalPos=t}get oldPos(){return this.oldTransform.pos}get vel(){return this.motion.vel}set vel(t){this.motion.vel=t}get acc(){return this.motion.acc}set acc(t){this.motion.acc=t}get torque(){return this.motion.torque}set torque(t){this.motion.torque=t}get oldRotation(){return this.oldTransform.rotation}get rotation(){return this.transform.globalRotation}set rotation(t){this.transform.globalRotation=t}get scale(){return this.transform.globalScale}set scale(t){this.transform.globalScale=t}get oldScale(){return this.oldTransform.scale}get scaleFactor(){return this.motion.scaleFactor}set scaleFactor(t){this.motion.scaleFactor=t}get angularVelocity(){return this.motion.angularVelocity}set angularVelocity(t){this.motion.angularVelocity=t}applyImpulse(t,e){if(this.collisionType!==$t.Active)return;const i=e.scale(this.inverseMass);if(this.limitDegreeOfFreedom.includes(Ue.X)&&(i.x=0),this.limitDegreeOfFreedom.includes(Ue.Y)&&(i.y=0),this.vel.addEqual(i),!this.limitDegreeOfFreedom.includes(Ue.Rotation)){const s=t.sub(this.globalPos);this.angularVelocity+=this.inverseInertia*s.cross(e)}}applyLinearImpulse(t){if(this.collisionType!==$t.Active)return;const e=t.scale(this.inverseMass);this.limitDegreeOfFreedom.includes(Ue.X)&&(e.x=0),this.limitDegreeOfFreedom.includes(Ue.Y)&&(e.y=0),this.vel=this.vel.add(e)}applyAngularImpulse(t,e){if(this.collisionType===$t.Active&&!this.limitDegreeOfFreedom.includes(Ue.Rotation)){const i=t.sub(this.globalPos);this.angularVelocity+=this.inverseInertia*i.cross(e)}}captureOldTransform(){this.__oldTransformCaptured=!0;const t=this.transform.get();t.clone(this.oldTransform),this.oldTransform.parent=t.parent,this.oldVel.setTo(this.vel.x,this.vel.y),this.oldAcc.setTo(this.acc.x,this.acc.y)}clone(){return super.clone()}}Vt._ID=0,Vt._DEFAULT_CONFIG={..._i.bodies};class ua{constructor(t){this.data=t,this.type="Component Added"}}function Aa(n){return!!n&&n.type==="Component Added"}class ga{constructor(t){this.data=t,this.type="Component Removed"}}function pa(n){return!!n&&n.type==="Component Removed"}const fa={Initialize:"initialize",PreUpdate:"preupdate",PostUpdate:"postupdate",Kill:"kill"};class Fe{constructor(t,e){this.id=Fe._ID++,this.name=`Entity#${this.id}`,this.events=new k,this._tags=new Set,this.componentAdded$=new ze,this.componentRemoved$=new ze,this.tagAdded$=new ze,this.tagRemoved$=new ze,this.components=new Map,this._componentsToRemove=[],this._instanceOfComponentCacheDirty=!0,this._instanceOfComponentCache=new Map,this.scene=null,this.active=!0,this._parent=null,this.childrenAdded$=new ze,this.childrenRemoved$=new ze,this._children=[],this._isInitialized=!1;let i,s;if(Array.isArray(t))i=t,s=e;else if(t&&typeof t=="object"){const{components:r,name:o}=t;i=r,s=o}if(s&&(this.name=s),i)for(const r of i)this.addComponent(r)}kill(){this.active&&(this.active=!1,this.unparent()),this.emit("kill",new Vi(this))}isKilled(){return!this.active}get tags(){return this._tags}hasTag(t){return this._tags.has(t)}addTag(t){return this._tags.add(t),this.tagAdded$.notifyAll(t),this}removeTag(t){return this._tags.delete(t),this.tagRemoved$.notifyAll(t),this}get types(){return Array.from(this.components.keys())}getComponents(){return Array.from(this.components.values())}hasAll(t){for(let e=0;e<t.length;e++)if(!this.components.has(t[e]))return!1;return!0}hasAllTags(t){for(let e=0;e<t.length;e++)if(!this.tags.has(t[e]))return!1;return!0}_getCachedInstanceOfType(t){if(this._instanceOfComponentCacheDirty&&(this._instanceOfComponentCacheDirty=!1,this._instanceOfComponentCache.clear()),this._instanceOfComponentCache.has(t))return this._instanceOfComponentCache.get(t);for(const e of this.components.values())if(e instanceof t)return this._instanceOfComponentCache.set(t,e),e}get(t){const e=this._getCachedInstanceOfType(t);return e??this.components.get(t)}get parent(){return this._parent}get children(){return this._children}unparent(){this._parent&&(this._parent.removeChild(this),this._parent=null)}addChild(t){if(t.parent===null){if(this.getAncestors().includes(t))throw new Error("Cycle detected, cannot add entity");this._children.push(t),t._parent=this,this.childrenAdded$.notifyAll(t)}else throw new Error("Entity already has a parent, cannot add without unparenting");return this}removeChild(t){return t.parent===this&&(K(t,this._children),t._parent=null,this.childrenRemoved$.notifyAll(t)),this}removeAllChildren(){for(let t=this.children.length-1;t>=0;t--)this.removeChild(this.children[t]);return this}getAncestors(){const t=[this];let e=this.parent;for(;e;)t.push(e),e=e.parent;return t.reverse()}getDescendants(){let t=[this],e=[this];for(;e.length>0;){const i=e.pop();i&&(e=e.concat(i.children),t=t.concat(i.children))}return t}clone(){const t=new Fe;for(const e of this.types){const i=this.get(e);i&&t.addComponent(i.clone())}for(const e of this.children)t.addChild(e.clone());return t}addTemplate(t,e=!1){for(const i of t.getComponents())this.addComponent(i.clone(),e);for(const i of t.children)this.addChild(i.clone().addTemplate(i));return this}addComponent(t,e=!1){if(this._instanceOfComponentCacheDirty=!0,this.has(t.constructor))if(e)this.removeComponent(t.constructor,!0);else return this;if(t.dependencies&&t.dependencies.length)for(const i of t.dependencies)this.addComponent(new i);return t.owner=this,this.components.set(t.constructor,t),t.onAdd&&t.onAdd(this),this.componentAdded$.notifyAll(t),this}removeComponent(t,e=!1){let i;if(En(t)?i=t:i=t.constructor,e){const s=this.components.get(i);s&&(this.componentRemoved$.notifyAll(s),s.owner=void 0,s.onRemove&&s.onRemove(this)),this.components.delete(i),this._instanceOfComponentCacheDirty=!0}else this._componentsToRemove.push(i);return this}clearComponents(){const t=this.types;for(const e of t)this.removeComponent(e)}processComponentRemoval(){for(const t of this._componentsToRemove)this.removeComponent(t,!0);this._componentsToRemove.length=0}has(t){return this.components.has(t)}get isInitialized(){return this._isInitialized}_initialize(t){this.isInitialized||(this.onInitialize(t),this.events.emit("initialize",new ys(t,this)),this._isInitialized=!0)}_preupdate(t,e){this.events.emit("preupdate",new ai(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.events.emit("postupdate",new li(t,e,this)),this.onPostUpdate(t,e)}onInitialize(t){}onPreUpdate(t,e){}onPostUpdate(t,e){}update(t,e){this._initialize(t),this._preupdate(t,e);for(const i of this.children)i.update(t,e);this._postupdate(t,e)}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){e?this.events.off(t,e):this.events.off(t)}}Fe._ID=0;var qs;(function(n){n.Forward="forward",n.Backward="backward"})(qs||(qs={}));var ui;(function(n){n.End="end",n.Loop="loop",n.PingPong="pingpong",n.Freeze="freeze"})(ui||(ui={}));const _a={Frame:"frame",Loop:"loop",End:"end"};class vi extends it{constructor(t){var e,i,s;super(t),this.events=new k,this.frames=[],this.strategy=ui.Loop,this.frameDuration=100,this._idempotencyToken=-1,this._firstTick=!0,this._currentFrame=0,this._timeLeftInFrame=0,this._pingPongDirection=1,this._done=!1,this._playing=!0,this._speed=1,this._reversed=!1,this.frames=t.frames,this.speed=(e=t.speed)!==null&&e!==void 0?e:this.speed,this.strategy=(i=t.strategy)!==null&&i!==void 0?i:this.strategy,this.frameDuration=t.totalDuration?t.totalDuration/this.frames.length:(s=t.frameDuration)!==null&&s!==void 0?s:this.frameDuration,t.reverse&&this.reverse(),this.goToFrame(0)}clone(){return new vi({frames:this.frames.map(t=>({...t})),frameDuration:this.frameDuration,speed:this.speed,reverse:this._reversed,strategy:this.strategy,...this.cloneGraphicOptions()})}get width(){const t=this.currentFrame;return t?Math.abs(t.graphic.width*this.scale.x):0}get height(){const t=this.currentFrame;return t?Math.abs(t.graphic.height*this.scale.y):0}static fromSpriteSheet(t,e,i,s=ui.Loop){const r=t.sprites.length-1,o=e.filter(a=>a<0||a>r);return o.length&&vi._LOGGER.warn(`Indices into SpriteSheet were provided that don't exist: ${o.join(",")} no frame will be shown`),new vi({frames:t.sprites.filter((a,u)=>e.indexOf(u)>-1).map(a=>({graphic:a,duration:i})),strategy:s})}static fromSpriteSheetCoordinates(t){const{spriteSheet:e,frameCoordinates:i,durationPerFrameMs:s,speed:r,strategy:o,reverse:a}=t,u=s??100,T=[];for(const P of i){const{x:N,y:J,duration:nt,options:at}=P,xt=e.getSprite(N,J,at);xt?T.push({graphic:xt,duration:nt??u}):vi._LOGGER.warn(`Skipping frame! SpriteSheet does not have coordinate (${N}, ${J}), please check your SpriteSheet to confirm that sprite exists`)}return new vi({frames:T,strategy:o,speed:r,reverse:a})}get speed(){return this._speed}set speed(t){this._speed=D(Math.abs(t),0,1/0)}get currentFrame(){return this._currentFrame>=0&&this._currentFrame<this.frames.length?this.frames[this._currentFrame]:null}get currentFrameIndex(){return this._currentFrame}get currentFrameTimeLeft(){return this._timeLeftInFrame}get isPlaying(){return this._playing}reverse(){this.frames=this.frames.slice().reverse(),this._reversed=!this._reversed}get direction(){return!!(this._reversed&&this._pingPongDirection===1)?qs.Backward:qs.Forward}play(){this._playing=!0}pause(){this._playing=!1,this._firstTick=!0}reset(){this._done=!1,this._firstTick=!0,this._currentFrame=0,this._timeLeftInFrame=this.frameDuration;const t=this.frames[this._currentFrame];t&&(this._timeLeftInFrame=(t==null?void 0:t.duration)||this.frameDuration)}get canFinish(){switch(this.strategy){case ui.End:case ui.Freeze:return!0;default:return!1}}get done(){return this._done}goToFrame(t,e){this._currentFrame=t,this._timeLeftInFrame=e??this.frameDuration;const i=this.frames[this._currentFrame];i&&!this._done&&(this._timeLeftInFrame=e??((i==null?void 0:i.duration)||this.frameDuration),this.events.emit("frame",{...i,frameIndex:this.currentFrameIndex}))}_nextFrame(){const t=this._currentFrame;if(this._done)return t;let e=-1;switch(this.strategy){case ui.Loop:{e=(t+1)%this.frames.length,e===0&&this.events.emit("loop",this);break}case ui.End:{e=t+1,e>=this.frames.length&&(this._done=!0,this._currentFrame=this.frames.length,this.events.emit("end",this));break}case ui.Freeze:{e=D(t+1,0,this.frames.length-1),e>=this.frames.length-1&&(this._done=!0,this.events.emit("end",this));break}case ui.PingPong:{t+this._pingPongDirection>=this.frames.length&&(this._pingPongDirection=-1,this.events.emit("loop",this)),t+this._pingPongDirection<0&&(this._pingPongDirection=1,this.events.emit("loop",this)),e=t+this._pingPongDirection%this.frames.length;break}}return e}tick(t,e=0){this._idempotencyToken!==e&&(this._idempotencyToken=e,this._playing&&(this._firstTick&&(this._firstTick=!1,this.events.emit("frame",{...this.currentFrame,frameIndex:this.currentFrameIndex})),this._timeLeftInFrame-=t*this._speed,this._timeLeftInFrame<=0&&this.goToFrame(this._nextFrame())))}_drawImage(t,e,i){this.currentFrame&&this.currentFrame.graphic.draw(t,e,i)}}vi._LOGGER=I.getInstance();class xs extends it{constructor(t){var e;super(t),this._logger=I.getInstance(),this.useAnchor=!0,this.members=[],this.members=t.members,this.useAnchor=(e=t.useAnchor)!==null&&e!==void 0?e:this.useAnchor,this._updateDimensions()}clone(){return new xs({members:[...this.members],...this.cloneGraphicOptions()})}_updateDimensions(){const t=this.localBounds;return this.width=t.width,this.height=t.height,t}get localBounds(){let t=new E;for(const e of this.members)if(e instanceof it)t=e.localBounds.combine(t);else{const{graphic:i,offset:s,useBounds:r}=e;i?(r===void 0?!0:r)&&(t=i.localBounds.translate(s).combine(t)):this._logger.warnOnce(`Graphics group member has an null or undefined graphic, member definition: ${JSON.stringify(e)}.`)}return t}_isAnimationOrGroup(t){return t instanceof vi||t instanceof xs}tick(t,e){for(const i of this.members){let s;i instanceof it?s=i:s=i.graphic,this._isAnimationOrGroup(s)&&s.tick(t,e)}}reset(){for(const t of this.members){let e;t instanceof it?e=t:e=t.graphic,this._isAnimationOrGroup(e)&&e.reset()}}_preDraw(t,e,i){this._updateDimensions(),super._preDraw(t,this.useAnchor?e:0,this.useAnchor?i:0)}_drawImage(t,e,i){const s=h.Zero;for(const r of this.members){let o;r instanceof it?o=r:(o=r.graphic,r.offset.clone(s)),o&&(t.save(),t.translate(e,i),o.draw(t,s.x,s.y),this.showDebug&&t.debug.drawRect(0,0,this.width,this.height),t.restore())}}}function en(n){return!!n.tick}class Ie extends ci{get offset(){return new _r(this._offset,()=>{this.recalculateBounds()})}set offset(t){this._offset=t,this.recalculateBounds()}get anchor(){return new _r(this._anchor,()=>{this.recalculateBounds()})}set anchor(t){this._anchor=t,this.recalculateBounds()}constructor(t){super(),this._logger=I.getInstance(),this._current="default",this._graphics={},this._options={},this.material=null,this.visible=!0,this.opacity=1,this._offset=h.Zero,this._anchor=h.Half,this.flipHorizontal=!1,this.flipVertical=!1,this.copyGraphics=!1,this._localBounds=null,t={visible:this.visible,graphics:{},...t};const{current:e,anchor:i,opacity:s,visible:r,graphics:o,offset:a,copyGraphics:u,onPreDraw:T,onPostDraw:P,onPreTransformDraw:N,onPostTransformDraw:J}=t;for(const[nt,at]of Object.entries(o))at instanceof it?this._graphics[nt]=at:(this._graphics[nt]=at.graphic,this._options[nt]=at.options);this.offset=a??this.offset,this.opacity=s??this.opacity,this.anchor=i??this.anchor,this.copyGraphics=u??this.copyGraphics,this.onPreDraw=T??this.onPreDraw,this.onPostDraw=P??this.onPostDraw,this.onPreDraw=N??this.onPreTransformDraw,this.onPostTransformDraw=J??this.onPostTransformDraw,this.visible=!!r,this._current=e??this._current,e&&this._graphics[e]&&this.use(e)}getGraphic(t){return this._graphics[t]}getOptions(t){return this._options[t]}getNames(){return Object.keys(this._graphics)}get current(){return this._graphics[this._current]}get currentOptions(){return this._options[this._current]}get graphics(){return this._graphics}get options(){return this._options}add(t,e,i){let s="default",r=null,o;return typeof t=="string"&&e instanceof it&&(s=t,r=e,o=i),t instanceof it&&!(e instanceof it)&&(r=t,o=e),this._graphics[s]=this.copyGraphics?r.clone():r,this._options[s]=this.copyGraphics?{...o}:o,s==="default"&&this.use("default"),r}remove(t){delete this._graphics[t],delete this._options[t],this._current===t&&(this._current="default",this.recalculateBounds())}show(t,e){return this.use(t,e)}use(t,e){var i;if(t instanceof it){let s=t;this.copyGraphics&&(s=t.clone()),this._current="default",this._graphics[this._current]=s,this._options[this._current]=e}else this._current=t,this._options[this._current]=e,this._current in this._graphics||this._logger.warn(`Graphic ${this._current} is not registered with the graphics component owned by ${(i=this.owner)===null||i===void 0?void 0:i.name}. Nothing will be drawn.`);return this.recalculateBounds(),this.current}hide(){this._current="ex.none"}set localBounds(t){this._localBounds=t}recalculateBounds(){let t=new E;const e=this._graphics[this._current],i=this._options[this._current];if(!e){this._localBounds=t;return}let s=this.anchor,r=this.offset;i!=null&&i.anchor&&(s=i.anchor),i!=null&&i.offset&&(r=i.offset);const o=e.localBounds,a=-o.width*s.x+r.x,u=-o.height*s.y+r.y;e instanceof xs&&!e.useAnchor?t=e==null?void 0:e.localBounds.combine(t):t=e==null?void 0:e.localBounds.translate(A(a,u)).combine(t),this._localBounds=t}get localBounds(){return(!this._localBounds||this._localBounds.hasZeroDimensions())&&this.recalculateBounds(),this._localBounds}get bounds(){let t=this.localBounds;if(this.owner){const e=this.owner.get(Ot);e&&(t=t.transform(e.get().matrix))}return t}update(t,e=0){const i=this.current;i&&en(i)&&i.tick(t,e)}clone(){const t=new Ie;return t._graphics={...this._graphics},t._options={...this._options},t.offset=this.offset.clone(),t.opacity=this.opacity,t.anchor=this.anchor.clone(),t.copyGraphics=this.copyGraphics,t.onPreDraw=this.onPreDraw,t.onPostDraw=this.onPostDraw,t.visible=this.visible,t}}class Vs extends Bi{constructor(t){super(t),this.width=t.width,this.height=t.height,this.rasterize()}clone(){return new Vs({width:this.width,height:this.height,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){this.color&&t.fillRect(0,0,this.width,this.height),this.strokeColor&&t.strokeRect(0,0,this.width,this.height)}}class xr extends Bi{get radius(){return this._radius}set radius(t){this._radius=t,this.width=this._radius*2,this.height=this._radius*2,this.flagDirty()}constructor(t){var e,i,s;super(t),this._radius=0;const r=(e=t.lineWidth)!==null&&e!==void 0?e:t.strokeColor?1:0;this.padding=(i=t.padding)!==null&&i!==void 0?i:2+r/2,this.radius=t.radius,this.filtering=(s=t.filtering)!==null&&s!==void 0?s:F.Blended,this.rasterize()}clone(){return new xr({radius:this.radius,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){this.radius>0&&(t.beginPath(),t.arc(this.radius,this.radius,this.radius,0,Math.PI*2),this.color&&t.fill(),this.strokeColor&&t.stroke())}}class wi extends ci{constructor(t){var e,i;super(),this.useColliderShape=!0,this.useGraphicsBounds=!0,this.useColliderShape=(e=t==null?void 0:t.useColliderShape)!==null&&e!==void 0?e:this.useColliderShape,this.useGraphicsBounds=(i=t==null?void 0:t.useGraphicsBounds)!==null&&i!==void 0?i:this.useGraphicsBounds,this.localBounds=t==null?void 0:t.localBounds}}class pe{static CreateReversibleEasingFunction(t){return(e,i,s,r)=>s<i?i-(t(e,s,i,r)-s):t(e,i,s,r)}static CreateVectorEasingFunction(t){return(e,i,s,r)=>new h(t(e,i.x,s.x,r),t(e,i.y,s.y,r))}}pe.Linear=pe.CreateReversibleEasingFunction((n,t,e,i)=>(e=e-t,e*n/i+t)),pe.EaseInQuad=pe.CreateReversibleEasingFunction((n,t,e,i)=>(e=e-t,n/=i,e*n*n+t)),pe.EaseOutQuad=pe.CreateReversibleEasingFunction((n,t,e,i)=>(e=e-t,n/=i,-e*n*(n-2)+t)),pe.EaseInOutQuad=pe.CreateReversibleEasingFunction((n,t,e,i)=>(e=e-t,n/=i/2,n<1?e/2*n*n+t:(n--,-e/2*(n*(n-2)-1)+t))),pe.EaseInCubic=pe.CreateReversibleEasingFunction((n,t,e,i)=>(e=e-t,n/=i,e*n*n*n+t)),pe.EaseOutCubic=pe.CreateReversibleEasingFunction((n,t,e,i)=>(e=e-t,n/=i,n--,e*(n*n*n+1)+t)),pe.EaseInOutCubic=pe.CreateReversibleEasingFunction((n,t,e,i)=>(e=e-t,n/=i/2,n<1?e/2*n*n*n+t:(n-=2,e/2*(n*n*n+2)+t)));class kn{constructor(t){this._actions=[],this._currentAction=null,this._completedActions=[],this._entity=t}add(t){this._actions.push(t)}remove(t){const e=this._actions.indexOf(t);this._actions.splice(e,1)}clearActions(){this._actions.length=0,this._completedActions.length=0,this._currentAction&&this._currentAction.stop()}getActions(){return this._actions.concat(this._completedActions)}hasNext(){return this._actions.length>0}isComplete(){return this._actions.length===0}reset(){this._actions=this.getActions();const t=this._actions.length;for(let e=0;e<t;e++)this._actions[e].reset();this._completedActions=[]}update(t){if(this._actions.length>0&&(this._currentAction!==this._actions[0]&&(this._currentAction=this._actions[0],this._entity.emit("actionstart",new Hr(this._currentAction,this._entity))),this._currentAction.update(t),this._currentAction.isComplete(this._entity))){this._entity.emit("actioncomplete",new Wr(this._currentAction,this._entity));const e=this._actions.shift();e&&this._completedActions.push(e)}}}class Dn{constructor(t,e,i){this._stopped=!1,this._repeatBuilder=e,this._repeatContext=new Xs(t),this._actionQueue=this._repeatContext.getQueue(),this._repeat=i,this._originalRepeat=i,this._repeatBuilder(this._repeatContext),this._repeat--}update(t){this._actionQueue.isComplete()&&(this._actionQueue.clearActions(),this._repeatBuilder(this._repeatContext),this._repeat--),this._actionQueue.update(t)}isComplete(){return this._stopped||this._repeat<=0&&this._actionQueue.isComplete()}stop(){this._stopped=!0}reset(){this._repeat=this._originalRepeat}}class Qn{constructor(t,e){this._stopped=!1,this._repeatBuilder=e,this._repeatContext=new Xs(t),this._actionQueue=this._repeatContext.getQueue(),this._repeatBuilder(this._repeatContext)}update(t){this._stopped||(this._actionQueue.isComplete()&&(this._actionQueue.clearActions(),this._repeatBuilder(this._repeatContext)),this._actionQueue.update(t))}isComplete(){return this._stopped}stop(){this._stopped=!0,this._actionQueue.clearActions()}reset(){}}class Pn{constructor(t,e,i,s){if(this._started=!1,this._stopped=!1,this._entity=t,this._tx=t.get(Ot),this._motion=t.get(me),this._speed=s,this._offset=new h(e,i),s<=0)throw I.getInstance().error("Attempted to moveBy with speed less than or equal to zero : "+s),new Error("Speed must be greater than 0 pixels per second")}update(t){this._started||(this._started=!0,this._start=new h(this._tx.pos.x,this._tx.pos.y),this._end=this._start.add(this._offset),this._distance=this._offset.size,this._dir=this._end.sub(this._start).normalize()),this.isComplete(this._entity)?(this._tx.pos=A(this._end.x,this._end.y),this._motion.vel=A(0,0)):this._motion.vel=this._dir.scale(this._speed)}isComplete(t){const e=t.get(Ot);return this._stopped||e.pos.distance(this._start)>=this._distance}stop(){this._motion.vel=A(0,0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class Fn{constructor(t,e,i,s){this.entity=t,this._started=!1,this._stopped=!1,this._tx=t.get(Ot),this._motion=t.get(me),this._end=new h(e,i),this._speed=s}update(t){this._started||(this._started=!0,this._start=new h(this._tx.pos.x,this._tx.pos.y),this._distance=this._start.distance(this._end),this._dir=this._end.sub(this._start).normalize());const e=this._dir.scale(this._speed);this._motion.vel=A(e.x,e.y),this.isComplete(this.entity)&&(this._tx.pos=A(this._end.x,this._end.y),this._motion.vel=A(0,0))}isComplete(t){const e=t.get(Ot);return this._stopped||new h(e.pos.x,e.pos.y).distance(this._start)>=this._distance}stop(){this._motion.vel=A(0,0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}var ei;(function(n){n[n.ShortestPath=0]="ShortestPath",n[n.LongestPath=1]="LongestPath",n[n.Clockwise=2]="Clockwise",n[n.CounterClockwise=3]="CounterClockwise"})(ei||(ei={}));class Mn{constructor(t,e,i,s){this._started=!1,this._stopped=!1,this._tx=t.get(Ot),this._motion=t.get(me),this._end=e,this._speed=i,this._rotationType=s||ei.ShortestPath}update(t){if(!this._started){this._started=!0,this._start=this._tx.rotation,this._currentNonCannonAngle=this._tx.rotation;const e=Math.abs(this._end-this._start),i=C-e;switch(e>i?(this._shortDistance=i,this._longDistance=e):(this._shortDistance=e,this._longDistance=i),this._shortestPathIsPositive=(this._start-this._end+C)%C>=Math.PI,this._rotationType){case ei.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case ei.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case ei.Clockwise:this._direction=1,this._shortestPathIsPositive?this._distance=this._shortDistance:this._distance=this._longDistance;break;case ei.CounterClockwise:this._direction=-1,this._shortestPathIsPositive?this._distance=this._longDistance:this._distance=this._shortDistance;break}}this._motion.angularVelocity=this._direction*this._speed,this._currentNonCannonAngle+=this._direction*this._speed*(t/1e3),this.isComplete()&&(this._tx.rotation=this._end,this._motion.angularVelocity=0,this._stopped=!0)}isComplete(){const t=Math.abs(this._currentNonCannonAngle-this._start);return this._stopped||t>=Math.abs(this._distance)}stop(){this._motion.angularVelocity=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class Ln{constructor(t,e,i,s){this._started=!1,this._stopped=!1,this._tx=t.get(Ot),this._motion=t.get(me),this._speed=i,this._offset=e,this._rotationType=s||ei.ShortestPath}update(t){if(!this._started){this._started=!0,this._start=this._tx.rotation,this._currentNonCannonAngle=this._tx.rotation,this._end=this._start+this._offset;const e=Math.abs(this._end-this._start),i=C-e;switch(e>i?(this._shortDistance=i,this._longDistance=e):(this._shortDistance=e,this._longDistance=i),this._shortestPathIsPositive=(this._start-this._end+C)%C>=Math.PI,this._rotationType){case ei.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case ei.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case ei.Clockwise:this._direction=1,this._shortDistance>=0?this._distance=this._shortDistance:this._distance=this._longDistance;break;case ei.CounterClockwise:this._direction=-1,this._shortDistance<=0?this._distance=this._shortDistance:this._distance=this._longDistance;break}}this._motion.angularVelocity=this._direction*this._speed,this._currentNonCannonAngle+=this._direction*this._speed*(t/1e3),this.isComplete()&&(this._tx.rotation=this._end,this._motion.angularVelocity=0,this._stopped=!0)}isComplete(){const t=Math.abs(this._currentNonCannonAngle-this._start);return this._stopped||t>=Math.abs(this._distance)}stop(){this._motion.angularVelocity=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._start=void 0,this._currentNonCannonAngle=void 0,this._distance=void 0}}class Rn{constructor(t,e,i,s,r){this._started=!1,this._stopped=!1,this._tx=t.get(Ot),this._motion=t.get(me),this._endX=e,this._endY=i,this._speedX=s,this._speedY=r}update(t){if(this._started||(this._started=!0,this._startX=this._tx.scale.x,this._startY=this._tx.scale.y,this._distanceX=Math.abs(this._endX-this._startX),this._distanceY=Math.abs(this._endY-this._startY)),Math.abs(this._tx.scale.x-this._startX)>=this._distanceX)this._motion.scaleFactor.x=0;else{const e=this._endY<this._startY?-1:1;this._motion.scaleFactor.x=this._speedX*e}if(Math.abs(this._tx.scale.y-this._startY)>=this._distanceY)this._motion.scaleFactor.y=0;else{const e=this._endY<this._startY?-1:1;this._motion.scaleFactor.y=this._speedY*e}this.isComplete()&&(this._tx.scale=A(this._endX,this._endY),this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0)}isComplete(){return this._stopped||Math.abs(this._tx.scale.x-this._startX)>=this._distanceX-.01&&Math.abs(this._tx.scale.y-this._startY)>=this._distanceY-.01}stop(){this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class zn{constructor(t,e,i,s){this._started=!1,this._stopped=!1,this._tx=t.get(Ot),this._motion=t.get(me),this._offset=new h(e,i),this._speedX=this._speedY=s}update(t){this._started||(this._started=!0,this._startScale=this._tx.scale.clone(),this._endScale=this._startScale.add(this._offset),this._distanceX=Math.abs(this._endScale.x-this._startScale.x),this._distanceY=Math.abs(this._endScale.y-this._startScale.y),this._directionX=this._endScale.x<this._startScale.x?-1:1,this._directionY=this._endScale.y<this._startScale.y?-1:1),this._motion.scaleFactor.x=this._speedX*this._directionX,this._motion.scaleFactor.y=this._speedY*this._directionY,this.isComplete()&&(this._tx.scale=this._endScale,this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0)}isComplete(){return this._stopped||Math.abs(this._tx.scale.x-this._startScale.x)>=this._distanceX-.01&&Math.abs(this._tx.scale.y-this._startScale.y)>=this._distanceY-.01}stop(){this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class On{constructor(t){this._method=null,this._hasBeenCalled=!1,this._method=t}update(t){this._method(),this._hasBeenCalled=!0}isComplete(){return this._hasBeenCalled}reset(){this._hasBeenCalled=!1}stop(){this._hasBeenCalled=!0}}class Nn{constructor(t,e,i,s,r){this.easingFcn=r,this._currentLerpTime=0,this._lerpDuration=1*1e3,this._lerpStart=new h(0,0),this._lerpEnd=new h(0,0),this._initialized=!1,this._stopped=!1,this._tx=t.get(Ot),this._motion=t.get(me),this._lerpDuration=s,this._lerpEnd=new h(e,i)}_initialize(){this._lerpStart=new h(this._tx.pos.x,this._tx.pos.y),this._currentLerpTime=0}update(t){this._initialized||(this._initialize(),this._initialized=!0),this._currentLerpTime+=t;let e=this._tx.pos.x,i=this._tx.pos.y;this._currentLerpTime<this._lerpDuration?(this._lerpEnd.x<this._lerpStart.x?e=this._lerpStart.x-(this.easingFcn(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):e=this.easingFcn(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),this._lerpEnd.y<this._lerpStart.y?i=this._lerpStart.y-(this.easingFcn(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):i=this.easingFcn(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this._motion.vel=A((e-this._tx.pos.x)/(t/1e3),(i-this._tx.pos.y)/(t/1e3))):(this._tx.pos=A(this._lerpEnd.x,this._lerpEnd.y),this._motion.vel=h.Zero)}isComplete(){return this._stopped||this._currentLerpTime>=this._lerpDuration}reset(){this._initialized=!1,this._stopped=!1,this._currentLerpTime=0}stop(){this._motion.vel=A(0,0),this._stopped=!0}}class Gn{constructor(t,e,i,s,r){this.easingFcn=r,this._currentLerpTime=0,this._lerpDuration=1*1e3,this._lerpStart=new h(0,0),this._lerpEnd=new h(0,0),this._initialized=!1,this._stopped=!1,this._tx=t.get(Ot),this._motion=t.get(me),this._lerpDuration=s,this._offset=new h(e,i)}_initialize(){this._lerpStart=new h(this._tx.pos.x,this._tx.pos.y),this._currentLerpTime=0,this._lerpEnd=this._lerpStart.add(this._offset)}update(t){this._initialized||(this._initialize(),this._initialized=!0),this._currentLerpTime+=t;let e=this._tx.pos.x,i=this._tx.pos.y;this._currentLerpTime<this._lerpDuration?(this._lerpEnd.x<this._lerpStart.x?e=this._lerpStart.x-(this.easingFcn(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):e=this.easingFcn(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),this._lerpEnd.y<this._lerpStart.y?i=this._lerpStart.y-(this.easingFcn(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):i=this.easingFcn(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this._motion.vel=A((e-this._tx.pos.x)/(t/1e3),(i-this._tx.pos.y)/(t/1e3))):(this._tx.pos=A(this._lerpEnd.x,this._lerpEnd.y),this._motion.vel=h.Zero)}isComplete(){return this._stopped||this._currentLerpTime>=this._lerpDuration}reset(){this._initialized=!1,this._stopped=!1,this._currentLerpTime=0}stop(){this._motion.vel=A(0,0),this._stopped=!0}}class Un{constructor(t,e,i,s=1){this._timeVisible=0,this._timeNotVisible=0,this._elapsedTime=0,this._totalTime=0,this._stopped=!1,this._started=!1,this._graphics=t.get(Ie),this._timeVisible=e,this._timeNotVisible=i,this._duration=(e+i)*s}update(t){this._started||(this._started=!0,this._elapsedTime=0,this._totalTime=0),this._graphics&&(this._elapsedTime+=t,this._totalTime+=t,this._graphics.visible&&this._elapsedTime>=this._timeVisible&&(this._graphics.visible=!1,this._elapsedTime=0),!this._graphics.visible&&this._elapsedTime>=this._timeNotVisible&&(this._graphics.visible=!0,this._elapsedTime=0),this.isComplete()&&(this._graphics.visible=!0))}isComplete(){return this._stopped||this._totalTime>=this._duration}stop(){this._graphics&&(this._graphics.visible=!0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._elapsedTime=0,this._totalTime=0}}class jn{constructor(t,e,i){this._multiplier=1,this._started=!1,this._stopped=!1,this._graphics=t.get(Ie),this._endOpacity=e,this._speed=this._ogspeed=i}update(t){this._graphics&&(this._started||(this._started=!0,this._speed=this._ogspeed,this._endOpacity<this._graphics.opacity?this._multiplier=-1:this._multiplier=1),this._speed>0&&(this._graphics.opacity+=this._multiplier*(Math.abs(this._graphics.opacity-this._endOpacity)*t)/this._speed),this._speed-=t,this.isComplete()&&(this._graphics.opacity=this._endOpacity),I.getInstance().debug("[Action fade] Actor opacity:",this._graphics.opacity))}isComplete(){return this._stopped||Math.abs(this._graphics.opacity-this._endOpacity)<.05}stop(){this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class Hn{constructor(t){this._elapsedTime=0,this._started=!1,this._stopped=!1,this._delay=t}update(t){this._started||(this._started=!0),this._elapsedTime+=t}isComplete(){return this._stopped||this._elapsedTime>=this._delay}stop(){this._stopped=!0}reset(){this._elapsedTime=0,this._started=!1,this._stopped=!1}}class Wn{constructor(t){this._stopped=!1,this._entity=t}update(t){this._entity.get(bs).clearActions(),this._entity.kill(),this._stopped=!0}isComplete(){return this._stopped}stop(){}reset(){}}class sn{constructor(t,e,i){this._started=!1,this._stopped=!1,this._tx=t.get(Ot),this._motion=t.get(me),this._followTx=e.get(Ot),this._followMotion=e.get(me),this._current=new h(this._tx.pos.x,this._tx.pos.y),this._end=new h(this._followTx.pos.x,this._followTx.pos.y),this._maximumDistance=i!==void 0?i:this._current.distance(this._end),this._speed=0}update(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());const e=Math.sqrt(Math.pow(this._followMotion.vel.x,2)+Math.pow(this._followMotion.vel.y,2));if(e!==0&&(this._speed=e),this._current=A(this._tx.pos.x,this._tx.pos.y),this._end=A(this._followTx.pos.x,this._followTx.pos.y),this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize(),this._distanceBetween>=this._maximumDistance){const i=this._dir.scale(this._speed);this._motion.vel=A(i.x,i.y)}else this._motion.vel=A(0,0);this.isComplete()&&(this._tx.pos=A(this._end.x,this._end.y),this._motion.vel=A(0,0))}stop(){this._motion.vel=A(0,0),this._stopped=!0}isComplete(){return this._stopped}reset(){this._started=!1,this._stopped=!1}}class rn{constructor(t,e,i){this._started=!1,this._stopped=!1,this._speedWasSpecified=!1,this._tx=t.get(Ot),this._motion=t.get(me),this._meetTx=e.get(Ot),this._meetMotion=e.get(me),this._current=new h(this._tx.pos.x,this._tx.pos.y),this._end=new h(this._meetTx.pos.x,this._meetTx.pos.y),this._speed=i||0,i!==void 0&&(this._speedWasSpecified=!0)}update(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());const e=Math.sqrt(Math.pow(this._meetMotion.vel.x,2)+Math.pow(this._meetMotion.vel.y,2));e!==0&&!this._speedWasSpecified&&(this._speed=e),this._current=A(this._tx.pos.x,this._tx.pos.y),this._end=A(this._meetTx.pos.x,this._meetTx.pos.y),this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize();const i=this._dir.scale(this._speed);this._motion.vel=A(i.x,i.y),this.isComplete()&&(this._tx.pos=A(this._end.x,this._end.y),this._motion.vel=A(0,0))}isComplete(){return this._stopped||this._distanceBetween<=1}stop(){this._motion.vel=A(0,0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._distanceBetween=void 0}}class Xs{constructor(t){this._entity=t,this._queue=new kn(t)}getQueue(){return this._queue}update(t){this._queue.update(t)}clearActions(){this._queue.clearActions()}runAction(t){return t.reset(),this._queue.add(t),this}easeTo(...t){var e,i;let s=0,r=0,o=0,a=pe.Linear;return t[0]instanceof h?(s=t[0].x,r=t[0].y,o=t[1],a=(e=t[2])!==null&&e!==void 0?e:a):(s=t[0],r=t[1],o=t[2],a=(i=t[3])!==null&&i!==void 0?i:a),this._queue.add(new Nn(this._entity,s,r,o,a)),this}easeBy(...t){var e,i;let s=0,r=0,o=0,a=pe.Linear;return t[0]instanceof h?(s=t[0].x,r=t[0].y,o=t[1],a=(e=t[2])!==null&&e!==void 0?e:a):(s=t[0],r=t[1],o=t[2],a=(i=t[3])!==null&&i!==void 0?i:a),this._queue.add(new Gn(this._entity,s,r,o,a)),this}moveTo(t,e,i){let s=0,r=0,o=0;return t instanceof h?(s=t.x,r=t.y,o=e):(s=t,r=e,o=i),this._queue.add(new Fn(this._entity,s,r,o)),this}moveBy(t,e,i){let s=0,r=0,o=0;return t instanceof h?(s=t.x,r=t.y,o=e):(s=t,r=e,o=i),this._queue.add(new Pn(this._entity,s,r,o)),this}rotateTo(t,e,i){return this._queue.add(new Mn(this._entity,t,e,i)),this}rotateBy(t,e,i){return this._queue.add(new Ln(this._entity,t,e,i)),this}scaleTo(t,e,i,s){let r=1,o=1,a=0,u=0;return t instanceof h&&e instanceof h&&(r=t.x,o=t.y,a=e.x,u=e.y),typeof t=="number"&&typeof e=="number"&&(r=t,o=e,a=i,u=s),this._queue.add(new Rn(this._entity,r,o,a,u)),this}scaleBy(t,e,i){let s=1,r=1;return t instanceof h&&(s=t.x,r=t.y,i=e),typeof t=="number"&&typeof e=="number"&&(s=t,r=e),this._queue.add(new zn(this._entity,s,r,i)),this}blink(t,e,i=1){return this._queue.add(new Un(this._entity,t,e,i)),this}fade(t,e){return this._queue.add(new jn(this._entity,t,e)),this}delay(t){return this._queue.add(new Hn(t)),this}die(){return this._queue.add(new Wn(this._entity)),this}callMethod(t){return this._queue.add(new On(t)),this}repeat(t,e){return e?(this._queue.add(new Dn(this._entity,t,e)),this):(this.repeatForever(t),this)}repeatForever(t){return this._queue.add(new Qn(this._entity,t)),this}follow(t,e){return e===void 0?this._queue.add(new sn(this._entity,t)):this._queue.add(new sn(this._entity,t,e)),this}meet(t,e){return e===void 0?this._queue.add(new rn(this._entity,t)):this._queue.add(new rn(this._entity,t,e)),this}toPromise(){return new Promise(e=>{this._queue.add(new On(()=>{e()}))})}}class bs extends ci{constructor(){super(...arguments),this.dependencies=[Ot,me],this._ctx=null}onAdd(t){this._ctx=new Xs(t)}onRemove(){this._ctx=null}_getCtx(){if(!this._ctx)throw new Error("Actions component not attached to an entity, no context available");return this._ctx}getQueue(){if(!this._ctx)throw new Error("Actions component not attached to an entity, no queue available");return this._ctx.getQueue()}runAction(t){if(!this._ctx)throw new Error("Actions component not attached to an entity, cannot run action");return this._ctx.runAction(t)}update(t){var e;return(e=this._ctx)===null||e===void 0?void 0:e.update(t)}clearActions(){var t;(t=this._ctx)===null||t===void 0||t.clearActions()}easeTo(...t){return this._getCtx().easeTo.apply(this._ctx,t)}easeBy(...t){return this._getCtx().easeBy.apply(this._ctx,t)}moveTo(t,e,i){return this._getCtx().moveTo.apply(this._ctx,[t,e,i])}moveBy(t,e,i){return this._getCtx().moveBy.apply(this._ctx,[t,e,i])}rotateTo(t,e,i){return this._getCtx().rotateTo(t,e,i)}rotateBy(t,e,i){return this._getCtx().rotateBy(t,e,i)}scaleTo(t,e,i,s){return this._getCtx().scaleTo.apply(this._ctx,[t,e,i,s])}scaleBy(t,e,i){return this._getCtx().scaleBy.apply(this._ctx,[t,e,i])}blink(t,e,i){return this._getCtx().blink(t,e,i)}fade(t,e){return this._getCtx().fade(t,e)}delay(t){return this._getCtx().delay(t)}die(){return this._getCtx().die()}callMethod(t){return this._getCtx().callMethod(t)}repeat(t,e){return this._getCtx().repeat(t,e)}repeatForever(t){return this._getCtx().repeatForever(t)}follow(t,e){return this._getCtx().follow(t,e)}meet(t,e){return this._getCtx().meet(t,e)}toPromise(){return this._getCtx().toPromise()}}var br;(function(n){n.Em="em",n.Rem="rem",n.Px="px",n.Pt="pt",n.Percent="%"})(br||(br={}));var Cr;(function(n){n.Left="left",n.Right="right",n.Center="center",n.Start="start",n.End="end"})(Cr||(Cr={}));var Ir;(function(n){n.Top="top",n.Hanging="hanging",n.Middle="middle",n.Alphabetic="alphabetic",n.Ideographic="ideographic",n.Bottom="bottom"})(Ir||(Ir={}));var Er;(function(n){n.Normal="normal",n.Italic="italic",n.Oblique="oblique"})(Er||(Er={}));var Br;(function(n){n.LeftToRight="ltr",n.RightToLeft="rtl"})(Br||(Br={}));class Cs{constructor(t,e,i,s){this.font=t,this.text=e,this.color=i,this.maxWidth=s,this._textFragments=[],this.disposed=!1,this._dirty=!0,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.dimensions=this.measureText(e),this._setDimension(this.dimensions,this.ctx),this._lastHashCode=this.getHashCode()}measureText(t,e){if(this.disposed)throw Error("Accessing disposed text instance! "+this.text);let i=null;e!=null?i=this._getLinesFromText(t,e):i=t.split(`
`);const s=i.reduce((J,nt)=>J.length>nt.length?J:nt);this._applyFont(this.ctx);const r=this.ctx.measureText(s);let o=Math.abs(r.actualBoundingBoxAscent)+Math.abs(r.actualBoundingBoxDescent);const a=o*i.length;o=a;const u=a-Math.abs(r.actualBoundingBoxAscent),T=0,P=0;return new E({left:T-Math.abs(r.actualBoundingBoxLeft)-this.font.padding,top:P-Math.abs(r.actualBoundingBoxAscent)-this.font.padding,bottom:P+u+this.font.padding,right:T+Math.abs(r.actualBoundingBoxRight)+this.font.padding})}_setDimension(t,e){let i=1;this.font.lineHeight&&(i=this.font.lineHeight/this.font.size),e.canvas.width=(t.width+this.font.padding*2)*2*this.font.quality,e.canvas.height=(t.height+this.font.padding*2)*2*this.font.quality*i}static getHashCode(t,e,i){var s;return e+"__hashcode__"+t.fontString+t.showDebug+t.textAlign+t.baseAlign+t.direction+t.lineHeight+JSON.stringify(t.shadow)+(t.padding.toString()+t.smoothing.toString()+t.lineWidth.toString()+t.lineDash.toString()+((s=t.strokeColor)===null||s===void 0?void 0:s.toString())+(i?i.toString():t.color.toString()))}getHashCode(t=!0){return Cs.getHashCode(this.font,this.text,t?this.color:void 0)}_applyRasterProperties(t){var e,i;t.translate(this.font.padding,this.font.padding),t.imageSmoothingEnabled=this.font.smoothing,t.lineWidth=this.font.lineWidth,t.setLineDash((e=this.font.lineDash)!==null&&e!==void 0?e:t.getLineDash()),t.strokeStyle=(i=this.font.strokeColor)===null||i===void 0?void 0:i.toString(),t.fillStyle=this.color.toString()}_applyFont(t){t.resetTransform(),t.translate(this.font.padding+t.canvas.width/2,this.font.padding+t.canvas.height/2),t.scale(this.font.quality,this.font.quality),t.textAlign=this.font.textAlign,t.textBaseline=this.font.baseAlign,t.font=this.font.fontString,t.direction=this.font.direction,this.font.shadow&&(t.shadowColor=this.font.shadow.color.toString(),t.shadowBlur=this.font.shadow.blur,t.shadowOffsetX=this.font.shadow.offset.x,t.shadowOffsetY=this.font.shadow.offset.y)}_drawText(t,e,i){this._applyRasterProperties(t),this._applyFont(t);for(let s=0;s<e.length;s++){const r=e[s];this.color&&t.fillText(r,0,s*i),this.font.strokeColor&&t.strokeText(r,0,s*i)}this.font.showDebug&&(qr(t,p.Green,-t.canvas.width/2,0,t.canvas.width/2,0,2),qr(t,p.Red,0,-t.canvas.height/2,0,t.canvas.height/2,2))}_splitTextBitmap(t){const e=[];let i=0,s=0;const r=Math.min(4096,t.canvas.width),o=Math.min(4096,t.canvas.height);for(;i<t.canvas.width;){for(;s<t.canvas.height;){const a=document.createElement("canvas");a.width=r,a.height=o,a.getContext("2d").drawImage(t.canvas,i,s,r,o,0,0,r,o),e.push({x:i,y:s,canvas:a}),s+=o}i+=r,s=0}return e}flagDirty(){this._dirty=!0}render(t,e,i,s){var r;if(this.disposed)throw Error("Accessing disposed text instance! "+this.text);this._ex=t;const o=this.getHashCode();if(this._lastHashCode!==o&&(this._dirty=!0),this._dirty){this.dimensions=this.measureText(this.text,s),this._setDimension(this.dimensions,this.ctx);const a=this._getLinesFromText(this.text,s),u=(r=this.font.lineHeight)!==null&&r!==void 0?r:this.dimensions.height/a.length;if(this._drawText(this.ctx,a,u),t instanceof ni)for(const T of this._textFragments)t.textureLoader.delete(T.canvas);if(this._textFragments=this._splitTextBitmap(this.ctx),t instanceof ni)for(const T of this._textFragments)t.textureLoader.load(T.canvas,{filtering:this.font.filtering},!0);this._lastHashCode=o,this._dirty=!1}for(const a of this._textFragments)t.drawImage(a.canvas,0,0,a.canvas.width,a.canvas.height,a.x/this.font.quality+e-this.ctx.canvas.width/this.font.quality/2,a.y/this.font.quality+i-this.ctx.canvas.height/this.font.quality/2,a.canvas.width/this.font.quality,a.canvas.height/this.font.quality)}dispose(){if(this.disposed=!0,this.dimensions=void 0,this.canvas=void 0,this.ctx=void 0,this._ex instanceof ni)for(const t of this._textFragments)this._ex.textureLoader.delete(t.canvas);this._textFragments.length=0}_getLinesFromText(t,e){if(this._cachedText===t&&this._cachedRenderWidth===e)return this._cachedLines;const i=t.split(`
`);if(e==null)return i;for(let s=0;s<i.length;s++){let r=i[s],o="";if(this.measureText(r).width>e){for(;this.measureText(r).width>e;)o=r[r.length-1]+o,r=r.slice(0,-1);i[s]=r,i[s+1]=o}}return this._cachedText=t,this._cachedLines=i,this._cachedRenderWidth=e,i}}class ce{static measureText(t,e,i){const s=Cs.getHashCode(e,t);if(ce._MEASURE_CACHE.has(s))return ce._MEASURE_CACHE.get(s);ce._LOGGER.debug("Font text measurement cache miss");const r=e.measureTextWithoutCache(t,i);return ce._MEASURE_CACHE.set(s,r),r}static getTextInstance(t,e,i){const s=Cs.getHashCode(e,t,i);let r=ce._TEXT_CACHE.get(s);return r||(r=new Cs(e,t,i),ce._TEXT_CACHE.set(s,r),ce._LOGGER.debug("Font text instance cache miss")),ce._TEXT_USAGE.set(r,performance.now()),r}static checkAndClearCache(){const t=[],e=new Set;for(const[s,r]of ce._TEXT_USAGE.entries())if(r+ce.FONT_TIMEOUT<performance.now())ce._LOGGER.debug(`Text cache entry timed out ${s.text}`),t.push(s),s.dispose();else{const o=s.getHashCode(!1);e.add(o)}t.forEach(s=>{ce._TEXT_USAGE.delete(s)}),this._TEXT_CACHE.clear();for(const[s]of this._TEXT_USAGE.entries())this._TEXT_CACHE.set(s.getHashCode(),s);const i=new Map;for(const s of e)ce._MEASURE_CACHE.has(s)&&i.set(s,ce._MEASURE_CACHE.get(s));this._MEASURE_CACHE.clear(),this._MEASURE_CACHE=i}static get cacheSize(){return ce._TEXT_USAGE.size}static clearCache(){for(const[t]of ce._TEXT_USAGE.entries())t.dispose();ce._TEXT_USAGE.clear(),ce._TEXT_CACHE.clear(),ce._MEASURE_CACHE.clear()}}ce.FONT_TIMEOUT=500,ce._LOGGER=I.getInstance(),ce._TEXT_USAGE=new Map,ce._TEXT_CACHE=new Map,ce._MEASURE_CACHE=new Map;class is extends it{constructor(t={}){var e,i,s,r,o,a,u,T,P,N,J,nt,at,xt,Bt,ft,_t,Tt,Ct,Rt;super(t),this.filtering=F.Blended,this.quality=2,this.padding=2,this.smoothing=!1,this.lineWidth=1,this.lineDash=[],this.color=p.Black,this.family="sans-serif",this.style=Er.Normal,this.bold=!1,this.unit=br.Px,this.textAlign=Cr.Left,this.baseAlign=Ir.Top,this.direction=Br.LeftToRight,this.lineHeight=void 0,this.size=10,this.shadow=null,this._textBounds=new E,this._textMeasurement=new Cs(this,"",p.Black),this.smoothing=(e=t==null?void 0:t.smoothing)!==null&&e!==void 0?e:this.smoothing,this.padding=(i=t==null?void 0:t.padding)!==null&&i!==void 0?i:this.padding,this.color=(s=t==null?void 0:t.color)!==null&&s!==void 0?s:this.color,this.strokeColor=(r=t==null?void 0:t.strokeColor)!==null&&r!==void 0?r:this.strokeColor,this.lineDash=(o=t==null?void 0:t.lineDash)!==null&&o!==void 0?o:this.lineDash,this.lineWidth=(a=t==null?void 0:t.lineWidth)!==null&&a!==void 0?a:this.lineWidth,this.filtering=(u=t==null?void 0:t.filtering)!==null&&u!==void 0?u:this.filtering,this.family=(T=t==null?void 0:t.family)!==null&&T!==void 0?T:this.family,this.style=(P=t==null?void 0:t.style)!==null&&P!==void 0?P:this.style,this.bold=(N=t==null?void 0:t.bold)!==null&&N!==void 0?N:this.bold,this.size=(J=t==null?void 0:t.size)!==null&&J!==void 0?J:this.size,this.unit=(nt=t==null?void 0:t.unit)!==null&&nt!==void 0?nt:this.unit,this.textAlign=(at=t==null?void 0:t.textAlign)!==null&&at!==void 0?at:this.textAlign,this.baseAlign=(xt=t==null?void 0:t.baseAlign)!==null&&xt!==void 0?xt:this.baseAlign,this.direction=(Bt=t==null?void 0:t.direction)!==null&&Bt!==void 0?Bt:this.direction,this.lineHeight=(ft=t==null?void 0:t.lineHeight)!==null&&ft!==void 0?ft:this.lineHeight,this.quality=(_t=t==null?void 0:t.quality)!==null&&_t!==void 0?_t:this.quality,t!=null&&t.shadow&&(this.shadow={},this.shadow.blur=(Tt=t.shadow.blur)!==null&&Tt!==void 0?Tt:this.shadow.blur,this.shadow.offset=(Ct=t.shadow.offset)!==null&&Ct!==void 0?Ct:this.shadow.offset,this.shadow.color=(Rt=t.shadow.color)!==null&&Rt!==void 0?Rt:this.shadow.color)}clone(){return new is({...this.cloneGraphicOptions(),size:this.size,unit:this.unit,family:this.family,style:this.style,bold:this.bold,textAlign:this.textAlign,baseAlign:this.baseAlign,direction:this.direction,shadow:this.shadow?{blur:this.shadow.blur,offset:this.shadow.offset,color:this.shadow.color}:null})}get fontString(){return`${this.style} ${this.bold?"bold":""} ${this.size}${this.unit} ${this.family}`}get localBounds(){return this._textBounds}_drawImage(t,e,i){}_rotate(t){var e;const i=(e=this.origin)!==null&&e!==void 0?e:this._textBounds.center;t.translate(i.x,i.y),t.rotate(this.rotation),t.translate(-i.x,-i.y)}_flip(t){this.flipHorizontal&&(t.translate(this._textBounds.width/this.scale.x,0),t.scale(-1,1)),this.flipVertical&&(t.translate(0,-this._textBounds.height/2/this.scale.y),t.scale(1,-1))}measureTextWithoutCache(t,e){return this._textMeasurement.measureText(t,e)}measureText(t,e){return ce.measureText(t,this,e)}_postDraw(t){t.restore()}render(t,e,i,s,r,o){const a=ce.getTextInstance(e,this,i);this._textBounds=a.dimensions,this._preDraw(t,s,r),a.render(t,s,r,o),this._postDraw(t)}}class Js extends it{constructor(t){var e,i;super(t),this._text="",this._textWidth=0,this._textHeight=0,this.font=(e=t.font)!==null&&e!==void 0?e:new is,this.color=(i=t.color)!==null&&i!==void 0?i:this.color,this.text=t.text,this.maxWidth=t.maxWidth}clone(){var t,e;return new Js({text:this.text.slice(),color:(e=(t=this.color)===null||t===void 0?void 0:t.clone())!==null&&e!==void 0?e:p.Black,font:this.font.clone(),maxWidth:this.maxWidth})}get text(){return this._text}set text(t){this._text=t,this._calculateDimension()}get font(){return this._font}set font(t){this._font=t}get width(){return this._textWidth===0&&this._calculateDimension(),this._textWidth*this.scale.x}get height(){return this._textHeight===0&&this._calculateDimension(),this._textHeight*this.scale.y}_calculateDimension(){const{width:t,height:e}=this.font.measureText(this._text,this.maxWidth);this._textWidth=t,this._textHeight=e}get localBounds(){return this.font.measureText(this._text,this.maxWidth).scale(this.scale)}_rotate(t){}_flip(t){}_preDraw(t,e,i){(this.isStale()||this.font.isStale())&&(this.font.flipHorizontal=this.flipHorizontal,this.font.flipVertical=this.flipVertical,this.font.rotation=this.rotation,this.font.origin=this.origin,this.font.opacity=this.opacity),this.font.tint=this.tint,super._preDraw(t,e,i)}_drawImage(t,e,i){var s;let r=p.Black;this.font instanceof is&&(r=(s=this.color)!==null&&s!==void 0?s:this.font.color);const{width:o,height:a}=this.font.measureText(this._text,this.maxWidth);this._textWidth=o,this._textHeight=a,this.font.render(t,this._text,r,e,i,this.maxWidth),this.font.showDebug&&(t.debug.drawRect(e-o,i-a,o*2,a*2),this.maxWidth!=null&&t.debug.drawRect(e,i,this.maxWidth,this.height,{color:p.Yellow}))}}class Ye extends Fe{get pos(){return this.transform.pos}set pos(t){this.transform.pos=t.clone()}get oldPos(){return this.body.oldPos}set oldPos(t){this.body.oldPos.setTo(t.x,t.y)}get vel(){return this.motion.vel}set vel(t){this.motion.vel=t.clone()}get oldVel(){return this.body.oldVel}set oldVel(t){this.body.oldVel.setTo(t.x,t.y)}get acc(){return this.motion.acc}set acc(t){this.motion.acc=t.clone()}set oldAcc(t){this.body.oldAcc.setTo(t.x,t.y)}get oldAcc(){return this.body.oldAcc}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angularVelocity(){return this.motion.angularVelocity}set angularVelocity(t){this.motion.angularVelocity=t}get scale(){return this.get(Ot).scale}set scale(t){this.get(Ot).scale=t}get anchor(){return this._anchor}set anchor(t){this._anchor=Mt(t,e=>this._handleAnchorChange(e)),this._handleAnchorChange(t)}_handleAnchorChange(t){this.graphics&&(this.graphics.anchor=t)}get offset(){return this._offset}set offset(t){this._offset=Mt(t,e=>this._handleOffsetChange(e)),this._handleOffsetChange(t)}_handleOffsetChange(t){this.graphics&&(this.graphics.offset=t)}get isOffScreen(){return this.hasTag("ex.offscreen")}get draggable(){return this._draggable}set draggable(t){t&&(t&&!this._draggable?(this.events.on("pointerdragstart",this._pointerDragStartHandler),this.events.on("pointerdragend",this._pointerDragEndHandler),this.events.on("pointerdragmove",this._pointerDragMoveHandler),this.events.on("pointerdragleave",this._pointerDragLeaveHandler)):!t&&this._draggable&&(this.events.off("pointerdragstart",this._pointerDragStartHandler),this.events.off("pointerdragend",this._pointerDragEndHandler),this.events.off("pointerdragmove",this._pointerDragMoveHandler),this.events.off("pointerdragleave",this._pointerDragLeaveHandler)),this._draggable=t)}get color(){return this._color}set color(t){this._color=t.clone();const e=this.graphics.current;(e instanceof Bi||e instanceof Js)&&(e.color=this._color)}constructor(t){super(),this.events=new k,this._anchor=Mt(h.Half,re=>this._handleAnchorChange(re)),this._offset=Mt(h.Zero,re=>this._handleOffsetChange(re)),this.logger=I.getInstance(),this._draggable=!1,this._dragging=!1,this._pointerDragStartHandler=()=>{this._dragging=!0},this._pointerDragEndHandler=()=>{this._dragging=!1},this._pointerDragMoveHandler=re=>{this._dragging&&(this.pos=re.worldPos)},this._pointerDragLeaveHandler=re=>{this._dragging&&(this.pos=re.worldPos)};const{name:e,x:i,y:s,pos:r,coordPlane:o,scale:a,width:u,height:T,radius:P,collider:N,vel:J,acc:nt,rotation:at,angularVelocity:xt,z:Bt,color:ft,visible:_t,opacity:Tt,anchor:Ct,offset:Rt,collisionType:se,collisionGroup:Dt}={...t};this.name=e??this.name,this.anchor=Ct??Ye.defaults.anchor.clone(),this.offset=Rt??h.Zero,this.transform=new Ot,this.addComponent(this.transform),this.pos=r??A(i??0,s??0),this.rotation=at??0,this.scale=a??A(1,1),this.z=Bt??0,this.transform.coordPlane=o??be.World,this.pointer=new wi,this.addComponent(this.pointer),this.graphics=new Ie({anchor:this.anchor,offset:this.offset,opacity:Tt}),this.addComponent(this.graphics),this.motion=new me,this.addComponent(this.motion),this.vel=J??h.Zero,this.acc=nt??h.Zero,this.angularVelocity=xt??0,this.actions=new bs,this.addComponent(this.actions),this.body=new Vt,this.addComponent(this.body),this.body.collisionType=se??$t.Passive,Dt&&(this.body.group=Dt),N?(this.collider=new ye(N),this.addComponent(this.collider)):P?(this.collider=new ye(Pe.Circle(P)),this.addComponent(this.collider)):u>0&&T>0?(this.collider=new ye(Pe.Box(u,T,this.anchor)),this.addComponent(this.collider)):(this.collider=new ye,this.addComponent(this.collider)),this.graphics.visible=_t??!0,ft&&(this.color=ft,u&&T?this.graphics.add(new Vs({color:ft,width:u,height:T})):P&&this.graphics.add(new xr({color:ft,radius:P})))}clone(){const t=new Ye({color:this.color.clone(),anchor:this.anchor.clone(),offset:this.offset.clone()});t.clearComponents(),t.processComponentRemoval(),t.addComponent(t.transform=this.transform.clone(),!0),t.addComponent(t.pointer=this.pointer.clone(),!0),t.addComponent(t.graphics=this.graphics.clone(),!0),t.addComponent(t.motion=this.motion.clone(),!0),t.addComponent(t.actions=this.actions.clone(),!0),t.addComponent(t.body=this.body.clone(),!0),t.addComponent(t.collider=this.collider.clone(),!0);const e=[this.transform,this.pointer,this.graphics,this.motion,this.actions,this.body,this.collider],i=this.getComponents();for(const s of i)e.includes(s)||t.addComponent(s.clone(),!0);return t}onInitialize(t){}_initialize(t){super._initialize(t);for(const e of this.children)e._initialize(t)}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}_prekill(t){this.events.emit("prekill",new gs(this)),this.onPreKill(t)}onPreKill(t){}_postkill(t){this.events.emit("postkill",new Li(this)),this.onPostKill(t)}onPostKill(t){}kill(){this.scene?(this._prekill(this.scene),this.events.emit("kill",new Vi(this)),super.kill(),this._postkill(this.scene)):this.logger.warn(`Cannot kill actor named "${this.name}", it was never added to the Scene`)}unkill(){this.active=!0}isKilled(){return!this.active}get z(){return this.get(Ot).z}set z(t){this.get(Ot).z=t}get center(){const t=this.getGlobalPos();return new h(t.x+this.width/2-this.anchor.x*this.width,t.y+this.height/2-this.anchor.y*this.height)}get localCenter(){return new h(this.pos.x+this.width/2-this.anchor.x*this.width,this.pos.y+this.height/2-this.anchor.y*this.height)}get width(){return this.collider.localBounds.width*this.getGlobalScale().x}get height(){return this.collider.localBounds.height*this.getGlobalScale().y}getGlobalRotation(){return this.get(Ot).globalRotation}getGlobalPos(){return this.get(Ot).globalPos}getGlobalScale(){return this.get(Ot).globalScale}contains(t,e,i=!1){const s=A(t,e),r=this.get(ye);r.update();const o=r.get();if(!o)return!1;const a=o.contains(s);return i?a||this.children.some(u=>u.contains(t,e,!0)):a}within(t,e){const i=this.get(ye),s=t.get(ye),r=i.get(),o=s.get();return r&&o?r.getClosestLineBetween(o).getLength()<=e:!1}update(t,e){this._initialize(t),this._preupdate(t,e),this._postupdate(t,e)}onPreUpdate(t,e){}onPostUpdate(t,e){}onPreCollisionResolve(t,e,i,s){}onPostCollisionResolve(t,e,i,s){}onCollisionStart(t,e,i,s){}onCollisionEnd(t,e,i,s){}_preupdate(t,e){this.events.emit("preupdate",new ai(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.events.emit("postupdate",new li(t,e,this)),this.onPostUpdate(t,e)}}Ye.defaults={anchor:h.Half};function Zn(n){return n instanceof nn}class nn extends Ye{constructor(t){var e,i;super({...t}),this.get(Ot).coordPlane=be.Screen,this.anchor=(e=t==null?void 0:t.anchor)!==null&&e!==void 0?e:A(0,0),this.body.collisionType=(i=t==null?void 0:t.collisionType)!==null&&i!==void 0?i:$t.PreventCollision,this.pointer.useGraphicsBounds=!0,this.pointer.useColliderShape=!1,!(t!=null&&t.collider)&&(t==null?void 0:t.width)>0&&(t==null?void 0:t.height)>0&&this.collider.useBoxCollider(this.width,this.height,this.anchor)}_initialize(t){this._engine=t,super._initialize(t)}contains(t,e,i=!0){if(i)return super.contains(t,e);const s=this._engine.worldToScreenCoordinates(new h(t,e));return super.contains(s.x,s.y)}}class ss{get complete(){return this._complete}constructor(t,e,i,s,r,o){if(this._logger=I.getInstance(),this.id=0,this._elapsedTime=0,this._totalTimeAlive=0,this._running=!1,this._numberOfTicks=0,this.interval=10,this.repeats=!1,this.maxNumberOfRepeats=-1,this.randomRange=[0,0],this._baseInterval=10,this._generateRandomInterval=()=>this._baseInterval+this.random.integer(this.randomRange[0],this.randomRange[1]),this._complete=!1,this.scene=null,typeof t!="function"){const a=t;t=a.fcn,e=a.interval,i=a.repeats,s=a.numberOfRepeats,r=a.randomRange,o=a.random}if(s&&s>=0&&(this.maxNumberOfRepeats=s,!i))throw new Error("repeats must be set to true if numberOfRepeats is set");if(this.id=ss._MAX_ID++,this._callbacks=[],this._baseInterval=this.interval=e,r){if(r[0]>r[1])throw new Error("min value must be lower than max value for range");this.random=o??new S,this.randomRange=r,this.interval=this._generateRandomInterval(),this.on(()=>{this.interval=this._generateRandomInterval()})}this.repeats=i||this.repeats,t&&this.on(t)}on(t){this._callbacks.push(t)}off(t){const e=this._callbacks.indexOf(t);this._callbacks.splice(e,1)}update(t){this._running&&(this._totalTimeAlive+=t,this._elapsedTime+=t,this.maxNumberOfRepeats>-1&&this._numberOfTicks>=this.maxNumberOfRepeats&&(this._complete=!0,this._running=!1,this._elapsedTime=0),!this.complete&&this._elapsedTime>=this.interval&&(this._callbacks.forEach(e=>{e.call(this)}),this._numberOfTicks++,this.repeats?this._elapsedTime=0:(this._complete=!0,this._running=!1,this._elapsedTime=0)))}reset(t,e){if(t&&t>=0&&(this._baseInterval=this.interval=t),this.maxNumberOfRepeats&&this.maxNumberOfRepeats>=0&&(this.maxNumberOfRepeats=e,!this.repeats))throw new Error("repeats must be set to true if numberOfRepeats is set");this._complete=!1,this._elapsedTime=0,this._numberOfTicks=0}get timesRepeated(){return this._numberOfTicks}getTimeRunning(){return this._totalTimeAlive}get timeToNextAction(){return this.complete?0:this.interval-this._elapsedTime}get timeElapsedTowardNextAction(){return this._elapsedTime}get isRunning(){return this._running}pause(){return this._running=!1,this}resume(){return this._running=!0,this}start(){return this.scene||this._logger.warn("Cannot start a timer not part of a scene, timer wont start until added"),this._running=!0,this.complete&&(this._complete=!1,this._elapsedTime=0,this._numberOfTicks=0),this}stop(){return this._running=!1,this._elapsedTime=0,this._numberOfTicks=0,this}cancel(){this.pause(),this.scene&&this.scene.cancelTimer(this)}}ss._MAX_ID=0;class Tr extends ci{constructor(t){super(),this.parallaxFactor=A(1,1),this.parallaxFactor=t??this.parallaxFactor}}class Sr extends ci{constructor(t,e=!0){super(),this.draw=t,this.useTransform=e}}const ma={PreUpdate:"preupdate",PostUpdate:"postupdate",PreDraw:"predraw",PostDraw:"postdraw",PointerUp:"pointerup",PointerDown:"pointerdown",PointerMove:"pointermove",PointerCancel:"pointercancel"};class Yn extends Fe{flagCollidersDirty(){this._collidersDirty=!0}flagTilesDirty(){for(let t=0;t<this.tiles.length;t++)this.tiles[t]&&this.tiles[t].flagDirty()}get x(){var t;return(t=this.transform.pos.x)!==null&&t!==void 0?t:0}set x(t){var e;!((e=this.transform)===null||e===void 0)&&e.pos&&(this.get(Ot).pos=A(t,this.y))}get y(){var t,e;return(e=(t=this.transform)===null||t===void 0?void 0:t.pos.y)!==null&&e!==void 0?e:0}set y(t){var e;!((e=this.transform)===null||e===void 0)&&e.pos&&(this.transform.pos=A(this.x,t))}get z(){var t;return(t=this.transform.z)!==null&&t!==void 0?t:0}set z(t){this.transform&&(this.transform.z=t)}get rotation(){var t,e;return(e=(t=this.transform)===null||t===void 0?void 0:t.rotation)!==null&&e!==void 0?e:0}set rotation(t){this.transform&&(this.transform.rotation=t)}get scale(){var t,e;return(e=(t=this.transform)===null||t===void 0?void 0:t.scale)!==null&&e!==void 0?e:h.One}set scale(t){var e;!((e=this.transform)===null||e===void 0)&&e.scale&&(this.transform.scale=t)}get pos(){return this.transform.pos}set pos(t){this.transform.pos=t}get vel(){return this._motion.vel}set vel(t){this._motion.vel=t}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}constructor(t){var e,i,s;super([],t.name),this.events=new k,this._token=0,this.logger=I.getInstance(),this.tiles=[],this._rows=[],this._cols=[],this.renderFromTopOfGraphic=!1,this.meshingLookBehind=10,this._collidersDirty=!0,this._forwardPointerEventToTile=o=>a=>{const u=this.getTileByPoint(a.worldPos);u&&u.events.emit(o,a)},this._originalOffsets=new WeakMap,this.meshingLookBehind=(e=t.meshingLookBehind)!==null&&e!==void 0?e:this.meshingLookBehind,this.addComponent(new Ot),this.addComponent(new me),this.addComponent(new Vt({type:$t.Fixed})),this.addComponent(new Ie({onPostDraw:(o,a)=>this.draw(o,a)})),this.addComponent(new Sr((o,a)=>this.debug(o,a),!1)),this.addComponent(new ye),this.addComponent(new wi),this.pointer=this.get(wi),this._graphics=this.get(Ie),this.transform=this.get(Ot),this._motion=this.get(me),this.collider=this.get(ye),this._composite=this.collider.useCompositeCollider([]),this.transform.pos=(i=t.pos)!==null&&i!==void 0?i:h.Zero,this._oldPos=this.transform.pos.clone(),this._oldScale=this.transform.scale.clone(),this.renderFromTopOfGraphic=(s=t.renderFromTopOfGraphic)!==null&&s!==void 0?s:this.renderFromTopOfGraphic,this.tileWidth=t.tileWidth,this.tileHeight=t.tileHeight,this.rows=t.rows,this.columns=t.columns,this.tiles=new Array(this.rows*this.columns),this._rows=new Array(this.rows),this._cols=new Array(this.columns);let r=[];for(let o=0;o<this.columns;o++){for(let a=0;a<this.rows;a++){const u=new qn({x:o,y:a,map:this});u.map=this,this.tiles[o+a*this.columns]=u,r.push(u),this._rows[a]||(this._rows[a]=[]),this._rows[a].push(u)}this._cols[o]=r,r=[]}this._setupPointerToTile(),this._graphics.localBounds=new E({left:0,top:0,right:this.columns*this.tileWidth*this.scale.x,bottom:this.rows*this.tileHeight*this.scale.y})}_initialize(t){super._initialize(t),this._engine=t}_setupPointerToTile(){this.events.on("pointerup",this._forwardPointerEventToTile("pointerup")),this.events.on("pointerdown",this._forwardPointerEventToTile("pointerdown")),this.events.on("pointermove",this._forwardPointerEventToTile("pointermove")),this.events.on("pointercancel",this._forwardPointerEventToTile("pointercancel"))}_getOrSetColliderOriginalOffset(t){if(this._originalOffsets.has(t))return this._originalOffsets.get(t);{const e=t.offset;return this._originalOffsets.set(t,e),e}}_updateColliders(){this.collider.$colliderRemoved.notifyAll(this._composite),this._composite.clearColliders();const t=[];this._composite=this.collider.useCompositeCollider([]);let e;const i=(r,o)=>r&&o?r.top===o.top&&r.bottom===o.bottom&&r.right===o.left:!1,s=(r,o,a=this.meshingLookBehind)=>{if(!r)return!1;for(let u=o.length-1;u>=0;u--){if(a--<0)return!1;const T=o[u];if(i(T,r))return o[u]=T.combine(r),!0}return!1};for(let r=0;r<this.columns;r++){for(let o=0;o<this.rows;o++){const a=this.tiles[r+o*this.columns];if(a.solid)if(a.getColliders().length>0){for(const u of a.getColliders()){const T=this._getOrSetColliderOriginalOffset(u);u.offset=A(a.x*this.tileWidth*this.scale.x,a.y*this.tileHeight*this.scale.y).add(T),u.owner=this,this._composite.addCollider(u)}e&&!s(e,t)&&t.push(e),e=null}else e?e=e.combine(a.defaultGeometry):e=a.defaultGeometry;else e&&!s(e,t)&&t.push(e),e=null}e&&!s(e,t)&&t.push(e),e=null}for(const r of t){const o=Pe.Box(r.width,r.height,h.Zero,A(r.left-this.pos.x,r.top-this.pos.y));o.owner=this,this._composite.addCollider(o)}this.collider.update(),this.collider.$colliderAdded.notifyAll(this._composite)}getTileByIndex(t){return this.tiles[t]}getTile(t,e){return t<0||e<0||t>=this.columns||e>=this.rows?null:this.tiles[t+e*this.columns]}getTileByPoint(t){const{x:e,y:i}=this._getTileCoordinates(t),s=this.getTile(e,i);return e>=0&&i>=0&&e<this.columns&&i<this.rows&&s?s:null}_getTileCoordinates(t){t=this.transform.applyInverse(t);const e=Math.floor(t.x/this.tileWidth),i=Math.floor(t.y/this.tileHeight);return{x:e,y:i}}getRows(){return this._rows}getColumns(){return this._cols}getOnScreenTiles(){let t=this._engine.screen.getWorldBounds();const e=this.get(Tr);if(e&&this.isInitialized){let nt=this.pos;const at=h.One.sub(e.parallaxFactor),xt=this._engine.currentScene.camera.pos.scale(at);nt=nt.sub(xt),t=t.translate(nt)}const i=this.transform.coordPlane===be.Screen?this._engine.screen.getScreenBounds():t,s=this._getTileCoordinates(i.topLeft),r=this._getTileCoordinates(i.topRight),o=this._getTileCoordinates(i.bottomRight),a=this._getTileCoordinates(i.bottomLeft),u=Math.min(D(s.x,0,this.columns-1),D(r.x,0,this.columns-1)),T=Math.min(D(s.y,0,this.rows-1),D(r.y,0,this.rows-1)),P=Math.max(D(o.x,0,this.columns-1),D(a.x,0,this.columns-1)),N=Math.max(D(o.y,0,this.rows-1),D(a.y,0,this.rows-1)),J=[];for(let nt=u;nt<=P;nt++)for(let at=T;at<=N;at++)J.push(this.getTile(nt,at));return J}update(t,e){this._initialize(t),this.onPreUpdate(t,e),this.emit("preupdate",new ai(t,e,this)),(!this._oldPos.equals(this.pos)||this._oldRotation!==this.rotation||!this._oldScale.equals(this.scale))&&(this.flagCollidersDirty(),this.flagTilesDirty()),this._collidersDirty&&(this._collidersDirty=!1,this._updateColliders()),this._token++,this.pos.clone(this._oldPos),this._oldRotation=this.rotation,this.scale.clone(this._oldScale),this.transform.pos=this.pos,this.onPostUpdate(t,e),this.emit("postupdate",new li(t,e,this))}draw(t,e){if(!this.isInitialized)return;this.emit("predraw",new Ti(t,e,this));let i,s,r;const o=this.getOnScreenTiles();for(let a=0;a<o.length;a++){const u=o[a],T=u.getGraphicsOffsets();for(i=u.getGraphics(),s=0,r=i.length;s<r;s++){const P=i[s],N=T[s];if(P){en(P)&&(P==null||P.tick(e,this._token));const J=this.renderFromTopOfGraphic?0:P.height-this.tileHeight;P.draw(t,u.x*this.tileWidth+N.x,u.y*this.tileHeight-J+N.y)}}}this.emit("postdraw",new Si(t,e,this))}debug(t,e){const{showAll:i,showGrid:s,gridColor:r,gridWidth:o,showSolidBounds:a,solidBoundsColor:u,showColliderGeometry:T}=e.tilemap,{geometryColor:P,geometryLineWidth:N,geometryPointSize:J}=e.collider,nt=this.tileWidth*this.columns*this.scale.x,at=this.tileHeight*this.rows*this.scale.y,xt=this.pos;if(s||i){for(let Bt=0;Bt<this.rows+1;Bt++){const ft=A(0,Bt*this.tileHeight*this.scale.y);t.drawLine(xt.add(ft),xt.add(A(nt,ft.y)),r,o)}for(let Bt=0;Bt<this.columns+1;Bt++){const ft=A(Bt*this.tileWidth*this.scale.x,0);t.drawLine(xt.add(ft),xt.add(A(ft.x,at)),r,o)}}if(i||a||T){const Bt=this._composite.getColliders();t.save(),t.translate(this.pos.x,this.pos.y),t.scale(this.scale.x,this.scale.y);for(const ft of Bt){const _t=ft.localBounds,Tt=ft.worldPos.sub(this.pos);a&&t.drawRectangle(Tt,_t.width,_t.height,u)}if(t.restore(),T)for(const ft of Bt)ft.debug(t,P,{lineWidth:N,pointSize:J})}if(i||a){if(t.save(),t.z=999,a)for(let Bt=0;Bt<this.tiles.length;Bt++)this.tiles[Bt].bounds.draw(t);t.restore()}}}class qn{get pos(){return this._posDirty&&(this._recalculate(),this._posDirty=!1),this._pos}get width(){return this._width}get height(){return this._height}get solid(){return this._solid}set solid(t){var e;(e=this.map)===null||e===void 0||e.flagCollidersDirty(),this._solid=t}getGraphics(){return this._graphics}getGraphicsOffsets(){return this._offsets}addGraphic(t,e){this._graphics.push(t),e!=null&&e.offset?this._offsets.push(e.offset):this._offsets.push(h.Zero)}removeGraphic(t){const e=this._graphics.indexOf(t);e>-1&&(this._graphics.splice(e,1),this._offsets.splice(e,1))}clearGraphics(){this._graphics.length=0,this._offsets.length=0}getColliders(){return this._colliders}addCollider(t){this._colliders.push(t),this.map.flagCollidersDirty()}removeCollider(t){const e=this._colliders.indexOf(t);e>-1&&this._colliders.splice(e,1),this.map.flagCollidersDirty()}clearColliders(){this._colliders.length=0,this.map.flagCollidersDirty()}constructor(t){var e,i;this._posDirty=!1,this.events=new k,this._solid=!1,this._graphics=[],this._offsets=[],this._colliders=[],this.data=new Map,this.x=t.x,this.y=t.y,this.map=t.map,this._width=t.map.tileWidth*this.map.scale.x,this._height=t.map.tileHeight*this.map.scale.y,this.solid=(e=t.solid)!==null&&e!==void 0?e:this.solid,this._graphics=(i=t.graphics)!==null&&i!==void 0?i:[],this._recalculate()}flagDirty(){return this._posDirty=!0}_recalculate(){const t=this.map.pos.add(A(this.x*this.map.tileWidth,this.y*this.map.tileHeight));this._geometry=new E(t.x,t.y,t.x+this.map.tileWidth,t.y+this.map.tileHeight),this._width=this.map.tileWidth*this.map.scale.x,this._height=this.map.tileHeight*this.map.scale.y,this._pos=this.map.pos.add(A(this.x*this._width,this.y*this._height)),this._bounds=new E(this._pos.x,this._pos.y,this._pos.x+this._width,this._pos.y+this._height),this.map.rotation&&(this._bounds=this._bounds.rotate(this.map.rotation,this.map.pos)),this._posDirty=!1}get bounds(){return this._posDirty&&this._recalculate(),this._bounds}get defaultGeometry(){return this._geometry}get center(){return this._posDirty&&this._recalculate(),new h(this._pos.x+this._width/2,this._pos.y+this._height/2)}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){e?this.events.off(t,e):this.events.off(t)}}class Vn{constructor(t){this.camera=t}lockToActor(t){this.camera.addStrategy(new Xn(t))}lockToActorAxis(t,e){this.camera.addStrategy(new Jn(t,e))}elasticToActor(t,e,i){this.camera.addStrategy(new Kn(t,e,i))}radiusAroundActor(t,e){this.camera.addStrategy(new $n(t,e))}limitCameraBounds(t){this.camera.addStrategy(new to(t))}}var kr;(function(n){n[n.X=0]="X",n[n.Y=1]="Y"})(kr||(kr={}));class Xn{constructor(t){this.target=t,this.action=(e,i,s,r)=>e.center}}class Jn{constructor(t,e){this.target=t,this.axis=e,this.action=(i,s,r,o)=>{const a=i.center,u=s.getFocus();return this.axis===kr.X?new h(a.x,u.y):new h(u.x,a.y)}}}class Kn{constructor(t,e,i){this.target=t,this.cameraElasticity=e,this.cameraFriction=i,this.action=(s,r,o,a)=>{const u=s.center;let T=r.getFocus(),P=r.vel.clone();const N=u.sub(T).scale(this.cameraElasticity);P=P.add(N);const J=P.scale(-1).scale(this.cameraFriction);return P=P.add(J),T=T.add(P),T}}}class $n{constructor(t,e){this.target=t,this.radius=e,this.action=(i,s,r,o)=>{const a=i.center,u=s.getFocus(),T=a.sub(u),P=T.size;if(P>=this.radius){const N=P-this.radius;return u.add(T.normalize().scale(N))}return u}}}class to{constructor(t){this.target=t,this.boundSizeChecked=!1,this.action=(e,i,s,r)=>{const o=i.getFocus();this.boundSizeChecked||((e.bottom-e.top<s.drawHeight||e.right-e.left<s.drawWidth)&&I.getInstance().warn("Camera bounds should not be smaller than the engine viewport"),this.boundSizeChecked=!0);let a=o.x,u=o.y;return o.x<e.left+s.halfDrawWidth?a=e.left+s.halfDrawWidth:o.x>e.right-s.halfDrawWidth&&(a=e.right-s.halfDrawWidth),o.y<e.top+s.halfDrawHeight?u=e.top+s.halfDrawHeight:o.y>e.bottom-s.halfDrawHeight&&(u=e.bottom-s.halfDrawHeight),A(a,u)}}}const va={Initialize:"initialize",PreUpdate:"preupdate",PostUpdate:"postupdate"};class eo{constructor(){this.events=new k,this.transform=It.identity(),this.inverse=It.identity(),this._cameraStrategies=[],this.strategy=new Vn(this),this._z=1,this.dz=0,this.az=0,this.rotation=0,this._angularVelocity=0,this._posChanged=!1,this._pos=g(h.Zero,()=>this._posChanged=!0),this.drawPos=this.pos.clone(),this._oldPos=this.pos.clone(),this.vel=h.Zero,this.acc=h.Zero,this._cameraMoving=!1,this._currentLerpTime=0,this._lerpDuration=1e3,this._lerpStart=null,this._lerpEnd=null,this._isShaking=!1,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._elapsedShakeTime=0,this._xShake=0,this._yShake=0,this._isZooming=!1,this._zoomStart=1,this._zoomEnd=1,this._currentZoomTime=0,this._zoomDuration=0,this._zoomEasing=pe.EaseInOutCubic,this._easing=pe.EaseInOutCubic,this._halfWidth=0,this._halfHeight=0,this._viewport=null,this._isInitialized=!1,this._snapPos=A(0,0)}get zoom(){return this._z}set zoom(t){this._z=t,this._engine&&(this._halfWidth=this._engine.halfDrawWidth,this._halfHeight=this._engine.halfDrawHeight)}get angularVelocity(){return this._angularVelocity}set angularVelocity(t){this._angularVelocity=t}get pos(){return this._pos}set pos(t){this._pos=g(t,()=>this._posChanged=!0),this._posChanged=!0}get x(){return this.pos.x}set x(t){!this._follow&&!this._cameraMoving&&(this.pos=A(t,this.pos.y))}get y(){return this.pos.y}set y(t){!this._follow&&!this._cameraMoving&&(this.pos=A(this.pos.x,t))}get dx(){return this.vel.x}set dx(t){this.vel=A(t,this.vel.y)}get dy(){return this.vel.y}set dy(t){this.vel=A(this.vel.x,t)}get ax(){return this.acc.x}set ax(t){this.acc=A(t,this.acc.y)}get ay(){return this.acc.y}set ay(t){this.acc=A(this.acc.x,t)}getFocus(){return this.pos}move(t,e,i=pe.EaseInOutCubic){if(typeof i!="function")throw"Please specify an EasingFunction";return this._follow?Promise.reject(t):(this._lerpPromise&&this._lerpResolve&&this._lerpResolve(t),this._lerpPromise=new Promise(s=>{this._lerpResolve=s}),this._lerpStart=this.getFocus().clone(),this._lerpDuration=e,this._lerpEnd=t,this._currentLerpTime=0,this._cameraMoving=!0,this._easing=i,this._lerpPromise)}shake(t,e,i){this._isShaking=!0,this._shakeMagnitudeX=t,this._shakeMagnitudeY=e,this._shakeDuration=i}zoomOverTime(t,e=0,i=pe.EaseInOutCubic){if(this._zoomPromise=new Promise(s=>{this._zoomResolve=s}),e)this._isZooming=!0,this._zoomEasing=i,this._currentZoomTime=0,this._zoomDuration=e,this._zoomStart=this.zoom,this._zoomEnd=t;else return this._isZooming=!1,this.zoom=t,Promise.resolve(!0);return this._zoomPromise}get viewport(){return this._viewport?this._viewport:new E(0,0,0,0)}addStrategy(t){this._cameraStrategies.push(t)}removeStrategy(t){K(t,this._cameraStrategies)}clearAllStrategies(){this._cameraStrategies.length=0}_preupdate(t,e){this.events.emit("preupdate",new ai(t,e,this)),this.onPreUpdate(t,e)}onPreUpdate(t,e){}_postupdate(t,e){this.events.emit("postupdate",new li(t,e,this)),this.onPostUpdate(t,e)}onPostUpdate(t,e){}get isInitialized(){return this._isInitialized}_initialize(t){if(!this.isInitialized){this._engine=t,this._screen=t.screen;const e=this._screen.contentArea;let i=A(e.width/2,e.height/2);if(!this._engine.loadingComplete){const s=this._screen.peekResolution();s&&(i=A(s.width/2,s.height/2))}this._halfWidth=i.x,this._halfHeight=i.y,this._posChanged||(this.pos=i),this.pos.clone(this.drawPos),this.updateTransform(this.pos),this.runStrategies(t,t.clock.elapsed()),this.updateViewport(),this.updateTransform(this.pos),this.pos.clone(this._oldPos),this.onInitialize(t),this.events.emit("initialize",new ys(t,this)),this._isInitialized=!0}}onInitialize(t){}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}runStrategies(t,e){for(const i of this._cameraStrategies)this.pos=i.action.call(i,i.target,this,t,e)}updateViewport(){this._viewport=new E(this.x-this._halfWidth,this.y-this._halfHeight,this.x+this._halfWidth,this.y+this._halfHeight)}update(t,e){if(this._initialize(t),this._preupdate(t,e),this.pos.clone(this._oldPos),this.pos=this.pos.add(this.vel.scale(e/1e3)),this.zoom+=this.dz*e/1e3,this.vel=this.vel.add(this.acc.scale(e/1e3)),this.dz+=this.az*e/1e3,this.rotation+=this.angularVelocity*e/1e3,this._isZooming)if(this._currentZoomTime<this._zoomDuration){const i=this._zoomEasing,s=i(this._currentZoomTime,this._zoomStart,this._zoomEnd,this._zoomDuration);this.zoom=s,this._currentZoomTime+=e}else this._isZooming=!1,this.zoom=this._zoomEnd,this._currentZoomTime=0,this._zoomResolve(!0);if(this._cameraMoving)if(this._currentLerpTime<this._lerpDuration){const s=pe.CreateVectorEasingFunction(this._easing)(this._currentLerpTime,this._lerpStart,this._lerpEnd,this._lerpDuration);this.pos=s,this._currentLerpTime+=e}else{this.pos=this._lerpEnd;const i=this._lerpEnd.clone();this._lerpStart=null,this._lerpEnd=null,this._currentLerpTime=0,this._cameraMoving=!1,this._lerpResolve(i)}this._isDoneShaking()?(this._isShaking=!1,this._elapsedShakeTime=0,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._xShake=0,this._yShake=0):(this._elapsedShakeTime+=e,this._xShake=(Math.random()*this._shakeMagnitudeX|0)+1,this._yShake=(Math.random()*this._shakeMagnitudeY|0)+1),this.runStrategies(t,e),this.updateViewport(),this.updateTransform(this.pos),this._postupdate(t,e)}draw(t){if(this.pos.clone(this.drawPos),this._engine.fixedUpdateFps){const e=this._engine.currentFrameLagMs/(1e3/this._engine.fixedUpdateFps),i=this.pos.scale(e).add(this._oldPos.scale(1-e));i.clone(this.drawPos),this.updateTransform(i)}if(t.snapToPixel){const e=this.drawPos.clone(this._snapPos);e.x=~~(e.x+ee*B(e.x)),e.y=~~(e.y+ee*B(e.y)),e.clone(this.drawPos),this.updateTransform(e)}t.multiply(this.transform)}updateTransform(t){const e=this._screen.resolution.width/this.zoom,i=this._screen.resolution.height/this.zoom,s=A(-t.x+e/2+this._xShake,-t.y+i/2+this._yShake);this.transform.reset(),this.transform.scale(this.zoom,this.zoom),this.transform.translate(e/2,i/2),this.transform.rotate(this.rotation),this.transform.translate(-e/2,-i/2),this.transform.translate(s.x,s.y),this.transform.inverse(this.inverse)}_isDoneShaking(){return!this._isShaking||this._elapsedShakeTime>=this._shakeDuration}}const wa={ExitTrigger:"exit",EnterTrigger:"enter"},ya={pos:h.Zero,width:10,height:10,visible:!1,action:()=>{},filter:()=>!0,repeat:-1};class io extends Ye{constructor(t){super({x:t.pos.x,y:t.pos.y,width:t.width,height:t.height}),this.events=new k,this.action=()=>{},this.filter=()=>!0,this.repeat=-1,t={...ya,...t},this.filter=t.filter||this.filter,this.repeat=t.repeat||this.repeat,this.action=t.action||this.action,t.target&&(this.target=t.target),this.graphics.visible=t.visible,this.body.collisionType=$t.Passive,this.events.on("collisionstart",e=>{this.filter(e.other)&&(this.events.emit("enter",new Ur(this,e.other)),this._dispatchAction(),this.repeat===0&&this.kill())}),this.events.on("collisionend",e=>{this.filter(e.other)&&this.events.emit("exit",new jr(this,e.other))})}set target(t){this._target=t,this.filter=e=>e===t}get target(){return this._target}_initialize(t){super._initialize(t)}_dispatchAction(){this.repeat!==0&&(this.action.call(this),this.repeat--)}}const yi={Highest:-1/0,Higher:-5,Average:0,Lower:5,Lowest:1/0};var qe;(function(n){n.Update="update",n.Draw="draw"})(qe||(qe={}));class oi{constructor(){this.priority=yi.Average}}class so{constructor(t){this._world=t,this.entities=[],this._entityIndex={},this._entitiesToRemove=[]}updateEntities(t,e){for(const i of this.entities)i.update(t.engine,e),i.active||this.removeEntity(i)}findEntitiesForRemoval(){for(const t of this.entities)t.active||this.removeEntity(t)}addEntity(t){t.active=!0,t.scene=this._world.scene,t&&!this._entityIndex[t.id]&&(this._entityIndex[t.id]=t,this.entities.push(t),this._world.queryManager.addEntity(t),t.children.forEach(e=>{e.scene=t.scene,this.addEntity(e)}),t.childrenAdded$.register({notify:e=>{this.addEntity(e)}}),t.childrenRemoved$.register({notify:e=>{this.removeEntity(e,!1)}}))}removeEntity(t,e=!0){var i,s;let r=0;t instanceof Fe?r=t.id:r=t;const o=this._entityIndex[r];if(o&&o.active&&(o.active=!1),o&&e){this._entitiesToRemove.push(o);return}delete this._entityIndex[r],o&&(o.scene=null,K(o,this.entities),this._world.queryManager.removeEntity(o),o.children.forEach(a=>{a.scene=null,this.removeEntity(a,e)}),o.childrenAdded$.clear(),o.childrenRemoved$.clear(),!((s=(i=this._world)===null||i===void 0?void 0:i.scene)===null||s===void 0)&&s.engine&&this._world.scene.engine.stats.currFrame.actors.killed++)}processEntityRemovals(){for(const t of this._entitiesToRemove)t.active||this.removeEntity(t,!1);this._entitiesToRemove.length=0}processComponentRemovals(){for(const t of this.entities)t.processComponentRemoval()}getById(t){return this._entityIndex[t]}getByName(t){return this.entities.filter(e=>e.name===t)}clear(){for(let t=this.entities.length-1;t>=0;t--)this.removeEntity(this.entities[t])}}class Ks{constructor(t){if(this.requiredComponents=t,this.components=new Set,this.entities=[],this.entityAdded$=new ze,this.entityRemoved$=new ze,t.length===0)throw new Error("Cannot create query without components");for(const e of t)this.components.add(e);this.id=Ks.createId(t)}static createId(t){return t.slice().map(e=>e.name).sort().join("-")}checkAndAdd(t){return!this.entities.includes(t)&&t.hasAll(Array.from(this.components))?(this.entities.push(t),this.entityAdded$.notifyAll(t),!0):!1}removeEntity(t){const e=this.entities.indexOf(t);e>-1&&(this.entities.splice(e,1),this.entityRemoved$.notifyAll(t))}getEntities(t){return t&&this.entities.sort(t),this.entities}}class $s{constructor(t){if(this.requiredTags=t,this.tags=new Set,this.entities=[],this.entityAdded$=new ze,this.entityRemoved$=new ze,t.length===0)throw new Error("Cannot create tag query without tags");for(const e of t)this.tags.add(e);this.id=$s.createId(t)}static createId(t){return t.slice().sort().join("-")}checkAndAdd(t){return!this.entities.includes(t)&&t.hasAllTags(Array.from(this.tags))?(this.entities.push(t),this.entityAdded$.notifyAll(t),!0):!1}removeEntity(t){const e=this.entities.indexOf(t);e>-1&&(this.entities.splice(e,1),this.entityRemoved$.notifyAll(t))}getEntities(t){return t&&this.entities.sort(t),this.entities}}class ro{constructor(t){this._world=t,this._queries=new Map,this._addComponentHandlers=new Map,this._removeComponentHandlers=new Map,this._componentToQueriesIndex=new Map,this._tagQueries=new Map,this._addTagHandlers=new Map,this._removeTagHandlers=new Map,this._tagToQueriesIndex=new Map,this._createAddComponentHandler=e=>i=>{this.addComponent(e,i)},this._createRemoveComponentHandler=e=>i=>{this.removeComponent(e,i)},this._createAddTagHandler=e=>i=>{this.addTag(e,i)},this._createRemoveTagHandler=e=>i=>{this.removeTag(e,i)}}createQuery(t){const e=Ks.createId(t);if(this._queries.has(e))return this._queries.get(e);const i=new Ks(t);this._queries.set(i.id,i);for(const s of t){const r=this._componentToQueriesIndex.get(s);r?r.push(i):this._componentToQueriesIndex.set(s,[i])}for(const s of this._world.entities)this.addEntity(s);return i}createTagQuery(t){const e=$s.createId(t);if(this._tagQueries.has(e))return this._tagQueries.get(e);const i=new $s(t);this._tagQueries.set(i.id,i);for(const s of t){const r=this._tagToQueriesIndex.get(s);r?r.push(i):this._tagToQueriesIndex.set(s,[i])}for(const s of this._world.entities)this.addEntity(s);return i}addEntity(t){const e=this._addComponentHandlers.get(t),i=this._removeComponentHandlers.get(t),s=e??this._createAddComponentHandler(t),r=i??this._createRemoveComponentHandler(t);this._addComponentHandlers.set(t,s),this._removeComponentHandlers.set(t,r);const o=this._addTagHandlers.get(t),a=this._removeTagHandlers.get(t),u=o??this._createAddTagHandler(t),T=a??this._createRemoveTagHandler(t);this._addTagHandlers.set(t,u),this._removeTagHandlers.set(t,T);for(const P of this._queries.values())P.checkAndAdd(t);for(const P of this._tagQueries.values())P.checkAndAdd(t);t.componentAdded$.subscribe(s),t.componentRemoved$.subscribe(r),t.tagAdded$.subscribe(u),t.tagRemoved$.subscribe(T)}removeEntity(t){const e=this._addComponentHandlers.get(t),i=this._removeComponentHandlers.get(t);for(const o of this._queries.values())o.removeEntity(t);e&&t.componentAdded$.unsubscribe(e),i&&t.componentRemoved$.unsubscribe(i);const s=this._addTagHandlers.get(t),r=this._removeTagHandlers.get(t);for(const o of this._tagQueries.values())o.removeEntity(t);s&&t.tagAdded$.unsubscribe(s),r&&t.tagRemoved$.unsubscribe(r)}addComponent(t,e){var i;const s=(i=this._componentToQueriesIndex.get(e.constructor))!==null&&i!==void 0?i:[];for(const r of s)r.checkAndAdd(t)}removeComponent(t,e){var i;const s=(i=this._componentToQueriesIndex.get(e.constructor))!==null&&i!==void 0?i:[];for(const r of s)r.removeEntity(t)}addTag(t,e){var i;const s=(i=this._tagToQueriesIndex.get(e))!==null&&i!==void 0?i:[];for(const r of s)r.checkAndAdd(t)}removeTag(t,e){var i;const s=(i=this._tagToQueriesIndex.get(e))!==null&&i!==void 0?i:[];for(const r of s)r.removeEntity(t)}}function no(n){var t,e;return!!(n!=null&&n.prototype)&&!!(!((e=(t=n==null?void 0:n.prototype)===null||t===void 0?void 0:t.constructor)===null||e===void 0)&&e.name)}class oo{constructor(t){this._world=t,this.systems=[],this.initialized=!1}get(t){return this.systems.find(e=>e instanceof t)}addSystem(t){let e;t instanceof oi?e=t:e=new t(this._world),this.systems.push(e),this.systems.sort((i,s)=>i.priority-s.priority),this.initialized&&e.initialize&&e.initialize(this._world,this._world.scene)}removeSystem(t){K(t,this.systems)}initialize(){if(!this.initialized){this.initialized=!0;for(const t of this.systems)t.initialize&&t.initialize(this._world,this._world.scene)}}updateSystems(t,e,i){const s=this.systems.filter(r=>r.systemType===t);for(const r of s)r.preupdate&&r.preupdate(e,i);for(const r of s)r.update(i);for(const r of s)r.postupdate&&r.postupdate(e,i)}clear(){for(let t=this.systems.length-1;t>=0;t--)this.removeSystem(this.systems[t])}}class ao{constructor(t){this.scene=t,this.queryManager=new ro(this),this.entityManager=new so(this),this.systemManager=new oo(this)}query(t){return this.queryManager.createQuery(t)}queryTags(t){return this.queryManager.createTagQuery(t)}update(t,e){t===qe.Update&&this.entityManager.updateEntities(this.scene,e),this.systemManager.updateSystems(t,this.scene,e),this.entityManager.findEntitiesForRemoval(),this.entityManager.processComponentRemovals(),this.entityManager.processEntityRemovals()}add(t){t instanceof Fe&&this.entityManager.addEntity(t),(t instanceof oi||no(t))&&this.systemManager.addSystem(t)}get(t){return this.systemManager.get(t)}remove(t,e=!0){t instanceof Fe&&this.entityManager.removeEntity(t,e),t instanceof oi&&this.systemManager.removeSystem(t)}get entities(){return this.entityManager.entities}clearEntities(){this.entityManager.clear()}clearSystems(){this.systemManager.clear()}}class je{static integrate(t,e,i,s){const r=s/1e3;e.vel.addEqual(i.scale(r,je._ACC)),t.pos.add(e.vel.scale(r,je._VEL),je._POS).addEqual(i.scale(.5*r*r,je._VEL_ACC)),e.angularVelocity+=e.torque*(1/e.inertia)*r;const o=t.rotation+e.angularVelocity*r;t.scale.add(e.scaleFactor.scale(r,this._SCALE_FACTOR),je._SCALE),t.get().setTransform(je._POS,o,je._SCALE)}}je._POS=new h(0,0),je._SCALE=new h(1,1),je._ACC=new h(0,0),je._VEL=new h(0,0),je._VEL_ACC=new h(0,0),je._SCALE_FACTOR=new h(0,0);class lo extends oi{constructor(t,e){super(),this.world=t,this.physics=e,this.systemType=qe.Update,this.priority=yi.Higher,this._physicsConfigDirty=!1,e.$configUpdate.subscribe(()=>this._physicsConfigDirty=!0),this.query=this.world.query([Ot,me])}update(t){let e,i;const s=this.query.entities;for(let r=0;r<s.length;r++){e=s[r].get(Ot),i=s[r].get(me);const o=s[r].get(Vt);if(this._physicsConfigDirty&&o&&o.updatePhysicsConfig(this.physics.config.bodies),o!=null&&o.sleeping)continue;const a=i.acc.clone();(o==null?void 0:o.collisionType)===$t.Active&&(o!=null&&o.useGravity)&&a.addEqual(this.physics.config.gravity),o==null||o.captureOldTransform(),je.integrate(e,i,a,t)}this._physicsConfigDirty=!1}}class on{constructor(t){this.config=t,this.directionMap=new Map,this.distanceMap=new Map}solve(t){this.preSolve(t),t=t.filter(i=>!i.isCanceled());let e;switch(this.config.contactSolveBias){case ts.HorizontalFirst:{e=Tn;break}case ts.VerticalFirst:{e=Bn;break}default:e=Sn}t.sort((i,s)=>{const r=this.directionMap.get(i.id),o=this.directionMap.get(s.id),a=this.distanceMap.get(i.id),u=this.distanceMap.get(s.id);return e[r]-e[o]||a-u});for(const i of t)this.solvePosition(i),this.solveVelocity(i);return this.postSolve(t),t}preSolve(t){for(const i of t){if(Math.abs(i.mtv.x)<1e-4&&Math.abs(i.mtv.y)<1e-4){i.cancel();continue}const s=R.fromDirection(i.mtv),r=i.mtv.negate(),o=i.colliderA.worldPos.squareDistance(i.colliderB.worldPos);this.distanceMap.set(i.id,o),this.directionMap.set(i.id,s===R.Left||s===R.Right?"horizontal":"vertical"),i.colliderA.events.emit("precollision",new Lt(i.colliderA,i.colliderB,s,r,i)),i.colliderB.events.emit("precollision",new Lt(i.colliderB,i.colliderA,R.getOpposite(s),r.negate(),i))}}postSolve(t){var e,i;for(const s of t){if(s.isCanceled())continue;const r=s.colliderA,o=s.colliderB,a=(e=r.owner)===null||e===void 0?void 0:e.get(Vt),u=(i=o.owner)===null||i===void 0?void 0:i.get(Vt);if(a&&u&&(a.collisionType===$t.Passive||u.collisionType===$t.Passive))continue;const T=R.fromDirection(s.mtv),P=s.mtv.negate();s.colliderA.events.emit("postcollision",new Nt(s.colliderA,s.colliderB,T,P,s)),s.colliderB.events.emit("postcollision",new Nt(s.colliderB,s.colliderA,R.getOpposite(T),P.negate(),s))}}solvePosition(t){var e,i;if(!t.colliderA.bounds.overlaps(t.colliderB.bounds,1e-4)){t.cancel();return}if(Math.abs(t.mtv.x)<1e-4&&Math.abs(t.mtv.y)<1e-4){t.cancel();return}let r=t.mtv;const o=t.colliderA,a=t.colliderB,u=(e=o.owner)===null||e===void 0?void 0:e.get(Vt),T=(i=a.owner)===null||i===void 0?void 0:i.get(Vt);if(u&&T){if(u.collisionType===$t.Passive||T.collisionType===$t.Passive)return;u.collisionType===$t.Active&&T.collisionType===$t.Active&&(r=r.scale(.5)),u.collisionType===$t.Active&&(u.globalPos.x-=r.x,u.globalPos.y-=r.y,o.update(u.transform.get())),T.collisionType===$t.Active&&(T.globalPos.x+=r.x,T.globalPos.y+=r.y,a.update(T.transform.get()))}}solveVelocity(t){var e,i;if(t.isCanceled())return;const s=t.colliderA,r=t.colliderB,o=(e=s.owner)===null||e===void 0?void 0:e.get(Vt),a=(i=r.owner)===null||i===void 0?void 0:i.get(Vt);if(o&&a){if(o.collisionType===$t.Passive||a.collisionType===$t.Passive)return;const u=t.normal,T=u.negate();if(o.collisionType===$t.Active&&o.vel.normalize().dot(T)<0){const P=u.scale(u.dot(o.vel.negate()));o.vel=o.vel.add(P)}if(a.collisionType===$t.Active&&a.vel.normalize().dot(u)<0){const P=T.scale(T.dot(a.vel.negate()));a.vel=a.vel.add(P)}}}}class ho{constructor(t,e,i){this.point=t,this.local=e,this.contact=i,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.aToContact=new h(0,0),this.bToContact=new h(0,0),this.originalVelocityAndRestitution=0,this.update()}update(){var t,e;const i=(t=this.contact.colliderA.owner)===null||t===void 0?void 0:t.get(Vt),s=(e=this.contact.colliderB.owner)===null||e===void 0?void 0:e.get(Vt);if(i&&s){const r=this.contact.normal,o=this.contact.tangent;this.aToContact=this.point.sub(i.globalPos),this.bToContact=this.point.sub(s.globalPos);const a=this.aToContact.cross(r),u=this.bToContact.cross(r);this.normalMass=i.inverseMass+s.inverseMass+i.inverseInertia*a*a+s.inverseInertia*u*u;const T=this.aToContact.cross(o),P=this.bToContact.cross(o);this.tangentMass=i.inverseMass+s.inverseMass+i.inverseInertia*T*T+s.inverseInertia*P*P}return this}getRelativeVelocity(){var t,e;const i=(t=this.contact.colliderA.owner)===null||t===void 0?void 0:t.get(Vt),s=(e=this.contact.colliderB.owner)===null||e===void 0?void 0:e.get(Vt);if(i&&s){const r=i.vel.add(h.cross(i.angularVelocity,this.aToContact));return s.vel.add(h.cross(s.angularVelocity,this.bToContact)).sub(r)}return h.Zero}}class an{constructor(t){this.config=t,this.lastFrameContacts=new Map,this.idToContactConstraint=new Map}getContactConstraints(t){var e;return(e=this.idToContactConstraint.get(t))!==null&&e!==void 0?e:[]}solve(t){return this.preSolve(t),t=t.filter(e=>!e.isCanceled()),this.solveVelocity(t),this.solvePosition(t),this.postSolve(t),t}preSolve(t){var e,i,s;for(const a of t){if(Math.abs(a.mtv.x)<1e-4&&Math.abs(a.mtv.y)<1e-4){a.cancel();continue}const u=R.fromDirection(a.mtv);a.colliderA.events.emit("precollision",new Lt(a.colliderA,a.colliderB,u,a.mtv,a)),a.colliderA.events.emit("beforecollisionresolve",new Ri(a.colliderA,a.colliderB,u,a.mtv,a)),a.colliderB.events.emit("precollision",new Lt(a.colliderB,a.colliderA,R.getOpposite(u),a.mtv.negate(),a)),a.colliderB.events.emit("beforecollisionresolve",new Ri(a.colliderB,a.colliderA,R.getOpposite(u),a.mtv.negate(),a)),a.matchAwake()}const o=Array.from(this.idToContactConstraint.keys());for(const a of t){const u=o.indexOf(a.id);u>-1&&o.splice(u,1);const T=(e=this.idToContactConstraint.get(a.id))!==null&&e!==void 0?e:[];let P=0;const N=a.colliderA.owner.get(Vt),J=a.colliderB.owner.get(Vt);if(N&&J)for(const nt of a.points){const at=a.normal,xt=a.tangent,Bt=nt.sub(N.globalPos),ft=nt.sub(J.globalPos),_t=Bt.cross(at),Tt=ft.cross(at),Ct=N.inverseMass+J.inverseMass+N.inverseInertia*_t*_t+J.inverseInertia*Tt*Tt,Rt=Bt.cross(xt),se=ft.cross(xt),Dt=N.inverseMass+J.inverseMass+N.inverseInertia*Rt*Rt+J.inverseInertia*se*se;T[P]&&((s=(i=T[P])===null||i===void 0?void 0:i.point)===null||s===void 0?void 0:s.squareDistance(nt))<4?(T[P].point=nt,T[P].local=a.localPoints[P]):T[P]=new ho(nt,a.localPoints[P],a),T[P].aToContact=Bt,T[P].bToContact=ft,T[P].normalMass=1/Ct,T[P].tangentMass=1/Dt;const re=N.bounciness>J.bounciness?N.bounciness:J.bounciness,ve=a.normal.dot(T[P].getRelativeVelocity());T[P].originalVelocityAndRestitution=0,ve<-.1&&(T[P].originalVelocityAndRestitution=-re*ve),P++}this.idToContactConstraint.set(a.id,T)}for(const a of o)this.idToContactConstraint.delete(a);if(this.config.warmStart)this.warmStart(t);else for(const a of t){const u=this.getContactConstraints(a.id);for(const T of u)T.normalImpulse=0,T.tangentImpulse=0}}postSolve(t){for(const e of t){const i=e.colliderA.owner.get(Vt),s=e.colliderB.owner.get(Vt);if(i&&s){if(i.collisionType===$t.Passive||s.collisionType===$t.Passive)continue;i.updateMotion(),s.updateMotion()}const r=R.fromDirection(e.mtv);e.colliderA.events.emit("postcollision",new Nt(e.colliderA,e.colliderB,r,e.mtv,e)),e.colliderA.events.emit("aftercollisionresolve",new fr(e.colliderA,e.colliderB,r,e.mtv,e)),e.colliderB.events.emit("postcollision",new Nt(e.colliderB,e.colliderA,R.getOpposite(r),e.mtv.negate(),e)),e.colliderB.events.emit("aftercollisionresolve",new fr(e.colliderB,e.colliderA,R.getOpposite(r),e.mtv.negate(),e))}this.lastFrameContacts.clear();for(const e of t)this.lastFrameContacts.set(e.id,e)}warmStart(t){var e,i,s;for(const r of t){const o=(e=r.colliderA.owner)===null||e===void 0?void 0:e.get(Vt),a=(i=r.colliderB.owner)===null||i===void 0?void 0:i.get(Vt);if(o&&a){const u=(s=this.idToContactConstraint.get(r.id))!==null&&s!==void 0?s:[];for(const T of u)if(this.config.warmStart){const P=r.normal.scale(T.normalImpulse),N=r.tangent.scale(T.tangentImpulse),J=P.add(N);o.applyImpulse(T.point,J.negate()),a.applyImpulse(T.point,J)}else T.normalImpulse=0,T.tangentImpulse=0}}}solvePosition(t){var e,i,s;for(let r=0;r<this.config.positionIterations;r++)for(const o of t){const a=(e=o.colliderA.owner)===null||e===void 0?void 0:e.get(Vt),u=(i=o.colliderB.owner)===null||i===void 0?void 0:i.get(Vt);if(a&&u){if(a.collisionType===$t.Passive||u.collisionType===$t.Passive)continue;const T=(s=this.idToContactConstraint.get(o.id))!==null&&s!==void 0?s:[];for(const P of T){const N=o.normal,J=di.FindContactSeparation(o,P.local),nt=this.config.steeringFactor,at=-5,xt=this.config.slop,Bt=D(nt*(J+xt),at,0),ft=N.scale(-Bt*P.normalMass);if(a.collisionType===$t.Active){const _t=ft.negate().scale(a.inverseMass);a.limitDegreeOfFreedom.includes(Ue.X)&&(_t.x=0),a.limitDegreeOfFreedom.includes(Ue.Y)&&(_t.y=0),a.globalPos=a.globalPos.add(_t),a.limitDegreeOfFreedom.includes(Ue.Rotation)||(a.rotation-=P.aToContact.cross(ft)*a.inverseInertia)}if(u.collisionType===$t.Active){const _t=ft.scale(u.inverseMass);u.limitDegreeOfFreedom.includes(Ue.X)&&(_t.x=0),u.limitDegreeOfFreedom.includes(Ue.Y)&&(_t.y=0),u.globalPos=u.globalPos.add(_t),u.limitDegreeOfFreedom.includes(Ue.Rotation)||(u.rotation+=P.bToContact.cross(ft)*u.inverseInertia)}}}}}solveVelocity(t){var e,i,s;for(let r=0;r<this.config.velocityIterations;r++)for(const o of t){const a=(e=o.colliderA.owner)===null||e===void 0?void 0:e.get(Vt),u=(i=o.colliderB.owner)===null||i===void 0?void 0:i.get(Vt);if(a&&u){if(a.collisionType===$t.Passive||u.collisionType===$t.Passive)continue;const T=Math.min(a.friction,u.friction),P=(s=this.idToContactConstraint.get(o.id))!==null&&s!==void 0?s:[];for(const N of P){let at=-N.getRelativeVelocity().dot(o.tangent)*N.tangentMass;const xt=T*N.normalImpulse,Bt=D(N.tangentImpulse+at,-xt,xt);at=Bt-N.tangentImpulse,N.tangentImpulse=Bt;const ft=o.tangent.scale(at);a.applyImpulse(N.point,ft.negate()),u.applyImpulse(N.point,ft)}for(const N of P){const nt=N.getRelativeVelocity().dot(o.normal);let at=-N.normalMass*(nt-N.originalVelocityAndRestitution);const xt=Math.max(N.normalImpulse+at,0);at=xt-N.normalImpulse,N.normalImpulse=xt;const Bt=o.normal.scale(at);a.applyImpulse(N.point,Bt.negate()),u.applyImpulse(N.point,Bt)}}}}}class ln extends oi{get _processor(){return this._physics.collisionProcessor}constructor(t,e){super(),this._physics=e,this.systemType=qe.Update,this.priority=yi.Higher,this._configDirty=!1,this._lastFrameContacts=new Map,this._currentFrameContacts=new Map,this._arcadeSolver=new on(e.config.arcade),this._realisticSolver=new an(e.config.realistic),this._physics.$configUpdate.subscribe(()=>this._configDirty=!0),this._trackCollider=i=>this._processor.track(i),this._untrackCollider=i=>this._processor.untrack(i),this.query=t.query([Ot,me,ye]),this.query.entityAdded$.subscribe(i=>{const s=i.get(ye);s.$colliderAdded.subscribe(this._trackCollider),s.$colliderRemoved.subscribe(this._untrackCollider);const r=s.get();r&&this._processor.track(r)}),this.query.entityRemoved$.subscribe(i=>{const s=i.get(ye),r=s.get();s&&r&&this._processor.untrack(r)})}initialize(t,e){this._engine=e.engine}update(t){var e,i,s,r;if(!this._physics.config.enabled)return;let o=[];for(const P of this.query.entities){const N=P.get(ye),J=N==null?void 0:N.get();if(N&&(!((e=N.owner)===null||e===void 0)&&e.active)&&J)if(N.update(),J instanceof De){const nt=J.getColliders();J.compositeStrategy||(J.compositeStrategy=this._physics.config.colliders.compositeStrategy),o=o.concat(nt)}else o.push(J)}this._processor.update(o);const a=this._processor.broadphase(o,t);this._currentFrameContacts.clear();let u=this._processor.narrowphase(a,(r=(s=(i=this._engine)===null||i===void 0?void 0:i.debug)===null||s===void 0?void 0:s.stats)===null||r===void 0?void 0:r.currFrame);u=this.getSolver().solve(u);for(const P of u){if(P.isCanceled())continue;const N=P.id.indexOf("|");if(N>0){const J=P.id.substring(N+1);this._currentFrameContacts.set(J,P)}else this._currentFrameContacts.set(P.id,P)}this.runContactStartEnd(),this._lastFrameContacts.clear(),this._lastFrameContacts=new Map(this._currentFrameContacts);for(const P of this.query.entities){const N=P.get(ye);N&&N.processColliderRemoval()}}getSolver(){return this._configDirty&&(this._configDirty=!1,this._arcadeSolver=new on(this._physics.config.arcade),this._realisticSolver=new an(this._physics.config.realistic)),this._physics.config.solver===Oi.Realistic?this._realisticSolver:this._arcadeSolver}debug(t){this._processor.debug(t)}runContactStartEnd(){for(const[t,e]of this._currentFrameContacts)if(!this._lastFrameContacts.has(t)){const i=e.colliderA,s=e.colliderB,r=R.fromDirection(e.mtv),o=R.getOpposite(r);i.events.emit("collisionstart",new Hs(i,s,r,e)),i.events.emit("contactstart",new ue(i,s,r,e)),s.events.emit("collisionstart",new Hs(s,i,o,e)),s.events.emit("contactstart",new ue(s,i,o,e))}for(const[t,e]of this._lastFrameContacts)if(!this._currentFrameContacts.has(t)){const i=e.colliderA,s=e.colliderB,r=R.fromDirection(e.mtv),o=R.getOpposite(r);i.events.emit("collisionend",new Ws(i,s,r,e)),i.events.emit("contactend",new hi(i,s,r,e)),s.events.emit("collisionend",new Ws(s,i,o,e)),s.events.emit("contactend",new hi(s,i,o,e))}}}function co(n){return class extends n{assign(t){for(const e in t)typeof this[e]!="function"&&(this[e]=t[e])}constructor(...t){super(...t),t.filter(function(i){return i!==void 0}).length===1&&t[0]&&typeof t[0]=="object"&&!(t[0]instanceof Array)&&this.assign(t[0])}}}var Is;(function(n){n[n.Circle=0]="Circle",n[n.Rectangle=1]="Rectangle"})(Is||(Is={}));class xa extends Fe{constructor(t,e,i,s,r,o,a,u,T,P,N){super(),this.position=new h(0,0),this.velocity=new h(0,0),this.acceleration=new h(0,0),this.particleRotationalVelocity=0,this.currentRotation=0,this.focus=null,this.focusAccel=0,this.opacity=1,this.beginColor=p.White,this.endColor=p.White,this.life=300,this.fadeFlag=!1,this._rRate=1,this._gRate=1,this._bRate=1,this._aRate=0,this._currentColor=p.White,this.emitter=null,this.particleSize=5,this.particleSprite=null,this.sizeRate=0,this.elapsedMultiplier=0,this.visible=!0,this.isOffscreen=!1;let J=t;if(J&&!(t instanceof uo)){const nt=t;J=nt.emitter,e=nt.life,i=nt.opacity,r=nt.endColor,s=nt.beginColor,o=nt.position,a=nt.velocity,u=nt.acceleration,T=nt.startSize,P=nt.endSize,N=nt.particleSprite}if(this.emitter=J,this.life=e||this.life,this.opacity=i||this.opacity,this.endColor=r||this.endColor.clone(),this.beginColor=s||this.beginColor.clone(),this._currentColor=this.beginColor.clone(),this.particleSprite=N,this.emitter.particleTransform===Es.Global){const nt=this.emitter.transform.globalPos;this.position=(o||this.position).add(nt),this.velocity=(a||this.velocity).rotate(this.emitter.transform.globalRotation)}else this.velocity=a||this.velocity,this.position=o||this.position;this.acceleration=u||this.acceleration,this._rRate=(this.endColor.r-this.beginColor.r)/this.life,this._gRate=(this.endColor.g-this.beginColor.g)/this.life,this._bRate=(this.endColor.b-this.beginColor.b)/this.life,this._aRate=this.opacity/this.life,this.startSize=T||0,this.endSize=P||0,this.endSize>0&&this.startSize>0&&(this.sizeRate=(this.endSize-this.startSize)/this.life,this.particleSize=this.startSize),this.addComponent(this.transform=new Ot),this.addComponent(this.graphics=new Ie),this.transform.pos=this.position,this.transform.rotation=this.currentRotation,this.transform.scale=A(1,1),this.transform.z=this.emitter.z,this.particleSprite?(this.graphics.opacity=this.opacity,this.graphics.use(this.particleSprite)):(this.graphics.localBounds=E.fromDimension(this.particleSize,this.particleSize,h.Half),this.graphics.onPostDraw=nt=>{nt.save(),this.graphics.opacity=this.opacity;const at=this._currentColor.clone();at.a=1,nt.debug.drawPoint(A(0,0),{color:at,size:this.particleSize}),nt.restore()})}kill(){this.emitter.removeParticle(this)}update(t,e){if(this.life=this.life-e,this.elapsedMultiplier=this.elapsedMultiplier+e,this.life<0&&this.kill(),this.fadeFlag&&(this.opacity=D(this._aRate*this.life,1e-4,1)),this.startSize>0&&this.endSize>0&&(this.particleSize=D(this.sizeRate*e+this.particleSize,Math.min(this.startSize,this.endSize),Math.max(this.startSize,this.endSize))),this._currentColor.r=D(this._currentColor.r+this._rRate*e,0,255),this._currentColor.g=D(this._currentColor.g+this._gRate*e,0,255),this._currentColor.b=D(this._currentColor.b+this._bRate*e,0,255),this._currentColor.a=D(this.opacity,1e-4,1),this.focus){const i=this.focus.sub(this.position).normalize().scale(this.focusAccel).scale(e/1e3);this.velocity=this.velocity.add(i)}else this.velocity=this.velocity.add(this.acceleration.scale(e/1e3));this.position=this.position.add(this.velocity.scale(e/1e3)),this.particleRotationalVelocity&&(this.currentRotation=(this.currentRotation+this.particleRotationalVelocity*e/1e3)%(2*Math.PI)),this.transform.pos=this.position,this.transform.rotation=this.currentRotation,this.transform.scale=A(1,1),this.graphics.opacity=this.opacity}}class Dr extends co(xa){constructor(t,e,i,s,r,o,a,u,T,P,N){super(t,e,i,s,r,o,a,u,T,P,N)}}var Es;(function(n){n.Global="global",n.Local="local"})(Es||(Es={}));class uo extends Ye{get opacity(){return this.graphics.opacity}set opacity(t){this.graphics.opacity=t}get particleSprite(){return this._sprite}set particleSprite(t){t&&(this._sprite=t)}constructor(t){var e,i;super({width:(e=t.width)!==null&&e!==void 0?e:0,height:(i=t.height)!==null&&i!==void 0?i:0}),this._particlesToEmit=0,this.numParticles=0,this.isEmitting=!0,this.particles=[],this.deadParticles=[],this.minVel=0,this.maxVel=0,this.acceleration=new h(0,0),this.minAngle=0,this.maxAngle=0,this.emitRate=1,this.particleLife=2e3,this.fadeFlag=!1,this.focus=null,this.focusAccel=null,this.startSize=null,this.endSize=null,this.minSize=5,this.maxSize=5,this.beginColor=p.White,this.endColor=p.White,this._sprite=null,this.emitterType=Is.Rectangle,this.radius=0,this.particleRotationalVelocity=0,this.randomRotation=!1,this.particleTransform=Es.Global;const{x:s,y:r,z:o,pos:a,isEmitting:u,minVel:T,maxVel:P,acceleration:N,minAngle:J,maxAngle:nt,emitRate:at,particleLife:xt,opacity:Bt,fadeFlag:ft,focus:_t,focusAccel:Tt,startSize:Ct,endSize:Rt,minSize:se,maxSize:Dt,beginColor:re,endColor:ve,particleSprite:Se,emitterType:Ve,radius:Xe,particleRotationalVelocity:Je,particleTransform:We,randomRotation:Me,random:Le}={...t};this.pos=a??A(s??0,r??0),this.z=o??0,this.isEmitting=u??this.isEmitting,this.minVel=T??this.minVel,this.maxVel=P??this.maxVel,this.acceleration=N??this.acceleration,this.minAngle=J??this.minAngle,this.maxAngle=nt??this.maxAngle,this.emitRate=at??this.emitRate,this.particleLife=xt??this.particleLife,this.opacity=Bt??this.opacity,this.fadeFlag=ft??this.fadeFlag,this.focus=_t??this.focus,this.focusAccel=Tt??this.focusAccel,this.startSize=Ct??this.startSize,this.endSize=Rt??this.endSize,this.minSize=se??this.minSize,this.maxSize=Dt??this.maxSize,this.beginColor=re??this.beginColor,this.endColor=ve??this.endColor,this.particleSprite=Se??this.particleSprite,this.emitterType=Ve??this.emitterType,this.radius=Xe??this.radius,this.particleRotationalVelocity=Je??this.particleRotationalVelocity,this.randomRotation=Me??this.randomRotation,this.particleTransform=We??this.particleTransform,this.body.collisionType=$t.PreventCollision,this.random=Le??new S}removeParticle(t){this.deadParticles.push(t)}emitParticles(t){var e;for(let i=0;i<t;i++){const s=this._createParticle();this.particles.push(s),!((e=this===null||this===void 0?void 0:this.scene)===null||e===void 0)&&e.world&&(this.particleTransform===Es.Global?this.scene.world.add(s):this.addChild(s))}}clearParticles(){this.particles.length=0}_createParticle(){let t=0,e=0;const i=f(this.minAngle,this.maxAngle,this.random),s=f(this.minVel,this.maxVel,this.random),r=this.startSize||f(this.minSize,this.maxSize,this.random),o=s*Math.cos(i),a=s*Math.sin(i);if(this.emitterType===Is.Rectangle)t=f(0,this.width,this.random),e=f(0,this.height,this.random);else if(this.emitterType===Is.Circle){const T=f(0,this.radius,this.random);t=T*Math.cos(i),e=T*Math.sin(i)}const u=new Dr(this,this.particleLife,this.opacity,this.beginColor,this.endColor,new h(t,e),new h(o,a),this.acceleration,this.startSize,this.endSize,this.particleSprite);return u.fadeFlag=this.fadeFlag,u.particleSize=r,u.particleRotationalVelocity=this.particleRotationalVelocity,this.randomRotation&&(u.currentRotation=f(0,Math.PI*2,this.random)),this.focus&&(u.focus=this.focus.add(new h(this.pos.x,this.pos.y)),u.focusAccel=this.focusAccel),u}update(t,e){var i;super.update(t,e),this.isEmitting&&(this._particlesToEmit+=this.emitRate*(e/1e3),this._particlesToEmit>1&&(this.emitParticles(Math.floor(this._particlesToEmit)),this._particlesToEmit=this._particlesToEmit-Math.floor(this._particlesToEmit)));for(let s=0;s<this.deadParticles.length;s++)K(this.deadParticles[s],this.particles),!((i=this===null||this===void 0?void 0:this.scene)===null||i===void 0)&&i.world&&this.scene.world.remove(this.deadParticles[s],!1);this.deadParticles.length=0}}function ba(n,t,e,i){if(n.parent!==t.parent){const P=n.clone(),N=n.globalPos.clone(),J=n.globalScale.clone(),nt=n.globalRotation;P.parent=t.parent,P.globalPos=N,P.globalScale=J,P.globalRotation=nt,n=P}let s=t.pos,r=t.scale,o=t.rotation;s=t.pos.scale(e).add(n.pos.scale(1-e)),r=t.scale.scale(e).add(n.scale.scale(1-e));const a=(1-e)*Math.cos(n.rotation)+e*Math.cos(t.rotation),u=(1-e)*Math.sin(n.rotation)+e*Math.sin(t.rotation);o=Math.atan2(u,a);const T=i??new Ki;return T.setTransform(s,o,r),T}class Ao extends oi{get sortedTransforms(){return this._sortedTransforms}constructor(t){super(),this.world=t,this.systemType=qe.Draw,this.priority=yi.Average,this._token=0,this._sortedTransforms=[],this._zHasChanged=!1,this._zIndexUpdate=()=>{this._zHasChanged=!0},this._targetInterpolationTransform=new Ki,this.query=this.world.query([Ot,Ie]),this.query.entityAdded$.subscribe(e=>{const i=e.get(Ot);this._sortedTransforms.push(i),i.zIndexChanged$.subscribe(this._zIndexUpdate),this._zHasChanged=!0}),this.query.entityRemoved$.subscribe(e=>{const i=e.get(Ot);i.zIndexChanged$.unsubscribe(this._zIndexUpdate);const s=this._sortedTransforms.indexOf(i);s>-1&&this._sortedTransforms.splice(s,1)})}initialize(t,e){this._camera=e.camera,this._engine=e.engine}preupdate(){this._graphicsContext=this._engine.graphicsContext,this._zHasChanged&&(this._sortedTransforms.sort((t,e)=>t.z-e.z),this._zHasChanged=!1)}update(t){this._token++;let e;ce.checkAndClearCache(),this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext);for(const i of this._sortedTransforms){const s=i.owner;if(s.hasTag("ex.offscreen")||(e=s.get(Ie),!e.visible))continue;e.onPreTransformDraw&&e.onPreTransformDraw(this._graphicsContext,t),s.events.emit("pretransformdraw",new _s(this._graphicsContext,t,s)),i.coordPlane===be.Screen&&this._graphicsContext.restore(),this._graphicsContext.save(),i.coordPlane===be.Screen&&this._graphicsContext.translate(this._engine.screen.contentArea.left,this._engine.screen.contentArea.top),e.update(t,this._token);const r=s.get(Tr);if(r){const a=h.One.sub(r.parallaxFactor),u=this._camera.drawPos.scale(a);this._graphicsContext.translate(u.x,u.y)}this._applyTransform(s),e.material&&(this._graphicsContext.material=e.material),e.onPreDraw&&e.onPreDraw(this._graphicsContext,t),s.events.emit("predraw",new Ti(this._graphicsContext,t,s));const o=s instanceof Dr?s.opacity:1;this._graphicsContext.opacity*=e.opacity*o,this._drawGraphicsComponent(e,i),e.onPostDraw&&e.onPostDraw(this._graphicsContext,t),s.events.emit("postdraw",new Si(this._graphicsContext,t,s)),this._graphicsContext.restore(),i.coordPlane===be.Screen&&(this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext)),e.onPostTransformDraw&&e.onPostTransformDraw(this._graphicsContext,t),s.events.emit("posttransformdraw",new ms(this._graphicsContext,t,s))}this._graphicsContext.restore()}_drawGraphicsComponent(t,e){var i,s;if(t.visible){const r=t.flipHorizontal,o=t.flipVertical,a=t.current,u=(i=t.currentOptions)!==null&&i!==void 0?i:{};if(a){let T=t.anchor,P=t.offset,N=1,J=1;u!=null&&u.anchor&&(T=u.anchor),u!=null&&u.offset&&(P=u.offset);const nt=e.globalScale;N*=a.scale.x*nt.x,J*=a.scale.y*nt.y;const at=-a.width*T.x+P.x*N,xt=-a.height*T.y+P.y*J,Bt=a.flipHorizontal,ft=a.flipVertical;if((r||o)&&(a.flipHorizontal=r?!Bt:Bt,a.flipVertical=o?!ft:ft),a==null||a.draw(this._graphicsContext,at,xt),(r||o)&&(a.flipHorizontal=Bt,a.flipVertical=ft),!((s=this._engine)===null||s===void 0)&&s.isDebug&&this._engine.debug.graphics.showBounds){const _t=A(at,xt);if(a instanceof xs)for(const Tt of a.members){let Ct,Rt=h.Zero;Tt instanceof it?Ct=Tt:(Ct=Tt.graphic,Rt=Tt.offset),a.useAnchor?Ct==null||Ct.localBounds.translate(_t.add(Rt)).draw(this._graphicsContext,this._engine.debug.graphics.boundsColor):Ct==null||Ct.localBounds.translate(Rt).draw(this._graphicsContext,this._engine.debug.graphics.boundsColor)}else a==null||a.localBounds.translate(_t).draw(this._graphicsContext,this._engine.debug.graphics.boundsColor)}}}}_applyTransform(t){const e=t.getAncestors();for(const i of e){const s=i==null?void 0:i.get(Ot),r=i==null?void 0:i.get(Vt);let o=s.get();if(r&&this._engine.fixedUpdateFps&&r.__oldTransformCaptured&&r.enableFixedUpdateInterpolate){const a=this._engine.currentFrameLagMs/(1e3/this._engine.fixedUpdateFps);o=ba(r.oldTransform,s.get(),a,this._targetInterpolationTransform)}s&&(this._graphicsContext.z=s.z,this._graphicsContext.translate(o.pos.x,o.pos.y),this._graphicsContext.scale(o.scale.x,o.scale.y),this._graphicsContext.rotate(o.rotation))}}}class go extends oi{constructor(t){super(),this.world=t,this.systemType=qe.Draw,this.priority=yi.Lowest,this.query=this.world.query([Ot])}initialize(t,e){this._graphicsContext=e.engine.graphicsContext,this._camera=e.camera,this._engine=e.engine,this._collisionSystem=t.systemManager.get(ln)}update(){var t;if(!this._engine.isDebug)return;const e=this._engine.debug.filter;let i,s;const r=this._engine.debug.entity;let o;const a=this._engine.debug.transform;let u;const T=this._engine.debug.motion;let P;const N=this._engine.debug.collider,J=this._engine.debug.physics;let nt;const at=this._engine.debug.graphics;let xt,Bt;const ft=this._engine.debug.body,_t=this._engine.debug.camera;for(const Tt of this.query.entities){if(Tt.hasTag("offscreen")||Tt instanceof Dr||e.useFilter&&(!(e.ids.length===0||e.ids.includes(Tt.id))||!(e.nameQuery===""||Tt.name.includes(e.nameQuery))))continue;let Ct=h.Zero;const Rt=A(0,16);if(i=Tt.id,s=Tt.name,o=Tt.get(Ot),this._pushCameraTransform(o),this._graphicsContext.save(),o.coordPlane===be.Screen&&this._graphicsContext.translate(this._engine.screen.contentArea.left,this._engine.screen.contentArea.top),this._graphicsContext.z=a.debugZIndex,this._applyTransform(Tt),o&&((a.showAll||a.showPosition)&&this._graphicsContext.debug.drawPoint(h.Zero,{size:4,color:a.positionColor}),(a.showAll||a.showPositionLabel)&&(this._graphicsContext.debug.drawText(`pos${o.pos.toString(2)}`,Ct),Ct=Ct.add(Rt)),(a.showAll||a.showZIndex)&&(this._graphicsContext.debug.drawText(`z(${o.z.toFixed(1)})`,Ct),Ct=Ct.add(Rt)),(r.showAll||r.showId)&&(this._graphicsContext.debug.drawText(`id(${i}) ${Tt.parent?"child of id("+((t=Tt.parent)===null||t===void 0?void 0:t.id)+")":""}`,Ct),Ct=Ct.add(Rt)),(r.showAll||r.showName)&&(this._graphicsContext.debug.drawText(`name(${s})`,Ct),Ct=Ct.add(Rt)),(a.showAll||a.showRotation)&&(this._graphicsContext.drawLine(h.Zero,h.fromAngle(o.rotation).scale(50).add(h.Zero),a.rotationColor,2),this._graphicsContext.debug.drawText(`rot deg(${V(o.rotation).toFixed(2)})`,Ct),Ct=Ct.add(Rt)),(a.showAll||a.showScale)&&this._graphicsContext.drawLine(h.Zero,o.scale.add(h.Zero),a.scaleColor,2)),nt=Tt.get(Ie),nt&&(at.showAll||at.showBounds)&&nt.localBounds.draw(this._graphicsContext,at.boundsColor),xt=Tt.get(Sr),xt&&(xt.useTransform||this._graphicsContext.restore(),xt.draw(this._graphicsContext,this._engine.debug),xt.useTransform||(this._graphicsContext.save(),this._applyTransform(Tt))),Bt=Tt.get(Vt),Bt&&((ft.showAll||ft.showCollisionGroup)&&(this._graphicsContext.debug.drawText(`collision group(${Bt.group.name})`,Ct),Ct=Ct.add(Rt)),(ft.showAll||ft.showCollisionType)&&(this._graphicsContext.debug.drawText(`collision type(${Bt.collisionType})`,Ct),Ct=Ct.add(Rt)),(ft.showAll||ft.showMass)&&(this._graphicsContext.debug.drawText(`mass(${Bt.mass})`,Ct),Ct=Ct.add(Rt)),(ft.showAll||ft.showMotion)&&(this._graphicsContext.debug.drawText(`motion(${Bt.sleepMotion})`,Ct),Ct=Ct.add(Rt)),(ft.showAll||ft.showSleeping)&&(this._graphicsContext.debug.drawText(`sleeping(${Bt.canSleep?Bt.sleeping:"cant sleep"})`,Ct),Ct=Ct.add(Rt))),this._graphicsContext.restore(),this._graphicsContext.save(),o.coordPlane===be.Screen&&this._graphicsContext.translate(this._engine.screen.contentArea.left,this._engine.screen.contentArea.top),this._graphicsContext.z=a.debugZIndex,u=Tt.get(me),u&&((T.showAll||T.showVelocity)&&(this._graphicsContext.debug.drawText(`vel${u.vel.toString(2)}`,Ct.add(o.globalPos)),this._graphicsContext.drawLine(o.globalPos,o.globalPos.add(u.vel),T.velocityColor,2),Ct=Ct.add(Rt)),(T.showAll||T.showAcceleration)&&this._graphicsContext.drawLine(o.globalPos,o.globalPos.add(u.acc),T.accelerationColor,2)),P=Tt.get(ye),P){const se=P.get();if((N.showAll||N.showGeometry)&&se&&se.debug(this._graphicsContext,N.geometryColor,{lineWidth:N.geometryLineWidth,pointSize:N.geometryPointSize}),N.showAll||N.showBounds){if(se instanceof De){const Dt=se.getColliders();for(const re of Dt){const ve=re.bounds,Se=A(ve.left,ve.top);this._graphicsContext.debug.drawRect(Se.x,Se.y,ve.width,ve.height,{color:N.boundsColor}),(N.showAll||N.showOwner)&&this._graphicsContext.debug.drawText(`owner id(${re.owner.id})`,Se)}P.bounds.draw(this._graphicsContext,N.boundsColor)}else if(se){const Dt=P.bounds,re=A(Dt.left,Dt.top);this._graphicsContext.debug.drawRect(re.x,re.y,Dt.width,Dt.height,{color:N.boundsColor}),(N.showAll||N.showOwner)&&this._graphicsContext.debug.drawText(`owner id(${P.owner.id})`,re)}}}this._graphicsContext.restore(),this._popCameraTransform(o)}if(this._graphicsContext.save(),this._camera.draw(this._graphicsContext),(J.showAll||J.showBroadphaseSpacePartitionDebug)&&this._collisionSystem.debug(this._graphicsContext),J.showAll||J.showCollisionContacts||J.showCollisionNormals)for(const[Tt,Ct]of this._engine.debug.stats.currFrame.physics.contacts){if(J.showAll||J.showCollisionContacts)for(const Rt of Ct.points)this._graphicsContext.debug.drawPoint(Rt,{size:J.contactSize,color:J.collisionContactColor});if(J.showAll||J.showCollisionNormals)for(const Rt of Ct.points)this._graphicsContext.debug.drawLine(Rt,Ct.normal.scale(30).add(Rt),{color:J.collisionNormalColor})}this._graphicsContext.restore(),_t&&(this._graphicsContext.save(),this._camera.draw(this._graphicsContext),(_t.showAll||_t.showFocus)&&this._graphicsContext.drawCircle(this._camera.pos,4,_t.focusColor),(_t.showAll||_t.showZoom)&&this._graphicsContext.debug.drawText(`zoom(${this._camera.zoom})`,this._camera.pos),this._graphicsContext.restore()),this._graphicsContext.flush()}postupdate(t,e){this._engine.isDebug&&(this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext),Ce.flush(this._graphicsContext),this._graphicsContext.restore())}_applyTransform(t){const e=t.getAncestors();for(const i of e){const s=i==null?void 0:i.get(Ot);s&&(this._graphicsContext.translate(s.pos.x,s.pos.y),this._graphicsContext.scale(s.scale.x,s.scale.y),this._graphicsContext.rotate(s.rotation))}}_pushCameraTransform(t){t.coordPlane===be.World&&(this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext))}_popCameraTransform(t){t.coordPlane===be.World&&this._graphicsContext.restore()}}class Qr extends oi{constructor(t){super(),this.world=t,this.systemType=qe.Update,this.priority=yi.Higher,this.overrideUseColliderShape=!1,this.overrideUseGraphicsBounds=!1,this.lastFrameEntityToPointers=new Map,this.currentFrameEntityToPointers=new Map,this._sortedTransforms=[],this._sortedEntities=[],this._zHasChanged=!1,this._zIndexUpdate=()=>{this._zHasChanged=!0},this.query=this.world.query([Ot,wi]),this.query.entityAdded$.subscribe(e=>{const i=e.get(Ot);this._sortedTransforms.push(i),this._sortedEntities.push(i.owner),i.zIndexChanged$.subscribe(this._zIndexUpdate),this._zHasChanged=!0}),this.query.entityRemoved$.subscribe(e=>{const i=e.get(Ot);i.zIndexChanged$.unsubscribe(this._zIndexUpdate);const s=this._sortedTransforms.indexOf(i);s>-1&&(this._sortedTransforms.splice(s,1),this._sortedEntities.splice(s,1))})}initialize(t,e){this._engine=e.engine,this._scene=e}preupdate(){this._receivers=[this._engine.input.pointers,this._scene.input.pointers],this._engineReceiver=this._engine.input.pointers,this._zHasChanged&&(this._sortedTransforms.sort((t,e)=>e.z-t.z),this._sortedEntities=this._sortedTransforms.map(t=>t.owner),this._zHasChanged=!1)}entityCurrentlyUnderPointer(t,e){return this.currentFrameEntityToPointers.has(t.id)&&this.currentFrameEntityToPointers.get(t.id).includes(e)}entityWasUnderPointer(t,e){return this.lastFrameEntityToPointers.has(t.id)&&this.lastFrameEntityToPointers.get(t.id).includes(e)}entered(t,e){return this.entityCurrentlyUnderPointer(t,e)&&!this.lastFrameEntityToPointers.has(t.id)}left(t,e){return!this.currentFrameEntityToPointers.has(t.id)&&this.entityWasUnderPointer(t,e)}addPointerToEntity(t,e){if(!this.currentFrameEntityToPointers.has(t.id)){this.currentFrameEntityToPointers.set(t.id,[e]);return}const i=this.currentFrameEntityToPointers.get(t.id);this.currentFrameEntityToPointers.set(t.id,i.concat(e))}update(){this._processPointerToEntity(this._sortedEntities),this._dispatchEvents(this._sortedEntities),this._receivers.forEach(t=>t.update()),this.lastFrameEntityToPointers.clear(),this.lastFrameEntityToPointers=new Map(this.currentFrameEntityToPointers),this.currentFrameEntityToPointers.clear(),this._receivers.forEach(t=>t.clear())}_processPointerToEntity(t){var e;let i,s,r,o;const a=this._engineReceiver;for(const u of t){if(i=u.get(Ot),o=(e=u.get(wi))!==null&&e!==void 0?e:new wi,o.localBounds){const T=o.localBounds.transform(i.get().matrix);for(const[P,N]of a.currentFramePointerCoords.entries())T.contains(i.coordPlane===be.World?N.worldPos:N.screenPos)&&this.addPointerToEntity(u,P)}if(s=u.get(ye),s&&(o.useColliderShape||this.overrideUseColliderShape)){s.update();const T=s.get();if(T)for(const[P,N]of a.currentFramePointerCoords.entries())T.contains(i.coordPlane===be.World?N.worldPos:N.screenPos)&&this.addPointerToEntity(u,P)}if(r=u.get(Ie),r&&(o.useGraphicsBounds||this.overrideUseGraphicsBounds)){const T=r.localBounds.transform(i.get().matrix);for(const[P,N]of a.currentFramePointerCoords.entries())T.contains(i.coordPlane===be.World?N.worldPos:N.screenPos)&&this.addPointerToEntity(u,P)}}}_processDownAndEmit(t){const e=this._engineReceiver,i=new Map;for(const s of e.currentFrameDown)s.active&&t.active&&this.entityCurrentlyUnderPointer(t,s.pointerId)&&(t.events.emit("pointerdown",s),e.isDragStart(s.pointerId)&&t.events.emit("pointerdragstart",s)),i.set(s.pointerId,s);return i}_processUpAndEmit(t){const e=this._engineReceiver,i=new Map;for(const s of e.currentFrameUp)s.active&&t.active&&this.entityCurrentlyUnderPointer(t,s.pointerId)&&(t.events.emit("pointerup",s),e.isDragEnd(s.pointerId)&&t.events.emit("pointerdragend",s)),i.set(s.pointerId,s);return i}_processMoveAndEmit(t){const e=this._engineReceiver,i=new Map;for(const s of e.currentFrameMove)s.active&&t.active&&this.entityCurrentlyUnderPointer(t,s.pointerId)&&(t.events.emit("pointermove",s),e.isDragging(s.pointerId)&&t.events.emit("pointerdragmove",s)),i.set(s.pointerId,s);return i}_processEnterLeaveAndEmit(t,e){const i=this._engineReceiver;for(const s of e){if(s.active&&t.active&&this.entered(t,s.pointerId)){t.events.emit("pointerenter",s),i.isDragging(s.pointerId)&&t.events.emit("pointerdragenter",s);break}if(s.active&&t.active&&(this.left(t,s.pointerId)||this.entityCurrentlyUnderPointer(t,s.pointerId)&&s.type==="up")){t.events.emit("pointerleave",s),i.isDragging(s.pointerId)&&t.events.emit("pointerdragleave",s);break}}}_processCancelAndEmit(t){const e=this._engineReceiver;for(const i of e.currentFrameCancel)i.active&&t.active&&this.entityCurrentlyUnderPointer(t,i.pointerId)&&t.events.emit("pointercancel",i)}_processWheelAndEmit(t){const e=this._engineReceiver;for(const i of e.currentFrameWheel)i.active&&t.active&&this.entityCurrentlyUnderPointer(t,0)&&t.events.emit("pointerwheel",i)}_dispatchEvents(t){const e=new Set(this.lastFrameEntityToPointers.keys()),i=new Set(this.currentFrameEntityToPointers.keys()),s=t.filter(u=>e.has(u.id)||i.has(u.id));let r,o,a;for(const u of s){a=this._processDownAndEmit(u),o=this._processUpAndEmit(u),r=this._processMoveAndEmit(u);const T=[...r.values(),...a.values(),...o.values()];this._processEnterLeaveAndEmit(u,T),this._processCancelAndEmit(u),this._processWheelAndEmit(u)}}}class po extends oi{constructor(t){super(),this.world=t,this.systemType=qe.Update,this.priority=yi.Higher,this._actions=[],this.query=this.world.query([bs]),this.query.entityAdded$.subscribe(e=>this._actions.push(e.get(bs))),this.query.entityRemoved$.subscribe(e=>{const i=e.get(bs),s=this._actions.indexOf(i);s>-1&&this._actions.splice(s,1)})}update(t){for(const e of this._actions)e.update(t)}}class tr extends ci{constructor(t){super(),this.elevation=0,this.columns=t.columns,this.rows=t.rows,this.tileWidth=t.tileWidth,this.tileHeight=t.tileHeight}}class fo extends oi{constructor(t){super(),this.world=t,this.systemType=qe.Update,this.priority=yi.Lower,this.query=this.world.query([Ot,tr])}update(){let t,e;for(const i of this.query.entities){t=i.get(Ot),e=i.get(tr);const r=Math.max(e.columns*e.tileWidth,e.rows*e.tileHeight)*e.elevation+t.pos.y;t.z=r}}}class _o extends oi{constructor(t){super(),this.world=t,this.systemType=qe.Draw,this.priority=yi.Higher,this.query=this.world.query([Ot,Ie])}initialize(t,e){this._camera=e.camera,this._screen=e.engine.screen}update(){this._worldBounds=this._screen.getWorldBounds();let t,e,i;for(const s of this.query.entities){e=s.get(Ie),t=s.get(Ot),i=s.get(Tr);let r;if(i){const a=h.One.sub(i.parallaxFactor);r=this._camera.pos.scale(a)}const o=this._isOffscreen(t,e,r);o&&!s.hasTag("ex.offscreen")&&(s.events.emit("exitviewport",new Nr(s)),s.addTag("ex.offscreen")),!o&&s.hasTag("ex.offscreen")&&(s.events.emit("enterviewport",new Gr(s)),s.removeTag("ex.offscreen"))}}_isOffscreen(t,e,i){if(t.coordPlane===be.World){let s=e.localBounds;i&&(s=s.translate(i));const r=s.transform(t.get().matrix);return!this._worldBounds.overlaps(r)}else return!1}}class mo{get config(){return st(this._config,t=>{this.$configUpdate.notifyAll(t)})}set config(t){this._config=t,this.$configUpdate.notifyAll(t)}get collisionProcessor(){if(this._configDirty){this._configDirty=!1;const t=this._collisionProcessor.getColliders();this._collisionProcessor=new mr(this._config);for(const e of t)this._collisionProcessor.track(e)}return this._collisionProcessor}constructor(t){this.$configUpdate=new ze,this._configDirty=!1,this.config=t,this.$configUpdate.subscribe(e=>{this._configDirty=!0,Vt.updateDefaultPhysicsConfig(e.bodies)}),this._collisionProcessor=new mr(this.config)}rayCast(t,e){return this.collisionProcessor.rayCast(t,e)}}class er{constructor(){this.events=new k,this.enabled=!1,this.supported=!!navigator.getGamepads,this._gamePadTimeStamps=[0,0,0,0],this._oldPads=[],this._pads=[],this._initSuccess=!1,this._navigator=navigator,this._minimumConfiguration=null,this._enabled=!0}init(){this.supported&&(this._initSuccess||(this._oldPads=this._clonePads(this._navigator.getGamepads()),this._oldPads.length&&this._oldPads[0]&&(this._initSuccess=!0)))}toggleEnabled(t){this._enabled=t}setMinimumGamepadConfiguration(t){this._enableAndUpdate(),this._minimumConfiguration=t}_enableAndUpdate(){this.enabled||(this.enabled=!0,this.update())}_isGamepadValid(t){if(!this._minimumConfiguration)return!0;if(!t)return!1;const e=t.axes.filter(s=>typeof s!==void 0).length,i=t.buttons.filter(s=>typeof s!==void 0).length;return e>=this._minimumConfiguration.axis&&i>=this._minimumConfiguration.buttons&&t.connected}emit(t,e){this.events.emit(t,e)}on(t,e){return this._enableAndUpdate(),this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this._enableAndUpdate(),this.events.off(t,e)}update(){if(!this.enabled||!this.supported||!this._enabled)return;this.init();const t=this._navigator.getGamepads();for(let e=0;e<t.length;e++){if(t[e])!this.at(e).connected&&this._isGamepadValid(t[e])&&this.events.emit("connect",new _(e,this.at(e))),this.at(e).connected=!0;else{const u=this.at(e);u.connected&&this.events.emit("disconnect",new z(e,u)),u.connected=!1;continue}if(this.at(e).update(),t[e].timestamp&&t[e].timestamp===this._gamePadTimeStamps[e])continue;this._gamePadTimeStamps[e]=t[e].timestamp,this.at(e).navigatorGamepad=t[e];let i,s,r,o,a;for(i in Bs)s=Bs[i],typeof s=="number"&&t[e].buttons[s]&&(a=t[e].buttons[s].value,a!==this._oldPads[e].getButton(s)&&(t[e].buttons[s].pressed?(this.at(e).updateButton(s,a),this.at(e).events.emit("button",new tt(s,a,this.at(e)))):this.at(e).updateButton(s,0)));for(r in Ts)o=Ts[r],typeof o=="number"&&(a=t[e].axes[o],a!==this._oldPads[e].getAxes(o)&&(this.at(e).updateAxes(o,a),this.at(e).events.emit("axis",new Pt(o,a,this.at(e)))));this._oldPads[e]=this._clonePad(t[e])}}at(t){if(this._enableAndUpdate(),t>=this._pads.length)for(let e=this._pads.length-1,i=t;e<i;e++)this._pads.push(new ir),this._oldPads.push(new ir);return this._pads[t]}getValidGamepads(){this._enableAndUpdate();const t=[];for(let e=0;e<this._pads.length;e++)this._isGamepadValid(this.at(e).navigatorGamepad)&&this.at(e).connected&&t.push(this.at(e));return t}count(){return this._pads.filter(t=>t.connected).length}_clonePads(t){const e=[];for(let i=0,s=t.length;i<s;i++)e.push(this._clonePad(t[i]));return e}_clonePad(t){let e,i;const s=new ir;if(!t)return s;for(e=0,i=t.buttons.length;e<i;e++)t.buttons[e]&&s.updateButton(e,t.buttons[e].value);for(e=0,i=t.axes.length;e<i;e++)s.updateAxes(e,t.axes[e]);return s}}er.MinAxisMoveThreshold=.05;class ir{constructor(){this.events=new k,this.connected=!1,this._axes=new Array(4),this._buttons=new Array(16),this._buttonsUp=new Array(16),this._buttonsDown=new Array(16);for(let t=0;t<this._buttons.length;t++)this._buttons[t]=0;for(let t=0;t<this._axes.length;t++)this._axes[t]=0}update(){this._buttonsDown=new Array(16),this._buttonsUp=new Array(16)}isButtonPressed(t,e=1){return this._buttons[t]>=e}isButtonHeld(t,e=1){return this._buttons[t]>=e}wasButtonPressed(t,e=1){return this._buttonsDown[t]>=e}wasButtonReleased(t){return!!this._buttonsUp[t]}getButton(t){return this._buttons[t]}getAxes(t){const e=this._axes[t];return Math.abs(e)<er.MinAxisMoveThreshold?0:e}updateButton(t,e){e===0&&this._buttons[t]?this._buttonsUp[t]=1:this._buttonsDown[t]=e,this._buttons[t]=e}updateAxes(t,e){this._axes[t]=e}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}}var Bs;(function(n){n[n.Face1=0]="Face1",n[n.Face2=1]="Face2",n[n.Face3=2]="Face3",n[n.Face4=3]="Face4",n[n.LeftBumper=4]="LeftBumper",n[n.RightBumper=5]="RightBumper",n[n.LeftTrigger=6]="LeftTrigger",n[n.RightTrigger=7]="RightTrigger",n[n.Select=8]="Select",n[n.Start=9]="Start",n[n.LeftStick=10]="LeftStick",n[n.RightStick=11]="RightStick",n[n.DpadUp=12]="DpadUp",n[n.DpadDown=13]="DpadDown",n[n.DpadLeft=14]="DpadLeft",n[n.DpadRight=15]="DpadRight"})(Bs||(Bs={}));var Ts;(function(n){n[n.LeftStickX=0]="LeftStickX",n[n.LeftStickY=1]="LeftStickY",n[n.RightStickX=2]="RightStickX",n[n.RightStickY=3]="RightStickY"})(Ts||(Ts={}));class vo{constructor(t){this.inputs=t,this._handlers=new Map}execute(){for(const[t,e]of this._handlers.entries()){const i=t(this.inputs);i&&e(i)}}on(t,e){this._handlers.set(t,e)}}function wo(){try{const n=()=>{};window.top.addEventListener("blur",n),window.top.removeEventListener("blur",n)}catch{return!0}return!1}var Ss;(function(n){n.Num0="Numpad0",n.Num1="Numpad1",n.Num2="Numpad2",n.Num3="Numpad3",n.Num4="Numpad4",n.Num5="Numpad5",n.Num6="Numpad6",n.Num7="Numpad7",n.Num8="Numpad8",n.Num9="Numpad9",n.NumAdd="NumpadAdd",n.NumSubtract="NumpadSubtract",n.NumMultiply="NumpadMultiply",n.NumDivide="NumpadDivide",n.NumDecimal="NumpadDecimal",n.Numpad0="Numpad0",n.Numpad1="Numpad1",n.Numpad2="Numpad2",n.Numpad3="Numpad3",n.Numpad4="Numpad4",n.Numpad5="Numpad5",n.Numpad6="Numpad6",n.Numpad7="Numpad7",n.Numpad8="Numpad8",n.Numpad9="Numpad9",n.NumpadAdd="NumpadAdd",n.NumpadSubtract="NumpadSubtract",n.NumpadMultiply="NumpadMultiply",n.NumpadDivide="NumpadDivide",n.NumpadDecimal="NumpadDecimal",n.NumLock="NumLock",n.ShiftLeft="ShiftLeft",n.ShiftRight="ShiftRight",n.AltLeft="AltLeft",n.AltRight="AltRight",n.ControlLeft="ControlLeft",n.ControlRight="ControlRight",n.MetaLeft="MetaLeft",n.MetaRight="MetaRight",n.Key0="Digit0",n.Key1="Digit1",n.Key2="Digit2",n.Key3="Digit3",n.Key4="Digit4",n.Key5="Digit5",n.Key6="Digit6",n.Key7="Digit7",n.Key8="Digit8",n.Key9="Digit9",n.Digit0="Digit0",n.Digit1="Digit1",n.Digit2="Digit2",n.Digit3="Digit3",n.Digit4="Digit4",n.Digit5="Digit5",n.Digit6="Digit6",n.Digit7="Digit7",n.Digit8="Digit8",n.Digit9="Digit9",n.F1="F1",n.F2="F2",n.F3="F3",n.F4="F4",n.F5="F5",n.F6="F6",n.F7="F7",n.F8="F8",n.F9="F9",n.F10="F10",n.F11="F11",n.F12="F12",n.A="KeyA",n.B="KeyB",n.C="KeyC",n.D="KeyD",n.E="KeyE",n.F="KeyF",n.G="KeyG",n.H="KeyH",n.I="KeyI",n.J="KeyJ",n.K="KeyK",n.L="KeyL",n.M="KeyM",n.N="KeyN",n.O="KeyO",n.P="KeyP",n.Q="KeyQ",n.R="KeyR",n.S="KeyS",n.T="KeyT",n.U="KeyU",n.V="KeyV",n.W="KeyW",n.X="KeyX",n.Y="KeyY",n.Z="KeyZ",n.KeyA="KeyA",n.KeyB="KeyB",n.KeyC="KeyC",n.KeyD="KeyD",n.KeyE="KeyE",n.KeyF="KeyF",n.KeyG="KeyG",n.KeyH="KeyH",n.KeyI="KeyI",n.KeyJ="KeyJ",n.KeyK="KeyK",n.KeyL="KeyL",n.KeyM="KeyM",n.KeyN="KeyN",n.KeyO="KeyO",n.KeyP="KeyP",n.KeyQ="KeyQ",n.KeyR="KeyR",n.KeyS="KeyS",n.KeyT="KeyT",n.KeyU="KeyU",n.KeyV="KeyV",n.KeyW="KeyW",n.KeyX="KeyX",n.KeyY="KeyY",n.KeyZ="KeyZ",n.Semicolon="Semicolon",n.Quote="Quote",n.Comma="Comma",n.Minus="Minus",n.Period="Period",n.Slash="Slash",n.Equal="Equal",n.BracketLeft="BracketLeft",n.Backslash="Backslash",n.BracketRight="BracketRight",n.Backquote="Backquote",n.Up="ArrowUp",n.Down="ArrowDown",n.Left="ArrowLeft",n.Right="ArrowRight",n.ArrowUp="ArrowUp",n.ArrowDown="ArrowDown",n.ArrowLeft="ArrowLeft",n.ArrowRight="ArrowRight",n.Space="Space",n.Backspace="Backspace",n.Delete="Delete",n.Esc="Escape",n.Escape="Escape",n.Enter="Enter",n.NumpadEnter="NumpadEnter",n.ContextMenu="ContextMenu"})(Ss||(Ss={}));class ks extends te{constructor(t,e,i){super(),this.key=t,this.value=e,this.originalEvent=i}}class hn{constructor(){this.events=new k,this._enabled=!0,this._keys=[],this._keysUp=[],this._keysDown=[],this._releaseAllKeys=t=>{for(const e of this._keys){const i=new ks(e,t.key,t);this.events.emit("up",i),this.events.emit("release",i)}this._keysUp=Array.from(new Set(this._keys.concat(this._keysUp))),this._keys.length=0},this._handleKeyDown=t=>{if(!this._enabled)return;!t.metaKey&&(this._keys.includes(Ss.MetaLeft)||this._keys.includes(Ss.MetaRight))&&this._releaseAllKeys(t);const e=t.code;if(this._keys.indexOf(e)===-1){this._keys.push(e),this._keysDown.push(e);const i=new ks(e,t.key,t);this.events.emit("down",i),this.events.emit("press",i)}},this._handleKeyUp=t=>{if(!this._enabled)return;const e=t.code,i=this._keys.indexOf(e);this._keys.splice(i,1),this._keysUp.push(e);const s=new ks(e,t.key,t);this.events.emit("up",s),this.events.emit("release",s),t.key==="Meta"&&this._releaseAllKeys(t)}}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}init(t){let{global:e}=t;const{grabWindowFocus:i}=t;e||(wo()?(e=window,i&&window.focus(),I.getInstance().warn("Excalibur might be in a cross-origin iframe, in order to receive keyboard events it must be in focus")):e=window.top),e.addEventListener("blur",()=>{this._keys.length=0}),e.addEventListener("keyup",this._handleKeyUp),e.addEventListener("keydown",this._handleKeyDown)}toggleEnabled(t){this._enabled=t}update(){this._keysDown.length=0,this._keysUp.length=0;for(let t=0;t<this._keys.length;t++)this.events.emit("hold",new ks(this._keys[t]))}getKeys(){return this._keys}wasPressed(t){return this._keysDown.indexOf(t)>-1}isHeld(t){return this._keys.indexOf(t)>-1}wasReleased(t){return this._keysUp.indexOf(t)>-1}triggerEvent(t,e,i){t==="down"&&this._handleKeyDown(new KeyboardEvent("keydown",{code:e,key:i??null})),t==="up"&&this._handleKeyUp(new KeyboardEvent("keyup",{code:e,key:i??null}))}}class sr{static fromPagePosition(t,e,i){let s,r,o,a;arguments.length===3?(s=t,r=e,o=new h(s,r),a=i):(o=t,s=o.x,r=o.y,a=e);const u=a.screen.pageToScreenCoordinates(o),T=a.screen.screenToWorldCoordinates(u);return new sr(T,o,u)}constructor(t,e,i){this.worldPos=t,this.pagePos=e,this.screenPos=i}}class Ds{cancel(){this.active=!1}get pagePos(){return this.coordinates.pagePos}get screenPos(){return this.coordinates.screenPos}get worldPos(){return this.coordinates.worldPos}constructor(t,e,i,s,r,o){this.type=t,this.pointerId=e,this.button=i,this.pointerType=s,this.coordinates=r,this.nativeEvent=o,this.active=!0}}class cn{cancel(){this.active=!1}constructor(t,e,i,s,r,o,a,u,T,P,N,J){this.x=t,this.y=e,this.pageX=i,this.pageY=s,this.screenX=r,this.screenY=o,this.index=a,this.deltaX=u,this.deltaY=T,this.deltaZ=P,this.deltaMode=N,this.ev=J,this.active=!0}}class dn{constructor(){this.events=new k,this.lastPagePos=h.Zero,this.lastScreenPos=h.Zero,this.lastWorldPos=h.Zero,this._onPointerMove=t=>{this.lastPagePos=new h(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new h(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new h(t.worldPos.x,t.worldPos.y)},this._onPointerDown=t=>{this.lastPagePos=new h(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new h(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new h(t.worldPos.x,t.worldPos.y)},this.on("move",this._onPointerMove),this.on("down",this._onPointerDown)}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}}var rs;(function(n){n.Pixel="Pixel",n.Line="Line",n.Page="Page"})(rs||(rs={}));var Di;(function(n){n[n.NoButton=-1]="NoButton",n[n.Left=0]="Left",n[n.Middle=1]="Middle",n[n.Right=2]="Right",n[n.Unknown=3]="Unknown"})(Di||(Di={}));var xi;(function(n){n.Left="Left",n.Middle="Middle",n.Right="Right",n.Unknown="Unknown",n.NoButton="NoButton"})(xi||(xi={}));var bi;(function(n){n.Touch="Touch",n.Mouse="Mouse",n.Pen="Pen",n.Unknown="Unknown"})(bi||(bi={}));function Ca(n){return globalThis.TouchEvent&&n instanceof globalThis.TouchEvent}function Ia(n){return globalThis.PointerEvent&&n instanceof globalThis.PointerEvent}class rr{constructor(t,e){this.target=t,this.engine=e,this.events=new k,this.primary=new dn,this._activeNativePointerIdsToNormalized=new Map,this.lastFramePointerCoords=new Map,this.currentFramePointerCoords=new Map,this.currentFramePointerDown=new Map,this.lastFramePointerDown=new Map,this.currentFrameDown=[],this.currentFrameUp=[],this.currentFrameMove=[],this.currentFrameCancel=[],this.currentFrameWheel=[],this._enabled=!0,this._pointers=[this.primary],this._boundHandle=this._handle.bind(this),this._boundWheel=this._handleWheel.bind(this)}toggleEnabled(t){this._enabled=t}recreate(t,e){const i=new rr(t,e);return i.primary=this.primary,i._pointers=this._pointers,i}at(t){if(t>=this._pointers.length)for(let e=this._pointers.length-1,i=t;e<i;e++)this._pointers.push(new dn);return this._pointers[t]}count(){return this._pointers.length}isDown(t){var e;return(e=this.currentFramePointerDown.get(t))!==null&&e!==void 0?e:!1}wasDown(t){var e;return(e=this.lastFramePointerDown.get(t))!==null&&e!==void 0?e:!1}isDragging(t){return this.isDown(t)}isDragStart(t){return this.isDown(t)&&!this.wasDown(t)}isDragEnd(t){return!this.isDown(t)&&this.wasDown(t)}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}update(){this.lastFramePointerDown=new Map(this.currentFramePointerDown),this.lastFramePointerCoords=new Map(this.currentFramePointerCoords);for(const t of this.currentFrameDown)this.emit("down",t),this.at(t.pointerId).emit("down",t),this.primary.emit("pointerdown",t);for(const t of this.currentFrameUp)this.emit("up",t),this.at(t.pointerId).emit("up",t);for(const t of this.currentFrameMove)this.emit("move",t),this.at(t.pointerId).emit("move",t);for(const t of this.currentFrameCancel)this.emit("cancel",t),this.at(t.pointerId).emit("cancel",t);for(const t of this.currentFrameWheel)this.emit("wheel",t),this.primary.emit("pointerwheel",t),this.primary.emit("wheel",t)}clear(){for(const t of this.currentFrameUp){this.currentFramePointerCoords.delete(t.pointerId);const e=this._activeNativePointerIdsToNormalized.entries();for(const[i,s]of e)s===t.pointerId&&this._activeNativePointerIdsToNormalized.delete(i)}this.currentFrameDown.length=0,this.currentFrameUp.length=0,this.currentFrameMove.length=0,this.currentFrameCancel.length=0,this.currentFrameWheel.length=0}init(t){var e;if(this.engine.isDisposed())return;this.target===this.engine.canvas?this.engine.canvas.style.touchAction="none":document.body.style.touchAction="none",window.PointerEvent?(this.target.addEventListener("pointerdown",this._boundHandle),this.target.addEventListener("pointerup",this._boundHandle),this.target.addEventListener("pointermove",this._boundHandle),this.target.addEventListener("pointercancel",this._boundHandle)):(this.target.addEventListener("touchstart",this._boundHandle),this.target.addEventListener("touchend",this._boundHandle),this.target.addEventListener("touchmove",this._boundHandle),this.target.addEventListener("touchcancel",this._boundHandle),this.target.addEventListener("mousedown",this._boundHandle),this.target.addEventListener("mouseup",this._boundHandle),this.target.addEventListener("mousemove",this._boundHandle));const i={passive:!(this.engine.pageScrollPreventionMode===Gi.All||this.engine.pageScrollPreventionMode===Gi.Canvas)};if("onwheel"in document.createElement("div")?this.target.addEventListener("wheel",this._boundWheel,i):document.onmousewheel!==void 0?this.target.addEventListener("mousewheel",this._boundWheel,i):this.target.addEventListener("MozMousePixelScroll",this._boundWheel,i),((e=t==null?void 0:t.grabWindowFocus)!==null&&e!==void 0?e:!0)&&wo()){const r=()=>{window.focus()};window.PointerEvent?this.target.addEventListener("pointerdown",r):(this.target.addEventListener("touchstart",r),this.target.addEventListener("mousedown",r))}}detach(){window.PointerEvent?(this.target.removeEventListener("pointerdown",this._boundHandle),this.target.removeEventListener("pointerup",this._boundHandle),this.target.removeEventListener("pointermove",this._boundHandle),this.target.removeEventListener("pointercancel",this._boundHandle)):(this.target.removeEventListener("touchstart",this._boundHandle),this.target.removeEventListener("touchend",this._boundHandle),this.target.removeEventListener("touchmove",this._boundHandle),this.target.removeEventListener("touchcancel",this._boundHandle),this.target.removeEventListener("mousedown",this._boundHandle),this.target.removeEventListener("mouseup",this._boundHandle),this.target.removeEventListener("mousemove",this._boundHandle)),"onwheel"in document.createElement("div")?this.target.removeEventListener("wheel",this._boundWheel):document.onmousewheel!==void 0?this.target.addEventListener("mousewheel",this._boundWheel):this.target.addEventListener("MozMousePixelScroll",this._boundWheel)}_normalizePointerId(t){this._activeNativePointerIdsToNormalized.set(t,-1);const i=Array.from(this._activeNativePointerIdsToNormalized.keys()).sort((s,r)=>s-r).findIndex(s=>s===t);return this._activeNativePointerIdsToNormalized.set(t,i),i}_handle(t){if(!this._enabled)return;t.preventDefault();const e=new Map;let i,s;if(Ca(t)){i=xi.Unknown,s=bi.Touch;for(let r=0;r<t.changedTouches.length;r++){const o=t.changedTouches[r],a=sr.fromPagePosition(o.pageX,o.pageY,this.engine),u=r+1,T=this._normalizePointerId(u);this.currentFramePointerCoords.set(T,a),e.set(T,a)}}else{i=this._nativeButtonToPointerButton(t.button),s=bi.Mouse;const r=sr.fromPagePosition(t.pageX,t.pageY,this.engine);let o=1;Ia(t)&&(o=t.pointerId,s=this._stringToPointerType(t.pointerType));const a=this._normalizePointerId(o);this.currentFramePointerCoords.set(a,r),e.set(a,r)}for(const[r,o]of e.entries())switch(t.type){case"mousedown":case"pointerdown":case"touchstart":this.currentFrameDown.push(new Ds("down",r,i,s,o,t)),this.currentFramePointerDown.set(r,!0);break;case"mouseup":case"pointerup":case"touchend":this.currentFrameUp.push(new Ds("up",r,i,s,o,t)),this.currentFramePointerDown.set(r,!1);break;case"mousemove":case"pointermove":case"touchmove":this.currentFrameMove.push(new Ds("move",r,i,s,o,t));break;case"touchcancel":case"pointercancel":this.currentFrameCancel.push(new Ds("cancel",r,i,s,o,t));break}}_handleWheel(t){if(!this._enabled)return;(this.engine.pageScrollPreventionMode===Gi.All||this.engine.pageScrollPreventionMode===Gi.Canvas&&t.target===this.engine.canvas)&&t.preventDefault();const e=this.engine.screen.pageToScreenCoordinates(A(t.pageX,t.pageY)),i=this.engine.screen.screenToWorldCoordinates(e),s=-1/40,r=t.deltaX||t.wheelDeltaX*s||0,o=t.deltaY||t.wheelDeltaY*s||t.wheelDelta*s||t.detail||0,a=t.deltaZ||0;let u=rs.Pixel;t.deltaMode&&(t.deltaMode===1?u=rs.Line:t.deltaMode===2&&(u=rs.Page));const T=new cn(i.x,i.y,t.pageX,t.pageY,e.x,e.y,0,r,o,a,u,t);this.currentFrameWheel.push(T)}triggerEvent(t,e){const i=this.engine.screen.worldToPageCoordinates(e);window.PointerEvent?this._handle(new window.PointerEvent("pointer"+t,{pointerId:0,clientX:i.x,clientY:i.y})):this._handle(new window.MouseEvent("mouse"+t,{clientX:i.x,clientY:i.y}));const s=this.engine.currentScene.world.get(Qr);s.preupdate(this.engine.currentScene,1),s.update(1)}_nativeButtonToPointerButton(t){switch(t){case Di.NoButton:return xi.NoButton;case Di.Left:return xi.Left;case Di.Middle:return xi.Middle;case Di.Right:return xi.Right;case Di.Unknown:return xi.Unknown;default:return lt(t)}}_stringToPointerType(t){switch(t){case"touch":return bi.Touch;case"mouse":return bi.Mouse;case"pen":return bi.Pen;default:return bi.Unknown}}}class un{constructor(t){this._enabled=!0;const{pointerTarget:e,grabWindowFocus:i,engine:s}=t;this.keyboard=new hn,this.pointers=new rr(e,s),this.gamepads=new er,this.keyboard.init({grabWindowFocus:i}),this.pointers.init({grabWindowFocus:i}),this.gamepads.init(),this.inputMapper=new vo({keyboard:this.keyboard,pointers:this.pointers,gamepads:this.gamepads})}get enabled(){return this._enabled}toggleEnabled(t){this._enabled=t,this.keyboard.toggleEnabled(this._enabled),this.pointers.toggleEnabled(this._enabled),this.gamepads.toggleEnabled(this._enabled)}update(){this._enabled&&(this.inputMapper.execute(),this.keyboard.update(),this.gamepads.update())}}class Ea{}const Ba={Initialize:"initialize",Activate:"activate",Deactivate:"deactivate",PreUpdate:"preupdate",PostUpdate:"postupdate",PreDraw:"predraw",PostDraw:"postdraw",PreDebugDraw:"predebugdraw",PostDebugDraw:"postdebugdraw",PreLoad:"preload"};function Ni(n){var t,e;return!!(n!=null&&n.prototype)&&!!(!((e=(t=n==null?void 0:n.prototype)===null||t===void 0?void 0:t.constructor)===null||e===void 0)&&e.name)}class Ai{get actors(){return this.world.entityManager.entities.filter(t=>t instanceof Ye)}get entities(){return this.world.entityManager.entities}get triggers(){return this.world.entityManager.entities.filter(t=>t instanceof io)}get tileMaps(){return this.world.entityManager.entities.filter(t=>t instanceof Yn)}get timers(){return this._timers}constructor(){this._logger=I.getInstance(),this.events=new k,this.camera=new eo,this.world=new ao(this),this.physics=new mo(_i),this._isInitialized=!1,this._timers=[],this._cancelQueue=[],this.world.add(po),this.world.add(new lo(this.world,this.physics)),this.world.add(new ln(this.world,this.physics)),this.world.add(Qr),this.world.add(fo),this.world.add(_o),this.world.add(Ao),this.world.add(go)}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}onPreLoad(t){}onTransition(t){}onInitialize(t){}onActivate(t){}onDeactivate(t){}onPreUpdate(t,e){}onPostUpdate(t,e){}onPreDraw(t,e){}onPostDraw(t,e){}_initializeChildren(){for(const t of this.entities)t._initialize(this.engine)}get isInitialized(){return this._isInitialized}async _initialize(t){var e;if(!this.isInitialized){try{this.engine=t,this.physics.config=this.engine.physics,this.input=new un({pointerTarget:t.pointerScope===b.Canvas?t.canvas:document,grabWindowFocus:t.grabWindowFocus,engine:t}),this.camera._initialize(t),this.world.systemManager.initialize(),await this.onInitialize(t),this._initializeChildren(),this._logger.debug("Scene.onInitialize",this,t),this.events.emit("initialize",new ys(t,this))}catch(i){throw this._logger.error(`Error during scene initialization for scene ${(e=t.director)===null||e===void 0?void 0:e.getSceneName(this)}!`),i}this._isInitialized=!0}}async _activate(t){var e,i;try{this._logger.debug("Scene.onActivate",this),this.input.toggleEnabled(!0),await this.onActivate(t)}catch(s){throw this._logger.error(`Error during scene activation for scene ${(i=(e=this.engine)===null||e===void 0?void 0:e.director)===null||i===void 0?void 0:i.getSceneName(this)}!`),s}}async _deactivate(t){this._logger.debug("Scene.onDeactivate",this),this.input.toggleEnabled(!1),await this.onDeactivate(t)}_preupdate(t,e){this.emit("preupdate",new ai(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.emit("postupdate",new li(t,e,this)),this.onPostUpdate(t,e)}_predraw(t,e){this.emit("predraw",new Ti(t,e,this)),this.onPreDraw(t,e)}_postdraw(t,e){this.emit("postdraw",new Si(t,e,this)),this.onPostDraw(t,e)}update(t,e){var i;if(!this.isInitialized){this._logger.warnOnce(`Scene update called before initialize for scene ${(i=t.director)===null||i===void 0?void 0:i.getSceneName(this)}!`);return}this._preupdate(t,e);let s,r;for(s=0,r=this._cancelQueue.length;s<r;s++)this.removeTimer(this._cancelQueue[s]);this._cancelQueue.length=0;for(const o of this._timers)o.update(e);this.world.update(qe.Update,e),this.camera&&this.camera.update(t,e),this._collectActorStats(t),this._postupdate(t,e),this.input.update()}draw(t,e){var i;if(!this.isInitialized){this._logger.warnOnce("Scene draw called before initialize!");return}this._predraw(t,e),this.world.update(qe.Draw,e),!((i=this.engine)===null||i===void 0)&&i.isDebug&&this.debugDraw(t),this._postdraw(t,e)}debugDraw(t){this.emit("predebugdraw",new vs(t,this)),this.emit("postdebugdraw",new ws(t,this))}contains(t){return this.actors.indexOf(t)>-1}add(t){if(this.emit("entityadded",{target:t}),this.world.add(t),t.scene=this,t instanceof ss){m(this._timers,t)||this.addTimer(t);return}}transfer(t){let e;t instanceof Fe&&t.scene&&t.scene!==this&&(e=t.scene,t.scene.world.remove(t,!1)),t instanceof ss&&t.scene&&(e=t.scene,t.scene.removeTimer(t)),e==null||e.emit("entityremoved",{target:t}),this.add(t)}remove(t){t instanceof Fe&&(this.emit("entityremoved",{target:t}),t.active&&t.kill(),this.world.remove(t)),t instanceof ss&&this.removeTimer(t)}clear(t=!0){for(let e=this.entities.length-1;e>=0;e--)this.world.remove(this.entities[e],t);for(let e=this.timers.length-1;e>=0;e--)this.removeTimer(this.timers[e])}addTimer(t){return this._timers.push(t),t.scene=this,t}removeTimer(t){const e=this._timers.indexOf(t);return e!==-1&&this._timers.splice(e,1),t}cancelTimer(t){return this._cancelQueue.push(t),t}isTimerActive(t){return this._timers.indexOf(t)>-1&&!t.complete}isCurrentScene(){return this.engine?this.engine.currentScene===this:!1}_collectActorStats(t){const e=this.actors.filter(i=>i instanceof nn);for(const i of e)t.stats.currFrame.actors.ui++;for(const i of this.actors){t.stats.currFrame.actors.alive++;for(const s of i.children)Zn(s)?t.stats.currFrame.actors.ui++:t.stats.currFrame.actors.alive++}}}var ns;(function(n){n.Protanope="Protanope",n.Deuteranope="Deuteranope",n.Tritanope="Tritanope"})(ns||(ns={}));const Ta=`#version 300 es\r
precision mediump float;\r
// our texture\r
uniform sampler2D u_image;\r
// the texCoords passed in from the vertex shader.\r
in vec2 v_texcoord;\r
\r
// color blind type\r
uniform int u_type;\r
\r
// simulation?\r
uniform bool u_simulate;\r
\r
out vec4 fragColor;\r
\r
void main() {\r
  vec4 o =  texture(u_image, v_texcoord);\r
  // RGB to LMS matrix conversion\r
  float L = (17.8824 * o.r) + (43.5161 * o.g) + (4.11935 * o.b);\r
  float M = (3.45565 * o.r) + (27.1554 * o.g) + (3.86714 * o.b);\r
  float S = (0.0299566 * o.r) + (0.184309 * o.g) + (1.46709 * o.b);\r
  // Simulate color blindness\r
  float l;\r
  float m;\r
  float s;\r
  //MODE CODE//\r
  if (u_type == 0) {\r
    // Protanope\r
    l = 0.0 * L + 2.02344 * M + -2.52581 * S;\r
    m = 0.0 * L + 1.0 * M + 0.0 * S;\r
    s = 0.0 * L + 0.0 * M + 1.0 * S;;\r
  } else if (u_type == 1) {\r
    // Deuteranope\r
    l = 1.0 * L + 0.0 * M + 0.0 * S;\r
    m = 0.494207 * L + 0.0 * M + 1.24827 * S;\r
    s = 0.0 * L + 0.0 * M + 1.0 * S;\r
  } else if (u_type == 2) {\r
    // Tritanope\r
    l = 1.0 * L + 0.0 * M + 0.0 * S;\r
    m = 0.0 * L + 1.0 * M + 0.0 * S;\r
    s = -0.395913 * L + 0.801109 * M + 0.0 * S;\r
  }\r
\r
  // LMS to RGB matrix conversion\r
  vec4 error; // simulate the colors\r
  error.r = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s);\r
  error.g = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s);\r
  error.b = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);\r
  error.a = 1.0;\r
  vec4 diff = o - error;\r
  vec4 correction; // correct the colors\r
  correction.r = 0.0;\r
  correction.g =  (diff.r * 0.7) + (diff.g * 1.0);\r
  correction.b =  (diff.r * 0.7) + (diff.b * 1.0);\r
  correction = o + correction;\r
  correction.a = o.a;\r
  //SIMULATE//\r
\r
  // sim \r
  if (u_simulate) {\r
    fragColor = error.rgba;\r
  } else {\r
    fragColor = correction.rgba;\r
  }\r
}`;class yo{constructor(t,e){this._shader=new Ae({gl:t,vertexSource:`#version 300 es
      in vec2 a_position;
      in vec2 a_texcoord;
      out vec2 v_texcoord;

      void main() {
        gl_Position = vec4(a_position, 0.0, 1.0);
        // Pass the texcoord to the fragment shader.
        v_texcoord = a_texcoord;
      }`,fragmentSource:e}),this._shader.compile(),this._buffer=new ke({gl:t,type:"static",data:new Float32Array([-1,-1,0,0,-1,1,0,1,1,-1,1,0,1,-1,1,0,-1,1,0,1,1,1,1,1])}),this._layout=new xe({gl:t,shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_texcoord",2]]}),this._buffer.upload()}getShader(){return this._shader}getLayout(){return this._layout}}class xo{constructor(t,e=!1){this._colorBlindnessMode=t,this._simulate=!1,this._simulate=e}initialize(t){this._shader=new yo(t,Ta),this.simulate=this._simulate,this.colorBlindnessMode=this._colorBlindnessMode}getShader(){return this._shader.getShader()}getLayout(){return this._shader.getLayout()}set colorBlindnessMode(t){if(this._colorBlindnessMode=t,this._shader){const e=this._shader.getShader();e.use(),this._colorBlindnessMode===ns.Protanope?e.setUniformInt("u_type",0):this._colorBlindnessMode===ns.Deuteranope?e.setUniformInt("u_type",1):this._colorBlindnessMode===ns.Tritanope&&e.setUniformInt("u_type",2)}}get colorBlindnessMode(){return this._colorBlindnessMode}set simulate(t){if(this._simulate=t,this._shader){const e=this._shader.getShader();e.use(),e.setUniformBoolean("u_simulate",t)}}get simulate(){return this._simulate}}class bo{constructor(t){this._engine=t,this._colorBlindPostProcessor=new xo(ns.Protanope)}correct(t){this._engine.graphicsContext instanceof ni&&(this.clear(),this._colorBlindPostProcessor.colorBlindnessMode=t,this._colorBlindPostProcessor.simulate=!1,this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor))}simulate(t){this._engine.graphicsContext instanceof ni&&(this.clear(),this._colorBlindPostProcessor.colorBlindnessMode=t,this._colorBlindPostProcessor.simulate=!0,this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor))}clear(){this._engine.graphicsContext.removePostProcessor(this._colorBlindPostProcessor)}}class Co{constructor(t){this.stats={currFrame:new nr,prevFrame:new nr},this.filter={useFilter:!1,nameQuery:"",ids:[]},this.entity={showAll:!1,showId:!1,showName:!1},this.transform={showAll:!1,debugZIndex:1e7,showPosition:!1,showPositionLabel:!1,positionColor:p.Yellow,showZIndex:!1,showScale:!1,scaleColor:p.Green,showRotation:!1,rotationColor:p.Blue},this.graphics={showAll:!1,showBounds:!1,boundsColor:p.Yellow},this.collider={showAll:!1,showBounds:!1,boundsColor:p.Blue,showOwner:!1,showGeometry:!0,geometryColor:p.Green,geometryLineWidth:1,geometryPointSize:.5},this.physics={showAll:!1,showBroadphaseSpacePartitionDebug:!1,showCollisionNormals:!1,collisionNormalColor:p.Cyan,showCollisionContacts:!0,contactSize:2,collisionContactColor:p.Red},this.motion={showAll:!1,showVelocity:!1,velocityColor:p.Yellow,showAcceleration:!1,accelerationColor:p.Red},this.body={showAll:!1,showCollisionGroup:!1,showCollisionType:!1,showSleeping:!1,showMotion:!1,showMass:!1},this.camera={showAll:!1,showFocus:!1,focusColor:p.Red,showZoom:!1},this.tilemap={showAll:!1,showGrid:!1,gridColor:p.Red,gridWidth:.5,showSolidBounds:!1,solidBoundsColor:p.fromHex("#8080807F"),showColliderGeometry:!0},this.isometric={showAll:!1,showPosition:!1,positionColor:p.Yellow,positionSize:1,showGrid:!1,gridColor:p.Red,gridWidth:1,showColliderGeometry:!0},this._engine=t,this.colorBlindMode=new bo(this._engine)}useTestClock(){const t=this._engine.clock,e=t.isRunning();t.stop();const i=t.toTestClock();return e&&i.start(),this._engine.clock=i,i}useStandardClock(){const t=this._engine.clock,e=t.isRunning();t.stop();const i=t.toStandardClock();return e&&i.start(),this._engine.clock=i,i}}class nr{constructor(){this._id=0,this._delta=0,this._fps=0,this._actorStats={alive:0,killed:0,ui:0,get remaining(){return this.alive-this.killed},get total(){return this.remaining+this.ui}},this._durationStats={update:0,draw:0,get total(){return this.update+this.draw}},this._physicsStats=new Pr,this._graphicsStats={drawCalls:0,drawnImages:0}}reset(t){t?(this.id=t.id,this.delta=t.delta,this.fps=t.fps,this.actors.alive=t.actors.alive,this.actors.killed=t.actors.killed,this.actors.ui=t.actors.ui,this.duration.update=t.duration.update,this.duration.draw=t.duration.draw,this._physicsStats.reset(t.physics),this.graphics.drawCalls=t.graphics.drawCalls,this.graphics.drawnImages=t.graphics.drawnImages):(this.id=this.delta=this.fps=0,this.actors.alive=this.actors.killed=this.actors.ui=0,this.duration.update=this.duration.draw=0,this._physicsStats.reset(),this.graphics.drawnImages=this.graphics.drawCalls=0)}clone(){const t=new nr;return t.reset(this),t}get id(){return this._id}set id(t){this._id=t}get delta(){return this._delta}set delta(t){this._delta=t}get fps(){return this._fps}set fps(t){this._fps=t}get actors(){return this._actorStats}get duration(){return this._durationStats}get physics(){return this._physicsStats}get graphics(){return this._graphicsStats}}class Pr{constructor(){this._pairs=0,this._collisions=0,this._contacts=new Map,this._fastBodies=0,this._fastBodyCollisions=0,this._broadphase=0,this._narrowphase=0}reset(t){t?(this.pairs=t.pairs,this.collisions=t.collisions,this.contacts=t.contacts,this.fastBodies=t.fastBodies,this.fastBodyCollisions=t.fastBodyCollisions,this.broadphase=t.broadphase,this.narrowphase=t.narrowphase):(this.pairs=this.collisions=this.fastBodies=0,this.fastBodyCollisions=this.broadphase=this.narrowphase=0,this.contacts.clear())}clone(){const t=new Pr;return t.reset(this),t}get pairs(){return this._pairs}set pairs(t){this._pairs=t}get collisions(){return this._collisions}set collisions(t){this._collisions=t}get contacts(){return this._contacts}set contacts(t){this._contacts=t}get fastBodies(){return this._fastBodies}set fastBodies(t){this._fastBodies=t}get fastBodyCollisions(){return this._fastBodyCollisions}set fastBodyCollisions(t){this._fastBodyCollisions=t}get broadphase(){return this._broadphase}set broadphase(t){this._broadphase=t}get narrowphase(){return this._narrowphase}set narrowphase(t){this._narrowphase=t}}class An{on(t,e){this._nativeHandlers[t]&&this.off(t,this._nativeHandlers[t]),this._nativeHandlers[t]=this._decorate(e),this.nativeComponent.addEventListener(t,this._nativeHandlers[t])}off(t,e){e||(e=this._nativeHandlers[t]),this.nativeComponent.removeEventListener(t,e),this._nativeHandlers[t]=null}_decorate(t){return e=>{this._paused||t(e)}}pause(){this._paused=!0}resume(){this._paused=!1}clear(){for(const t in this._nativeHandlers)this.off(t)}constructor(t){this.nativeComponent=t,this._paused=!1,this._nativeHandlers={}}}class Io{constructor(t,e){this._windowGlobal=t,this._documentGlobal=e,this._windowComponent=new An(this._windowGlobal),this._documentComponent=new An(this._documentGlobal)}get window(){return this._windowComponent}get document(){return this._documentComponent}pause(){this.window.pause(),this.document.pause()}resume(){this.window.resume(),this.document.resume()}clear(){this.window.clear(),this.document.clear()}}const Eo={pixelArtSampler:!1,nativeContextAntialiasing:!1,multiSampleAntialiasing:!0,filtering:F.Blended,canvasImageRendering:"auto"},Bo={pixelArtSampler:!0,nativeContextAntialiasing:!1,multiSampleAntialiasing:!0,filtering:F.Blended,canvasImageRendering:"auto"};class To{constructor(t){var e;this._samplePeriod=100,this._currentFrameTime=0,this._frames=0,this._previousSampleTime=0,this._beginFrameTime=0,this._fps=t.initialFps,this._samplePeriod=(e=t.samplePeriod)!==null&&e!==void 0?e:this._samplePeriod,this._currentFrameTime=1e3/t.initialFps,this._nowFn=t.nowFn,this._previousSampleTime=this._nowFn()}start(){this._beginFrameTime=this._nowFn()}end(){this._frames++;const t=this._nowFn();this._currentFrameTime=t-this._beginFrameTime,t>=this._previousSampleTime+this._samplePeriod&&(this._fps=this._frames*1e3/(t-this._previousSampleTime),this._previousSampleTime=t,this._frames=0)}get fps(){return this._fps}get instant(){return 1e3/this._currentFrameTime}}class gn{constructor(t){var e,i,s;this._onFatalException=()=>{},this._maxFps=1/0,this._lastTime=0,this._elapsed=1,this._scheduledCbs=[],this._totalElapsed=0,this._options=t,this.tick=t.tick,this._lastTime=(e=this.now())!==null&&e!==void 0?e:0,this._maxFps=(i=t.maxFps)!==null&&i!==void 0?i:this._maxFps,this._onFatalException=(s=t.onFatalException)!==null&&s!==void 0?s:this._onFatalException,this.fpsSampler=new To({initialFps:60,nowFn:()=>this.now()})}elapsed(){return this._elapsed}now(){return performance.now()}toTestClock(){return new So({...this._options,defaultUpdateMs:16.6})}toStandardClock(){return new pn({...this._options})}setFatalExceptionHandler(t){this._onFatalException=t}schedule(t,e=0,i="preframe"){const s=this._totalElapsed+e;this._scheduledCbs.push([t,s,i])}__runScheduledCbs(t="preframe"){for(let e=this._scheduledCbs.length-1;e>-1;e--)t===this._scheduledCbs[e][2]&&this._scheduledCbs[e][1]<=this._totalElapsed&&(this._scheduledCbs[e][0](this._elapsed),this._scheduledCbs.splice(e,1))}update(t){try{this.fpsSampler.start();const e=this.now();let i=e-this._lastTime||1;const s=1e3/this._maxFps;if(i>=s){let r=0;s!==0&&(r=i%s,i=i-r),i>200&&(i=1),this._elapsed=t||i,this._totalElapsed+=this._elapsed,this.__runScheduledCbs("preframe"),this.tick(t||i),this.__runScheduledCbs("postframe"),s!==0?this._lastTime=e-r:this._lastTime=e,this.fpsSampler.end()}}catch(e){this._onFatalException(e),this.stop()}}}class pn extends gn{constructor(t){super(t),this._running=!1}isRunning(){return this._running}start(){if(this._running)return;this._running=!0;const t=()=>{if(this._running)try{this._requestId=window.requestAnimationFrame(t),this.update()}catch(e){throw window.cancelAnimationFrame(this._requestId),e}};t()}stop(){window.cancelAnimationFrame(this._requestId),this._running=!1}}class So extends gn{constructor(t){super({...t}),this._logger=I.getInstance(),this._running=!1,this._currentTime=0,this._updateMs=t.defaultUpdateMs}now(){var t;return(t=this._currentTime)!==null&&t!==void 0?t:0}isRunning(){return this._running}start(){this._running=!0}stop(){this._running=!1}step(t){const e=t??this._updateMs;this._running?(this.update(e),this._currentTime+=e):this._logger.warn("The clock is not running, no step will be performed")}run(t,e){for(let i=0;i<t;i++)this.step(e??this._updateMs)}}var Sa=fe(4296);class ko{constructor(){this._toasterCss=Sa.A.toString(),this._isInitialized=!1}_initialize(){this._isInitialized||(this._container=document.createElement("div"),this._container.id="ex-toast-container",document.body.appendChild(this._container),this._isInitialized=!0,this._styleBlock=document.createElement("style"),this._styleBlock.textContent=this._toasterCss,document.head.appendChild(this._styleBlock))}dispose(){this._container.parentElement.removeChild(this._container),this._styleBlock.parentElement.removeChild(this._styleBlock),this._isInitialized=!1}_createFragment(t){const e=document.createElement("span");return e.innerText=t,e}toast(t,e,i){this._initialize();const s=document.createElement("div");s.className="ex-toast-message";const r=t.split("[LINK]").map(P=>this._createFragment(P));if(e){const P=document.createElement("a");P.href=e,i?P.innerText=i:P.innerText=e,r.splice(1,0,P)}const o=document.createElement("div");r.forEach(P=>{o.appendChild(P)}),s.appendChild(o);const a=document.createElement("button");a.innerText="x",a.addEventListener("click",()=>{this._container.removeChild(s)}),s.appendChild(a);const u=P=>{if(P.key==="Escape")try{this._container.removeChild(s)}catch{}document.removeEventListener("keydown",u)};document.addEventListener("keydown",u);const T=this._container.firstChild;this._container.insertBefore(s,T)}}const ka={NavigationStart:"navigationstart",Navigation:"navigation",NavigationEnd:"navigationend"};class Do{get isTransitioning(){return this._isTransitioning}constructor(t,e){this._engine=t,this.events=new k,this._logger=I.getInstance(),this._initialized=!1,this.scenes={},this._sceneToInstance=new Map,this._sceneToLoader=new Map,this._sceneToTransition=new Map,this._loadedScenes=new Set,this._isTransitioning=!1,this.rootScene=this.currentScene=new Ai,this.add("root",this.rootScene),this.currentScene=this.rootScene,this.currentSceneName="root";for(const i in e){const s=e[i];this.add(i,s),i==="root"&&(this.rootScene=this.getSceneInstance("root"),this.currentScene=this.rootScene)}}async onInitialize(){if(!this._initialized)if(this._initialized=!0,this._deferredGoto){const t=this._deferredGoto,e=this._deferredTransition;this._deferredGoto=null,this._deferredTransition=null,await this.swapScene(t),e&&await this.playTransition(e)}else await this.swapScene("root")}get isInitialized(){return this._initialized}configureStart(t,e){const i=e==null?void 0:e.loader;i instanceof Zs?this.mainLoader=i:Yr(i)?this.mainLoader=new i:this.mainLoader=new Ji;let s;if(e){const{inTransition:r}=e;s=r}this.startScene=t,s?this.swapScene(this.startScene).then(()=>{this.playTransition(s)}):this.swapScene(this.startScene),this.currentSceneName=this.startScene}_getLoader(t){return this._sceneToLoader.get(t)}_getInTransition(t){var e;const i=this.scenes[t];return i instanceof Ai||Ni(i)?null:(e=i==null?void 0:i.transitions)===null||e===void 0?void 0:e.in}_getOutTransition(t){var e;const i=this.scenes[t];return i instanceof Ai||Ni(i)?null:(e=i==null?void 0:i.transitions)===null||e===void 0?void 0:e.out}getDeferredScene(){const t=this.getSceneDefinition(this._deferredGoto);return this._deferredGoto&&t?t:null}getSceneDefinition(t){const e=this.scenes[t];if(e instanceof Ai||Ni(e))return e;if(e)return e.scene}getSceneName(t){for(const[e,i]of this._sceneToInstance)if(t===i)return e;return"unknown scene name"}assertAdded(t){return this}assertRemoved(t){return this}add(t,e){if(!(e instanceof Ai)&&!Ni(e)){const{loader:i,transitions:s}=e,{in:r,out:o}=s??{};this._sceneToTransition.set(t,{in:r,out:o}),Yr(i)?this._sceneToLoader.set(t,new i):this._sceneToLoader.set(t,i)}return this.scenes[t]&&this._logger.warn("Scene",t,"already exists overwriting"),this.scenes[t]=e,this.assertAdded(t)}remove(t){if(t instanceof Ai||Ni(t)){const e=t;for(const i in this.scenes)if(this.scenes.hasOwnProperty(i)){const s=this.scenes[i];let r;if(s instanceof Ai||Ni(s)?r=s:r=s.scene,r===e){if(i===this.currentSceneName)throw new Error(`Cannot remove a currently active scene: ${i}`);this._sceneToInstance.delete(i),this._sceneToTransition.delete(i),this._sceneToLoader.delete(i),delete this.scenes[i]}}}if(typeof t=="string"){if(t===this.currentSceneName)throw new Error(`Cannot remove a currently active scene: ${t}`);this._sceneToInstance.delete(t),this._sceneToTransition.delete(t),this._sceneToLoader.delete(t),delete this.scenes[t]}}async goto(t,e){var i,s,r,o,a,u;const T=this.getSceneInstance(t);if(!T){this._logger.warn(`Scene ${t} does not exist! Check the name, are you sure you added it?`);return}const P=this.currentSceneName,N=(s=(i=this._engine.input)===null||i===void 0?void 0:i.enabled)!==null&&s!==void 0?s:!0;this._isTransitioning=!0;const J=(r=this.getSceneInstance(P))===null||r===void 0?void 0:r.onTransition("out"),nt=T==null?void 0:T.onTransition("in");e={sourceOut:(o=this._getOutTransition(this.currentSceneName))!==null&&o!==void 0?o:J,destinationIn:(a=this._getInTransition(t))!==null&&a!==void 0?a:nt,...e};const{sourceOut:at,destinationIn:xt,sceneActivationData:Bt}=e,ft=at??this._getOutTransition(this.currentSceneName),_t=xt??this._getInTransition(t),Tt=(ft==null?void 0:ft.hideLoader)||(_t==null?void 0:_t.hideLoader);Tt&&this.maybeLoadScene(t,Tt),this._emitEvent("navigationstart",P,t),await this.playTransition(ft),await this.maybeLoadScene(t,Tt),await(_t==null?void 0:_t.onPreviousSceneDeactivate(this.currentScene)),await this.swapScene(t,Bt),this._emitEvent("navigation",P,t),await this.playTransition(_t),this._emitEvent("navigationend",P,t),(u=this._engine.input)===null||u===void 0||u.toggleEnabled(N),this._isTransitioning=!1}getSceneInstance(t){const e=this.getSceneDefinition(t);if(!e)return;if(this._sceneToInstance.has(t))return this._sceneToInstance.get(t);if(e instanceof Ai)return this._sceneToInstance.set(t,e),e;const i=new e;return this._sceneToInstance.set(t,i),i}async maybeLoadScene(t,e=!1){var i;const s=(i=this._getLoader(t))!==null&&i!==void 0?i:new Zs,r=this.getSceneDefinition(t),o=this.getSceneInstance(t);r&&o&&!this._loadedScenes.has(o)&&(o.onPreLoad(s),o.events.emit("preload",{loader:s}),e?this._engine.load(s,e):await this._engine.load(s),this._loadedScenes.add(o))}async playTransition(t){var e,i,s,r,o,a,u;if(!this.isInitialized){this._deferredTransition=t;return}if(t){this.currentTransition=t;const T=this._engine.currentScene,P=(i=(e=T.input)===null||e===void 0?void 0:e.enabled)!==null&&i!==void 0?i:!0;(s=T.input)===null||s===void 0||s.toggleEnabled(!t.blockInput),(r=this._engine.input)===null||r===void 0||r.toggleEnabled(!t.blockInput),await this.currentTransition.play(this._engine),(o=T.input)===null||o===void 0||o.toggleEnabled(P)}(a=this.currentTransition)===null||a===void 0||a.kill(),(u=this.currentTransition)===null||u===void 0||u.reset(),this.currentTransition=null}async swapScene(t,e){const i=this._engine;if(!this.isInitialized){this._deferredGoto=t;return}const s=this.getSceneInstance(t);if(s){const r=this.currentScene,o=s;if(this._logger.debug("Going to scene:",t),this.currentScene.isInitialized){const T={engine:i,previousScene:r,nextScene:o};await this.currentScene._deactivate(T),this.currentScene.events.emit("deactivate",new Or(T,this.currentScene))}const a=this._sceneToLoader.get(t);await(a==null?void 0:a.areResourcesLoaded()),this.currentScene=o,this.currentSceneName=t,i.screen.setCurrentCamera(o.camera),await this.currentScene._initialize(i);const u={engine:i,previousScene:r,nextScene:o,data:e};await this.currentScene._activate(u),this.currentScene.events.emit("activate",new zr(u,this.currentScene))}else this._logger.error("Scene",t,"does not exist!")}_emitEvent(t,e,i){const s=this.getSceneDefinition(e),r=this.getSceneDefinition(i);this.events.emit(t,{sourceScene:s,sourceName:e,destinationScene:r,destinationName:i})}}function Da(){const n={scope:(t,e)=>(n.value=t,e()),value:void 0};return n}function Qa(n){return n.value}Z();const Pa={FallbackGraphicsContext:"fallbackgraphicscontext",Initialize:"initialize",Visible:"visible",Hidden:"hidden",Start:"start",Stop:"stop",PreUpdate:"preupdate",PostUpdate:"postupdate",PreFrame:"preframe",PostFrame:"postframe",PreDraw:"predraw",PostDraw:"postdraw"};var Gi;(function(n){n[n.None=0]="None",n[n.Canvas=1]="Canvas",n[n.All=2]="All"})(Gi||(Gi={}));class He{static useEngine(){const t=Qa(He.Context);if(!t)throw new Error("Cannot inject engine with `useEngine()`, `useEngine()` was called outside of Engine lifecycle scope.");return t}get canvasWidth(){return this.screen.canvasWidth}get halfCanvasWidth(){return this.screen.halfCanvasWidth}get canvasHeight(){return this.screen.canvasHeight}get halfCanvasHeight(){return this.screen.halfCanvasHeight}get drawWidth(){return this.screen.drawWidth}get halfDrawWidth(){return this.screen.halfDrawWidth}get drawHeight(){return this.screen.drawHeight}get halfDrawHeight(){return this.screen.halfDrawHeight}get isHiDpi(){return this.screen.isHiDpi}get stats(){return this.debug.stats}get currentScene(){return this.director.currentScene}get currentSceneName(){return this.director.currentSceneName}get rootScene(){return this.director.rootScene}get scenes(){return this.director.scenes}get isFullscreen(){return this.screen.isFullScreen}get displayMode(){return this.screen.displayMode}get pixelRatio(){return this.screen.pixelRatio}get isDebug(){return this._isDebug}get snapToPixel(){return this.graphicsContext.snapToPixel}set snapToPixel(t){this.graphicsContext.snapToPixel=t}emit(t,e){this.events.emit(t,e)}on(t,e){return this.events.on(t,e)}once(t,e){return this.events.once(t,e)}off(t,e){this.events.off(t,e)}constructor(t){var e,i,s,r,o,a,u,T;this.scope=Tt=>He.Context.scope(this,Tt),this.version=yn,this.events=new k,this.maxFps=Number.POSITIVE_INFINITY,this._inputEnabled=!0,this._suppressPlayButton=!1,this.pauseAudioWhenHidden=!0,this._isDebug=!1,this.enableCanvasTransparency=!0,this.onFatalException=Tt=>{I.getInstance().fatal(Tt,Tt.stack)},this._toaster=new ko,this._timescale=1,this._isInitialized=!1,this._originalOptions={},this._handleWebGLContextLost=Tt=>{var Ct;Tt.preventDefault(),this.clock.stop(),this._logger.fatalOnce("WebGL Graphics Lost",Tt);const Rt=document.createElement("div");Rt.id="ex-webgl-graphics-context-lost",Rt.style.position="absolute",Rt.style.zIndex="99",Rt.style.left="50%",Rt.style.top="50%",Rt.style.display="flex",Rt.style.flexDirection="column",Rt.style.transform="translate(-50%, -50%)",Rt.style.backgroundColor="white",Rt.style.padding="10px",Rt.style.borderStyle="solid 1px";const se=document.createElement("div");if(se.innerHTML=`
      <h1>There was an issue rendering, please refresh the page.</h1>
      <div>
        <p>WebGL Graphics Context Lost</p>

        <button id="ex-webgl-graphics-reload">Refresh Page</button>

        <p>There are a few reasons this might happen:</p>
        <ul>
          <li>Two or more pages are placing a high demand on the GPU</li>
          <li>Another page or operation has stalled the GPU and the browser has decided to reset the GPU</li>
          <li>The computer has multiple GPUs and the user has switched between them</li>
          <li>Graphics driver has crashed or restarted</li>
          <li>Graphics driver was updated</li>
        </ul>
      </div>
    `,Rt.appendChild(se),!((Ct=this.canvas)===null||Ct===void 0)&&Ct.parentElement){this.canvas.parentElement.appendChild(Rt);const Dt=se.querySelector("#ex-webgl-graphics-reload");Dt==null||Dt.addEventListener("click",()=>location.reload())}},this._performanceThresholdTriggered=!1,this._fpsSamples=[],this._disposed=!1,this._isLoading=!1,this._hideLoader=!1,this._isReadyFuture=new X,this.currentFrameElapsedMs=0,this.currentFrameLagMs=0,this._lagMs=0,this._screenShotRequests=[],t={...He._DEFAULT_ENGINE_OPTIONS,...t},this._originalOptions=t,Y.freeze(),this.browser=new Io(window,document);const P=new In;if(!t.suppressMinimumBrowserFeatureDetection&&!(this._compatible=P.test())){const Tt=document.createElement("div");if(Tt.innerText="Sorry, your browser does not support all the features needed for Excalibur",document.body.appendChild(Tt),P.failedTests.forEach(function(Ct){const Rt=document.createElement("div");Rt.innerText="Browser feature missing "+Ct,document.body.appendChild(Rt)}),t.canvasElementId){const Ct=document.getElementById(t.canvasElementId);Ct&&Ct.parentElement.removeChild(Ct)}return}else this._compatible=!0;if(console.log&&!t.suppressConsoleBootMessage&&(console.log(`%cPowered by Excalibur.js (v${yn})`,"background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;"),console.log(`
      /| ________________
O|===|* >________________>
      \\|`),console.log("Visit","http://excaliburjs.com","for more information")),t.suppressPlayButton&&(this._suppressPlayButton=!0),this._logger=I.getInstance(),this._logger.defaultLevel===x.Debug&&P.logBrowserFeatures(),this._logger.debug("Building engine..."),this.canvasElementId=t.canvasElementId,t.canvasElementId){if(this._logger.debug("Using Canvas element specified: "+t.canvasElementId),document.getElementById(t.canvasElementId)===null)throw new Error("Cannot find existing element in the DOM, please ensure element is created prior to engine creation.");this.canvas=document.getElementById(t.canvasElementId)}else t.canvasElement?(this._logger.debug("Using Canvas element specified:",t.canvasElement),this.canvas=t.canvasElement):(this._logger.debug("Using generated canvas element"),this.canvas=document.createElement("canvas"));let N=(e=t.displayMode)!==null&&e!==void 0?e:we.Fixed;t.width&&t.height||t.viewport?(t.displayMode===void 0&&(N=we.Fixed),this._logger.debug("Engine viewport is size "+t.width+" x "+t.height)):t.displayMode||(this._logger.debug("Engine viewport is fit"),N=we.FitScreen),this._originalDisplayMode=N;let J,nt,at,xt,Bt,ft;typeof t.antialiasing=="object"?{pixelArtSampler:J,nativeContextAntialiasing:at,multiSampleAntialiasing:ft,filtering:Bt,canvasImageRendering:xt}={...t.pixelArt?Bo:Eo,...t.antialiasing}:(J=!!t.pixelArt,at=!1,ft=t.antialiasing,xt=t.antialiasing?"auto":"pixelated",Bt=t.antialiasing?F.Blended:F.Pixel),at&&ft&&this._logger.warnOnce("Cannot use antialias setting nativeContextAntialiasing and multiSampleAntialiasing at the same time, they are incompatible settings. If you aren't sure use multiSampleAntialiasing"),t.pixelArt&&(nt=.25),(!t.antialiasing||Bt===F.Pixel)&&(nt=0),nt=(s=(i=t.uvPadding)!==null&&i!==void 0?i:nt)!==null&&s!==void 0?s:.01;let _t=Y.isEnabled("use-canvas-context");if(!_t)try{this.graphicsContext=new ni({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,pixelArtSampler:J,antialiasing:at,multiSampleAntialiasing:ft,uvPadding:nt,powerPreference:t.powerPreference,backgroundColor:t.backgroundColor,snapToPixel:t.snapToPixel,useDrawSorting:t.useDrawSorting,handleContextLost:(r=t.handleContextLost)!==null&&r!==void 0?r:this._handleWebGLContextLost,handleContextRestored:t.handleContextRestored})}catch(Tt){this._logger.warn(`Excalibur could not load webgl for some reason (${Tt.message}) and loaded a Canvas 2D fallback. Some features of Excalibur will not work in this mode. 

Read more about this issue at https://excaliburjs.com/docs/performance`),_t=!0}_t&&(this.graphicsContext=new Wi({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,antialiasing:at,backgroundColor:t.backgroundColor,snapToPixel:t.snapToPixel,useDrawSorting:t.useDrawSorting})),this.screen=new us({canvas:this.canvas,context:this.graphicsContext,antialiasing:at,canvasImageRendering:xt,browser:this.browser,viewport:(o=t.viewport)!==null&&o!==void 0?o:t.width&&t.height?{width:t.width,height:t.height}:ds.SVGA,resolution:t.resolution,displayMode:N,pixelRatio:t.suppressHiDPIScaling?1:(a=t.pixelRatio)!==null&&a!==void 0?a:null}),ht.filtering=Bt,t.backgroundColor&&(this.backgroundColor=t.backgroundColor.clone()),this.grabWindowFocus=t.grabWindowFocus,this.pointerScope=t.pointerScope,this.maxFps=(u=t.maxFps)!==null&&u!==void 0?u:this.maxFps,this.fixedUpdateFps=(T=t.fixedUpdateFps)!==null&&T!==void 0?T:this.fixedUpdateFps,this.clock=new pn({maxFps:this.maxFps,tick:this._mainloop.bind(this),onFatalException:Tt=>this.onFatalException(Tt)}),this.enableCanvasTransparency=t.enableCanvasTransparency,typeof t.physics=="boolean"?this.physics={..._i,...$r(),enabled:t.physics}:this.physics={..._i,...$r(),...t.physics},this.debug=new Co(this),this.director=new Do(this,t.scenes),this._initialize(t),window.___EXCALIBUR_DEVTOOL=this,He.InstanceCount++}_monitorPerformanceThresholdAndTriggerFallback(){const{allow:t}=this._originalOptions.configurePerformanceCanvas2DFallback;let{threshold:e,showPlayerMessage:i}=this._originalOptions.configurePerformanceCanvas2DFallback;if(e===void 0&&(e=He._DEFAULT_ENGINE_OPTIONS.configurePerformanceCanvas2DFallback.threshold),i===void 0&&(i=He._DEFAULT_ENGINE_OPTIONS.configurePerformanceCanvas2DFallback.showPlayerMessage),!Y.isEnabled("use-canvas-context")&&t&&this.ready&&!this._performanceThresholdTriggered){this._fpsSamples.length===e.numberOfFrames&&this._fpsSamples.splice(0,1),this._fpsSamples.push(this.clock.fpsSampler.fps);let s=0;for(let o=0;o<this._fpsSamples.length;o++)s+=this._fpsSamples[o];const r=s/this._fpsSamples.length;this._fpsSamples.length===e.numberOfFrames&&r<=e.fps&&(this._performanceThresholdTriggered=!0,this._logger.warn(`Switching to browser 2D Canvas fallback due to performance. Some features of Excalibur will not work in this mode.
this might mean your browser doesn't have webgl enabled or hardware acceleration is unavailable.

If in Chrome:
  * Visit Settings > Advanced > System, and ensure "Use Hardware Acceleration" is checked.
  * Visit chrome://flags/#ignore-gpu-blocklist and ensure "Override software rendering list" is "enabled"
If in Firefox, visit about:config
  * Ensure webgl.disabled = false
  * Ensure webgl.force-enabled = true
  * Ensure layers.acceleration.force-enabled = true

Read more about this issue at https://excaliburjs.com/docs/performance`),i&&this._toaster.toast("Excalibur is encountering performance issues. It's possible that your browser doesn't have hardware acceleration enabled. Visit [LINK] for more information and potential solutions.","https://excaliburjs.com/docs/performance"),this.useCanvas2DFallback(),this.emit("fallbackgraphicscontext",this.graphicsContext))}}useCanvas2DFallback(){var t,e,i;const s=this.canvas.cloneNode(!1);this.canvas.parentNode.replaceChild(s,this.canvas),this.canvas=s;const r={...this._originalOptions,antialiasing:this.getAntialiasing()},o=this._originalDisplayMode;this.graphicsContext=new Wi({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,antialiasing:r.antialiasing,backgroundColor:r.backgroundColor,snapToPixel:r.snapToPixel,useDrawSorting:r.useDrawSorting}),this.screen&&this.screen.dispose(),this.screen=new us({canvas:this.canvas,context:this.graphicsContext,antialiasing:(t=r.antialiasing)!==null&&t!==void 0?t:!0,browser:this.browser,viewport:(e=r.viewport)!==null&&e!==void 0?e:r.width&&r.height?{width:r.width,height:r.height}:ds.SVGA,resolution:r.resolution,displayMode:o,pixelRatio:r.suppressHiDPIScaling?1:(i=r.pixelRatio)!==null&&i!==void 0?i:null}),this.screen.setCurrentCamera(this.currentScene.camera),this.input.pointers.detach();const a=r&&r.pointerScope===b.Document?document:this.canvas;this.input.pointers=this.input.pointers.recreate(a,this),this.input.pointers.init()}dispose(){this._disposed||(this._disposed=!0,this.stop(),this.input.toggleEnabled(!1),this.canvas.parentNode.removeChild(this.canvas),this.canvas=null,this.screen.dispose(),this.graphicsContext.dispose(),this.graphicsContext=null,He.InstanceCount--)}isDisposed(){return this._disposed}getWorldBounds(){return this.screen.getWorldBounds()}get timescale(){return this._timescale}set timescale(t){if(t<=0){I.getInstance().error("Cannot set engine.timescale to a value of 0 or less than 0.");return}this._timescale=t}addTimer(t){return this.currentScene.addTimer(t)}removeTimer(t){return this.currentScene.removeTimer(t)}addScene(t,e){return this.director.add(t,e),this}removeScene(t){this.director.remove(t)}add(t){if(arguments.length===2){this.director.add(arguments[0],arguments[1]);return}const e=this.director.getDeferredScene();e instanceof Ai?e.add(t):this.currentScene.add(t)}remove(t){t instanceof Fe&&this.currentScene.remove(t),(t instanceof Ai||Ni(t))&&this.removeScene(t),typeof t=="string"&&this.removeScene(t)}async goto(t,e){await this.scope(async()=>{await this.director.goto(t,e)})}async goToScene(t,e){await this.scope(async()=>{await this.director.goto(t,e)})}screenToWorldCoordinates(t){return this.screen.screenToWorldCoordinates(t)}worldToScreenCoordinates(t){return this.screen.worldToScreenCoordinates(t)}_initialize(t){var e,i;this.pageScrollPreventionMode=t.scrollPreventionMode;const s=t&&t.pointerScope===b.Document?document:this.canvas,r=(i=(e=this._originalOptions)===null||e===void 0?void 0:e.grabWindowFocus)!==null&&i!==void 0?i:!0;this.input=new un({pointerTarget:s,grabWindowFocus:r,engine:this}),this.inputMapper=this.input.inputMapper,this.browser.document.on("visibilitychange",()=>{document.visibilityState==="hidden"?(this.events.emit("hidden",new mt(this)),this._logger.debug("Window hidden")):document.visibilityState==="visible"&&(this.events.emit("visible",new kt(this)),this._logger.debug("Window visible"))}),!this.canvasElementId&&!t.canvasElement&&document.body.appendChild(this.canvas)}toggleInputEnabled(t){this._inputEnabled=t,this.input.toggleEnabled(this._inputEnabled)}onInitialize(t){}setAntialiasing(t){this.screen.antialiasing=t}getAntialiasing(){return this.screen.antialiasing}get isInitialized(){return this._isInitialized}async _overrideInitialize(t){this.isInitialized||(await this.director.onInitialize(),await this.onInitialize(t),this.events.emit("initialize",new ys(t,this)),this._isInitialized=!0)}_update(t){var e;if(this._isLoading){(e=this._loader)===null||e===void 0||e.onUpdate(this,t),this.input.update();return}this.clock.__runScheduledCbs("preupdate"),this._preupdate(t),this.currentScene.update(this,t),this.graphicsContext.updatePostProcessors(t),this.clock.__runScheduledCbs("postupdate"),this._postupdate(t),this.input.update()}_preupdate(t){this.emit("preupdate",new ai(this,t,this)),this.onPreUpdate(this,t)}onPreUpdate(t,e){}_postupdate(t){this.emit("postupdate",new li(this,t,this)),this.onPostUpdate(this,t)}onPostUpdate(t,e){}_draw(t){var e,i;if(this.graphicsContext.beginDrawLifecycle(),this.graphicsContext.clear(),this.clock.__runScheduledCbs("predraw"),this._predraw(this.graphicsContext,t),this._isLoading){this._hideLoader||((e=this._loader)===null||e===void 0||e.canvas.draw(this.graphicsContext,0,0),this.clock.__runScheduledCbs("postdraw"),this.graphicsContext.flush(),this.graphicsContext.endDrawLifecycle());return}this.graphicsContext.backgroundColor=(i=this.currentScene.backgroundColor)!==null&&i!==void 0?i:this.backgroundColor,this.currentScene.draw(this.graphicsContext,t),this.clock.__runScheduledCbs("postdraw"),this._postdraw(this.graphicsContext,t),this.graphicsContext.flush(),this.graphicsContext.endDrawLifecycle(),this._checkForScreenShots()}_predraw(t,e){this.emit("predraw",new Ti(t,e,this)),this.onPreDraw(t,e)}onPreDraw(t,e){}_postdraw(t,e){this.emit("postdraw",new Si(t,e,this)),this.onPostDraw(t,e)}onPostDraw(t,e){}showDebug(t){this._isDebug=t}toggleDebug(){return this._isDebug=!this._isDebug,this._isDebug}get loadingComplete(){return!this._isLoading}get ready(){return this._isReadyFuture.isCompleted}isReady(){return this._isReadyFuture.promise}async start(t,e){await this.scope(async()=>{if(!this._compatible)throw new Error("Excalibur is incompatible with your browser");this._isLoading=!0;let i;return t instanceof Zs?i=t:typeof t=="string"&&(this.director.configureStart(t,e),i=this.director.mainLoader),this._logger.debug("Starting game clock..."),this.browser.resume(),this.clock.start(),this._logger.debug("Game clock started"),await this.load(i??new Ji),await this._overrideInitialize(this),this._isReadyFuture.resolve(),this.emit("start",new ps(this)),this._isReadyFuture.promise})}_mainloop(t){this.scope(()=>{this.emit("preframe",new j(this,this.stats.prevFrame));const e=t*this.timescale;this.currentFrameElapsedMs=e;const i=this.stats.prevFrame.id+1;this.stats.currFrame.reset(),this.stats.currFrame.id=i,this.stats.currFrame.delta=e,this.stats.currFrame.fps=this.clock.fpsSampler.fps,he.clear();const s=this.clock.now(),r=1e3/this.fixedUpdateFps;if(this.fixedUpdateFps)for(this._lagMs+=e;this._lagMs>=r;)this._update(r),this._lagMs-=r;else this._update(e);const o=this.clock.now();this.currentFrameLagMs=this._lagMs,this._draw(e);const a=this.clock.now();this.stats.currFrame.duration.update=o-s,this.stats.currFrame.duration.draw=a-o,this.stats.currFrame.graphics.drawnImages=he.DrawnImagesCount,this.stats.currFrame.graphics.drawCalls=he.DrawCallCount,this.emit("postframe",new c(this,this.stats.currFrame)),this.stats.prevFrame.reset(this.stats.currFrame),this._monitorPerformanceThresholdAndTriggerFallback()})}stop(){this.clock.isRunning()&&(this.emit("stop",new fs(this)),this.browser.pause(),this.clock.stop(),this._logger.debug("Game stopped"))}isRunning(){return this.clock.isRunning()}screenshot(t=!1){return new Promise(i=>{this._screenShotRequests.push({preserveHiDPIResolution:t,resolve:i})})}_checkForScreenShots(){for(const t of this._screenShotRequests){const e=t.preserveHiDPIResolution?this.canvas.width:this.screen.resolution.width,i=t.preserveHiDPIResolution?this.canvas.height:this.screen.resolution.height,s=document.createElement("canvas");s.width=e,s.height=i;const r=s.getContext("2d");r.imageSmoothingEnabled=this.screen.antialiasing,r.drawImage(this.canvas,0,0,e,i);const o=new Image,a=s.toDataURL("image/png");o.src=a,t.resolve(o)}this._screenShotRequests.length=0}async load(t,e=!1){await this.scope(async()=>{try{if(t.isLoaded())return;this._loader=t,this._isLoading=!0,this._hideLoader=e,t instanceof Ji&&(t.suppressPlayButton=this._suppressPlayButton),this._loader.onInitialize(this),await t.load()}catch(i){this._logger.error("Error loading resources, things may not behave properly",i),await Promise.resolve()}finally{this._isLoading=!1,this._hideLoader=!1,this._loader=null}})}}He.Context=Da(),He.InstanceCount=0,He._DEFAULT_ENGINE_OPTIONS={width:0,height:0,enableCanvasTransparency:!0,useDrawSorting:!0,configurePerformanceCanvas2DFallback:{allow:!1,showPlayerMessage:!1,threshold:{fps:20,numberOfFrames:100}},canvasElementId:"",canvasElement:void 0,snapToPixel:!1,antialiasing:!0,pixelArt:!1,powerPreference:"high-performance",pointerScope:b.Canvas,suppressConsoleBootMessage:null,suppressMinimumBrowserFeatureDetection:null,suppressHiDPIScaling:null,suppressPlayButton:null,grabWindowFocus:!0,scrollPreventionMode:Gi.Canvas,backgroundColor:p.fromHex("#2185d0")};class Fa{constructor(){this._handlers={},this._wiredEventDispatchers=[],this._deferedHandlerRemovals=[]}clear(){this._handlers={},this._wiredEventDispatchers=[]}_processDeferredHandlerRemovals(){for(const t of this._deferedHandlerRemovals)this._removeHandler(t.name,t.handler);this._deferedHandlerRemovals.length=0}emit(t,e){if(this._processDeferredHandlerRemovals(),!t)return;t=t.toLowerCase(),(typeof e>"u"||e===null)&&(e=new te);let i,s;if(this._handlers[t])for(i=0,s=this._handlers[t].length,i;i<s;i++)this._handlers[t][i](e);for(i=0,s=this._wiredEventDispatchers.length,i;i<s;i++)this._wiredEventDispatchers[i].emit(t,e)}on(t,e){this._processDeferredHandlerRemovals(),t=t.toLowerCase(),this._handlers[t]||(this._handlers[t]=[]),this._handlers[t].push(e)}off(t,e){this._deferedHandlerRemovals.push({name:t,handler:e})}_removeHandler(t,e){t=t.toLowerCase();const i=this._handlers[t];if(i)if(!e)this._handlers[t].length=0;else{const s=i.indexOf(e);s>-1&&this._handlers[t].splice(s,1)}}once(t,e){this._processDeferredHandlerRemovals();const i=s=>{const r=s||new te;this.off(t,i),e(r)};this.on(t,i)}wire(t){t._wiredEventDispatchers.push(this)}unwire(t){const e=t._wiredEventDispatchers.indexOf(this);e>-1&&t._wiredEventDispatchers.splice(e,1)}}class Ma extends Ye{get font(){return this._font}set font(t){this._font=t,this._text.font=t}get text(){return this._text.text}set text(t){this._text.text=t}get color(){return this._text.color}set color(t){this._text&&(this._text.color=t)}get opacity(){return this._text.opacity}set opacity(t){this._text.opacity=t}get spriteFont(){return this._spriteFont}set spriteFont(t){t&&(this._spriteFont=t,this._text.font=this._spriteFont)}constructor(t){super(t),this._font=new is,this._text=new Js({text:"",font:this._font});const{text:e,pos:i,x:s,y:r,spriteFont:o,font:a,color:u}={text:"",...t};this.pos=i??(s&&r?A(s,r):this.pos),this.text=e??this.text,this.font=a??this.font,this.spriteFont=o??this.spriteFont,this._text.color=u??this.color;const T=this.get(Ie);T.anchor=h.Zero,T.use(this._text)}_initialize(t){super._initialize(t)}getTextWidth(){return this._text.width}}class Qo extends Fe{getGraphics(){return this._graphics}addGraphic(t,e){this._graphics.push(t),this._gfx.visible=this.map.visible,this._gfx.opacity=this.map.opacity,e!=null&&e.offset&&(this._gfx.offset=e.offset),this._gfx.localBounds=this._recalculateBounds()}_recalculateBounds(){let t=this._tileBounds.clone();for(const e of this._graphics){const i=A(this.map.graphicsOffset.x-this.map.tileWidth/2,this.map.graphicsOffset.y-(this.map.renderFromTopOfGraphic?0:e.height-this.map.tileHeight));t=t.combine(e.localBounds.translate(i))}return t}removeGraphic(t){const e=this._graphics.indexOf(t);e>-1&&this._graphics.splice(e,1),this._gfx.localBounds=this._recalculateBounds()}clearGraphics(){this._graphics.length=0,this._gfx.visible=!1,this._gfx.localBounds=this._recalculateBounds()}getColliders(){return this._colliders}addCollider(t){this._colliders.push(t),this.map.flagCollidersDirty()}removeCollider(t){const e=this._colliders.indexOf(t);e>-1&&this._colliders.splice(e,1),this.map.flagCollidersDirty()}clearColliders(){this._colliders.length=0,this.map.flagCollidersDirty()}get pos(){return this.map.tileToWorld(A(this.x,this.y))}get center(){return this.pos.add(A(0,this.map.tileHeight/2))}constructor(t,e,i,s){super([new Ot,new Ie({offset:i??h.Zero,onPostDraw:(J,nt)=>this.draw(J,nt)}),new tr(s)]),this.solid=!1,this.events=new k,this._tileBounds=new E,this._graphics=[],this._colliders=[],this.data=new Map,this.x=t,this.y=e,this.map=s,this._transform=this.get(Ot),this._isometricEntityComponent=this.get(tr);const r=this.map.tileWidth/2,o=this.map.tileHeight/2,a=(this.x-this.y)*r,u=(this.x+this.y)*o;this._transform.pos=A(a,u),this._isometricEntityComponent.elevation=s.elevation,this._gfx=this.get(Ie),this._gfx.visible=!1;const T=this.map.tileWidth,P=this.map.tileHeight,N=A(0,this.map.renderFromTopOfGraphic?P:0);this._gfx.localBounds=this._tileBounds=new E({left:-T/2,top:-P,right:T/2,bottom:P}).translate(N)}draw(t,e){const i=this.map.tileWidth/2;t.save(),t.translate(-i,0);for(const s of this._graphics)s.draw(t,this.map.graphicsOffset.x,this.map.graphicsOffset.y-(this.map.renderFromTopOfGraphic?0:s.height-this.map.tileHeight));t.restore()}}class La extends Fe{constructor(t){super([new Ot,new Vt({type:$t.Fixed}),new ye,new wi,new Sr((P,N)=>this.debug(P,N),!1)],t.name),this.elevation=0,this.visible=!0,this.opacity=1,this.renderFromTopOfGraphic=!1,this.graphicsOffset=A(0,0),this._forwardPointerEventToTile=P=>N=>{const J=this.getTileByPoint(N.worldPos);J&&J.events.emit(P,N)},this._collidersDirty=!1,this._originalOffsets=new WeakMap;const{pos:e,tileWidth:i,tileHeight:s,columns:r,rows:o,renderFromTopOfGraphic:a,graphicsOffset:u,elevation:T}=t;this.transform=this.get(Ot),e&&(this.transform.pos=e),this.collider=this.get(ye),this.collider&&this.collider.set(this._composite=new De([])),this.pointer=this.get(wi),this.renderFromTopOfGraphic=a??this.renderFromTopOfGraphic,this.graphicsOffset=u??this.graphicsOffset,this.elevation=T??this.elevation,this.tileWidth=i,this.tileHeight=s,this.columns=r,this.rows=o,this.tiles=new Array(r*o);for(let P=0;P<o;P++)for(let N=0;N<r;N++){const J=new Qo(N,P,this.graphicsOffset,this);this.tiles[N+P*r]=J,this.addChild(J)}this.pointer.localBounds=E.fromDimension(i*r*this.transform.scale.x,s*o*this.transform.scale.y,A(.5,0)),this._setupPointerToTile()}_setupPointerToTile(){this.events.on("pointerup",this._forwardPointerEventToTile("pointerup")),this.events.on("pointerdown",this._forwardPointerEventToTile("pointerdown")),this.events.on("pointermove",this._forwardPointerEventToTile("pointermove")),this.events.on("pointercancel",this._forwardPointerEventToTile("pointercancel"))}update(){this._collidersDirty&&(this.updateColliders(),this._collidersDirty=!1)}flagCollidersDirty(){this._collidersDirty=!0}_getOrSetColliderOriginalOffset(t){if(this._originalOffsets.has(t))return this._originalOffsets.get(t);{const e=t.offset;return this._originalOffsets.set(t,e),e}}updateColliders(){this._composite.clearColliders();const t=this.get(Ot).pos;for(const e of this.tiles)if(e.solid)for(const i of e.getColliders()){const s=this._getOrSetColliderOriginalOffset(i);i.offset=this.tileToWorld(A(e.x,e.y)).sub(t).add(s).sub(A(this.tileWidth/2,this.tileHeight)),i.owner=this,this._composite.addCollider(i)}this.collider.update()}worldToTile(t){t=t.sub(this.transform.globalPos);const e=this.tileWidth/2,i=this.tileHeight/2;return A(~~((t.x/e+t.y/i)/2),~~((t.y/i-t.x/e)/2))}tileToWorld(t){const e=this.tileWidth/2,i=this.tileHeight/2,s=(t.x-t.y)*e,r=(t.x+t.y)*i;return A(s,r).add(this.transform.pos)}getTile(t,e){return t<0||e<0||t>=this.columns||e>=this.rows?null:this.tiles[t+e*this.columns]}getTileByPoint(t){const e=this.worldToTile(t);return this.getTile(e.x,e.y)}_getMaxZIndex(){let t=Number.NEGATIVE_INFINITY;for(const e of this.tiles){const i=e.get(Ot).z;i>t&&(t=i)}return t}debug(t,e){const{showAll:i,showPosition:s,positionColor:r,positionSize:o,showGrid:a,gridColor:u,gridWidth:T,showColliderGeometry:P}=e.isometric,{geometryColor:N,geometryLineWidth:J,geometryPointSize:nt}=e.collider;if(t.save(),t.z=this._getMaxZIndex()+.5,i||a){for(let at=0;at<this.rows+1;at++){const xt=this.tileToWorld(A(0,at)),Bt=this.tileToWorld(A(this.columns,at));t.drawLine(xt,Bt,u,T)}for(let at=0;at<this.columns+1;at++){const xt=this.tileToWorld(A(at,0)),Bt=this.tileToWorld(A(at,this.rows));t.drawLine(xt,Bt,u,T)}}if(i||s)for(const at of this.tiles)t.drawCircle(this.tileToWorld(A(at.x,at.y)),o,r);if(i||P){for(const at of this.tiles)if(at.solid)for(const xt of at.getColliders())xt.debug(t,N,{lineWidth:J,pointSize:nt})}t.restore()}}class fn{constructor(t,e){this._stopped=!1,this._sequenceBuilder=e,this._sequenceContext=new Xs(t),this._actionQueue=this._sequenceContext.getQueue(),this._sequenceBuilder(this._sequenceContext)}update(t){this._actionQueue.update(t)}isComplete(){return this._stopped||this._actionQueue.isComplete()}stop(){this._stopped=!0}reset(){this._stopped=!1,this._actionQueue.reset()}clone(t){return new fn(t,this._sequenceBuilder)}}class Ra{constructor(t){this._actions=t}update(t){for(let e=0;e<this._actions.length;e++)this._actions[e].update(t)}isComplete(t){return this._actions.every(e=>e.isComplete(t))}reset(){this._actions.forEach(t=>t.reset())}stop(){this._actions.forEach(t=>t.stop())}}class Qs{constructor(t,e){this.bounds=t,this.options=e,this._defaultOptions={maxDepth:10,capacity:10,level:0},this.items=[],this._isDivided=!1,this.topLeft=null,this.topRight=null,this.bottomLeft=null,this.bottomRight=null,this.options={...this._defaultOptions,...e},this.halfWidth=t.width/2,this.halfHeight=t.height/2}_split(){this._isDivided=!0;const t={maxDepth:this.options.maxDepth,capacity:this.options.capacity,level:this.options.level+1};this.topLeft=new Qs(new E({left:this.bounds.left,top:this.bounds.top,right:this.bounds.left+this.halfWidth,bottom:this.bounds.top+this.halfHeight}),t),this.topRight=new Qs(new E({left:this.bounds.left+this.halfWidth,top:this.bounds.top,right:this.bounds.right,bottom:this.bounds.top+this.halfHeight}),t),this.bottomLeft=new Qs(new E({left:this.bounds.left,top:this.bounds.top+this.halfHeight,right:this.bounds.left+this.halfWidth,bottom:this.bounds.bottom}),t),this.bottomRight=new Qs(new E({left:this.bounds.left+this.halfWidth,top:this.bounds.top+this.halfHeight,right:this.bounds.right,bottom:this.bounds.bottom}),t)}_insertIntoSubNodes(t){var e,i,s,r;!((e=this.topLeft)===null||e===void 0)&&e.bounds.overlaps(t.bounds)&&this.topLeft.insert(t),!((i=this.topRight)===null||i===void 0)&&i.bounds.overlaps(t.bounds)&&this.topRight.insert(t),!((s=this.bottomLeft)===null||s===void 0)&&s.bounds.overlaps(t.bounds)&&this.bottomLeft.insert(t),!((r=this.bottomRight)===null||r===void 0)&&r.bounds.overlaps(t.bounds)&&this.bottomRight.insert(t)}insert(t){if(this._isDivided){this._insertIntoSubNodes(t);return}if(this.items.push(t),this.items.length>this.options.capacity&&this.options.level<this.options.maxDepth){this._isDivided||this._split();for(const e of this.items)this._insertIntoSubNodes(e);this.items.length=0}}remove(t){var e,i,s,r;if(this.bounds.overlaps(t.bounds)){if(!this._isDivided){const o=this.items.indexOf(t);o>-1&&this.items.splice(o,1);return}!((e=this.topLeft)===null||e===void 0)&&e.bounds.overlaps(t.bounds)&&this.topLeft.remove(t),!((i=this.topRight)===null||i===void 0)&&i.bounds.overlaps(t.bounds)&&this.topRight.remove(t),!((s=this.bottomLeft)===null||s===void 0)&&s.bounds.overlaps(t.bounds)&&this.bottomLeft.remove(t),!((r=this.bottomRight)===null||r===void 0)&&r.bounds.overlaps(t.bounds)&&this.bottomRight.remove(t)}}query(t){let e=this.items;return this._isDivided&&(this.topLeft.bounds.overlaps(t)&&(e=e.concat(this.topLeft.query(t))),this.topRight.bounds.overlaps(t)&&(e=e.concat(this.topRight.query(t))),this.bottomLeft.bounds.overlaps(t)&&(e=e.concat(this.bottomLeft.query(t))),this.bottomRight.bounds.overlaps(t)&&(e=e.concat(this.bottomRight.query(t)))),e=e.filter((i,s)=>e.indexOf(i)>=s),e}clear(){this.items=[],this._isDivided=!1,this.topLeft=null,this.topRight=null,this.bottomLeft=null,this.bottomRight=null}getAllItems(){let t=this.items;return this._isDivided&&(t=t.concat(this.topLeft.getAllItems()),t=t.concat(this.topRight.getAllItems()),t=t.concat(this.bottomLeft.getAllItems()),t=t.concat(this.bottomRight.getAllItems())),t=t.filter((e,i)=>t.indexOf(e)>=i),t}getTreeDepth(){return this._isDivided?1+Math.max(this.topLeft.getTreeDepth(),this.topRight.getTreeDepth(),this.bottomLeft.getTreeDepth(),this.bottomRight.getTreeDepth()):0}debug(t){this.bounds.draw(t,p.Yellow),this._isDivided&&(this.topLeft.bounds.draw(t,p.Yellow),this.topRight.bounds.draw(t,p.Yellow),this.bottomLeft.bounds.draw(t,p.Yellow),this.bottomRight.bounds.draw(t,p.Yellow))}}function za(n){return!!n._initialize}function Oa(n){return!!n.onInitialize}function Na(n){return!!n._preupdate}function Ga(n){return!!n.onPreUpdate}function Ua(n){return!!n.onPostUpdate}function ja(n){return!!n.onPostUpdate}function Ha(n){return!!n.onPreDraw}function Wa(n){return!!n.onPostDraw}class Za{constructor(t,e=p.Magenta,i=!1){this.path=t,this.color=e,this._stream=null,this._gif=null,this._textures=[],this._animation=null,this._transparentColor=null,this._resource=new zt(t,"arraybuffer",i),this._transparentColor=e}get bustCache(){return this._resource.bustCache}set bustCache(t){this._resource.bustCache=t}async load(){const t=await this._resource.load();this._stream=new Po(t),this._gif=new Fo(this._stream,this._transparentColor);const e=this._gif.images.map(i=>new vt(i.src,!1));return await Promise.all(e.map(i=>i.load())),this.data=this._textures=e}isLoaded(){return!!this.data}toSprite(t=0){return this._textures[t].toSprite()}toSpriteSheet(){const t=this._textures.map(e=>e.toSprite());return new bt({sprites:t})}toAnimation(t){const e=this.toSpriteSheet(),i=e.sprites.length;return this._animation=vi.fromSpriteSheet(e,L(0,i),t),this._animation}get readCheckBytes(){return this._gif.checkBytes}}const Fr=n=>n.reduce(function(t,e){return t*2+e},0),_n=n=>{const t=[];for(let e=7;e>=0;e--)t.push(!!(n&1<<e));return t};class Po{constructor(t){if(this.data=null,this.len=0,this.position=0,this.readByte=()=>{if(this.position>=this.data.byteLength)throw new Error("Attempted to read past end of stream.");return this.data[this.position++]},this.readBytes=e=>{const i=[];for(let s=0;s<e;s++)i.push(this.readByte());return i},this.read=e=>{let i="";for(let s=0;s<e;s++)i+=String.fromCharCode(this.readByte());return i},this.readUnsigned=()=>{const e=this.readBytes(2);return(e[1]<<8)+e[0]},this.data=new Uint8Array(t),this.len=this.data.byteLength,this.len===0)throw new Error("No data loaded from file")}}const Ya=function(n,t){let e=0;const i=function(J){let nt=0;for(let at=0;at<J;at++)t.charCodeAt(e>>3)&1<<(e&7)&&(nt|=1<<at),e++;return nt},s=[],r=1<<n,o=r+1;let a=n+1,u=[];const T=function(){u=[],a=n+1;for(let J=0;J<r;J++)u[J]=[J];u[r]=[],u[o]=null};let P,N;for(;;){if(N=P,P=i(a),P===r){T();continue}if(P===o)break;if(P<u.length)N!==r&&u.push(u[N].concat(u[P][0]));else{if(P!==u.length)throw new Error("Invalid LZW code.");u.push(u[N].concat(u[N][0]))}s.push.apply(s,u[P]),u.length===1<<a&&a<12&&a++}return s};class Fo{constructor(t,e=p.Magenta){this._st=null,this._handler={},this._transparentColor=null,this.frames=[],this.images=[],this.globalColorTable=[],this.checkBytes=[],this.parseColorTable=i=>{const s=[];for(let r=0;r<i;r++){const a="#"+this._st.readBytes(3).map(u=>{const T=u.toString(16);return T.length===1?"0"+T:T}).join("");s.push(a)}return s},this.readSubBlocks=()=>{let i,s;s="";do i=this._st.readByte(),s+=this._st.read(i);while(i!==0);return s},this.parseHeader=()=>{const i={sig:null,ver:null,width:null,height:null,colorRes:null,globalColorTableSize:null,gctFlag:null,sorted:null,globalColorTable:[],bgColor:null,pixelAspectRatio:null};if(i.sig=this._st.read(3),i.ver=this._st.read(3),i.sig!=="GIF")throw new Error("Not a GIF file.");i.width=this._st.readUnsigned(),i.height=this._st.readUnsigned();const s=_n(this._st.readByte());i.gctFlag=s.shift(),i.colorRes=Fr(s.splice(0,3)),i.sorted=s.shift(),i.globalColorTableSize=Fr(s.splice(0,3)),i.bgColor=this._st.readByte(),i.pixelAspectRatio=this._st.readByte(),i.gctFlag&&(i.globalColorTable=this.parseColorTable(1<<i.globalColorTableSize+1),this.globalColorTable=i.globalColorTable),this._handler.hdr&&this._handler.hdr(i)&&this.checkBytes.push(this._handler.hdr)},this.parseExt=i=>{const s=T=>{this.checkBytes.push(this._st.readByte());const P=_n(this._st.readByte());T.reserved=P.splice(0,3),T.disposalMethod=Fr(P.splice(0,3)),T.userInput=P.shift(),T.transparencyGiven=P.shift(),T.delayTime=this._st.readUnsigned(),T.transparencyIndex=this._st.readByte(),T.terminator=this._st.readByte(),this._handler.gce&&this._handler.gce(T)&&this.checkBytes.push(this._handler.gce)},r=T=>{T.comment=this.readSubBlocks(),this._handler.com&&this._handler.com(T)&&this.checkBytes.push(this._handler.com)},o=T=>{this.checkBytes.push(this._st.readByte()),T.ptHeader=this._st.readBytes(12),T.ptData=this.readSubBlocks(),this._handler.pte&&this._handler.pte(T)&&this.checkBytes.push(this._handler.pte)},a=T=>{const P=J=>{this.checkBytes.push(this._st.readByte()),J.unknown=this._st.readByte(),J.iterations=this._st.readUnsigned(),J.terminator=this._st.readByte(),this._handler.app&&this._handler.app.NETSCAPE&&this._handler.app.NETSCAPE(J)&&this.checkBytes.push(this._handler.app)},N=J=>{J.appData=this.readSubBlocks(),this._handler.app&&this._handler.app[J.identifier]&&this._handler.app[J.identifier](J)&&this.checkBytes.push(this._handler.app[J.identifier])};switch(this.checkBytes.push(this._st.readByte()),T.identifier=this._st.read(8),T.authCode=this._st.read(3),T.identifier){case"NETSCAPE":P(T);break;default:N(T);break}},u=T=>{T.data=this.readSubBlocks(),this._handler.unknown&&this._handler.unknown(T)&&this.checkBytes.push(this._handler.unknown)};switch(i.label=this._st.readByte(),i.label){case 249:i.extType="gce",s(i);break;case 254:i.extType="com",r(i);break;case 1:i.extType="pte",o(i);break;case 255:i.extType="app",a(i);break;default:i.extType="unknown",u(i);break}},this.parseImg=i=>{const s=(a,u)=>{const T=new Array(a.length),P=a.length/u,N=(xt,Bt)=>{const ft=a.slice(Bt*u,(Bt+1)*u);T.splice.apply(T,[xt*u,u].concat(ft))},J=[0,4,2,1],nt=[8,8,4,2];let at=0;for(let xt=0;xt<4;xt++)for(let Bt=J[xt];Bt<P;Bt+=nt[xt])N(Bt,at),at++;return T};i.leftPos=this._st.readUnsigned(),i.topPos=this._st.readUnsigned(),i.width=this._st.readUnsigned(),i.height=this._st.readUnsigned();const r=_n(this._st.readByte());i.lctFlag=r.shift(),i.interlaced=r.shift(),i.sorted=r.shift(),i.reserved=r.splice(0,2),i.lctSize=Fr(r.splice(0,3)),i.lctFlag&&(i.lct=this.parseColorTable(1<<i.lctSize+1)),i.lzwMinCodeSize=this._st.readByte();const o=this.readSubBlocks();i.pixels=Ya(i.lzwMinCodeSize,o),i.interlaced&&(i.pixels=s(i.pixels,i.width)),this.frames.push(i),this.arrayToImage(i),this._handler.img&&this._handler.img(i)&&this.checkBytes.push(this._handler)},this.parseBlock=()=>{const i={sentinel:this._st.readByte(),type:""};switch(String.fromCharCode(i.sentinel)){case"!":i.type="ext",this.parseExt(i);break;case",":i.type="img",this.parseImg(i);break;case";":i.type="eof",this._handler.eof&&this._handler.eof(i)&&this.checkBytes.push(this._handler.eof);break;default:throw new Error("Unknown block: 0x"+i.sentinel.toString(16))}i.type!=="eof"&&this.parseBlock()},this.arrayToImage=i=>{let s=0;const r=document.createElement("canvas");r.id=s.toString(),r.width=i.width,r.height=i.height,s++;const o=r.getContext("2d"),a=1;let u=0,T=0;for(let N=0;N<i.pixels.length;N++)T%i.width===0&&(u++,T=0),this.globalColorTable[i.pixels[N]]===this._transparentColor.toHex()?o.fillStyle="rgba(0, 0, 0, 0)":o.fillStyle=this.globalColorTable[i.pixels[N]],o.fillRect(T,u,a,a),T++;const P=new Image;P.src=r.toDataURL(),this.images.push(P)},this._st=t,this._handler={},this._transparentColor=e,this.parseHeader(),this.parseBlock()}}class qa{constructor(t,e,{bustCache:i,...s}={}){this.path=t,this.family=e,this._isLoaded=!1,this._resource=new zt(t,"blob",i),this._options=s}async load(){if(this.isLoaded())return this.data;try{const t=await this._resource.load(),e=URL.createObjectURL(t);this.data||(this.data=new FontFace(this.family,`url(${e})`),document.fonts.add(this.data)),await this.data.load(),this._isLoaded=!0}catch(t){throw`Error loading FontSource from path '${this.path}' with error [${t.message}]`}return this.data}isLoaded(){return this._isLoaded}toFont(t){return new is({family:this.family,...this._options,...t})}}const Va=/^\s*(?:function)?\*/;function Mo(n){return typeof n!="function"?!1:Va.test(Function.prototype.toString.call(n))?!0:Object.getPrototypeOf?Object.getPrototypeOf(n)===Object.getPrototypeOf(new Function("return function * () {}")()):!1}function Lo(...n){let t,e,i,s;Mo(n[0])&&(e=globalThis,t=n[0],i=n[1]),Mo(n[1])&&(e=n[0],t=n[1],i=n[2]),n[1]instanceof He&&(e=n[0],s=n[1],t=n[2],i=n[3]),n[0]instanceof He&&(e=globalThis,s=n[0],t=n[1],i=n[2]);const r=i==null?void 0:i.timing;let o;try{o=s??He.useEngine()}catch{throw Error(`Cannot run coroutine without engine parameter outside of an excalibur lifecycle method.
Pass an engine parameter to ex.coroutine(engine, function * {...})`)}const a=t.bind(e);return new Promise((u,T)=>{const P=a(),N=J=>{try{const{done:nt,value:at}=P.next(J);nt&&u(),at instanceof Promise?at.then(()=>{o.clock.schedule(N,0,r)}):at===void 0||at===void 0?o.clock.schedule(N,0,r):o.clock.schedule(N,at||0,r)}catch(nt){T(nt)}};N(o.clock.elapsed())})}class mn extends Fe{get progress(){return this._currentProgress}get complete(){return this.direction==="out"?this.progress>=1:this.progress<=0}constructor(t){var e,i,s,r;super(),this._logger=I.getInstance(),this.transform=new Ot,this.graphics=new Ie,this._completeFuture=new X,this.started=!1,this._currentDistance=0,this._currentProgress=0,this.done=this._completeFuture.promise,this.name=`Transition#${this.id}`,this.duration=t.duration,this.easing=(e=t.easing)!==null&&e!==void 0?e:pe.Linear,this.direction=(i=t.direction)!==null&&i!==void 0?i:"out",this.hideLoader=(s=t.hideLoader)!==null&&s!==void 0?s:!1,this.blockInput=(r=t.blockInput)!==null&&r!==void 0?r:!1,this.transform.coordPlane=be.Screen,this.transform.pos=h.Zero,this.transform.z=1/0,this.graphics.anchor=h.Zero,this.addComponent(this.transform),this.addComponent(this.graphics),this.direction==="out"?this._currentProgress=0:this._currentProgress=1}updateTransition(t,e){this.complete||(this._currentDistance+=D(e/this.duration,0,1),this._currentDistance>=1&&(this._currentDistance=1),this.direction==="out"?this._currentProgress=D(this.easing(this._currentDistance,0,1,1),0,1):this._currentProgress=D(this.easing(this._currentDistance,1,0,1),0,1))}async onPreviousSceneDeactivate(t){}onStart(t){}onUpdate(t){}onEnd(t){}onReset(){}reset(){this.started=!1,this._completeFuture=new X,this.done=this._completeFuture.promise,this._currentDistance=0,this.direction==="out"?this._currentProgress=0:this._currentProgress=1,this.onReset()}play(t,e){this.started&&(this.reset(),this._logger.warn(`Attempted to play a transition ${this.name} that is already playing, reset transition.`)),(e??t.currentScene).add(this);const s=this;return Lo(t,function*(){for(;!s.complete;){const r=yield;s.updateTransition(t,r),s.execute()}})}execute(){this.isInitialized&&(this.started||(this.started=!0,this.onStart(this.progress)),this.onUpdate(this.progress),this.complete&&!this._completeFuture.isCompleted&&(this.onEnd(this.progress),this._completeFuture.resolve()))}}class Xa extends mn{constructor(t){var e,i;super({...t,duration:(e=t.duration)!==null&&e!==void 0?e:2e3}),this.name=`FadeInOut#${this.id}`,this.color=(i=t.color)!==null&&i!==void 0?i:p.Black}onInitialize(t){this.transform.pos=t.screen.unsafeArea.topLeft,this.screenCover=new Vs({width:t.screen.resolution.width,height:t.screen.resolution.height,color:this.color}),this.graphics.add(this.screenCover),this.graphics.opacity=this.progress}onReset(){this.graphics.opacity=this.progress}onStart(t){this.graphics.opacity=t}onEnd(t){this.graphics.opacity=t}onUpdate(t){this.graphics.opacity=t}}class Ja extends mn{constructor(t){super({direction:"in",...t}),this.name=`CrossFade#${this.id}`}async onPreviousSceneDeactivate(t){this.image=await t.engine.screenshot(!0),await this.image.decode()}onInitialize(t){this.engine=t,this.transform.pos=t.screen.unsafeArea.topLeft,this.screenCover=vt.fromHtmlImageElement(this.image).toSprite(),this.graphics.add(this.screenCover),this.transform.scale=A(1/t.screen.pixelRatio,1/t.screen.pixelRatio),this.graphics.opacity=this.progress}onStart(t){this.graphics.opacity=this.progress}onReset(){this.graphics.opacity=this.progress}onEnd(t){this.graphics.opacity=t}onUpdate(t){this.graphics.opacity=t}}class vn extends it{constructor(t){super(),this.color=p.Black,this.thickness=1;const{start:e,end:i,color:s,thickness:r}=t;this.start=e,this.end=i,this.color=s??this.color,this.thickness=r??this.thickness,this._localBounds=this._calculateBounds();const{width:o,height:a}=this._localBounds;this.width=o,this.height=a}get localBounds(){return this._localBounds}_calculateBounds(){const t=this.end.sub(this.start).normal(),e=this.thickness/2,i=[this.start.add(t.scale(e)),this.end.add(t.scale(e)),this.end.add(t.scale(-e)),this.start.add(t.scale(-e))];return E.fromPoints(i)}_drawImage(t,e,i){t.drawLine(this.start,this.end,this.color,this.thickness)}clone(){return new vn({start:this.start,end:this.end,color:this.color,thickness:this.thickness})}}class wn extends Bi{get points(){return this._points}set points(t){this._points=t;const e=this.minPoint;this.width=this._points.reduce((i,s)=>Math.max(s.x,i),0)-e.x,this.height=this._points.reduce((i,s)=>Math.max(s.y,i),0)-e.y,this.flagDirty()}get minPoint(){const t=this._points.reduce((i,s)=>Math.min(s.x,i),1/0),e=this._points.reduce((i,s)=>Math.min(s.y,i),1/0);return A(t,e)}constructor(t){super(t),this.points=t.points,this.filtering=F.Blended,this.rasterize()}clone(){return new wn({points:this.points.map(t=>t.clone()),...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){if(this.points&&this.points.length){t.beginPath();const e=this.minPoint.negate(),i=this.points[0].add(e);t.moveTo(i.x,i.y),this.points.forEach(s=>{t.lineTo(s.x+e.x,s.y+e.y)}),t.lineTo(i.x,i.y),t.closePath(),this.color&&t.fill(),this.strokeColor&&t.stroke()}}}const Ro=5,Ps={},Ka=()=>{for(const n in Ps)Ps[n]=0},Mr=(n,t)=>{const e=Y.isEnabled("suppress-obsolete-message");Ps[n]<Ro&&!e&&(I.getInstance().warn(n),console.trace&&t.showStackTrace&&console.trace()),Ps[n]++};function $a(n){return n={message:"This feature will be removed in future versions of Excalibur.",alternateMethod:null,showStackTrace:!1,...n},function(t,e,i){if(i&&!(typeof i.value=="function"||typeof i.get=="function"||typeof i.set=="function"))throw new SyntaxError("Only classes/functions/getters/setters can be marked as obsolete");const r=`${`${t.name||""}${t.name&&e?".":""}${e||""}`} is marked obsolete: ${n.message}`+(n.alternateMethod?` Use ${n.alternateMethod} instead`:"");Ps[r]||(Ps[r]=0);const o=i?{...i}:t;if(!i){class a extends o{constructor(...T){Mr(r,n),super(...T)}}return a}return i&&i.value?(o.value=function(){return Mr(r,n),i.value.apply(this,arguments)},o):(i&&i.get&&(o.get=function(){return Mr(r,n),i.get.apply(this,arguments)}),i&&i.set&&(o.set=function(){return Mr(r,n),i.set.apply(this,arguments)}),o)}}class tl{constructor(){this._queue=[]}get length(){return this._queue.length}enqueue(){const t=new X;return this._queue.push(t),t.promise}dequeue(t){this._queue.shift().resolve(t)}}class el{constructor(t){this._count=t,this._waitQueue=new tl}get count(){return this._count}get waiting(){return this._waitQueue.length}async enter(){return this._count!==0?(this._count--,Promise.resolve()):this._waitQueue.enqueue()}exit(t=1){if(t!==0){for(;t!==0&&this._waitQueue.length!==0;)this._waitQueue.dequeue(null),t--;this._count+=t}}}const yn="0.29.2";Z()})();var ol=H.eKr,al=H.yVm,ll=H.a7j,hl=H.U_w,cl=H.JF2,dl=H.htg,ul=H.HXL,Al=H.mcg,qt=H.Agj,gl=H.u6S,pl=H.x7M,ar=H.X55,fl=H.m3M,_l=H.aE5,ml=H.YJU,vl=H.eZi,wl=H.GNv,or=H.Y56,yl=H._0v,xl=H.vhs,bl=H.Z8b,Cl=H.Yfw,Il=H.IcQ,El=H.Rl2,Bl=H.kgJ,Tl=H.GTT,Rr=H.ypY,Sl=H.i7d,kl=H.fQ3,Dl=H.HlI,Ql=H.jlt,Pl=H.VQc,Fl=H.zD7,Ml=H.I0I,Ll=H.AUF,Rl=H.JoF,zl=H.MlA,Ol=H.PZh,Nl=H.qA,Gl=H.CrD,Ul=H.dQK,jl=H.D3r,Hl=H.Qpo,Wl=H.D9n,Zl=H.b6v,Yl=H.mvh,cs=H.Bpo,Yt=H.Q1f,ql=H.IKv,Vl=H.fcV,Xl=H.Glf,Jl=H.uAl,Kl=H.ElT,$l=H.MPu,th=H.Z8r,eh=H.QSL,ih=H.sPV,sh=H.nAn,rh=H.zCU,nh=H.QrV,oh=H.fF9,ah=H.xI8,lh=H.yar,hh=H.SP7,ch=H.oRy,dh=H.f5X,uh=H.V1c,Ah=H.Mlx,gh=H.ZCo,ph=H.Vy3,fh=H.J5p,_h=H.mL_,mh=H.Guw,vh=H.VKx,wh=H.N5j,yh=H.pgY,xh=H.OP3,bh=H.rl5,Ch=H.eod,Ho=H.q5Z,Ih=H.YUC,Eh=H.saR,Bh=H.hvr,Th=H.Qol,Sh=H.Wf4,kh=H.JCs,Dh=H.gJV,Qh=H.fWD,Ph=H.Va_,Wo=H.N$8,Fh=H._jQ,Mh=H.rxj,Lh=H.rhv,Rh=H.wCu,zh=H.HAp,Oh=H.Zy1,Nh=H.Qev,Zo=H.bkB,Gh=H.wfL,Uh=H.sVA,jh=H.$Gs,Hh=H.CJ0,Wh=H.NWh,Zh=H.tWi,Yh=H.xAj,qh=H.zWh,Vh=H.i_4,Xh=H.iIx,Jh=H.c9e,Ee=H.KQV,Kh=H.weH,$h=H.jXp,tc=H.zzY,ec=H.yRQ,ic=H.MtE,sc=H.rPj,rc=H.KLc,nc=H.Fir,oc=H.V5f,ac=H.Xj7,lc=H.Wud,hc=H.FVg,cc=H.g5Y,dc=H.YQB,uc=H.KPb,Ac=H.nHK,gc=H.TX_,pc=H.r3n,fc=H.vYh,_c=H.hnk,mc=H.D2R,vc=H.n1o,wc=H.RLG,yc=H.fBU,xc=H.Adb,Jt=H.bEs,bc=H.wCy,Cc=H.CbD,Ic=H.x_C,Kt=H.pde,Ec=H.pGf,Bc=H.ibQ,Tc=H.QlN,Sc=H.shR,kc=H.Yjk,Dc=H._u1,Qc=H.OBI,Pc=H.klh,Fc=H.s3S,Qi=H.D$R,Mc=H.xth,Be=H.JU7,Lc=H.h9x,Rc=H.N1A,zc=H.e_k,Yo=H.aHM,Oc=H.tlv,Nc=H.Vi9,Gc=H.ieR,Uc=H.$bb,jc=H.VyI,Hc=H.imn,Wc=H.uqu,Zc=H.QnL,Yc=H.vnc,qc=H.wk_,Vc=H.GH0,Xc=H._1r,Jc=H.l0X,Kc=H.HHX,$c=H.tjk,td=H.rWe,ed=H.j9l,id=H.NVp,sd=H.cPK,rd=H.XoL,nd=H.RmF,od=H.DXI,ad=H.tCD,ld=H.oGn,hd=H.J3D,cd=H.vCJ,dd=H.f9l,ud=H.AQx,Ad=H.v9m,gd=H.yRJ,pd=H.EU6,fd=H.m3O,_d=H.Ryz,md=H.OxP,vd=H.LEs,wd=H.Ec,yd=H.Pi5,xd=H.gmH,bd=H.tS,Cd=H.XxX,Id=H.bCz,Ed=H.nYS,Bd=H.yiT,Td=H.NHl,Sd=H.mO8,kd=H.PXI,Dd=H.bn5,Qd=H.Ywr,Pd=H.cMd,Fd=H.Bs6,Md=H.G0k,Ld=H.pyn,Rd=H.QeM,zd=H.aPX,Od=H.ITP,Nd=H.BY0,Gd=H.MFw,Ud=H.sBn,jd=H.S3L,Hd=H.XKQ,Wd=H.ESI,Zd=H.uxz,Yd=H.o8N,qd=H.u_r,Vd=H.RlV,Xd=H.gVA,Jd=H.M_G,Kd=H.GRB,$d=H.kM6,tu=H.dO8,eu=H.jgM,iu=H.FWq,su=H.s3j,ru=H.hlw,nu=H.B7e,ou=H.H_X,au=H.S_d,lu=H.U7E,Ci=H.Z58,hu=H.yh2,cu=H.ff$,du=H.cWi,uu=H.NBt,Au=H.oNz,gu=H.QlU,pu=H.Xey,fu=H.jft,_u=H.Mtr,mu=H.ypk,vu=H.mnM,wu=H.bAZ,qo=H.ABN,yu=H.VK6,hs=H.kxk,xu=H.DT1,lr=H.FLG,bu=H.qN_,Cu=H.Z37,Iu=H.FtL,Eu=H.Z6X,Bu=H.iQT,Tu=H.ziO,Su=H.OEF,ku=H.uuE,Du=H.tiv,Qu=H.T$Y,Pu=H.EYj,Fu=H.nOB,Mu=H.Tap,Lu=H.FAs,Ru=H.B_P,zu=H.aA5,Vo=H.M4G,Ou=H.l$l,Nu=H.dLy,Gu=H.WZP,Uu=H.eB6,ju=H.nFK,Hu=H.l9z,Wu=H.YOF,Zu=H.yhB,Yu=H.J0N,Ft=H.Miz,qu=H.Bj4,Vu=H.Rcs,Xu=H.vJ4,Ju=H.TqC,Ku=H.nM0,$u=H.X1u,tA=H.SpZ,eA=H.DX8,iA=H.Yx$,sA=H.HK4,rA=H.SE$,nA=H.qE8,oA=H.Pz7,aA=H.sX_,lA=H.JuI,hA=H.Nl$,cA=H.OwT,dA=H.P$G,uA=H.mHV,AA=H.Fx_,gA=H.WFC,pA=H.aDq,fA=H.jIg,_A=H.UH3,mA=H.K6X,vA=H.C1Y,wA=H.Aw1,yA=H.A8$,xA=H.hsx,bA=H.l9E,CA=H.aSf,IA=H.Zex,EA=H.mXP,BA=H.vt$,TA=H.hCA,SA=H.pjR,kA=H.U43,DA=H.pSZ,QA=H.y17,PA=H.jVr,FA=H._SZ,MA=H.xWn,LA=H.ehJ,RA=H.t6s,zA=H.Eyn;const OA=Object.freeze(Object.defineProperty({__proto__:null,ActionCompleteEvent:ol,ActionContext:al,ActionQueue:ll,ActionSequence:hl,ActionStartEvent:cl,ActionsComponent:dl,ActionsSystem:ul,ActivateEvent:Al,Actor:qt,AddedComponent:gl,AffineMatrix:pl,Animation:ar,AnimationDirection:fl,AnimationEvents:_l,AnimationStrategy:ml,ArcadeSolver:vl,AudioContextFactory:wl,Axes:or,Axis:yl,BaseAlign:xl,Blink:bl,BodyComponent:Cl,BoundingBox:Il,BroadphaseStrategy:El,BrowserComponent:Bl,BrowserEvents:Tl,Buttons:Rr,Camera:Sl,CameraEvents:kl,Canvas:Dl,Circle:Ql,CircleCollider:Pl,Clock:Fl,ClosestLine:Ml,ClosestLineJumpTable:Ll,Collider:Rl,ColliderComponent:zl,CollisionContact:Ol,CollisionEndEvent:Nl,CollisionGroup:Gl,CollisionGroupManager:Ul,CollisionJumpTable:jl,CollisionPostSolveEvent:Hl,CollisionPreSolveEvent:Wl,CollisionStartEvent:Zl,CollisionSystem:Yl,CollisionType:cs,Color:Yt,ColorBlindFlags:ql,ColorBlindnessMode:Vl,ColorBlindnessPostProcessor:Xl,Component:Jl,CompositeCollider:Kl,Configurable:$l,ConsoleAppender:th,ContactConstraintPoint:eh,ContactEndEvent:ih,ContactSolveBias:sh,ContactStartEvent:rh,CoordPlane:nh,CrossFade:oh,DeactivateEvent:ah,Debug:lh,DebugConfig:hh,DebugGraphicsComponent:ch,DebugSystem:dh,DebugText:uh,DefaultAntialiasOptions:Ah,DefaultLoader:gh,DefaultPhysicsConfig:ph,DefaultPixelArtOptions:fh,DegreeOfFreedom:_h,Delay:mh,DeprecatedStaticToConfig:vh,Detector:wh,Die:yh,Direction:xh,Director:bh,DirectorEvents:Ch,DisplayMode:Ho,DynamicTree:Ih,DynamicTreeCollisionProcessor:Eh,EX_VERSION:Bh,EaseBy:Th,EaseTo:Sh,EasingFunctions:kh,EdgeCollider:Dh,ElasticToActorStrategy:Qh,EmitterType:Ph,Engine:Wo,EngineEvents:Fh,EnterTriggerEvent:Mh,EnterViewPortEvent:Lh,Entity:Rh,EntityEvents:zh,EntityManager:Oh,EventDispatcher:Nh,EventEmitter:Zo,EventTypes:Gh,Events:Uh,ExResponse:jh,ExcaliburGraphicsContext2DCanvas:Hh,ExcaliburGraphicsContextWebGL:Wh,ExitTriggerEvent:Zh,ExitViewPortEvent:Yh,Fade:qh,FadeInOut:Vh,Flags:Xh,Follow:Jh,Font:Ee,FontCache:Kh,FontSource:$h,FontStyle:tc,FontUnit:ec,FpsSampler:ic,FrameStats:sc,Future:rc,GameEvent:nc,GameStartEvent:oc,GameStopEvent:ac,Gamepad:lc,GamepadAxisEvent:hc,GamepadButtonEvent:cc,GamepadConnectEvent:dc,GamepadDisconnectEvent:uc,Gamepads:Ac,Gif:gc,GlobalCoordinates:pc,Graphic:fc,GraphicsComponent:_c,GraphicsGroup:mc,GraphicsSystem:vc,HiddenEvent:wc,HorizontalFirst:yc,ImageFiltering:xc,ImageSource:Jt,ImageSourceAttributeConstants:bc,ImageWrapping:Cc,InitializeEvent:Ic,Input:Kt,InputHost:Ec,InputMapper:Bc,Integrator:Tc,IsometricEntityComponent:Sc,IsometricEntitySystem:kc,IsometricMap:Dc,IsometricTile:Qc,KeyEvent:Pc,Keyboard:Fc,Keys:Qi,KillEvent:Mc,Label:Be,LimitCameraBoundsStrategy:Lc,Line:Rc,LineSegment:zc,Loader:Yo,LoaderEvents:Oc,LockCameraToActorAxisStrategy:Nc,LockCameraToActorStrategy:Gc,LogLevel:Uc,Logger:jc,Material:Hc,Matrix:Wc,MatrixLocations:Zc,MediaEvent:Yc,Meet:qc,MotionComponent:Vc,MotionSystem:Xc,MoveBy:Jc,MoveTo:Kc,NativePointerButton:$c,NativeSoundEvent:td,NativeSoundProcessedEvent:ed,None:id,Observable:sd,OffscreenSystem:rd,Pair:nd,ParallaxComponent:od,ParallelActions:ad,ParseGif:ld,Particle:hd,ParticleEmitter:cd,ParticleTransform:dd,Physics:ud,PhysicsStats:Ad,PhysicsWorld:gd,PointerAbstraction:pd,PointerButton:fd,PointerComponent:_d,PointerEvent:md,PointerEventReceiver:vd,PointerScope:wd,PointerSystem:yd,PointerType:xd,Polygon:bd,PolygonCollider:Cd,Pool:Id,PostCollisionEvent:Ed,PostDebugDrawEvent:Bd,PostDrawEvent:Td,PostFrameEvent:Sd,PostKillEvent:kd,PostTransformDrawEvent:Dd,PostUpdateEvent:Qd,PreCollisionEvent:Pd,PreDebugDrawEvent:Fd,PreDrawEvent:Md,PreFrameEvent:Ld,PreKillEvent:Rd,PreLoadEvent:zd,PreTransformDrawEvent:Od,PreUpdateEvent:Nd,Projection:Gd,QuadIndexBuffer:Ud,QuadTree:jd,Query:Hd,QueryManager:Wd,RadiusAroundActorStrategy:Zd,Random:Yd,Raster:qd,Ray:Vd,RealisticSolver:Xd,Rectangle:Jd,RemovedComponent:Kd,Repeat:$d,RepeatForever:tu,Resolution:eu,Resource:iu,ResourceEvents:su,RotateBy:ru,RotateTo:nu,RotationType:ou,ScaleBy:au,ScaleTo:lu,Scene:Ci,SceneEvents:hu,Screen:cu,ScreenAppender:du,ScreenElement:uu,ScreenEvents:Au,ScreenShader:gu,ScrollPreventionMode:pu,Semaphore:fu,Shader:_u,Shape:mu,Side:vu,SolverStrategy:wu,Sound:qo,SoundEvents:yu,Sprite:hs,SpriteFont:xu,SpriteSheet:lr,StandardClock:bu,StateMachine:Cu,StrategyContainer:Iu,Stream:Eu,System:Bu,SystemManager:Tu,SystemPriority:Su,SystemType:ku,TagQuery:Du,TestClock:Qu,Text:Pu,TextAlign:Fu,TextureLoader:Mu,Tile:Lu,TileMap:Ru,TileMapEvents:zu,Timer:Vo,Toaster:Ou,Transform:Nu,TransformComponent:Gu,Transition:Uu,TreeNode:ju,Trigger:Hu,TriggerEvents:Wu,TwoPI:Zu,Util:Yu,Vector:Ft,VectorView:qu,VertexBuffer:Vu,VertexLayout:Xu,VerticalFirst:Ju,VisibleEvent:Ku,WebAudio:$u,WebAudioInstance:tA,WheelDeltaMode:eA,WheelEvent:iA,World:sA,canonicalizeAngle:rA,clamp:nA,coroutine:oA,createId:aA,frac:lA,hasGraphicsTick:hA,hasOnInitialize:cA,hasOnPostUpdate:dA,hasOnPreUpdate:uA,hasPostDraw:AA,hasPreDraw:gA,has_initialize:pA,has_postupdate:fA,has_preupdate:_A,isAddedComponent:mA,isComponentCtor:vA,isLoaderConstructor:wA,isRemovedComponent:yA,isSceneConstructor:xA,isScreenElement:bA,isSystemConstructor:CA,maxMessages:IA,obsolete:EA,parseImageFiltering:BA,parseImageWrapping:TA,pixelSnapEpsilon:SA,randomInRange:kA,randomIntInRange:DA,range:QA,resetObsoleteCounter:PA,sign:FA,toDegrees:MA,toRadians:LA,vec:RA,webgl:zA},Symbol.toStringTag,{value:"Module"}));function Xo(rt){if(rt.__esModule)return rt;var ot=rt.default;if(typeof ot=="function"){var d=function W(){return this instanceof W?Reflect.construct(ot,arguments,this.constructor):ot.apply(this,arguments)};d.prototype=ot.prototype}else d={};return Object.defineProperty(d,"__esModule",{value:!0}),Object.keys(rt).forEach(function(W){var q=Object.getOwnPropertyDescriptor(rt,W);Object.defineProperty(d,W,q.get?q:{enumerable:!0,get:function(){return rt[W]}})}),d}var Jo={exports:{}};const NA={},GA=Object.freeze(Object.defineProperty({__proto__:null,default:NA},Symbol.toStringTag,{value:"Module"})),UA=Xo(GA),jA=Xo(OA);/*! For license information please see excalibur-tiled.min.js.LICENSE.txt */(function(rt,ot){(function(d,W){rt.exports=W(function(){try{return UA}catch{}}(),jA)})(self,(d,W)=>(()=>{var q={"./node_modules/compare-versions/lib/esm/compare.js":(X,k,b)=>{b.r(k),b.d(k,{compare:()=>S});var l=b("./node_modules/compare-versions/lib/esm/compareVersions.js");const S=(D,O,V)=>{B(V);const M=(0,l.compareVersions)(D,O);return C[V].includes(M)},C={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1],"!=":[-1,1]},Q=Object.keys(C),B=D=>{if(typeof D!="string")throw new TypeError("Invalid operator type, expected string but got "+typeof D);if(Q.indexOf(D)===-1)throw new Error(`Invalid operator, expected one of ${Q.join("|")}`)}},"./node_modules/compare-versions/lib/esm/compareVersions.js":(X,k,b)=>{b.r(k),b.d(k,{compareVersions:()=>S});var l=b("./node_modules/compare-versions/lib/esm/utils.js");const S=(C,Q)=>{const B=(0,l.validateAndParse)(C),D=(0,l.validateAndParse)(Q),O=B.pop(),V=D.pop(),M=(0,l.compareSegments)(B,D);return M!==0?M:O&&V?(0,l.compareSegments)(O.split("."),V.split(".")):O||V?O?-1:1:0}},"./node_modules/compare-versions/lib/esm/utils.js":(X,k,b)=>{b.r(k),b.d(k,{compareSegments:()=>D,semver:()=>l,validateAndParse:()=>S});const l=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,S=O=>{if(typeof O!="string")throw new TypeError("Invalid argument expected string");const V=O.match(l);if(!V)throw new Error(`Invalid argument not valid semver ('${O}' received)`);return V.shift(),V},C=O=>O==="*"||O==="x"||O==="X",Q=O=>{const V=parseInt(O,10);return isNaN(V)?O:V},B=(O,V)=>{if(C(O)||C(V))return 0;const[M,L]=((f,v)=>typeof f!=typeof v?[String(f),String(v)]:[f,v])(Q(O),Q(V));return M>L?1:M<L?-1:0},D=(O,V)=>{for(let M=0;M<Math.max(O.length,V.length);M++){const L=B(O[M]||"0",V[M]||"0");if(L!==0)return L}return 0}},"./node_modules/fast-xml-parser/src/json2xml.js":(X,k,b)=>{const l=b("./node_modules/fast-xml-parser/src/util.js").buildOptions,S={attributeNamePrefix:"@_",attrNodeName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataTagName:!1,cdataPositionChar:"\\c",format:!1,indentBy:"  ",supressEmptyNode:!1,tagValueProcessor:function(p){return p},attrValueProcessor:function(p){return p}},C=["attributeNamePrefix","attrNodeName","textNodeName","ignoreAttributes","cdataTagName","cdataPositionChar","format","indentBy","supressEmptyNode","tagValueProcessor","attrValueProcessor","rootNodeName"];function Q(p){this.options=l(p,S,C),this.options.ignoreAttributes||this.options.attrNodeName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=h),this.options.cdataTagName?this.isCDATA=A:this.isCDATA=function(){return!1},this.replaceCDATAstr=D,this.replaceCDATAarr=O,this.processTextOrObjNode=B,this.options.format?(this.indentate=v,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine=""),this.options.supressEmptyNode?(this.buildTextNode=f,this.buildObjNode=M):(this.buildTextNode=L,this.buildObjNode=V),this.buildTextValNode=L,this.buildObjectNode=V}function B(p,y,x){const I=this.j2x(p,x+1);return p[this.options.textNodeName]!==void 0&&Object.keys(p).length===1?this.buildTextNode(I.val,y,I.attrStr,x):this.buildObjNode(I.val,y,I.attrStr,x)}function D(p,y){return p=this.options.tagValueProcessor(""+p),this.options.cdataPositionChar===""||p===""?p+"<![CDATA["+y+"]]"+this.tagEndChar:p.replace(this.options.cdataPositionChar,"<![CDATA["+y+"]]"+this.tagEndChar)}function O(p,y){if(p=this.options.tagValueProcessor(""+p),this.options.cdataPositionChar===""||p==="")return p+"<![CDATA["+y.join("]]><![CDATA[")+"]]"+this.tagEndChar;for(let x in y)p=p.replace(this.options.cdataPositionChar,"<![CDATA["+y[x]+"]]>");return p+this.newLine}function V(p,y,x,I){return x&&p.indexOf("<")===-1?this.indentate(I)+"<"+y+x+">"+p+"</"+y+this.tagEndChar:this.indentate(I)+"<"+y+x+this.tagEndChar+p+this.indentate(I)+"</"+y+this.tagEndChar}function M(p,y,x,I){return p!==""?this.buildObjectNode(p,y,x,I):this.indentate(I)+"<"+y+x+"/"+this.tagEndChar}function L(p,y,x,I){return this.indentate(I)+"<"+y+x+">"+this.options.tagValueProcessor(p)+"</"+y+this.tagEndChar}function f(p,y,x,I){return p!==""?this.buildTextValNode(p,y,x,I):this.indentate(I)+"<"+y+x+"/"+this.tagEndChar}function v(p){return this.options.indentBy.repeat(p)}function h(p){return!!p.startsWith(this.options.attributeNamePrefix)&&p.substr(this.attrPrefixLen)}function A(p){return p===this.options.cdataTagName}Q.prototype.parse=function(p){return Array.isArray(p)&&this.options.rootNodeName&&this.options.rootNodeName.length>1&&(p={[this.options.rootNodeName]:p}),this.j2x(p,0).val},Q.prototype.j2x=function(p,y){let x="",I="";for(let w in p)if(p[w]!==void 0)if(p[w]===null)I+=this.indentate(y)+"<"+w+"/"+this.tagEndChar;else if(p[w]instanceof Date)I+=this.buildTextNode(p[w],w,"",y);else if(typeof p[w]!="object"){const U=this.isAttribute(w);U?x+=" "+U+'="'+this.options.attrValueProcessor(""+p[w])+'"':this.isCDATA(w)?p[this.options.textNodeName]?I+=this.replaceCDATAstr(p[this.options.textNodeName],p[w]):I+=this.replaceCDATAstr("",p[w]):w===this.options.textNodeName?p[this.options.cdataTagName]||(I+=this.options.tagValueProcessor(""+p[w])):I+=this.buildTextNode(p[w],w,"",y)}else if(Array.isArray(p[w]))if(this.isCDATA(w))I+=this.indentate(y),p[this.options.textNodeName]?I+=this.replaceCDATAarr(p[this.options.textNodeName],p[w]):I+=this.replaceCDATAarr("",p[w]);else{const U=p[w].length;for(let R=0;R<U;R++){const E=p[w][R];E===void 0||(I+=E===null?this.indentate(y)+"<"+w+"/"+this.tagEndChar:typeof E=="object"?this.processTextOrObjNode(E,w,y):this.buildTextNode(E,w,"",y))}}else if(this.options.attrNodeName&&w===this.options.attrNodeName){const U=Object.keys(p[w]),R=U.length;for(let E=0;E<R;E++)x+=" "+U[E]+'="'+this.options.attrValueProcessor(""+p[w][U[E]])+'"'}else I+=this.processTextOrObjNode(p[w],w,y);return{attrStr:x,val:I}},X.exports=Q},"./node_modules/fast-xml-parser/src/nimndata.js":(X,k,b)=>{const l=function(L){return String.fromCharCode(L)},S={nilChar:l(176),missingChar:l(201),nilPremitive:l(175),missingPremitive:l(200),emptyChar:l(178),emptyValue:l(177),boundryChar:l(179),objStart:l(198),arrStart:l(204),arrayEnd:l(185)},C=[S.nilChar,S.nilPremitive,S.missingChar,S.missingPremitive,S.boundryChar,S.emptyChar,S.emptyValue,S.arrayEnd,S.objStart,S.arrStart],Q=function(L,f,v){if(typeof f=="string")return L&&L[0]&&L[0].val!==void 0?B(L[0].val):B(L);{const A=(h=L)===void 0?S.missingChar:h===null?S.nilChar:!(h.child&&Object.keys(h.child).length===0&&(!h.attrsMap||Object.keys(h.attrsMap).length===0))||S.emptyChar;if(A===!0){let p="";if(Array.isArray(f)){p+=S.arrStart;const y=f[0],x=L.length;if(typeof y=="string")for(let I=0;I<x;I++){const w=B(L[I].val);p=D(p,w)}else for(let I=0;I<x;I++){const w=Q(L[I],y,v);p=D(p,w)}p+=S.arrayEnd}else{p+=S.objStart;const y=Object.keys(f);Array.isArray(L)&&(L=L[0]);for(let x in y){const I=y[x];let w;w=!v.ignoreAttributes&&L.attrsMap&&L.attrsMap[I]?Q(L.attrsMap[I],f[I],v):I===v.textNodeName?Q(L.val,f[I],v):Q(L.child[I],f[I],v),p=D(p,w)}}return p}return A}var h},B=function(L){switch(L){case void 0:return S.missingPremitive;case null:return S.nilPremitive;case"":return S.emptyValue;default:return L}},D=function(L,f){return O(f[0])||O(L[L.length-1])||(L+=S.boundryChar),L+f},O=function(L){return C.indexOf(L)!==-1},V=b("./node_modules/fast-xml-parser/src/xmlstr2xmlnode.js"),M=b("./node_modules/fast-xml-parser/src/util.js").buildOptions;k.convert2nimn=function(L,f,v){return v=M(v,V.defaultOptions,V.props),Q(L,f,v)}},"./node_modules/fast-xml-parser/src/node2json.js":(X,k,b)=>{const l=b("./node_modules/fast-xml-parser/src/util.js"),S=function(C,Q,B){const D={};if(!Q.alwaysCreateTextNode&&(!C.child||l.isEmptyObject(C.child))&&(!C.attrsMap||l.isEmptyObject(C.attrsMap)))return l.isExist(C.val)?C.val:"";if(l.isExist(C.val)&&(typeof C.val!="string"||C.val!==""&&C.val!==Q.cdataPositionChar)){const V=l.isTagNameInArrayMode(C.tagname,Q.arrayMode,B);D[Q.textNodeName]=V?[C.val]:C.val}l.merge(D,C.attrsMap,Q.arrayMode);const O=Object.keys(C.child);for(let V=0;V<O.length;V++){const M=O[V];if(C.child[M]&&C.child[M].length>1){D[M]=[];for(let L in C.child[M])C.child[M].hasOwnProperty(L)&&D[M].push(S(C.child[M][L],Q,M))}else{const L=S(C.child[M][0],Q,M),f=Q.arrayMode===!0&&typeof L=="object"||l.isTagNameInArrayMode(M,Q.arrayMode,B);D[M]=f?[L]:L}}return D};k.convertToJson=S},"./node_modules/fast-xml-parser/src/node2json_str.js":(X,k,b)=>{const l=b("./node_modules/fast-xml-parser/src/util.js"),S=b("./node_modules/fast-xml-parser/src/util.js").buildOptions,C=b("./node_modules/fast-xml-parser/src/xmlstr2xmlnode.js"),Q=function(B,D,O){let V="{";const M=Object.keys(B.child);for(let f=0;f<M.length;f++){const v=M[f];if(B.child[v]&&B.child[v].length>1){V+='"'+v+'" : [ ';for(let h in B.child[v])V+=Q(B.child[v][h],D)+" , ";V=V.substr(0,V.length-1)+" ] "}else V+='"'+v+'" : '+Q(B.child[v][0],D)+" ,"}return l.merge(V,B.attrsMap),l.isEmptyObject(V)?l.isExist(B.val)?B.val:"":(l.isExist(B.val)&&(typeof B.val!="string"||B.val!==""&&B.val!==D.cdataPositionChar)&&(V+='"'+D.textNodeName+'" : '+((L=B.val)!==!0&&L!==!1&&isNaN(L)?'"'+L+'"':L)),V[V.length-1]===","&&(V=V.substr(0,V.length-2)),V+"}");var L};k.convertToJsonString=function(B,D){return(D=S(D,C.defaultOptions,C.props)).indentBy=D.indentBy||"",Q(B,D)}},"./node_modules/fast-xml-parser/src/parser.js":(X,k,b)=>{const l=b("./node_modules/fast-xml-parser/src/node2json.js"),S=b("./node_modules/fast-xml-parser/src/xmlstr2xmlnode.js"),C=b("./node_modules/fast-xml-parser/src/xmlstr2xmlnode.js"),Q=b("./node_modules/fast-xml-parser/src/util.js").buildOptions,B=b("./node_modules/fast-xml-parser/src/validator.js");k.parse=function(D,O={},V){if(V){V===!0&&(V={});const f=B.validate(D,V);if(f!==!0)throw Error(f.err.msg)}O.parseTrueNumberOnly&&O.parseNodeValue!==!1&&!O.numParseOptions&&(O.numParseOptions={leadingZeros:!1});let M=Q(O,C.defaultOptions,C.props);const L=S.getTraversalObj(D,M);return l.convertToJson(L,M)},k.convertTonimn=b("./node_modules/fast-xml-parser/src/nimndata.js").convert2nimn,k.getTraversalObj=S.getTraversalObj,k.convertToJson=l.convertToJson,k.convertToJsonString=b("./node_modules/fast-xml-parser/src/node2json_str.js").convertToJsonString,k.validate=B.validate,k.j2xParser=b("./node_modules/fast-xml-parser/src/json2xml.js"),k.parseToNimn=function(D,O,V){return k.convertTonimn(k.getTraversalObj(D,V),O,V)}},"./node_modules/fast-xml-parser/src/util.js":(X,k)=>{const b=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",l="["+b+"]["+b+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*",S=new RegExp("^"+l+"$");k.isExist=function(C){return C!==void 0},k.isEmptyObject=function(C){return Object.keys(C).length===0},k.merge=function(C,Q,B){if(Q){const D=Object.keys(Q),O=D.length;for(let V=0;V<O;V++)C[D[V]]=B==="strict"?[Q[D[V]]]:Q[D[V]]}},k.getValue=function(C){return k.isExist(C)?C:""},k.buildOptions=function(C,Q,B){let D={};if(!C)return Q;for(let O=0;O<B.length;O++)C[B[O]]!==void 0?D[B[O]]=C[B[O]]:D[B[O]]=Q[B[O]];return D},k.isTagNameInArrayMode=function(C,Q,B){return Q!==!1&&(Q instanceof RegExp?Q.test(C):typeof Q=="function"?!!Q(C,B):Q==="strict")},k.isName=function(C){return S.exec(C)!=null},k.getAllMatches=function(C,Q){const B=[];let D=Q.exec(C);for(;D;){const O=[];O.startIndex=Q.lastIndex-D[0].length;const V=D.length;for(let M=0;M<V;M++)O.push(D[M]);B.push(O),D=Q.exec(C)}return B},k.nameRegexp=l},"./node_modules/fast-xml-parser/src/validator.js":(X,k,b)=>{const l=b("./node_modules/fast-xml-parser/src/util.js"),S={allowBooleanAttributes:!1},C=["allowBooleanAttributes"];function Q(y,x){const I=x;for(;x<y.length;x++)if(!(y[x]!="?"&&y[x]!=" ")){const w=y.substr(I,x-I);if(x>5&&w==="xml")return v("InvalidXml","XML declaration allowed only at the start of the document.",A(y,x));if(y[x]=="?"&&y[x+1]==">"){x++;break}}return x}function B(y,x){if(y.length>x+5&&y[x+1]==="-"&&y[x+2]==="-"){for(x+=3;x<y.length;x++)if(y[x]==="-"&&y[x+1]==="-"&&y[x+2]===">"){x+=2;break}}else if(y.length>x+8&&y[x+1]==="D"&&y[x+2]==="O"&&y[x+3]==="C"&&y[x+4]==="T"&&y[x+5]==="Y"&&y[x+6]==="P"&&y[x+7]==="E"){let I=1;for(x+=8;x<y.length;x++)if(y[x]==="<")I++;else if(y[x]===">"&&(I--,I===0))break}else if(y.length>x+9&&y[x+1]==="["&&y[x+2]==="C"&&y[x+3]==="D"&&y[x+4]==="A"&&y[x+5]==="T"&&y[x+6]==="A"&&y[x+7]==="["){for(x+=8;x<y.length;x++)if(y[x]==="]"&&y[x+1]==="]"&&y[x+2]===">"){x+=2;break}}return x}k.validate=function(y,x){x=l.buildOptions(x,S,C);const I=[];let w=!1,U=!1;y[0]==="\uFEFF"&&(y=y.substr(1));for(let E=0;E<y.length;E++)if(y[E]==="<"&&y[E+1]==="?"){if(E+=2,E=Q(y,E),E.err)return E}else{if(y[E]!=="<"){if(y[E]===" "||y[E]==="	"||y[E]===`
`||y[E]==="\r")continue;return v("InvalidChar","char '"+y[E]+"' is not expected.",A(y,E))}{let $=E;if(E++,y[E]==="!"){E=B(y,E);continue}{let G=!1;y[E]==="/"&&(G=!0,E++);let K="";for(;E<y.length&&y[E]!==">"&&y[E]!==" "&&y[E]!=="	"&&y[E]!==`
`&&y[E]!=="\r";E++)K+=y[E];if(K=K.trim(),K[K.length-1]==="/"&&(K=K.substring(0,K.length-1),E--),R=K,!l.isName(R)){let Et;return Et=K.trim().length===0?"Invalid space after '<'.":"Tag '"+K+"' is an invalid name.",v("InvalidTag",Et,A(y,E))}const m=V(y,E);if(m===!1)return v("InvalidAttr","Attributes for '"+K+"' have open quote.",A(y,E));let lt=m.value;if(E=m.index,lt[lt.length-1]==="/"){const Et=E-lt.length;lt=lt.substring(0,lt.length-1);const dt=L(lt,x);if(dt!==!0)return v(dt.err.code,dt.err.msg,A(y,Et+dt.err.line));w=!0}else if(G){if(!m.tagClosed)return v("InvalidTag","Closing tag '"+K+"' doesn't have proper closing.",A(y,E));if(lt.trim().length>0)return v("InvalidTag","Closing tag '"+K+"' can't have attributes or invalid starting.",A(y,$));{const Et=I.pop();if(K!==Et.tagName){let dt=A(y,Et.tagStartPos);return v("InvalidTag","Expected closing tag '"+Et.tagName+"' (opened in line "+dt.line+", col "+dt.col+") instead of closing tag '"+K+"'.",A(y,$))}I.length==0&&(U=!0)}}else{const Et=L(lt,x);if(Et!==!0)return v(Et.err.code,Et.err.msg,A(y,E-lt.length+Et.err.line));if(U===!0)return v("InvalidXml","Multiple possible root nodes found.",A(y,E));I.push({tagName:K,tagStartPos:$}),w=!0}for(E++;E<y.length;E++)if(y[E]==="<"){if(y[E+1]==="!"){E++,E=B(y,E);continue}if(y[E+1]!=="?")break;if(E=Q(y,++E),E.err)return E}else if(y[E]==="&"){const Et=f(y,E);if(Et==-1)return v("InvalidChar","char '&' is not expected.",A(y,E));E=Et}y[E]==="<"&&E--}}}var R;return w?I.length==1?v("InvalidTag","Unclosed tag '"+I[0].tagName+"'.",A(y,I[0].tagStartPos)):!(I.length>0)||v("InvalidXml","Invalid '"+JSON.stringify(I.map(E=>E.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):v("InvalidXml","Start tag expected.",1)};const D='"',O="'";function V(y,x){let I="",w="",U=!1;for(;x<y.length;x++){if(y[x]===D||y[x]===O)w===""?w=y[x]:w!==y[x]||(w="");else if(y[x]===">"&&w===""){U=!0;break}I+=y[x]}return w===""&&{value:I,index:x,tagClosed:U}}const M=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function L(y,x){const I=l.getAllMatches(y,M),w={};for(let U=0;U<I.length;U++){if(I[U][1].length===0)return v("InvalidAttr","Attribute '"+I[U][2]+"' has no space in starting.",p(I[U]));if(I[U][3]===void 0&&!x.allowBooleanAttributes)return v("InvalidAttr","boolean attribute '"+I[U][2]+"' is not allowed.",p(I[U]));const R=I[U][2];if(!h(R))return v("InvalidAttr","Attribute '"+R+"' is an invalid name.",p(I[U]));if(w.hasOwnProperty(R))return v("InvalidAttr","Attribute '"+R+"' is repeated.",p(I[U]));w[R]=1}return!0}function f(y,x){if(y[++x]===";")return-1;if(y[x]==="#")return function(w,U){let R=/\d/;for(w[U]==="x"&&(U++,R=/[\da-fA-F]/);U<w.length;U++){if(w[U]===";")return U;if(!w[U].match(R))break}return-1}(y,++x);let I=0;for(;x<y.length;x++,I++)if(!(y[x].match(/\w/)&&I<20)){if(y[x]===";")break;return-1}return x}function v(y,x,I){return{err:{code:y,msg:x,line:I.line||I,col:I.col}}}function h(y){return l.isName(y)}function A(y,x){const I=y.substring(0,x).split(/\r?\n/);return{line:I.length,col:I[I.length-1].length+1}}function p(y){return y.startIndex+y[1].length}},"./node_modules/fast-xml-parser/src/xmlNode.js":X=>{X.exports=function(k,b,l){this.tagname=k,this.parent=b,this.child={},this.attrsMap={},this.val=l,this.addChild=function(S){Array.isArray(this.child[S.tagname])?this.child[S.tagname].push(S):this.child[S.tagname]=[S]}}},"./node_modules/fast-xml-parser/src/xmlstr2xmlnode.js":(X,k,b)=>{const l=b("./node_modules/fast-xml-parser/src/util.js"),S=b("./node_modules/fast-xml-parser/src/util.js").buildOptions,C=b("./node_modules/fast-xml-parser/src/xmlNode.js"),Q=b("./node_modules/strnum/strnum.js");"<((!\\[CDATA\\[([\\s\\S]*?)(]]>))|((NAME:)?(NAME))([^>]*)>|((\\/)(NAME)\\s*>))([^<]*)".replace(/NAME/g,l.nameRegexp),!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const B={attributeNamePrefix:"@_",attrNodeName:!1,textNodeName:"#text",ignoreAttributes:!0,ignoreNameSpace:!1,allowBooleanAttributes:!1,parseNodeValue:!0,parseAttributeValue:!1,arrayMode:!1,trimValues:!0,cdataTagName:!1,cdataPositionChar:"\\c",numParseOptions:{hex:!0,leadingZeros:!0},tagValueProcessor:function(A,p){return A},attrValueProcessor:function(A,p){return A},stopNodes:[],alwaysCreateTextNode:!1};k.defaultOptions=B;const D=["attributeNamePrefix","attrNodeName","textNodeName","ignoreAttributes","ignoreNameSpace","allowBooleanAttributes","parseNodeValue","parseAttributeValue","arrayMode","trimValues","cdataTagName","cdataPositionChar","tagValueProcessor","attrValueProcessor","parseTrueNumberOnly","numParseOptions","stopNodes","alwaysCreateTextNode"];function O(A,p,y){return p&&(y.trimValues&&(p=p.trim()),p=M(p=y.tagValueProcessor(p,A),y.parseNodeValue,y.numParseOptions)),p}function V(A,p){if(p.ignoreNameSpace){const y=A.split(":"),x=A.charAt(0)==="/"?"/":"";if(y[0]==="xmlns")return"";y.length===2&&(A=x+y[1])}return A}function M(A,p,y){if(p&&typeof A=="string"){const x=A.trim();return x==="true"||x!=="false"&&Q(A,y)}return l.isExist(A)?A:""}k.props=D;const L=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])(.*?)\\3)?`,"g");function f(A,p){if(!p.ignoreAttributes&&typeof A=="string"){A=A.replace(/\r?\n/g," ");const y=l.getAllMatches(A,L),x=y.length,I={};for(let w=0;w<x;w++){const U=V(y[w][1],p);U.length&&(y[w][4]!==void 0?(p.trimValues&&(y[w][4]=y[w][4].trim()),y[w][4]=p.attrValueProcessor(y[w][4],U),I[p.attributeNamePrefix+U]=M(y[w][4],p.parseAttributeValue,p.numParseOptions)):p.allowBooleanAttributes&&(I[p.attributeNamePrefix+U]=!0))}if(!Object.keys(I).length)return;if(p.attrNodeName){const w={};return w[p.attrNodeName]=I,w}return I}}function v(A,p){let y,x="";for(let I=p;I<A.length;I++){let w=A[I];if(y)w===y&&(y="");else if(w==='"'||w==="'")y=w;else{if(w===">")return{data:x,index:I};w==="	"&&(w=" ")}x+=w}}function h(A,p,y,x){const I=A.indexOf(p,y);if(I===-1)throw new Error(x);return I+p.length-1}k.getTraversalObj=function(A,p){A=A.replace(/\r\n?/g,`
`),p=S(p,B,D);const y=new C("!xml");let x=y,I="";for(let w=0;w<A.length;w++)if(A[w]==="<")if(A[w+1]==="/"){const U=h(A,">",w,"Closing Tag is not closed.");let R=A.substring(w+2,U).trim();if(p.ignoreNameSpace){const E=R.indexOf(":");E!==-1&&(R=R.substr(E+1))}x&&(x.val?x.val=l.getValue(x.val)+""+O(R,I,p):x.val=O(R,I,p)),p.stopNodes.length&&p.stopNodes.includes(x.tagname)&&(x.child=[],x.attrsMap==null&&(x.attrsMap={}),x.val=A.substr(x.startIndex+1,w-x.startIndex-1)),x=x.parent,I="",w=U}else if(A[w+1]==="?")w=h(A,"?>",w,"Pi Tag is not closed.");else if(A.substr(w+1,3)==="!--")w=h(A,"-->",w,"Comment is not closed.");else if(A.substr(w+1,2)==="!D"){const U=h(A,">",w,"DOCTYPE is not closed.");w=A.substring(w,U).indexOf("[")>=0?A.indexOf("]>",w)+1:U}else if(A.substr(w+1,2)==="!["){const U=h(A,"]]>",w,"CDATA is not closed.")-2,R=A.substring(w+9,U);if(I&&(x.val=l.getValue(x.val)+""+O(x.tagname,I,p),I=""),p.cdataTagName){const E=new C(p.cdataTagName,x,R);x.addChild(E),x.val=l.getValue(x.val)+p.cdataPositionChar,R&&(E.val=R)}else x.val=(x.val||"")+(R||"");w=U+2}else{const U=v(A,w+1);let R=U.data;const E=U.index,$=R.indexOf(" ");let G=R,K=!0;if($!==-1&&(G=R.substr(0,$).replace(/\s\s*$/,""),R=R.substr($+1)),p.ignoreNameSpace){const m=G.indexOf(":");m!==-1&&(G=G.substr(m+1),K=G!==U.data.substr(m+1))}if(x&&I&&x.tagname!=="!xml"&&(x.val=l.getValue(x.val)+""+O(x.tagname,I,p)),R.length>0&&R.lastIndexOf("/")===R.length-1){G[G.length-1]==="/"?(G=G.substr(0,G.length-1),R=G):R=R.substr(0,R.length-1);const m=new C(G,x,"");G!==R&&(m.attrsMap=f(R,p)),x.addChild(m)}else{const m=new C(G,x);p.stopNodes.length&&p.stopNodes.includes(m.tagname)&&(m.startIndex=E),G!==R&&K&&(m.attrsMap=f(R,p)),x.addChild(m),x=m}I="",w=E}else I+=A[w];return y}},"./node_modules/pako/index.js":(X,k,b)=>{var l={};(0,b("./node_modules/pako/lib/utils/common.js").assign)(l,b("./node_modules/pako/lib/deflate.js"),b("./node_modules/pako/lib/inflate.js"),b("./node_modules/pako/lib/zlib/constants.js")),X.exports=l},"./node_modules/pako/lib/deflate.js":(X,k,b)=>{var l=b("./node_modules/pako/lib/zlib/deflate.js"),S=b("./node_modules/pako/lib/utils/common.js"),C=b("./node_modules/pako/lib/utils/strings.js"),Q=b("./node_modules/pako/lib/zlib/messages.js"),B=b("./node_modules/pako/lib/zlib/zstream.js"),D=Object.prototype.toString,O=0,V=-1,M=0,L=8;function f(h){if(!(this instanceof f))return new f(h);this.options=S.assign({level:V,method:L,chunkSize:16384,windowBits:15,memLevel:8,strategy:M,to:""},h||{});var A=this.options;A.raw&&A.windowBits>0?A.windowBits=-A.windowBits:A.gzip&&A.windowBits>0&&A.windowBits<16&&(A.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new B,this.strm.avail_out=0;var p=l.deflateInit2(this.strm,A.level,A.method,A.windowBits,A.memLevel,A.strategy);if(p!==O)throw new Error(Q[p]);if(A.header&&l.deflateSetHeader(this.strm,A.header),A.dictionary){var y;if(y=typeof A.dictionary=="string"?C.string2buf(A.dictionary):D.call(A.dictionary)==="[object ArrayBuffer]"?new Uint8Array(A.dictionary):A.dictionary,(p=l.deflateSetDictionary(this.strm,y))!==O)throw new Error(Q[p]);this._dict_set=!0}}function v(h,A){var p=new f(A);if(p.push(h,!0),p.err)throw p.msg||Q[p.err];return p.result}f.prototype.push=function(h,A){var p,y,x=this.strm,I=this.options.chunkSize;if(this.ended)return!1;y=A===~~A?A:A===!0?4:0,typeof h=="string"?x.input=C.string2buf(h):D.call(h)==="[object ArrayBuffer]"?x.input=new Uint8Array(h):x.input=h,x.next_in=0,x.avail_in=x.input.length;do{if(x.avail_out===0&&(x.output=new S.Buf8(I),x.next_out=0,x.avail_out=I),(p=l.deflate(x,y))!==1&&p!==O)return this.onEnd(p),this.ended=!0,!1;x.avail_out!==0&&(x.avail_in!==0||y!==4&&y!==2)||(this.options.to==="string"?this.onData(C.buf2binstring(S.shrinkBuf(x.output,x.next_out))):this.onData(S.shrinkBuf(x.output,x.next_out)))}while((x.avail_in>0||x.avail_out===0)&&p!==1);return y===4?(p=l.deflateEnd(this.strm),this.onEnd(p),this.ended=!0,p===O):y!==2||(this.onEnd(O),x.avail_out=0,!0)},f.prototype.onData=function(h){this.chunks.push(h)},f.prototype.onEnd=function(h){h===O&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=S.flattenChunks(this.chunks)),this.chunks=[],this.err=h,this.msg=this.strm.msg},k.Deflate=f,k.deflate=v,k.deflateRaw=function(h,A){return(A=A||{}).raw=!0,v(h,A)},k.gzip=function(h,A){return(A=A||{}).gzip=!0,v(h,A)}},"./node_modules/pako/lib/inflate.js":(X,k,b)=>{var l=b("./node_modules/pako/lib/zlib/inflate.js"),S=b("./node_modules/pako/lib/utils/common.js"),C=b("./node_modules/pako/lib/utils/strings.js"),Q=b("./node_modules/pako/lib/zlib/constants.js"),B=b("./node_modules/pako/lib/zlib/messages.js"),D=b("./node_modules/pako/lib/zlib/zstream.js"),O=b("./node_modules/pako/lib/zlib/gzheader.js"),V=Object.prototype.toString;function M(f){if(!(this instanceof M))return new M(f);this.options=S.assign({chunkSize:16384,windowBits:0,to:""},f||{});var v=this.options;v.raw&&v.windowBits>=0&&v.windowBits<16&&(v.windowBits=-v.windowBits,v.windowBits===0&&(v.windowBits=-15)),!(v.windowBits>=0&&v.windowBits<16)||f&&f.windowBits||(v.windowBits+=32),v.windowBits>15&&v.windowBits<48&&!(15&v.windowBits)&&(v.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new D,this.strm.avail_out=0;var h=l.inflateInit2(this.strm,v.windowBits);if(h!==Q.Z_OK)throw new Error(B[h]);if(this.header=new O,l.inflateGetHeader(this.strm,this.header),v.dictionary&&(typeof v.dictionary=="string"?v.dictionary=C.string2buf(v.dictionary):V.call(v.dictionary)==="[object ArrayBuffer]"&&(v.dictionary=new Uint8Array(v.dictionary)),v.raw&&(h=l.inflateSetDictionary(this.strm,v.dictionary))!==Q.Z_OK))throw new Error(B[h])}function L(f,v){var h=new M(v);if(h.push(f,!0),h.err)throw h.msg||B[h.err];return h.result}M.prototype.push=function(f,v){var h,A,p,y,x,I=this.strm,w=this.options.chunkSize,U=this.options.dictionary,R=!1;if(this.ended)return!1;A=v===~~v?v:v===!0?Q.Z_FINISH:Q.Z_NO_FLUSH,typeof f=="string"?I.input=C.binstring2buf(f):V.call(f)==="[object ArrayBuffer]"?I.input=new Uint8Array(f):I.input=f,I.next_in=0,I.avail_in=I.input.length;do{if(I.avail_out===0&&(I.output=new S.Buf8(w),I.next_out=0,I.avail_out=w),(h=l.inflate(I,Q.Z_NO_FLUSH))===Q.Z_NEED_DICT&&U&&(h=l.inflateSetDictionary(this.strm,U)),h===Q.Z_BUF_ERROR&&R===!0&&(h=Q.Z_OK,R=!1),h!==Q.Z_STREAM_END&&h!==Q.Z_OK)return this.onEnd(h),this.ended=!0,!1;I.next_out&&(I.avail_out!==0&&h!==Q.Z_STREAM_END&&(I.avail_in!==0||A!==Q.Z_FINISH&&A!==Q.Z_SYNC_FLUSH)||(this.options.to==="string"?(p=C.utf8border(I.output,I.next_out),y=I.next_out-p,x=C.buf2string(I.output,p),I.next_out=y,I.avail_out=w-y,y&&S.arraySet(I.output,I.output,p,y,0),this.onData(x)):this.onData(S.shrinkBuf(I.output,I.next_out)))),I.avail_in===0&&I.avail_out===0&&(R=!0)}while((I.avail_in>0||I.avail_out===0)&&h!==Q.Z_STREAM_END);return h===Q.Z_STREAM_END&&(A=Q.Z_FINISH),A===Q.Z_FINISH?(h=l.inflateEnd(this.strm),this.onEnd(h),this.ended=!0,h===Q.Z_OK):A!==Q.Z_SYNC_FLUSH||(this.onEnd(Q.Z_OK),I.avail_out=0,!0)},M.prototype.onData=function(f){this.chunks.push(f)},M.prototype.onEnd=function(f){f===Q.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=S.flattenChunks(this.chunks)),this.chunks=[],this.err=f,this.msg=this.strm.msg},k.Inflate=M,k.inflate=L,k.inflateRaw=function(f,v){return(v=v||{}).raw=!0,L(f,v)},k.ungzip=L},"./node_modules/pako/lib/utils/common.js":(X,k)=>{var b=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function l(Q,B){return Object.prototype.hasOwnProperty.call(Q,B)}k.assign=function(Q){for(var B=Array.prototype.slice.call(arguments,1);B.length;){var D=B.shift();if(D){if(typeof D!="object")throw new TypeError(D+"must be non-object");for(var O in D)l(D,O)&&(Q[O]=D[O])}}return Q},k.shrinkBuf=function(Q,B){return Q.length===B?Q:Q.subarray?Q.subarray(0,B):(Q.length=B,Q)};var S={arraySet:function(Q,B,D,O,V){if(B.subarray&&Q.subarray)Q.set(B.subarray(D,D+O),V);else for(var M=0;M<O;M++)Q[V+M]=B[D+M]},flattenChunks:function(Q){var B,D,O,V,M,L;for(O=0,B=0,D=Q.length;B<D;B++)O+=Q[B].length;for(L=new Uint8Array(O),V=0,B=0,D=Q.length;B<D;B++)M=Q[B],L.set(M,V),V+=M.length;return L}},C={arraySet:function(Q,B,D,O,V){for(var M=0;M<O;M++)Q[V+M]=B[D+M]},flattenChunks:function(Q){return[].concat.apply([],Q)}};k.setTyped=function(Q){Q?(k.Buf8=Uint8Array,k.Buf16=Uint16Array,k.Buf32=Int32Array,k.assign(k,S)):(k.Buf8=Array,k.Buf16=Array,k.Buf32=Array,k.assign(k,C))},k.setTyped(b)},"./node_modules/pako/lib/utils/strings.js":(X,k,b)=>{var l=b("./node_modules/pako/lib/utils/common.js"),S=!0,C=!0;try{String.fromCharCode.apply(null,[0])}catch{S=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{C=!1}for(var Q=new l.Buf8(256),B=0;B<256;B++)Q[B]=B>=252?6:B>=248?5:B>=240?4:B>=224?3:B>=192?2:1;function D(O,V){if(V<65534&&(O.subarray&&C||!O.subarray&&S))return String.fromCharCode.apply(null,l.shrinkBuf(O,V));for(var M="",L=0;L<V;L++)M+=String.fromCharCode(O[L]);return M}Q[254]=Q[254]=1,k.string2buf=function(O){var V,M,L,f,v,h=O.length,A=0;for(f=0;f<h;f++)(64512&(M=O.charCodeAt(f)))==55296&&f+1<h&&(64512&(L=O.charCodeAt(f+1)))==56320&&(M=65536+(M-55296<<10)+(L-56320),f++),A+=M<128?1:M<2048?2:M<65536?3:4;for(V=new l.Buf8(A),v=0,f=0;v<A;f++)(64512&(M=O.charCodeAt(f)))==55296&&f+1<h&&(64512&(L=O.charCodeAt(f+1)))==56320&&(M=65536+(M-55296<<10)+(L-56320),f++),M<128?V[v++]=M:M<2048?(V[v++]=192|M>>>6,V[v++]=128|63&M):M<65536?(V[v++]=224|M>>>12,V[v++]=128|M>>>6&63,V[v++]=128|63&M):(V[v++]=240|M>>>18,V[v++]=128|M>>>12&63,V[v++]=128|M>>>6&63,V[v++]=128|63&M);return V},k.buf2binstring=function(O){return D(O,O.length)},k.binstring2buf=function(O){for(var V=new l.Buf8(O.length),M=0,L=V.length;M<L;M++)V[M]=O.charCodeAt(M);return V},k.buf2string=function(O,V){var M,L,f,v,h=V||O.length,A=new Array(2*h);for(L=0,M=0;M<h;)if((f=O[M++])<128)A[L++]=f;else if((v=Q[f])>4)A[L++]=65533,M+=v-1;else{for(f&=v===2?31:v===3?15:7;v>1&&M<h;)f=f<<6|63&O[M++],v--;v>1?A[L++]=65533:f<65536?A[L++]=f:(f-=65536,A[L++]=55296|f>>10&1023,A[L++]=56320|1023&f)}return D(A,L)},k.utf8border=function(O,V){var M;for((V=V||O.length)>O.length&&(V=O.length),M=V-1;M>=0&&(192&O[M])==128;)M--;return M<0||M===0?V:M+Q[O[M]]>V?M:V}},"./node_modules/pako/lib/zlib/adler32.js":X=>{X.exports=function(k,b,l,S){for(var C=65535&k|0,Q=k>>>16&65535|0,B=0;l!==0;){l-=B=l>2e3?2e3:l;do Q=Q+(C=C+b[S++]|0)|0;while(--B);C%=65521,Q%=65521}return C|Q<<16|0}},"./node_modules/pako/lib/zlib/constants.js":X=>{X.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},"./node_modules/pako/lib/zlib/crc32.js":X=>{var k=function(){for(var b,l=[],S=0;S<256;S++){b=S;for(var C=0;C<8;C++)b=1&b?3988292384^b>>>1:b>>>1;l[S]=b}return l}();X.exports=function(b,l,S,C){var Q=k,B=C+S;b^=-1;for(var D=C;D<B;D++)b=b>>>8^Q[255&(b^l[D])];return-1^b}},"./node_modules/pako/lib/zlib/deflate.js":(X,k,b)=>{var l,S=b("./node_modules/pako/lib/utils/common.js"),C=b("./node_modules/pako/lib/zlib/trees.js"),Q=b("./node_modules/pako/lib/zlib/adler32.js"),B=b("./node_modules/pako/lib/zlib/crc32.js"),D=b("./node_modules/pako/lib/zlib/messages.js"),O=0,V=0,M=-2,L=2,f=8,v=286,h=30,A=19,p=2*v+1,y=15,x=3,I=258,w=I+x+1,U=42,R=103,E=113,$=666;function G(g,it){return g.msg=D[it],it}function K(g){return(g<<1)-(g>4?9:0)}function m(g){for(var it=g.length;--it>=0;)g[it]=0}function lt(g){var it=g.state,ut=it.pending;ut>g.avail_out&&(ut=g.avail_out),ut!==0&&(S.arraySet(g.output,it.pending_buf,it.pending_out,ut,g.next_out),g.next_out+=ut,it.pending_out+=ut,g.total_out+=ut,g.avail_out-=ut,it.pending-=ut,it.pending===0&&(it.pending_out=0))}function Et(g,it){C._tr_flush_block(g,g.block_start>=0?g.block_start:-1,g.strstart-g.block_start,it),g.block_start=g.strstart,lt(g.strm)}function dt(g,it){g.pending_buf[g.pending++]=it}function Ut(g,it){g.pending_buf[g.pending++]=it>>>8&255,g.pending_buf[g.pending++]=255&it}function At(g,it){var ut,F,St=g.max_chain_length,gt=g.strstart,pt=g.prev_length,ht=g.nice_match,ct=g.strstart>g.w_size-w?g.strstart-(g.w_size-w):0,vt=g.window,Qt=g.w_mask,bt=g.prev,Gt=g.strstart+I,oe=vt[gt+pt-1],jt=vt[gt+pt];g.prev_length>=g.good_match&&(St>>=2),ht>g.lookahead&&(ht=g.lookahead);do if(vt[(ut=it)+pt]===jt&&vt[ut+pt-1]===oe&&vt[ut]===vt[gt]&&vt[++ut]===vt[gt+1]){gt+=2,ut++;do;while(vt[++gt]===vt[++ut]&&vt[++gt]===vt[++ut]&&vt[++gt]===vt[++ut]&&vt[++gt]===vt[++ut]&&vt[++gt]===vt[++ut]&&vt[++gt]===vt[++ut]&&vt[++gt]===vt[++ut]&&vt[++gt]===vt[++ut]&&gt<Gt);if(F=I-(Gt-gt),gt=Gt-I,F>pt){if(g.match_start=it,pt=F,F>=ht)break;oe=vt[gt+pt-1],jt=vt[gt+pt]}}while((it=bt[it&Qt])>ct&&--St!=0);return pt<=g.lookahead?pt:g.lookahead}function It(g){var it,ut,F,St,gt,pt,ht,ct,vt,Qt,bt=g.w_size;do{if(St=g.window_size-g.lookahead-g.strstart,g.strstart>=bt+(bt-w)){S.arraySet(g.window,g.window,bt,bt,0),g.match_start-=bt,g.strstart-=bt,g.block_start-=bt,it=ut=g.hash_size;do F=g.head[--it],g.head[it]=F>=bt?F-bt:0;while(--ut);it=ut=bt;do F=g.prev[--it],g.prev[it]=F>=bt?F-bt:0;while(--ut);St+=bt}if(g.strm.avail_in===0)break;if(pt=g.strm,ht=g.window,ct=g.strstart+g.lookahead,vt=St,Qt=void 0,(Qt=pt.avail_in)>vt&&(Qt=vt),ut=Qt===0?0:(pt.avail_in-=Qt,S.arraySet(ht,pt.input,pt.next_in,Qt,ct),pt.state.wrap===1?pt.adler=Q(pt.adler,ht,Qt,ct):pt.state.wrap===2&&(pt.adler=B(pt.adler,ht,Qt,ct)),pt.next_in+=Qt,pt.total_in+=Qt,Qt),g.lookahead+=ut,g.lookahead+g.insert>=x)for(gt=g.strstart-g.insert,g.ins_h=g.window[gt],g.ins_h=(g.ins_h<<g.hash_shift^g.window[gt+1])&g.hash_mask;g.insert&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[gt+x-1])&g.hash_mask,g.prev[gt&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=gt,gt++,g.insert--,!(g.lookahead+g.insert<x)););}while(g.lookahead<w&&g.strm.avail_in!==0)}function yt(g,it){for(var ut,F;;){if(g.lookahead<w){if(It(g),g.lookahead<w&&it===O)return 1;if(g.lookahead===0)break}if(ut=0,g.lookahead>=x&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+x-1])&g.hash_mask,ut=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart),ut!==0&&g.strstart-ut<=g.w_size-w&&(g.match_length=At(g,ut)),g.match_length>=x)if(F=C._tr_tally(g,g.strstart-g.match_start,g.match_length-x),g.lookahead-=g.match_length,g.match_length<=g.max_lazy_match&&g.lookahead>=x){g.match_length--;do g.strstart++,g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+x-1])&g.hash_mask,ut=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart;while(--g.match_length!=0);g.strstart++}else g.strstart+=g.match_length,g.match_length=0,g.ins_h=g.window[g.strstart],g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+1])&g.hash_mask;else F=C._tr_tally(g,0,g.window[g.strstart]),g.lookahead--,g.strstart++;if(F&&(Et(g,!1),g.strm.avail_out===0))return 1}return g.insert=g.strstart<x-1?g.strstart:x-1,it===4?(Et(g,!0),g.strm.avail_out===0?3:4):g.last_lit&&(Et(g,!1),g.strm.avail_out===0)?1:2}function wt(g,it){for(var ut,F,St;;){if(g.lookahead<w){if(It(g),g.lookahead<w&&it===O)return 1;if(g.lookahead===0)break}if(ut=0,g.lookahead>=x&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+x-1])&g.hash_mask,ut=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart),g.prev_length=g.match_length,g.prev_match=g.match_start,g.match_length=x-1,ut!==0&&g.prev_length<g.max_lazy_match&&g.strstart-ut<=g.w_size-w&&(g.match_length=At(g,ut),g.match_length<=5&&(g.strategy===1||g.match_length===x&&g.strstart-g.match_start>4096)&&(g.match_length=x-1)),g.prev_length>=x&&g.match_length<=g.prev_length){St=g.strstart+g.lookahead-x,F=C._tr_tally(g,g.strstart-1-g.prev_match,g.prev_length-x),g.lookahead-=g.prev_length-1,g.prev_length-=2;do++g.strstart<=St&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+x-1])&g.hash_mask,ut=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart);while(--g.prev_length!=0);if(g.match_available=0,g.match_length=x-1,g.strstart++,F&&(Et(g,!1),g.strm.avail_out===0))return 1}else if(g.match_available){if((F=C._tr_tally(g,0,g.window[g.strstart-1]))&&Et(g,!1),g.strstart++,g.lookahead--,g.strm.avail_out===0)return 1}else g.match_available=1,g.strstart++,g.lookahead--}return g.match_available&&(F=C._tr_tally(g,0,g.window[g.strstart-1]),g.match_available=0),g.insert=g.strstart<x-1?g.strstart:x-1,it===4?(Et(g,!0),g.strm.avail_out===0?3:4):g.last_lit&&(Et(g,!1),g.strm.avail_out===0)?1:2}function ie(g,it,ut,F,St){this.good_length=g,this.max_lazy=it,this.nice_length=ut,this.max_chain=F,this.func=St}function zt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=f,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new S.Buf16(2*p),this.dyn_dtree=new S.Buf16(2*(2*h+1)),this.bl_tree=new S.Buf16(2*(2*A+1)),m(this.dyn_ltree),m(this.dyn_dtree),m(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new S.Buf16(y+1),this.heap=new S.Buf16(2*v+1),m(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new S.Buf16(2*v+1),m(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Mt(g){var it;return g&&g.state?(g.total_in=g.total_out=0,g.data_type=L,(it=g.state).pending=0,it.pending_out=0,it.wrap<0&&(it.wrap=-it.wrap),it.status=it.wrap?U:E,g.adler=it.wrap===2?0:1,it.last_flush=O,C._tr_init(it),V):G(g,M)}function ae(g){var it,ut=Mt(g);return ut===V&&((it=g.state).window_size=2*it.w_size,m(it.head),it.max_lazy_match=l[it.level].max_lazy,it.good_match=l[it.level].good_length,it.nice_match=l[it.level].nice_length,it.max_chain_length=l[it.level].max_chain,it.strstart=0,it.block_start=0,it.lookahead=0,it.insert=0,it.match_length=it.prev_length=x-1,it.match_available=0,it.ins_h=0),ut}function st(g,it,ut,F,St,gt){if(!g)return M;var pt=1;if(it===-1&&(it=6),F<0?(pt=0,F=-F):F>15&&(pt=2,F-=16),St<1||St>9||ut!==f||F<8||F>15||it<0||it>9||gt<0||gt>4)return G(g,M);F===8&&(F=9);var ht=new zt;return g.state=ht,ht.strm=g,ht.wrap=pt,ht.gzhead=null,ht.w_bits=F,ht.w_size=1<<ht.w_bits,ht.w_mask=ht.w_size-1,ht.hash_bits=St+7,ht.hash_size=1<<ht.hash_bits,ht.hash_mask=ht.hash_size-1,ht.hash_shift=~~((ht.hash_bits+x-1)/x),ht.window=new S.Buf8(2*ht.w_size),ht.head=new S.Buf16(ht.hash_size),ht.prev=new S.Buf16(ht.w_size),ht.lit_bufsize=1<<St+6,ht.pending_buf_size=4*ht.lit_bufsize,ht.pending_buf=new S.Buf8(ht.pending_buf_size),ht.d_buf=1*ht.lit_bufsize,ht.l_buf=3*ht.lit_bufsize,ht.level=it,ht.strategy=gt,ht.method=ut,ae(g)}l=[new ie(0,0,0,0,function(g,it){var ut=65535;for(ut>g.pending_buf_size-5&&(ut=g.pending_buf_size-5);;){if(g.lookahead<=1){if(It(g),g.lookahead===0&&it===O)return 1;if(g.lookahead===0)break}g.strstart+=g.lookahead,g.lookahead=0;var F=g.block_start+ut;if((g.strstart===0||g.strstart>=F)&&(g.lookahead=g.strstart-F,g.strstart=F,Et(g,!1),g.strm.avail_out===0)||g.strstart-g.block_start>=g.w_size-w&&(Et(g,!1),g.strm.avail_out===0))return 1}return g.insert=0,it===4?(Et(g,!0),g.strm.avail_out===0?3:4):(g.strstart>g.block_start&&(Et(g,!1),g.strm.avail_out),1)}),new ie(4,4,8,4,yt),new ie(4,5,16,8,yt),new ie(4,6,32,32,yt),new ie(4,4,16,16,wt),new ie(8,16,32,32,wt),new ie(8,16,128,128,wt),new ie(8,32,128,256,wt),new ie(32,128,258,1024,wt),new ie(32,258,258,4096,wt)],k.deflateInit=function(g,it){return st(g,it,f,15,8,0)},k.deflateInit2=st,k.deflateReset=ae,k.deflateResetKeep=Mt,k.deflateSetHeader=function(g,it){return g&&g.state?g.state.wrap!==2?M:(g.state.gzhead=it,V):M},k.deflate=function(g,it){var ut,F,St,gt;if(!g||!g.state||it>5||it<0)return g?G(g,M):M;if(F=g.state,!g.output||!g.input&&g.avail_in!==0||F.status===$&&it!==4)return G(g,g.avail_out===0?-5:M);if(F.strm=g,ut=F.last_flush,F.last_flush=it,F.status===U)if(F.wrap===2)g.adler=0,dt(F,31),dt(F,139),dt(F,8),F.gzhead?(dt(F,(F.gzhead.text?1:0)+(F.gzhead.hcrc?2:0)+(F.gzhead.extra?4:0)+(F.gzhead.name?8:0)+(F.gzhead.comment?16:0)),dt(F,255&F.gzhead.time),dt(F,F.gzhead.time>>8&255),dt(F,F.gzhead.time>>16&255),dt(F,F.gzhead.time>>24&255),dt(F,F.level===9?2:F.strategy>=2||F.level<2?4:0),dt(F,255&F.gzhead.os),F.gzhead.extra&&F.gzhead.extra.length&&(dt(F,255&F.gzhead.extra.length),dt(F,F.gzhead.extra.length>>8&255)),F.gzhead.hcrc&&(g.adler=B(g.adler,F.pending_buf,F.pending,0)),F.gzindex=0,F.status=69):(dt(F,0),dt(F,0),dt(F,0),dt(F,0),dt(F,0),dt(F,F.level===9?2:F.strategy>=2||F.level<2?4:0),dt(F,3),F.status=E);else{var pt=f+(F.w_bits-8<<4)<<8;pt|=(F.strategy>=2||F.level<2?0:F.level<6?1:F.level===6?2:3)<<6,F.strstart!==0&&(pt|=32),pt+=31-pt%31,F.status=E,Ut(F,pt),F.strstart!==0&&(Ut(F,g.adler>>>16),Ut(F,65535&g.adler)),g.adler=1}if(F.status===69)if(F.gzhead.extra){for(St=F.pending;F.gzindex<(65535&F.gzhead.extra.length)&&(F.pending!==F.pending_buf_size||(F.gzhead.hcrc&&F.pending>St&&(g.adler=B(g.adler,F.pending_buf,F.pending-St,St)),lt(g),St=F.pending,F.pending!==F.pending_buf_size));)dt(F,255&F.gzhead.extra[F.gzindex]),F.gzindex++;F.gzhead.hcrc&&F.pending>St&&(g.adler=B(g.adler,F.pending_buf,F.pending-St,St)),F.gzindex===F.gzhead.extra.length&&(F.gzindex=0,F.status=73)}else F.status=73;if(F.status===73)if(F.gzhead.name){St=F.pending;do{if(F.pending===F.pending_buf_size&&(F.gzhead.hcrc&&F.pending>St&&(g.adler=B(g.adler,F.pending_buf,F.pending-St,St)),lt(g),St=F.pending,F.pending===F.pending_buf_size)){gt=1;break}gt=F.gzindex<F.gzhead.name.length?255&F.gzhead.name.charCodeAt(F.gzindex++):0,dt(F,gt)}while(gt!==0);F.gzhead.hcrc&&F.pending>St&&(g.adler=B(g.adler,F.pending_buf,F.pending-St,St)),gt===0&&(F.gzindex=0,F.status=91)}else F.status=91;if(F.status===91)if(F.gzhead.comment){St=F.pending;do{if(F.pending===F.pending_buf_size&&(F.gzhead.hcrc&&F.pending>St&&(g.adler=B(g.adler,F.pending_buf,F.pending-St,St)),lt(g),St=F.pending,F.pending===F.pending_buf_size)){gt=1;break}gt=F.gzindex<F.gzhead.comment.length?255&F.gzhead.comment.charCodeAt(F.gzindex++):0,dt(F,gt)}while(gt!==0);F.gzhead.hcrc&&F.pending>St&&(g.adler=B(g.adler,F.pending_buf,F.pending-St,St)),gt===0&&(F.status=R)}else F.status=R;if(F.status===R&&(F.gzhead.hcrc?(F.pending+2>F.pending_buf_size&&lt(g),F.pending+2<=F.pending_buf_size&&(dt(F,255&g.adler),dt(F,g.adler>>8&255),g.adler=0,F.status=E)):F.status=E),F.pending!==0){if(lt(g),g.avail_out===0)return F.last_flush=-1,V}else if(g.avail_in===0&&K(it)<=K(ut)&&it!==4)return G(g,-5);if(F.status===$&&g.avail_in!==0)return G(g,-5);if(g.avail_in!==0||F.lookahead!==0||it!==O&&F.status!==$){var ht=F.strategy===2?function(ct,vt){for(var Qt;;){if(ct.lookahead===0&&(It(ct),ct.lookahead===0)){if(vt===O)return 1;break}if(ct.match_length=0,Qt=C._tr_tally(ct,0,ct.window[ct.strstart]),ct.lookahead--,ct.strstart++,Qt&&(Et(ct,!1),ct.strm.avail_out===0))return 1}return ct.insert=0,vt===4?(Et(ct,!0),ct.strm.avail_out===0?3:4):ct.last_lit&&(Et(ct,!1),ct.strm.avail_out===0)?1:2}(F,it):F.strategy===3?function(ct,vt){for(var Qt,bt,Gt,oe,jt=ct.window;;){if(ct.lookahead<=I){if(It(ct),ct.lookahead<=I&&vt===O)return 1;if(ct.lookahead===0)break}if(ct.match_length=0,ct.lookahead>=x&&ct.strstart>0&&(bt=jt[Gt=ct.strstart-1])===jt[++Gt]&&bt===jt[++Gt]&&bt===jt[++Gt]){oe=ct.strstart+I;do;while(bt===jt[++Gt]&&bt===jt[++Gt]&&bt===jt[++Gt]&&bt===jt[++Gt]&&bt===jt[++Gt]&&bt===jt[++Gt]&&bt===jt[++Gt]&&bt===jt[++Gt]&&Gt<oe);ct.match_length=I-(oe-Gt),ct.match_length>ct.lookahead&&(ct.match_length=ct.lookahead)}if(ct.match_length>=x?(Qt=C._tr_tally(ct,1,ct.match_length-x),ct.lookahead-=ct.match_length,ct.strstart+=ct.match_length,ct.match_length=0):(Qt=C._tr_tally(ct,0,ct.window[ct.strstart]),ct.lookahead--,ct.strstart++),Qt&&(Et(ct,!1),ct.strm.avail_out===0))return 1}return ct.insert=0,vt===4?(Et(ct,!0),ct.strm.avail_out===0?3:4):ct.last_lit&&(Et(ct,!1),ct.strm.avail_out===0)?1:2}(F,it):l[F.level].func(F,it);if(ht!==3&&ht!==4||(F.status=$),ht===1||ht===3)return g.avail_out===0&&(F.last_flush=-1),V;if(ht===2&&(it===1?C._tr_align(F):it!==5&&(C._tr_stored_block(F,0,0,!1),it===3&&(m(F.head),F.lookahead===0&&(F.strstart=0,F.block_start=0,F.insert=0))),lt(g),g.avail_out===0))return F.last_flush=-1,V}return it!==4?V:F.wrap<=0?1:(F.wrap===2?(dt(F,255&g.adler),dt(F,g.adler>>8&255),dt(F,g.adler>>16&255),dt(F,g.adler>>24&255),dt(F,255&g.total_in),dt(F,g.total_in>>8&255),dt(F,g.total_in>>16&255),dt(F,g.total_in>>24&255)):(Ut(F,g.adler>>>16),Ut(F,65535&g.adler)),lt(g),F.wrap>0&&(F.wrap=-F.wrap),F.pending!==0?V:1)},k.deflateEnd=function(g){var it;return g&&g.state?(it=g.state.status)!==U&&it!==69&&it!==73&&it!==91&&it!==R&&it!==E&&it!==$?G(g,M):(g.state=null,it===E?G(g,-3):V):M},k.deflateSetDictionary=function(g,it){var ut,F,St,gt,pt,ht,ct,vt,Qt=it.length;if(!g||!g.state||(gt=(ut=g.state).wrap)===2||gt===1&&ut.status!==U||ut.lookahead)return M;for(gt===1&&(g.adler=Q(g.adler,it,Qt,0)),ut.wrap=0,Qt>=ut.w_size&&(gt===0&&(m(ut.head),ut.strstart=0,ut.block_start=0,ut.insert=0),vt=new S.Buf8(ut.w_size),S.arraySet(vt,it,Qt-ut.w_size,ut.w_size,0),it=vt,Qt=ut.w_size),pt=g.avail_in,ht=g.next_in,ct=g.input,g.avail_in=Qt,g.next_in=0,g.input=it,It(ut);ut.lookahead>=x;){F=ut.strstart,St=ut.lookahead-(x-1);do ut.ins_h=(ut.ins_h<<ut.hash_shift^ut.window[F+x-1])&ut.hash_mask,ut.prev[F&ut.w_mask]=ut.head[ut.ins_h],ut.head[ut.ins_h]=F,F++;while(--St);ut.strstart=F,ut.lookahead=x-1,It(ut)}return ut.strstart+=ut.lookahead,ut.block_start=ut.strstart,ut.insert=ut.lookahead,ut.lookahead=0,ut.match_length=ut.prev_length=x-1,ut.match_available=0,g.next_in=ht,g.input=ct,g.avail_in=pt,ut.wrap=gt,V},k.deflateInfo="pako deflate (from Nodeca project)"},"./node_modules/pako/lib/zlib/gzheader.js":X=>{X.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},"./node_modules/pako/lib/zlib/inffast.js":X=>{X.exports=function(k,b){var l,S,C,Q,B,D,O,V,M,L,f,v,h,A,p,y,x,I,w,U,R,E,$,G,K;l=k.state,S=k.next_in,G=k.input,C=S+(k.avail_in-5),Q=k.next_out,K=k.output,B=Q-(b-k.avail_out),D=Q+(k.avail_out-257),O=l.dmax,V=l.wsize,M=l.whave,L=l.wnext,f=l.window,v=l.hold,h=l.bits,A=l.lencode,p=l.distcode,y=(1<<l.lenbits)-1,x=(1<<l.distbits)-1;t:do{h<15&&(v+=G[S++]<<h,h+=8,v+=G[S++]<<h,h+=8),I=A[v&y];e:for(;;){if(v>>>=w=I>>>24,h-=w,(w=I>>>16&255)==0)K[Q++]=65535&I;else{if(!(16&w)){if(!(64&w)){I=A[(65535&I)+(v&(1<<w)-1)];continue e}if(32&w){l.mode=12;break t}k.msg="invalid literal/length code",l.mode=30;break t}U=65535&I,(w&=15)&&(h<w&&(v+=G[S++]<<h,h+=8),U+=v&(1<<w)-1,v>>>=w,h-=w),h<15&&(v+=G[S++]<<h,h+=8,v+=G[S++]<<h,h+=8),I=p[v&x];i:for(;;){if(v>>>=w=I>>>24,h-=w,!(16&(w=I>>>16&255))){if(!(64&w)){I=p[(65535&I)+(v&(1<<w)-1)];continue i}k.msg="invalid distance code",l.mode=30;break t}if(R=65535&I,h<(w&=15)&&(v+=G[S++]<<h,(h+=8)<w&&(v+=G[S++]<<h,h+=8)),(R+=v&(1<<w)-1)>O){k.msg="invalid distance too far back",l.mode=30;break t}if(v>>>=w,h-=w,R>(w=Q-B)){if((w=R-w)>M&&l.sane){k.msg="invalid distance too far back",l.mode=30;break t}if(E=0,$=f,L===0){if(E+=V-w,w<U){U-=w;do K[Q++]=f[E++];while(--w);E=Q-R,$=K}}else if(L<w){if(E+=V+L-w,(w-=L)<U){U-=w;do K[Q++]=f[E++];while(--w);if(E=0,L<U){U-=w=L;do K[Q++]=f[E++];while(--w);E=Q-R,$=K}}}else if(E+=L-w,w<U){U-=w;do K[Q++]=f[E++];while(--w);E=Q-R,$=K}for(;U>2;)K[Q++]=$[E++],K[Q++]=$[E++],K[Q++]=$[E++],U-=3;U&&(K[Q++]=$[E++],U>1&&(K[Q++]=$[E++]))}else{E=Q-R;do K[Q++]=K[E++],K[Q++]=K[E++],K[Q++]=K[E++],U-=3;while(U>2);U&&(K[Q++]=K[E++],U>1&&(K[Q++]=K[E++]))}break}}break}}while(S<C&&Q<D);S-=U=h>>3,v&=(1<<(h-=U<<3))-1,k.next_in=S,k.next_out=Q,k.avail_in=S<C?C-S+5:5-(S-C),k.avail_out=Q<D?D-Q+257:257-(Q-D),l.hold=v,l.bits=h}},"./node_modules/pako/lib/zlib/inflate.js":(X,k,b)=>{var l=b("./node_modules/pako/lib/utils/common.js"),S=b("./node_modules/pako/lib/zlib/adler32.js"),C=b("./node_modules/pako/lib/zlib/crc32.js"),Q=b("./node_modules/pako/lib/zlib/inffast.js"),B=b("./node_modules/pako/lib/zlib/inftrees.js"),D=0,O=-2,V=1,M=12,L=30,f=852,v=592;function h(G){return(G>>>24&255)+(G>>>8&65280)+((65280&G)<<8)+((255&G)<<24)}function A(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new l.Buf16(320),this.work=new l.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function p(G){var K;return G&&G.state?(K=G.state,G.total_in=G.total_out=K.total=0,G.msg="",K.wrap&&(G.adler=1&K.wrap),K.mode=V,K.last=0,K.havedict=0,K.dmax=32768,K.head=null,K.hold=0,K.bits=0,K.lencode=K.lendyn=new l.Buf32(f),K.distcode=K.distdyn=new l.Buf32(v),K.sane=1,K.back=-1,D):O}function y(G){var K;return G&&G.state?((K=G.state).wsize=0,K.whave=0,K.wnext=0,p(G)):O}function x(G,K){var m,lt;return G&&G.state?(lt=G.state,K<0?(m=0,K=-K):(m=1+(K>>4),K<48&&(K&=15)),K&&(K<8||K>15)?O:(lt.window!==null&&lt.wbits!==K&&(lt.window=null),lt.wrap=m,lt.wbits=K,y(G))):O}function I(G,K){var m,lt;return G?(lt=new A,G.state=lt,lt.window=null,(m=x(G,K))!==D&&(G.state=null),m):O}var w,U,R=!0;function E(G){if(R){var K;for(w=new l.Buf32(512),U=new l.Buf32(32),K=0;K<144;)G.lens[K++]=8;for(;K<256;)G.lens[K++]=9;for(;K<280;)G.lens[K++]=7;for(;K<288;)G.lens[K++]=8;for(B(1,G.lens,0,288,w,0,G.work,{bits:9}),K=0;K<32;)G.lens[K++]=5;B(2,G.lens,0,32,U,0,G.work,{bits:5}),R=!1}G.lencode=w,G.lenbits=9,G.distcode=U,G.distbits=5}function $(G,K,m,lt){var Et,dt=G.state;return dt.window===null&&(dt.wsize=1<<dt.wbits,dt.wnext=0,dt.whave=0,dt.window=new l.Buf8(dt.wsize)),lt>=dt.wsize?(l.arraySet(dt.window,K,m-dt.wsize,dt.wsize,0),dt.wnext=0,dt.whave=dt.wsize):((Et=dt.wsize-dt.wnext)>lt&&(Et=lt),l.arraySet(dt.window,K,m-lt,Et,dt.wnext),(lt-=Et)?(l.arraySet(dt.window,K,m-lt,lt,0),dt.wnext=lt,dt.whave=dt.wsize):(dt.wnext+=Et,dt.wnext===dt.wsize&&(dt.wnext=0),dt.whave<dt.wsize&&(dt.whave+=Et))),0}k.inflateReset=y,k.inflateReset2=x,k.inflateResetKeep=p,k.inflateInit=function(G){return I(G,15)},k.inflateInit2=I,k.inflate=function(G,K){var m,lt,Et,dt,Ut,At,It,yt,wt,ie,zt,Mt,ae,st,g,it,ut,F,St,gt,pt,ht,ct,vt,Qt=0,bt=new l.Buf8(4),Gt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!G||!G.state||!G.output||!G.input&&G.avail_in!==0)return O;(m=G.state).mode===M&&(m.mode=13),Ut=G.next_out,Et=G.output,It=G.avail_out,dt=G.next_in,lt=G.input,At=G.avail_in,yt=m.hold,wt=m.bits,ie=At,zt=It,ht=D;t:for(;;)switch(m.mode){case V:if(m.wrap===0){m.mode=13;break}for(;wt<16;){if(At===0)break t;At--,yt+=lt[dt++]<<wt,wt+=8}if(2&m.wrap&&yt===35615){m.check=0,bt[0]=255&yt,bt[1]=yt>>>8&255,m.check=C(m.check,bt,2,0),yt=0,wt=0,m.mode=2;break}if(m.flags=0,m.head&&(m.head.done=!1),!(1&m.wrap)||(((255&yt)<<8)+(yt>>8))%31){G.msg="incorrect header check",m.mode=L;break}if((15&yt)!=8){G.msg="unknown compression method",m.mode=L;break}if(wt-=4,pt=8+(15&(yt>>>=4)),m.wbits===0)m.wbits=pt;else if(pt>m.wbits){G.msg="invalid window size",m.mode=L;break}m.dmax=1<<pt,G.adler=m.check=1,m.mode=512&yt?10:M,yt=0,wt=0;break;case 2:for(;wt<16;){if(At===0)break t;At--,yt+=lt[dt++]<<wt,wt+=8}if(m.flags=yt,(255&m.flags)!=8){G.msg="unknown compression method",m.mode=L;break}if(57344&m.flags){G.msg="unknown header flags set",m.mode=L;break}m.head&&(m.head.text=yt>>8&1),512&m.flags&&(bt[0]=255&yt,bt[1]=yt>>>8&255,m.check=C(m.check,bt,2,0)),yt=0,wt=0,m.mode=3;case 3:for(;wt<32;){if(At===0)break t;At--,yt+=lt[dt++]<<wt,wt+=8}m.head&&(m.head.time=yt),512&m.flags&&(bt[0]=255&yt,bt[1]=yt>>>8&255,bt[2]=yt>>>16&255,bt[3]=yt>>>24&255,m.check=C(m.check,bt,4,0)),yt=0,wt=0,m.mode=4;case 4:for(;wt<16;){if(At===0)break t;At--,yt+=lt[dt++]<<wt,wt+=8}m.head&&(m.head.xflags=255&yt,m.head.os=yt>>8),512&m.flags&&(bt[0]=255&yt,bt[1]=yt>>>8&255,m.check=C(m.check,bt,2,0)),yt=0,wt=0,m.mode=5;case 5:if(1024&m.flags){for(;wt<16;){if(At===0)break t;At--,yt+=lt[dt++]<<wt,wt+=8}m.length=yt,m.head&&(m.head.extra_len=yt),512&m.flags&&(bt[0]=255&yt,bt[1]=yt>>>8&255,m.check=C(m.check,bt,2,0)),yt=0,wt=0}else m.head&&(m.head.extra=null);m.mode=6;case 6:if(1024&m.flags&&((Mt=m.length)>At&&(Mt=At),Mt&&(m.head&&(pt=m.head.extra_len-m.length,m.head.extra||(m.head.extra=new Array(m.head.extra_len)),l.arraySet(m.head.extra,lt,dt,Mt,pt)),512&m.flags&&(m.check=C(m.check,lt,Mt,dt)),At-=Mt,dt+=Mt,m.length-=Mt),m.length))break t;m.length=0,m.mode=7;case 7:if(2048&m.flags){if(At===0)break t;Mt=0;do pt=lt[dt+Mt++],m.head&&pt&&m.length<65536&&(m.head.name+=String.fromCharCode(pt));while(pt&&Mt<At);if(512&m.flags&&(m.check=C(m.check,lt,Mt,dt)),At-=Mt,dt+=Mt,pt)break t}else m.head&&(m.head.name=null);m.length=0,m.mode=8;case 8:if(4096&m.flags){if(At===0)break t;Mt=0;do pt=lt[dt+Mt++],m.head&&pt&&m.length<65536&&(m.head.comment+=String.fromCharCode(pt));while(pt&&Mt<At);if(512&m.flags&&(m.check=C(m.check,lt,Mt,dt)),At-=Mt,dt+=Mt,pt)break t}else m.head&&(m.head.comment=null);m.mode=9;case 9:if(512&m.flags){for(;wt<16;){if(At===0)break t;At--,yt+=lt[dt++]<<wt,wt+=8}if(yt!==(65535&m.check)){G.msg="header crc mismatch",m.mode=L;break}yt=0,wt=0}m.head&&(m.head.hcrc=m.flags>>9&1,m.head.done=!0),G.adler=m.check=0,m.mode=M;break;case 10:for(;wt<32;){if(At===0)break t;At--,yt+=lt[dt++]<<wt,wt+=8}G.adler=m.check=h(yt),yt=0,wt=0,m.mode=11;case 11:if(m.havedict===0)return G.next_out=Ut,G.avail_out=It,G.next_in=dt,G.avail_in=At,m.hold=yt,m.bits=wt,2;G.adler=m.check=1,m.mode=M;case M:if(K===5||K===6)break t;case 13:if(m.last){yt>>>=7&wt,wt-=7&wt,m.mode=27;break}for(;wt<3;){if(At===0)break t;At--,yt+=lt[dt++]<<wt,wt+=8}switch(m.last=1&yt,wt-=1,3&(yt>>>=1)){case 0:m.mode=14;break;case 1:if(E(m),m.mode=20,K===6){yt>>>=2,wt-=2;break t}break;case 2:m.mode=17;break;case 3:G.msg="invalid block type",m.mode=L}yt>>>=2,wt-=2;break;case 14:for(yt>>>=7&wt,wt-=7&wt;wt<32;){if(At===0)break t;At--,yt+=lt[dt++]<<wt,wt+=8}if((65535&yt)!=(yt>>>16^65535)){G.msg="invalid stored block lengths",m.mode=L;break}if(m.length=65535&yt,yt=0,wt=0,m.mode=15,K===6)break t;case 15:m.mode=16;case 16:if(Mt=m.length){if(Mt>At&&(Mt=At),Mt>It&&(Mt=It),Mt===0)break t;l.arraySet(Et,lt,dt,Mt,Ut),At-=Mt,dt+=Mt,It-=Mt,Ut+=Mt,m.length-=Mt;break}m.mode=M;break;case 17:for(;wt<14;){if(At===0)break t;At--,yt+=lt[dt++]<<wt,wt+=8}if(m.nlen=257+(31&yt),yt>>>=5,wt-=5,m.ndist=1+(31&yt),yt>>>=5,wt-=5,m.ncode=4+(15&yt),yt>>>=4,wt-=4,m.nlen>286||m.ndist>30){G.msg="too many length or distance symbols",m.mode=L;break}m.have=0,m.mode=18;case 18:for(;m.have<m.ncode;){for(;wt<3;){if(At===0)break t;At--,yt+=lt[dt++]<<wt,wt+=8}m.lens[Gt[m.have++]]=7&yt,yt>>>=3,wt-=3}for(;m.have<19;)m.lens[Gt[m.have++]]=0;if(m.lencode=m.lendyn,m.lenbits=7,ct={bits:m.lenbits},ht=B(0,m.lens,0,19,m.lencode,0,m.work,ct),m.lenbits=ct.bits,ht){G.msg="invalid code lengths set",m.mode=L;break}m.have=0,m.mode=19;case 19:for(;m.have<m.nlen+m.ndist;){for(;it=(Qt=m.lencode[yt&(1<<m.lenbits)-1])>>>16&255,ut=65535&Qt,!((g=Qt>>>24)<=wt);){if(At===0)break t;At--,yt+=lt[dt++]<<wt,wt+=8}if(ut<16)yt>>>=g,wt-=g,m.lens[m.have++]=ut;else{if(ut===16){for(vt=g+2;wt<vt;){if(At===0)break t;At--,yt+=lt[dt++]<<wt,wt+=8}if(yt>>>=g,wt-=g,m.have===0){G.msg="invalid bit length repeat",m.mode=L;break}pt=m.lens[m.have-1],Mt=3+(3&yt),yt>>>=2,wt-=2}else if(ut===17){for(vt=g+3;wt<vt;){if(At===0)break t;At--,yt+=lt[dt++]<<wt,wt+=8}wt-=g,pt=0,Mt=3+(7&(yt>>>=g)),yt>>>=3,wt-=3}else{for(vt=g+7;wt<vt;){if(At===0)break t;At--,yt+=lt[dt++]<<wt,wt+=8}wt-=g,pt=0,Mt=11+(127&(yt>>>=g)),yt>>>=7,wt-=7}if(m.have+Mt>m.nlen+m.ndist){G.msg="invalid bit length repeat",m.mode=L;break}for(;Mt--;)m.lens[m.have++]=pt}}if(m.mode===L)break;if(m.lens[256]===0){G.msg="invalid code -- missing end-of-block",m.mode=L;break}if(m.lenbits=9,ct={bits:m.lenbits},ht=B(1,m.lens,0,m.nlen,m.lencode,0,m.work,ct),m.lenbits=ct.bits,ht){G.msg="invalid literal/lengths set",m.mode=L;break}if(m.distbits=6,m.distcode=m.distdyn,ct={bits:m.distbits},ht=B(2,m.lens,m.nlen,m.ndist,m.distcode,0,m.work,ct),m.distbits=ct.bits,ht){G.msg="invalid distances set",m.mode=L;break}if(m.mode=20,K===6)break t;case 20:m.mode=21;case 21:if(At>=6&&It>=258){G.next_out=Ut,G.avail_out=It,G.next_in=dt,G.avail_in=At,m.hold=yt,m.bits=wt,Q(G,zt),Ut=G.next_out,Et=G.output,It=G.avail_out,dt=G.next_in,lt=G.input,At=G.avail_in,yt=m.hold,wt=m.bits,m.mode===M&&(m.back=-1);break}for(m.back=0;it=(Qt=m.lencode[yt&(1<<m.lenbits)-1])>>>16&255,ut=65535&Qt,!((g=Qt>>>24)<=wt);){if(At===0)break t;At--,yt+=lt[dt++]<<wt,wt+=8}if(it&&!(240&it)){for(F=g,St=it,gt=ut;it=(Qt=m.lencode[gt+((yt&(1<<F+St)-1)>>F)])>>>16&255,ut=65535&Qt,!(F+(g=Qt>>>24)<=wt);){if(At===0)break t;At--,yt+=lt[dt++]<<wt,wt+=8}yt>>>=F,wt-=F,m.back+=F}if(yt>>>=g,wt-=g,m.back+=g,m.length=ut,it===0){m.mode=26;break}if(32&it){m.back=-1,m.mode=M;break}if(64&it){G.msg="invalid literal/length code",m.mode=L;break}m.extra=15&it,m.mode=22;case 22:if(m.extra){for(vt=m.extra;wt<vt;){if(At===0)break t;At--,yt+=lt[dt++]<<wt,wt+=8}m.length+=yt&(1<<m.extra)-1,yt>>>=m.extra,wt-=m.extra,m.back+=m.extra}m.was=m.length,m.mode=23;case 23:for(;it=(Qt=m.distcode[yt&(1<<m.distbits)-1])>>>16&255,ut=65535&Qt,!((g=Qt>>>24)<=wt);){if(At===0)break t;At--,yt+=lt[dt++]<<wt,wt+=8}if(!(240&it)){for(F=g,St=it,gt=ut;it=(Qt=m.distcode[gt+((yt&(1<<F+St)-1)>>F)])>>>16&255,ut=65535&Qt,!(F+(g=Qt>>>24)<=wt);){if(At===0)break t;At--,yt+=lt[dt++]<<wt,wt+=8}yt>>>=F,wt-=F,m.back+=F}if(yt>>>=g,wt-=g,m.back+=g,64&it){G.msg="invalid distance code",m.mode=L;break}m.offset=ut,m.extra=15&it,m.mode=24;case 24:if(m.extra){for(vt=m.extra;wt<vt;){if(At===0)break t;At--,yt+=lt[dt++]<<wt,wt+=8}m.offset+=yt&(1<<m.extra)-1,yt>>>=m.extra,wt-=m.extra,m.back+=m.extra}if(m.offset>m.dmax){G.msg="invalid distance too far back",m.mode=L;break}m.mode=25;case 25:if(It===0)break t;if(Mt=zt-It,m.offset>Mt){if((Mt=m.offset-Mt)>m.whave&&m.sane){G.msg="invalid distance too far back",m.mode=L;break}Mt>m.wnext?(Mt-=m.wnext,ae=m.wsize-Mt):ae=m.wnext-Mt,Mt>m.length&&(Mt=m.length),st=m.window}else st=Et,ae=Ut-m.offset,Mt=m.length;Mt>It&&(Mt=It),It-=Mt,m.length-=Mt;do Et[Ut++]=st[ae++];while(--Mt);m.length===0&&(m.mode=21);break;case 26:if(It===0)break t;Et[Ut++]=m.length,It--,m.mode=21;break;case 27:if(m.wrap){for(;wt<32;){if(At===0)break t;At--,yt|=lt[dt++]<<wt,wt+=8}if(zt-=It,G.total_out+=zt,m.total+=zt,zt&&(G.adler=m.check=m.flags?C(m.check,Et,zt,Ut-zt):S(m.check,Et,zt,Ut-zt)),zt=It,(m.flags?yt:h(yt))!==m.check){G.msg="incorrect data check",m.mode=L;break}yt=0,wt=0}m.mode=28;case 28:if(m.wrap&&m.flags){for(;wt<32;){if(At===0)break t;At--,yt+=lt[dt++]<<wt,wt+=8}if(yt!==(4294967295&m.total)){G.msg="incorrect length check",m.mode=L;break}yt=0,wt=0}m.mode=29;case 29:ht=1;break t;case L:ht=-3;break t;case 31:return-4;default:return O}return G.next_out=Ut,G.avail_out=It,G.next_in=dt,G.avail_in=At,m.hold=yt,m.bits=wt,(m.wsize||zt!==G.avail_out&&m.mode<L&&(m.mode<27||K!==4))&&$(G,G.output,G.next_out,zt-G.avail_out)?(m.mode=31,-4):(ie-=G.avail_in,zt-=G.avail_out,G.total_in+=ie,G.total_out+=zt,m.total+=zt,m.wrap&&zt&&(G.adler=m.check=m.flags?C(m.check,Et,zt,G.next_out-zt):S(m.check,Et,zt,G.next_out-zt)),G.data_type=m.bits+(m.last?64:0)+(m.mode===M?128:0)+(m.mode===20||m.mode===15?256:0),(ie===0&&zt===0||K===4)&&ht===D&&(ht=-5),ht)},k.inflateEnd=function(G){if(!G||!G.state)return O;var K=G.state;return K.window&&(K.window=null),G.state=null,D},k.inflateGetHeader=function(G,K){var m;return G&&G.state&&2&(m=G.state).wrap?(m.head=K,K.done=!1,D):O},k.inflateSetDictionary=function(G,K){var m,lt=K.length;return G&&G.state?(m=G.state).wrap!==0&&m.mode!==11?O:m.mode===11&&S(1,K,lt,0)!==m.check?-3:$(G,K,lt,lt)?(m.mode=31,-4):(m.havedict=1,D):O},k.inflateInfo="pako inflate (from Nodeca project)"},"./node_modules/pako/lib/zlib/inftrees.js":(X,k,b)=>{var l=b("./node_modules/pako/lib/utils/common.js"),S=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],C=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],Q=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],B=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];X.exports=function(D,O,V,M,L,f,v,h){var A,p,y,x,I,w,U,R,E,$=h.bits,G=0,K=0,m=0,lt=0,Et=0,dt=0,Ut=0,At=0,It=0,yt=0,wt=null,ie=0,zt=new l.Buf16(16),Mt=new l.Buf16(16),ae=null,st=0;for(G=0;G<=15;G++)zt[G]=0;for(K=0;K<M;K++)zt[O[V+K]]++;for(Et=$,lt=15;lt>=1&&zt[lt]===0;lt--);if(Et>lt&&(Et=lt),lt===0)return L[f++]=20971520,L[f++]=20971520,h.bits=1,0;for(m=1;m<lt&&zt[m]===0;m++);for(Et<m&&(Et=m),At=1,G=1;G<=15;G++)if(At<<=1,(At-=zt[G])<0)return-1;if(At>0&&(D===0||lt!==1))return-1;for(Mt[1]=0,G=1;G<15;G++)Mt[G+1]=Mt[G]+zt[G];for(K=0;K<M;K++)O[V+K]!==0&&(v[Mt[O[V+K]]++]=K);if(D===0?(wt=ae=v,w=19):D===1?(wt=S,ie-=257,ae=C,st-=257,w=256):(wt=Q,ae=B,w=-1),yt=0,K=0,G=m,I=f,dt=Et,Ut=0,y=-1,x=(It=1<<Et)-1,D===1&&It>852||D===2&&It>592)return 1;for(;;){U=G-Ut,v[K]<w?(R=0,E=v[K]):v[K]>w?(R=ae[st+v[K]],E=wt[ie+v[K]]):(R=96,E=0),A=1<<G-Ut,m=p=1<<dt;do L[I+(yt>>Ut)+(p-=A)]=U<<24|R<<16|E|0;while(p!==0);for(A=1<<G-1;yt&A;)A>>=1;if(A!==0?(yt&=A-1,yt+=A):yt=0,K++,--zt[G]==0){if(G===lt)break;G=O[V+v[K]]}if(G>Et&&(yt&x)!==y){for(Ut===0&&(Ut=Et),I+=m,At=1<<(dt=G-Ut);dt+Ut<lt&&!((At-=zt[dt+Ut])<=0);)dt++,At<<=1;if(It+=1<<dt,D===1&&It>852||D===2&&It>592)return 1;L[y=yt&x]=Et<<24|dt<<16|I-f|0}}return yt!==0&&(L[I+yt]=G-Ut<<24|4194304|0),h.bits=Et,0}},"./node_modules/pako/lib/zlib/messages.js":X=>{X.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},"./node_modules/pako/lib/zlib/trees.js":(X,k,b)=>{var l=b("./node_modules/pako/lib/utils/common.js");function S(st){for(var g=st.length;--g>=0;)st[g]=0}var C=256,Q=286,B=30,D=15,O=16,V=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],M=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],L=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],f=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],v=new Array(576);S(v);var h=new Array(60);S(h);var A=new Array(512);S(A);var p=new Array(256);S(p);var y=new Array(29);S(y);var x,I,w,U=new Array(B);function R(st,g,it,ut,F){this.static_tree=st,this.extra_bits=g,this.extra_base=it,this.elems=ut,this.max_length=F,this.has_stree=st&&st.length}function E(st,g){this.dyn_tree=st,this.max_code=0,this.stat_desc=g}function $(st){return st<256?A[st]:A[256+(st>>>7)]}function G(st,g){st.pending_buf[st.pending++]=255&g,st.pending_buf[st.pending++]=g>>>8&255}function K(st,g,it){st.bi_valid>O-it?(st.bi_buf|=g<<st.bi_valid&65535,G(st,st.bi_buf),st.bi_buf=g>>O-st.bi_valid,st.bi_valid+=it-O):(st.bi_buf|=g<<st.bi_valid&65535,st.bi_valid+=it)}function m(st,g,it){K(st,it[2*g],it[2*g+1])}function lt(st,g){var it=0;do it|=1&st,st>>>=1,it<<=1;while(--g>0);return it>>>1}function Et(st,g,it){var ut,F,St=new Array(D+1),gt=0;for(ut=1;ut<=D;ut++)St[ut]=gt=gt+it[ut-1]<<1;for(F=0;F<=g;F++){var pt=st[2*F+1];pt!==0&&(st[2*F]=lt(St[pt]++,pt))}}function dt(st){var g;for(g=0;g<Q;g++)st.dyn_ltree[2*g]=0;for(g=0;g<B;g++)st.dyn_dtree[2*g]=0;for(g=0;g<19;g++)st.bl_tree[2*g]=0;st.dyn_ltree[512]=1,st.opt_len=st.static_len=0,st.last_lit=st.matches=0}function Ut(st){st.bi_valid>8?G(st,st.bi_buf):st.bi_valid>0&&(st.pending_buf[st.pending++]=st.bi_buf),st.bi_buf=0,st.bi_valid=0}function At(st,g,it,ut){var F=2*g,St=2*it;return st[F]<st[St]||st[F]===st[St]&&ut[g]<=ut[it]}function It(st,g,it){for(var ut=st.heap[it],F=it<<1;F<=st.heap_len&&(F<st.heap_len&&At(g,st.heap[F+1],st.heap[F],st.depth)&&F++,!At(g,ut,st.heap[F],st.depth));)st.heap[it]=st.heap[F],it=F,F<<=1;st.heap[it]=ut}function yt(st,g,it){var ut,F,St,gt,pt=0;if(st.last_lit!==0)do ut=st.pending_buf[st.d_buf+2*pt]<<8|st.pending_buf[st.d_buf+2*pt+1],F=st.pending_buf[st.l_buf+pt],pt++,ut===0?m(st,F,g):(m(st,(St=p[F])+C+1,g),(gt=V[St])!==0&&K(st,F-=y[St],gt),m(st,St=$(--ut),it),(gt=M[St])!==0&&K(st,ut-=U[St],gt));while(pt<st.last_lit);m(st,256,g)}function wt(st,g){var it,ut,F,St=g.dyn_tree,gt=g.stat_desc.static_tree,pt=g.stat_desc.has_stree,ht=g.stat_desc.elems,ct=-1;for(st.heap_len=0,st.heap_max=573,it=0;it<ht;it++)St[2*it]!==0?(st.heap[++st.heap_len]=ct=it,st.depth[it]=0):St[2*it+1]=0;for(;st.heap_len<2;)St[2*(F=st.heap[++st.heap_len]=ct<2?++ct:0)]=1,st.depth[F]=0,st.opt_len--,pt&&(st.static_len-=gt[2*F+1]);for(g.max_code=ct,it=st.heap_len>>1;it>=1;it--)It(st,St,it);F=ht;do it=st.heap[1],st.heap[1]=st.heap[st.heap_len--],It(st,St,1),ut=st.heap[1],st.heap[--st.heap_max]=it,st.heap[--st.heap_max]=ut,St[2*F]=St[2*it]+St[2*ut],st.depth[F]=(st.depth[it]>=st.depth[ut]?st.depth[it]:st.depth[ut])+1,St[2*it+1]=St[2*ut+1]=F,st.heap[1]=F++,It(st,St,1);while(st.heap_len>=2);st.heap[--st.heap_max]=st.heap[1],function(vt,Qt){var bt,Gt,oe,jt,le,_e,de=Qt.dyn_tree,Oe=Qt.max_code,Ke=Qt.stat_desc.static_tree,$e=Qt.stat_desc.has_stree,ii=Qt.stat_desc.extra_bits,si=Qt.stat_desc.extra_base,Ae=Qt.stat_desc.max_length,ke=0;for(jt=0;jt<=D;jt++)vt.bl_count[jt]=0;for(de[2*vt.heap[vt.heap_max]+1]=0,bt=vt.heap_max+1;bt<573;bt++)(jt=de[2*de[2*(Gt=vt.heap[bt])+1]+1]+1)>Ae&&(jt=Ae,ke++),de[2*Gt+1]=jt,Gt>Oe||(vt.bl_count[jt]++,le=0,Gt>=si&&(le=ii[Gt-si]),_e=de[2*Gt],vt.opt_len+=_e*(jt+le),$e&&(vt.static_len+=_e*(Ke[2*Gt+1]+le)));if(ke!==0){do{for(jt=Ae-1;vt.bl_count[jt]===0;)jt--;vt.bl_count[jt]--,vt.bl_count[jt+1]+=2,vt.bl_count[Ae]--,ke-=2}while(ke>0);for(jt=Ae;jt!==0;jt--)for(Gt=vt.bl_count[jt];Gt!==0;)(oe=vt.heap[--bt])>Oe||(de[2*oe+1]!==jt&&(vt.opt_len+=(jt-de[2*oe+1])*de[2*oe],de[2*oe+1]=jt),Gt--)}}(st,g),Et(St,ct,st.bl_count)}function ie(st,g,it){var ut,F,St=-1,gt=g[1],pt=0,ht=7,ct=4;for(gt===0&&(ht=138,ct=3),g[2*(it+1)+1]=65535,ut=0;ut<=it;ut++)F=gt,gt=g[2*(ut+1)+1],++pt<ht&&F===gt||(pt<ct?st.bl_tree[2*F]+=pt:F!==0?(F!==St&&st.bl_tree[2*F]++,st.bl_tree[32]++):pt<=10?st.bl_tree[34]++:st.bl_tree[36]++,pt=0,St=F,gt===0?(ht=138,ct=3):F===gt?(ht=6,ct=3):(ht=7,ct=4))}function zt(st,g,it){var ut,F,St=-1,gt=g[1],pt=0,ht=7,ct=4;for(gt===0&&(ht=138,ct=3),ut=0;ut<=it;ut++)if(F=gt,gt=g[2*(ut+1)+1],!(++pt<ht&&F===gt)){if(pt<ct)do m(st,F,st.bl_tree);while(--pt!=0);else F!==0?(F!==St&&(m(st,F,st.bl_tree),pt--),m(st,16,st.bl_tree),K(st,pt-3,2)):pt<=10?(m(st,17,st.bl_tree),K(st,pt-3,3)):(m(st,18,st.bl_tree),K(st,pt-11,7));pt=0,St=F,gt===0?(ht=138,ct=3):F===gt?(ht=6,ct=3):(ht=7,ct=4)}}S(U);var Mt=!1;function ae(st,g,it,ut){K(st,0+(ut?1:0),3),function(F,St,gt,pt){Ut(F),G(F,gt),G(F,~gt),l.arraySet(F.pending_buf,F.window,St,gt,F.pending),F.pending+=gt}(st,g,it)}k._tr_init=function(st){Mt||(function(){var g,it,ut,F,St,gt=new Array(D+1);for(ut=0,F=0;F<28;F++)for(y[F]=ut,g=0;g<1<<V[F];g++)p[ut++]=F;for(p[ut-1]=F,St=0,F=0;F<16;F++)for(U[F]=St,g=0;g<1<<M[F];g++)A[St++]=F;for(St>>=7;F<B;F++)for(U[F]=St<<7,g=0;g<1<<M[F]-7;g++)A[256+St++]=F;for(it=0;it<=D;it++)gt[it]=0;for(g=0;g<=143;)v[2*g+1]=8,g++,gt[8]++;for(;g<=255;)v[2*g+1]=9,g++,gt[9]++;for(;g<=279;)v[2*g+1]=7,g++,gt[7]++;for(;g<=287;)v[2*g+1]=8,g++,gt[8]++;for(Et(v,287,gt),g=0;g<B;g++)h[2*g+1]=5,h[2*g]=lt(g,5);x=new R(v,V,257,Q,D),I=new R(h,M,0,B,D),w=new R(new Array(0),L,0,19,7)}(),Mt=!0),st.l_desc=new E(st.dyn_ltree,x),st.d_desc=new E(st.dyn_dtree,I),st.bl_desc=new E(st.bl_tree,w),st.bi_buf=0,st.bi_valid=0,dt(st)},k._tr_stored_block=ae,k._tr_flush_block=function(st,g,it,ut){var F,St,gt=0;st.level>0?(st.strm.data_type===2&&(st.strm.data_type=function(pt){var ht,ct=4093624447;for(ht=0;ht<=31;ht++,ct>>>=1)if(1&ct&&pt.dyn_ltree[2*ht]!==0)return 0;if(pt.dyn_ltree[18]!==0||pt.dyn_ltree[20]!==0||pt.dyn_ltree[26]!==0)return 1;for(ht=32;ht<C;ht++)if(pt.dyn_ltree[2*ht]!==0)return 1;return 0}(st)),wt(st,st.l_desc),wt(st,st.d_desc),gt=function(pt){var ht;for(ie(pt,pt.dyn_ltree,pt.l_desc.max_code),ie(pt,pt.dyn_dtree,pt.d_desc.max_code),wt(pt,pt.bl_desc),ht=18;ht>=3&&pt.bl_tree[2*f[ht]+1]===0;ht--);return pt.opt_len+=3*(ht+1)+5+5+4,ht}(st),F=st.opt_len+3+7>>>3,(St=st.static_len+3+7>>>3)<=F&&(F=St)):F=St=it+5,it+4<=F&&g!==-1?ae(st,g,it,ut):st.strategy===4||St===F?(K(st,2+(ut?1:0),3),yt(st,v,h)):(K(st,4+(ut?1:0),3),function(pt,ht,ct,vt){var Qt;for(K(pt,ht-257,5),K(pt,ct-1,5),K(pt,vt-4,4),Qt=0;Qt<vt;Qt++)K(pt,pt.bl_tree[2*f[Qt]+1],3);zt(pt,pt.dyn_ltree,ht-1),zt(pt,pt.dyn_dtree,ct-1)}(st,st.l_desc.max_code+1,st.d_desc.max_code+1,gt+1),yt(st,st.dyn_ltree,st.dyn_dtree)),dt(st),ut&&Ut(st)},k._tr_tally=function(st,g,it){return st.pending_buf[st.d_buf+2*st.last_lit]=g>>>8&255,st.pending_buf[st.d_buf+2*st.last_lit+1]=255&g,st.pending_buf[st.l_buf+st.last_lit]=255&it,st.last_lit++,g===0?st.dyn_ltree[2*it]++:(st.matches++,g--,st.dyn_ltree[2*(p[it]+C+1)]++,st.dyn_dtree[2*$(g)]++),st.last_lit===st.lit_bufsize-1},k._tr_align=function(st){K(st,2,3),m(st,256,v),function(g){g.bi_valid===16?(G(g,g.bi_buf),g.bi_buf=0,g.bi_valid=0):g.bi_valid>=8&&(g.pending_buf[g.pending++]=255&g.bi_buf,g.bi_buf>>=8,g.bi_valid-=8)}(st)}},"./node_modules/pako/lib/zlib/zstream.js":X=>{X.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},"./node_modules/strnum/strnum.js":X=>{const k=/^[-+]?0x[a-fA-F0-9]+$/,b=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const l={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};X.exports=function(S,C={}){if(C=Object.assign({},l,C),!S||typeof S!="string")return S;let Q=S.trim();if(C.skipLike!==void 0&&C.skipLike.test(Q))return S;if(C.hex&&k.test(Q))return Number.parseInt(Q,16);{const D=b.exec(Q);if(D){const O=D[1],V=D[2];let M=((B=D[3])&&B.indexOf(".")!==-1&&((B=B.replace(/0+$/,""))==="."?B="0":B[0]==="."?B="0"+B:B[B.length-1]==="."&&(B=B.substr(0,B.length-1))),B);const L=D[4]||D[6];if(!C.leadingZeros&&V.length>0&&O&&Q[2]!=="."||!C.leadingZeros&&V.length>0&&!O&&Q[1]!==".")return S;{const f=Number(Q),v=""+f;return v.search(/[eE]/)!==-1||L?C.eNotation?f:S:Q.indexOf(".")!==-1?v==="0"&&M===""||v===M||O&&v==="-"+M?f:S:V?M===v||O+M===v?f:S:Q===v||Q===O+v?f:S}}return S}var B}},"./src/deprecated.ts":(X,k,b)=>{b.r(k),b.d(k,{FLIPPED_DIAGONALLY_FLAG:()=>l.FLIPPED_DIAGONALLY_FLAG,FLIPPED_HORIZONTALLY_FLAG:()=>l.FLIPPED_HORIZONTALLY_FLAG,FLIPPED_VERTICALLY_FLAG:()=>l.FLIPPED_VERTICALLY_FLAG,TiledEntity:()=>l.TiledEntity,TiledLayer:()=>l.TiledLayer,TiledLayerComponent:()=>l.TiledLayerComponent,TiledMap:()=>l.TiledMap,TiledMapFormat:()=>l.TiledMapFormat,TiledMapResource:()=>l.TiledMapResource,TiledObject:()=>l.TiledObject,TiledObjectComponent:()=>l.TiledObjectComponent,TiledObjectGroup:()=>l.TiledObjectGroup,TiledTileset:()=>l.TiledTileset,TiledTilesetTile:()=>l.TiledTilesetTile,getCanonicalGid:()=>l.getCanonicalGid,getProperty:()=>l.getProperty,isFlippedDiagonally:()=>l.isFlippedDiagonally,isFlippedHorizontally:()=>l.isFlippedHorizontally,isFlippedVertically:()=>l.isFlippedVertically,parseExternalJson:()=>l.parseExternalJson,parseExternalTsx:()=>l.parseExternalTsx});var l=b("./src/deprecated/index.ts")},"./src/deprecated/index.ts":(X,k,b)=>{b.r(k),b.d(k,{FLIPPED_DIAGONALLY_FLAG:()=>Q.FLIPPED_DIAGONALLY_FLAG,FLIPPED_HORIZONTALLY_FLAG:()=>Q.FLIPPED_HORIZONTALLY_FLAG,FLIPPED_VERTICALLY_FLAG:()=>Q.FLIPPED_VERTICALLY_FLAG,TiledEntity:()=>C.TiledEntity,TiledLayer:()=>Q.TiledLayer,TiledLayerComponent:()=>V.TiledLayerComponent,TiledMap:()=>S.TiledMap,TiledMapFormat:()=>l.TiledMapFormat,TiledMapResource:()=>l.TiledMapResource,TiledObject:()=>B.TiledObject,TiledObjectComponent:()=>O.TiledObjectComponent,TiledObjectGroup:()=>B.TiledObjectGroup,TiledTileset:()=>D.TiledTileset,TiledTilesetTile:()=>D.TiledTilesetTile,getCanonicalGid:()=>Q.getCanonicalGid,getProperty:()=>C.getProperty,isFlippedDiagonally:()=>Q.isFlippedDiagonally,isFlippedHorizontally:()=>Q.isFlippedHorizontally,isFlippedVertically:()=>Q.isFlippedVertically,parseExternalJson:()=>D.parseExternalJson,parseExternalTsx:()=>D.parseExternalTsx}),b("./src/deprecated/tiled-types.ts");var l=b("./src/deprecated/tiled-map-resource.ts"),S=b("./src/deprecated/tiled-map-parser.ts"),C=b("./src/deprecated/tiled-entity.ts"),Q=b("./src/deprecated/tiled-layer.ts"),B=b("./src/deprecated/tiled-object.ts"),D=b("./src/deprecated/tiled-tileset.ts"),O=b("./src/deprecated/tiled-object-component.ts"),V=b("./src/deprecated/tiled-layer-component.ts");b("./src/deprecated/raw-tiled-layer.ts"),b("./src/deprecated/raw-tiled-map.ts"),b("./src/deprecated/raw-tiled-object.ts"),b("./src/deprecated/raw-tiled-text.ts"),b("./src/deprecated/raw-tiled-tileset.ts"),b("./src/deprecated/raw-tileset-tile.ts")},"./src/deprecated/raw-tiled-layer.ts":(X,k,b)=>{b.r(k)},"./src/deprecated/raw-tiled-map.ts":(X,k,b)=>{b.r(k)},"./src/deprecated/raw-tiled-object.ts":(X,k,b)=>{b.r(k)},"./src/deprecated/raw-tiled-text.ts":(X,k,b)=>{b.r(k)},"./src/deprecated/raw-tiled-tileset.ts":(X,k,b)=>{b.r(k)},"./src/deprecated/raw-tileset-tile.ts":(X,k,b)=>{b.r(k)},"./src/deprecated/tiled-entity.ts":(X,k,b)=>{b.r(k),b.d(k,{TiledEntity:()=>S,getProperty:()=>l});const l=(C,Q)=>{if(Array.isArray(C))return C==null?void 0:C.filter(B=>{var D;return((D=B.name)===null||D===void 0?void 0:D.toLocaleLowerCase())===Q.toLocaleLowerCase()})[0]};class S{constructor(){this.properties=[]}getProperty(Q){return l(this.properties,Q)}}},"./src/deprecated/tiled-layer-component.ts":(X,k,b)=>{b.r(k),b.d(k,{TiledLayerComponent:()=>S});var l=b("excalibur");class S extends l.Component{constructor(Q){super(),this.layer=Q,this.type="ex.tiledlayer"}}},"./src/deprecated/tiled-layer.ts":(X,k,b)=>{b.r(k),b.d(k,{FLIPPED_DIAGONALLY_FLAG:()=>B,FLIPPED_HORIZONTALLY_FLAG:()=>C,FLIPPED_VERTICALLY_FLAG:()=>Q,TiledLayer:()=>L,getCanonicalGid:()=>M,isFlippedDiagonally:()=>V,isFlippedHorizontally:()=>D,isFlippedVertically:()=>O});var l=b("./src/deprecated/tiled-entity.ts"),S=b("excalibur");const C=2147483648,Q=1073741824,B=536870912,D=f=>!!(f&C),O=f=>!!(f&Q),V=f=>!!(f&B),M=f=>f&~(C|Q|B);class L extends l.TiledEntity{constructor(){super(...arguments),this.offset=S.Vector.Zero,this.parallaxFactor=null,this.encoding="csv"}static parse(v){var h,A,p,y,x,I;if(v.type!=="tilelayer")throw Error("Cannot parse a non tilelayer type layer");const w=new L;return w.id=+v.id,w.name=v.name,w.data=v.data,w.offset=(0,S.vec)((h=v.offsetx)!==null&&h!==void 0?h:0,(A=v.offsety)!==null&&A!==void 0?A:0),w.parallaxFactor=v.parallaxx||v.parallaxy?(0,S.vec)((p=v.parallaxx)!==null&&p!==void 0?p:1,(y=v.parallaxy)!==null&&y!==void 0?y:1):null,w.width=v.width,w.height=v.height,w.encoding=(x=v.encoding)!==null&&x!==void 0?x:"csv",w.compression=v.compression,w.order=v.order,w.properties=(I=v.properties)!==null&&I!==void 0?I:[],w.rawLayer=v,w}}},"./src/deprecated/tiled-map-parser.ts":(X,k,b)=>{b.r(k),b.d(k,{TiledMap:()=>O});var l=b("./node_modules/fast-xml-parser/src/parser.js"),S=b("./node_modules/pako/index.js"),C=b("./node_modules/zstddec/dist/zstddec.modern.js"),Q=b("./src/deprecated/tiled-layer.ts"),B=b("./src/deprecated/tiled-object.ts"),D=b("./src/deprecated/tiled-tileset.ts");class O{constructor(){this.layers=[],this.tileSets=[],this.objectGroups=[]}getExcaliburObjects(){return this.getObjectLayerByProperty("excalibur",!0)}getObjects(){var f;return(f=this.objectGroups.filter(v=>{var h;return!(!((h=v.getProperty("excalibur-exclude"))===null||h===void 0)&&h.value)}))!==null&&f!==void 0?f:[]}getObjectLayerByName(f){return this.objectGroups.filter(v=>v.name===f)[0]}getObjectLayerByProperty(f,v){return this.objectGroups.filter(h=>{var A;return((A=h.getProperty(f))===null||A===void 0?void 0:A.value)===v})}getTileLayerByName(f){return this.layers.filter(v=>v.name===f)[0]}getTileLayersByProperty(f,v){return this.layers.filter(h=>{var A;return((A=h.getProperty(f))===null||A===void 0?void 0:A.value)===v})}static async fromTmx(f){var v,h,A,p,y,x,I,w,U,R,E,$,G,K,m,lt;const Et=(At,It,yt=!1)=>{At[It]?(At[It+(yt?"s":"")]=Array.isArray(At[It])?At[It]:[At[It]],yt&&delete At[It]):At[It+(yt?"s":"")]=[]},dt=l.parse(f,{attributeNamePrefix:"",textNodeName:"#text",ignoreAttributes:!1,ignoreNameSpace:!1,allowBooleanAttributes:!0,parseNodeValue:!0,parseAttributeValue:!0,trimValues:!0,parseTrueNumberOnly:!1,arrayMode:!1,stopNodes:["parse-me-as-string"]}).map;Et(dt,"layer",!0);for(let At of dt.layers)At.type=(v=At.type)!==null&&v!==void 0?v:"tilelayer",At.encoding=At.data.encoding,At.compression=At.data.compression,At.encoding==="csv"?At.data=At.data["#text"].split(",").map(It=>+It):At.data=At.data["#text"],At.properties=(A=(h=At.properties)===null||h===void 0?void 0:h.property)!==null&&A!==void 0?A:[],Et(At,"properties");dt.objectgroup=(p=dt.objectgroup)!==null&&p!==void 0?p:[];let Ut=Array.isArray(dt.objectgroup)?dt.objectgroup:[dt.objectgroup];for(let At of Ut)if(At.type=(y=At.type)!==null&&y!==void 0?y:"objectgroup",At.properties=(I=(x=At.properties)===null||x===void 0?void 0:x.property)!==null&&I!==void 0?I:[],Et(At,"properties"),At.object){At.objects=Array.isArray(At.object)?At.object:[At.object],At.objects.forEach(It=>{var yt,wt;return It.properties=(wt=(yt=It.properties)===null||yt===void 0?void 0:yt.property)!==null&&wt!==void 0?wt:[]}),At.objects.forEach(It=>Et(It,"properties")),delete At.object;for(let It of At.objects)It.text&&(It.text.text=It.text["#text"],It.text.halign=(w=It.text.halign)!==null&&w!==void 0?w:"left",It.text.valign=(U=It.text.valign)!==null&&U!==void 0?U:"top",It.text.fontfamily=(R=It.text.fontfamily)!==null&&R!==void 0?R:"sans-serif",It.text.pixelsize=+((E=It.text.pixelsize)!==null&&E!==void 0?E:16),It.text.kerning=!!It.text.kerning,It.text.italic=!!It.text.italic,It.text.bold=!!It.text.bold,It.text.underline=!!It.text.underline,It.text.strikeout=!!It.text.strikeout,It.text.color=($=It.text.color)!==null&&$!==void 0?$:"#000000"),It.point===""&&(It.point=!0),It.ellipse===""&&(It.ellipse=!0),It.polyline&&(It.polyline=It.polyline.points.split(" ").map(yt=>{const wt=yt.split(",");return{x:+wt[0],y:+wt[1]}})),It.polygon&&(It.polygon=It.polygon.points.split(" ").map(yt=>{const wt=yt.split(",");return{x:+wt[0],y:+wt[1]}}));dt.layers.push(At)}delete dt.objectgroup,Et(dt,"imagelayer",!0);for(let At of dt.imagelayers)At.type=(G=At.type)!==null&&G!==void 0?G:"imagelayer",At.image=At.image.source,At.properties=(m=(K=At.properties)===null||K===void 0?void 0:K.property)!==null&&m!==void 0?m:[],Et(At,"properties"),dt.layers.push(At);delete dt.imagelayer,Et(dt,"tileset",!0);for(let At of dt.tilesets)At.source||(At.image&&(At.imagewidth=At.image.width,At.imageheight=At.image.height,At.image=At.image.source),At.objectalignment=(lt=At.objectalignment)!==null&&lt!==void 0?lt:"unspecified",Et(At,"tile",!0),At.tiles.forEach(It=>{var yt;!((yt=It.image)===null||yt===void 0)&&yt.source&&(It.image=It.image.source),It.objectgroup&&(It.objectgroup.type="objectgroup",Et(It.objectgroup,"object",!0))}));return await O._fromRawTiledMap(dt)}static async fromJson(f){return await O._fromRawTiledMap(f)}static async _fromRawTiledMap(f){await O._decompresslayers(f);const v=new O;v.orientation=f.orientation,v.rawMap=f,v.width=+f.width,v.height=+f.height,v.tileWidth=+f.tilewidth,v.tileHeight=+f.tileheight,V(f);for(let h of f.layers)h.type=="tilelayer"&&v.layers.push(Q.TiledLayer.parse(h)),h.type=="objectgroup"&&v.objectGroups.push(B.TiledObjectGroup.parse(h));for(let h of f.tilesets)h.source||v.tileSets.push(D.TiledTileset.parse(h));return v}static async _decompresslayers(f){var v;if(f.layers)for(var h of f.layers)typeof h.data=="string"?h.encoding==="base64"&&(h.data=await M.decompressBase64(h.data,h.encoding,(v=h.compression)!==null&&v!==void 0?v:"")):h.data=M.decompressCsv(h.data);return f}}const V=L=>{let f=0;for(let v of L.layers)v.order=f++},M={decompressCsv:L=>L,decompressBase64:(L,f,v)=>{var h,A,p,y,x,I;if(L.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var w=43,U=47,R=48,E=97,$=65,G=45,K=95;function m(Ut){var At=Ut.charCodeAt(0);if(At===w||At===G)return 62;if(At===U||At===K)return 63;if(At<R)return-1;if(At<R+10)return At-R+26+26;if(At<$+26)return At-$;if(At<E+26)return At-E+26;throw Error("Could not decode elt")}var lt=L.length;x=L.charAt(lt-2)==="="?2:L.charAt(lt-1)==="="?1:0,I=new Uint8Array(3*L.length/4-x),p=x>0?L.length-4:L.length;var Et=0;function dt(Ut){I[Et++]=Ut}for(h=0,A=0;h<p;h+=4,A+=3)dt((16711680&(y=m(L.charAt(h))<<18|m(L.charAt(h+1))<<12|m(L.charAt(h+2))<<6|m(L.charAt(h+3))))>>16),dt((65280&y)>>8),dt(255&y);return x===2?dt(255&(y=m(L.charAt(h))<<2|m(L.charAt(h+1))>>4)):x===1&&(dt((y=m(L.charAt(h))<<10|m(L.charAt(h+1))<<4|m(L.charAt(h+2))>>2)>>8&255),dt(255&y)),new Promise(Ut=>{const At=function(wt){for(var ie=0,zt=wt.length-1;zt>=0;zt--)ie=256*ie+1*wt[zt];return ie};if(v==="zlib"||v==="gzip"){var It=(I=(0,S.inflate)(I)).length/4,yt=new Array(It);for(h=0;h<It;h++)yt[h]=At(I.slice(4*h,4*h+4));Ut(yt)}if(v==="zstd"){const wt=new C.ZSTDDecoder;wt.init().then(()=>{var ie=(I=wt.decode(I)).length/4,zt=new Array(ie);for(h=0;h<ie;h++)zt[h]=At(I.slice(4*h,4*h+4));Ut(zt)})}if(!v){for(It=I.length/4,yt=new Array(It),h=0;h<It;h++)yt[h]=At(I.slice(4*h,4*h+4));Ut(yt)}})}}},"./src/deprecated/tiled-map-resource.ts":(X,k,b)=>{b.r(k),b.d(k,{TiledMapFormat:()=>l,TiledMapResource:()=>M});var l,S=b("excalibur"),C=b("./src/deprecated/tiled-map-parser.ts"),Q=b("./src/deprecated/tiled-tileset.ts"),B=b("./src/deprecated/tiled-layer.ts"),D=b("./src/deprecated/tiled-entity.ts"),O=b("./src/deprecated/tiled-object-component.ts"),V=b("./src/deprecated/tiled-layer-component.ts");(function(L){L.TMX="TMX",L.JSON="JSON"})(l||(l={}));class M{constructor(f,v){this.path=f,this.layers=[],this.isoLayers=[],this._layerZIndexStart=-1,this._mapToRawLayer=new Map;const{mapFormatOverride:h,startingLayerZIndex:A}={...v};this._layerZIndexStart=A??this._layerZIndexStart;const p=h??(f.includes(".tmx")?l.TMX:l.JSON);switch(p){case l.TMX:this._resource=new S.Resource(f,"text");break;case l.JSON:this._resource=new S.Resource(f,"json");break;default:throw`The format ${p} is not currently supported. Please export Tiled map as JSON.`}this.mapFormat=p,this.ex={},this.imageMap={},this.sheetMap={},this.tileImageMap={},this.convertPath=(y,x)=>{if(x.indexOf("/")===0)return x;const I=y.split("/"),w=x.split("/");return I[I.length-1].includes(".")&&I.pop(),I.concat(w).join("/")}}_addTiledCamera(f){const v=this.ex.camera;if(v){let h=(0,S.vec)(v.x,v.y);this.isIsometric()&&(h=this._isoTileToScreenCoords(v.x,v.y)),f.camera.x=h.x,f.camera.y=h.y,f.camera.zoom=v.zoom}}_addTiledColliders(f){var v;const h=this.ex.colliders;if(h)for(let A of h){const p=new S.Actor({pos:(0,S.vec)(A.x,A.y),name:A.name,collisionType:(v=A.collisionType)!==null&&v!==void 0?v:S.CollisionType.Fixed});if(A.color&&(p.color=S.Color.fromHex(A.color.value)),A.type==="box")if(this.isIsometric()){p.pos=this._isoTileToScreenCoords(A.x,A.y);const y=new S.BoundingBox({left:0,top:0,right:A.width,bottom:A.height}).getPoints().map(x=>this._isoTileToScreenCoords(x.x,x.y));p.collider.usePolygonCollider(y,S.Vector.Zero)}else p.collider.useBoxCollider(A.width,A.height,S.Vector.Zero);A.type==="circle"&&p.collider.useCircleCollider(A.radius),p.addComponent(new O.TiledObjectComponent(A.tiled)),f.add(p),A.zIndex&&(p.z=A.zIndex)}}_isoTileToScreenCoords(f,v){if(this.isIsometric()){const h=this.isoLayers[0],A=h.tileWidth,p=h.tileHeight,y=0,x=v/p,I=f/p;return(0,S.vec)((I-x)*A/2+y,(I+x)*p/2)}return(0,S.vec)(f,v)}_addTiledText(f){var v,h,A,p,y,x,I,w,U,R,E,$;const G=(v=this.data)===null||v===void 0?void 0:v.getObjects();if(G&&G.length>0)for(const K of G){const m=K.getText();for(const lt of m){let Et=(0,S.vec)(lt.x,lt.y+(((h=lt.height)!==null&&h!==void 0?h:0)-((p=(A=lt.text)===null||A===void 0?void 0:A.pixelSize)!==null&&p!==void 0?p:0)));this.isIsometric()&&(Et=this._isoTileToScreenCoords(lt.x,lt.y));const dt=new S.Label({anchor:S.Vector.Zero,x:Et.x,y:Et.y,text:(x=(y=lt.text)===null||y===void 0?void 0:y.text)!==null&&x!==void 0?x:"",name:this._getEntityName(lt),font:new S.Font({family:(I=lt.text)===null||I===void 0?void 0:I.fontFamily,size:(w=lt.text)===null||w===void 0?void 0:w.pixelSize,unit:S.FontUnit.Px})});if(dt.font.textAlign=S.TextAlign.Left,dt.font.baseAlign=S.BaseAlign.Top,dt.rotation=lt.rotation,dt.color=S.Color.fromHex((R=(U=lt.text)===null||U===void 0?void 0:U.color)!==null&&R!==void 0?R:"#000000"),dt.collider.set(S.Shape.Box((E=lt.width)!==null&&E!==void 0?E:0,($=lt.height)!==null&&$!==void 0?$:0)),dt.body.collisionType=S.CollisionType.PreventCollision,dt.addComponent(new O.TiledObjectComponent(lt)),dt.z=this._calculateZIndex(lt,K),this.isIsometric()){const Ut=new S.IsometricEntityComponent(this.isoLayers[0]);dt.addComponent(Ut),Ut.elevation=K.order}f.add(dt)}}}_addTiledInsertedTiles(f){var v,h,A;const p=(v=this.data)===null||v===void 0?void 0:v.getObjects();if(p&&p.length>0)for(const y of p){const x=y.getInsertedTiles();for(const I of x){const w=I.getProperty("collisionType");let U=S.CollisionType.PreventCollision;w&&(U=w.value);let R=(0,S.vec)(I.x,I.y);if(this.isIsometric()&&(R=this._isoTileToScreenCoords(I.x,I.y)),I.gid){const E=this.getSpriteForGid(I.gid),$=this.getCollidersForGid(I.gid),G=new S.Actor({x:R.x,y:R.y,width:I.width,height:I.height,anchor:this.isIsometric()?(0,S.vec)(.5,1):(0,S.vec)(0,1),rotation:I.rotation,collisionType:U,name:this._getEntityName(I)});if(this.isIsometric()){const K=this.isoLayers[0];for(let m of $)m.offset=(0,S.vec)(-K.tileWidth/2,2*-K.tileHeight)}if($.length&&(G.collider.clear(),G.collider.set(new S.CompositeCollider($))),G.addComponent(new O.TiledObjectComponent(I)),G.graphics.anchor=this.isIsometric()?(0,S.vec)(.5,1):(0,S.vec)(0,1),E.destSize.width=(h=I.width)!==null&&h!==void 0?h:E.destSize.width,E.destSize.height=(A=I.height)!==null&&A!==void 0?A:E.destSize.height,G.graphics.use(E),this.isIsometric()){const K=new S.IsometricEntityComponent(this.isoLayers[0]);G.addComponent(K),K.elevation=y.order}f.add(G),G.z=this._calculateZIndex(I,y)}}}}useSolidLayers(){var f,v,h;let A=this.getTileMapLayers();A=A.concat(this.isoLayers);for(const p of A){const y=this._mapToRawLayer.get(p);if(y&&(v=(f=(0,D.getProperty)(y.properties,"solid"))===null||f===void 0?void 0:f.value)!==null&&v!==void 0&&v)for(let x=0;x<y.data.length;x++)(h=p.tiles[x]).solid||(h.solid=!!y.data[x])}}addTiledMapToScene(f){const v=this.getTileMapLayers();for(const h of v)f.add(h);for(const h of this.isoLayers)f.add(h);this._addTiledCamera(f),this._addTiledColliders(f),this._addTiledText(f),this._addTiledInsertedTiles(f),this.useSolidLayers()}_parseExcaliburInfo(){var f,v,h,A,p,y,x,I,w,U;const R=(f=this.data)===null||f===void 0?void 0:f.getObjects(),E={};if(R.length>0){E.camera=(v=R.find($=>$.getObjectByClass("camera")))===null||v===void 0?void 0:v.getCamera(),E.colliders=[];for(let $ of R){const G=$.getObjectsByClass("boxcollider");for(let m of G){const lt=m.getProperty("collisiontype"),Et=m.getProperty("color"),dt=this._calculateZIndex(m,$);E.colliders.push({...m,width:+((h=m.width)!==null&&h!==void 0?h:0),height:+((A=m.height)!==null&&A!==void 0?A:0),collisionType:(p=lt==null?void 0:lt.value)!==null&&p!==void 0?p:S.CollisionType.Fixed,color:Et,zIndex:dt,radius:0,type:"box",tiled:m,name:this._getEntityName(m)})}const K=$.getObjectsByClass("circlecollider");for(let m of K){const lt=m.getProperty("collisiontype"),Et=m.getProperty("color"),dt=this._calculateZIndex(m,$);E.colliders.push({x:m.x,y:m.y,radius:Math.max((y=m.width)!==null&&y!==void 0?y:0,(x=m.height)!==null&&x!==void 0?x:0),collisionType:(I=lt==null?void 0:lt.value)!==null&&I!==void 0?I:S.CollisionType.Fixed,color:Et,zIndex:dt,width:(w=m.width)!==null&&w!==void 0?w:0,height:(U=m.height)!==null&&U!==void 0?U:0,type:"circle",tiled:m,name:this._getEntityName(m)})}}}this.ex=E}isLoaded(){return!!this.data}isIsometric(){return!!this.isoLayers.length}async load(){const f=await this._resource.load(),v=await this._importMapData(f);let h=[];return v.rawMap.tilesets.forEach(A=>{if(A.source){const y=A.source.includes(".tsx")?"text":"json";var p=new S.Resource(this.convertPath(this.path,A.source),y);h.push(p.load().then(x=>{x=y==="text"?(0,Q.parseExternalTsx)(x,A.firstgid,A.source):(0,Q.parseExternalJson)(x,A.firstgid,A.source),Object.assign(A,x),v.tileSets.push(x)},()=>{S.Logger.getInstance().error(`[Tiled] Error loading external tileset file ${p.path}`)}))}}),await Promise.all(h).then(()=>{let A=[];return v.rawMap.tilesets.forEach(p=>{let y=[];if(p.image){y=p.source?[this.convertPath(p.source,p.image)]:[this.convertPath(this.path,p.image)];for(let x of y){const I=new S.ImageSource(x);this.imageMap[p.firstgid]=I,A.push(I.load()),S.Logger.getInstance().debug("[Tiled] Loading associated tileset image: "+p.image)}}else for(let x of p.tiles){let I;I=p.source?this.convertPath(p.source,x.image):this.convertPath(this.path,x.image);const w=new S.ImageSource(I);A.push(w.load()),this.tileImageMap[p.firstgid]||(this.tileImageMap[p.firstgid]=[]),this.tileImageMap[p.firstgid].push([x,w]),S.Logger.getInstance().debug("[Tiled] Loading associated tileset image: "+I)}}),Promise.all(A).then(()=>{this._createTileMap()},()=>{S.Logger.getInstance().error("[Tiled] Error loading tileset images")})}),this._parseExcaliburInfo(),v}async _importMapData(f){if(f===void 0)throw`Tiled map resource ${this.path} is empty`;switch(this.mapFormat){case l.TMX:return this.data=await C.TiledMap.fromTmx(f);case l.JSON:return this.data=await C.TiledMap.fromJson(f);default:throw new Error("Unknown map format: "+this.mapFormat)}}getTilesetForTile(f){if(this.data)for(var v=this.data.tileSets.length-1;v>=0;v--){var h=this.data.tileSets[v];if(f>=h.firstGid&&f<=h.firstGid+h.tileCount-1)return h}throw Error(`No tileset exists for tiled gid [${f}]!`)}getSpriteForGid(f){const v=(0,B.isFlippedHorizontally)(f),h=(0,B.isFlippedVertically)(f),A=(0,B.isFlippedDiagonally)(f),p=(0,B.getCanonicalGid)(f),y=this.getTilesetForTile(p),x=p-y.firstGid,I=this.sheetMap[y.firstGid.toString()];if(I){let w=I.sprites[x];return(A||v||h)&&(w=w.clone()),A&&(w.rotation=-Math.PI/2,w.scale=(0,S.vec)(-1,1)),v&&(w.scale=(0,S.vec)((A?1:-1)*w.scale.x,(A?-1:1)*w.scale.y)),h&&(w.scale=(0,S.vec)((A?-1:1)*w.scale.x,(A?1:-1)*w.scale.y)),w}throw new Error(`Could not find sprite for gid: [${f}] normalized gid: [${p}]`)}_transformPoints(f,v,h){const A=(0,B.isFlippedHorizontally)(h),p=(0,B.isFlippedVertically)(h);return(0,B.isFlippedDiagonally)(h)&&(f=f.map(y=>v.diagonalFlipTransform.multiply(y))),A&&(f=f.map(y=>v.horizontalFlipTransform.multiply(y))),p&&(f=f.map(y=>v.verticalFlipTransform.multiply(y))),f}getCollidersForGid(f){const v=(0,B.getCanonicalGid)(f),h=this.getTilesetForTile(v),A=v-h.firstGid,p=h.tiles.find(y=>y.id===A);if(p&&p.objectgroup){const y=[];for(const x of p.objectgroup.getPolygons()){const I=(0,S.vec)(x.x,x.y),w=x.polygon.points.split(" ").map(R=>{const E=R.split(",");return(0,S.vec)(Number.parseFloat(E[0]),Number.parseFloat(E[1])).add(I)}),U=S.Shape.Polygon(w);U.points=this._transformPoints(U.points,h,f),y.push(U)}for(const x of p.objectgroup.getBoxes()){const I=S.Shape.Box(x.width,x.height,S.Vector.Zero);I.points=I.points.map(w=>w.add((0,S.vec)(x.x,x.y))),I.points=this._transformPoints(I.points,h,f),y.push(I)}for(const x of p.objectgroup.getEllipses()){const I=S.Shape.Circle(Math.min(x.width/2,x.height/2),(0,S.vec)(x.width/2,x.height/2).add((0,S.vec)(x.x,x.y)));y.push(I)}return y}return[]}getAnimationForGid(f){const v=(0,B.getCanonicalGid)(f),h=this.getTilesetForTile(v),A=v-h.firstGid,p=h.tiles.find(y=>y.id===A);return p&&p.hasAnimation()?p.getAnimation(this):null}_calculateZIndex(f,v){var h,A,p;let y=(A=(h=f.getProperty("z"))===null||h===void 0?void 0:h.value)!==null&&A!==void 0?A:(p=f.getProperty("zindex"))===null||p===void 0?void 0:p.value;return y!=null||(y=v.order+this._layerZIndexStart),+y}_getEntityName(f){return f.name}_createTileMap(){var f,v,h,A,p,y,x,I,w;for(const R of this.data.rawMap.tilesets){const E=(f=R.spacing)!==null&&f!==void 0?f:0,$=Math.floor((R.imagewidth+E)/(R.tilewidth+E)),G=Math.floor((R.imageheight+E)/(R.tileheight+E));if(this.imageMap[R.firstgid]){const K=S.SpriteSheet.fromImageSource({image:this.imageMap[R.firstgid],grid:{columns:$,rows:G,spriteWidth:R.tilewidth,spriteHeight:R.tileheight},spacing:{originOffset:{x:(v=R.margin)!==null&&v!==void 0?v:0,y:(h=R.margin)!==null&&h!==void 0?h:0},margin:{x:(A=R.spacing)!==null&&A!==void 0?A:0,y:(p=R.spacing)!==null&&p!==void 0?p:0}}});this.sheetMap[R.firstgid.toString()]=K}else{const K=this.tileImageMap[R.firstgid].map(([lt,Et])=>Et.toSprite()),m=new S.SpriteSheet({sprites:K});this.sheetMap[R.firstgid.toString()]=m}}for(var U of this.data.layers)if(U.rawLayer.type==="tilelayer"){if(this.data.orientation==="orthogonal"){const R=U.rawLayer,E=new S.TileMap({name:U.rawLayer.name,pos:(0,S.vec)(U.offset.x,U.offset.y),tileWidth:this.data.rawMap.tilewidth,tileHeight:this.data.rawMap.tileheight,columns:this.data.width,rows:this.data.height});if(E.addComponent(new V.TiledLayerComponent(U)),U.rawLayer.parallaxx||U.rawLayer.parallaxy){const $=(0,S.vec)((y=U.rawLayer.parallaxx)!==null&&y!==void 0?y:1,(x=U.rawLayer.parallaxy)!==null&&x!==void 0?x:1);E.addComponent(new S.ParallaxComponent($))}E.z=this._calculateZIndex(U,U);for(let $=0;$<R.data.length;$++){let G=R.data[$];if(G!==0){const K=this.getSpriteForGid(G);E.tiles[$].addGraphic(K);const m=this.getCollidersForGid(G);for(let Et of m)E.tiles[$].addCollider(Et);const lt=this.getAnimationForGid(G);lt&&(E.tiles[$].clearGraphics(),E.tiles[$].addGraphic(lt))}}this._mapToRawLayer.set(E,R),(I=this.layers)===null||I===void 0||I.push(E)}if(this.data.orientation==="isometric"){const R=U.rawLayer,E=new S.IsometricMap({name:U.rawLayer.name,pos:(0,S.vec)(U.offset.x,U.offset.y),columns:this.data.width,rows:this.data.height,tileWidth:this.data.tileWidth,tileHeight:this.data.tileHeight}),$=E.get(S.TransformComponent);$&&($.z=this._calculateZIndex(U,U));for(let G=0;G<R.data.length;G++){let K=R.data[G];if(K!==0){const m=this.getSpriteForGid(K);E.tiles[G].addGraphic(m);const lt=this.getCollidersForGid(K);for(let dt of lt)E.tiles[G].addCollider(dt);const Et=E.tiles[G].get(S.IsometricEntityComponent);Et&&(Et.elevation=U.order)}}E.updateColliders(),this._mapToRawLayer.set(E,R),(w=this.isoLayers)===null||w===void 0||w.push(E)}}}getTileMapLayers(){var f;return!((f=this.layers)===null||f===void 0)&&f.length?this.layers:[]}getIsometricMapLayers(){var f;return!((f=this.isoLayers)===null||f===void 0)&&f.length?this.isoLayers:[]}_lookupTile(f,v,h){const A=f.tiles.indexOf(v),p=this.data.getTileLayerByName(h),y=(0,B.getCanonicalGid)(p.data[A]);if(y===0)return null;const x=this.getTilesetForTile(y);return x.tiles.find(I=>I.id===y-1)||{id:y-1,tileset:x,properties:{}}}getTileByPoint(f,v){const h=this.getTileMapLayers().find(A=>A.name===f);if(h){const A=h.getTileByPoint(v);return A?this._lookupTile(h,A,f):null}return null}getTileByCoordinate(f,v,h){const A=this.getTileMapLayers().find(p=>p.name===f);if(A){const p=A.getTile(v,h);return this._lookupTile(A,p,f)}return null}}},"./src/deprecated/tiled-object-component.ts":(X,k,b)=>{b.r(k),b.d(k,{TiledObjectComponent:()=>S});var l=b("excalibur");class S extends l.Component{constructor(Q){super(),this.object=Q,this.type="ex.tiledobject"}}},"./src/deprecated/tiled-object.ts":(X,k,b)=>{b.r(k),b.d(k,{TiledObject:()=>Q,TiledObjectGroup:()=>C});var l=b("./src/deprecated/tiled-entity.ts"),S=b("excalibur");class C extends l.TiledEntity{constructor(){super(...arguments),this.objects=[]}getCamera(){var D;const O=this.getObjectByClass("camera");if(O){const V=O.getProperty("zoom");return{x:O.x,y:O.y,zoom:V?+((D=V==null?void 0:V.value)!==null&&D!==void 0?D:1):1}}}getObjectByType(D){return this.getObjectsByType(D)[0]}getObjectByClass(D){return this.getObjectsByClass(D)[0]}getObjectsByType(D){return this.objects.filter(O=>{var V;return((V=O.type)===null||V===void 0?void 0:V.toLocaleLowerCase())===D.toLocaleLowerCase()})}getObjectsByClass(D){return this.objects.filter(O=>{var V,M;return((V=O.class)===null||V===void 0?void 0:V.toLocaleLowerCase())===D.toLocaleLowerCase()||((M=O.type)===null||M===void 0?void 0:M.toLocaleLowerCase())===D.toLocaleLowerCase()})}getObjectByName(D){return this.getObjectsByName(D)[0]}getObjectsByName(D){return this.objects.filter(O=>{var V;return((V=O.name)===null||V===void 0?void 0:V.toString().toLocaleLowerCase())===D.toString().toLocaleLowerCase()})}getPoints(){return this.objects.filter(D=>!!D.point)}getEllipses(){return this.objects.filter(D=>!!D.ellipse)}getText(){return this.objects.filter(D=>!!D.text)}getPolyLines(){return this.objects.filter(D=>!!D.polyline)}getPolygons(){return this.objects.filter(D=>!!D.polygon)}getBoxes(){return this.objects.filter(D=>!!D.width&&!!D.height&&!D.ellipse)}getInsertedTiles(){return this.objects.filter(D=>!!D.gid)}static parse(D){var O;if(D.type!=="objectgroup")throw Error("Cannot parse non objectgroup type layer");const V=new C;V.id=+D.id,V.name=D.name,V.properties=(O=D.properties)!==null&&O!==void 0?O:[],V.rawObjectGroup=D,V.order=D.order;for(let M of D.objects)V.objects.push(Q.parse(M));return V}}class Q extends l.TiledEntity{static parse(D){var O,V,M,L;const f=new Q;return f.id=+D.id,f.gid=D.gid,f.visible=(O=D.visible)===null||O===void 0||O,f.name=D.name,f.type=D.type,f.class=D.class,f.x=+D.x,f.y=+D.y,f.rotation=D.rotation?(0,S.toRadians)(D.rotation):0,f.width=(V=D.width)!==null&&V!==void 0?V:0,f.height=(M=D.height)!==null&&M!==void 0?M:0,f.point=D.point,f.ellipse=D.ellipse===!0||D.ellipse==="",f.polyline=D.polyline,f.polygon=D.polygon,f.rawObject=D,D.text&&(f.text={...D.text,pixelSize:D.text.pixelsize,fontFamily:D.text.fontfamily}),f.properties=(L=D.properties)!==null&&L!==void 0?L:[],f}}},"./src/deprecated/tiled-tileset.ts":(X,k,b)=>{b.r(k),b.d(k,{TiledTileset:()=>B,TiledTilesetTile:()=>D,parseExternalJson:()=>V,parseExternalTsx:()=>O});var l=b("excalibur"),S=b("./node_modules/fast-xml-parser/src/parser.js"),C=b("./src/deprecated/tiled-object.ts"),Q=b("./src/deprecated/tiled-entity.ts");class B{constructor(){this.tiles=[]}static parse(L){var f,v;const h=new B;let A=[];if(Array.isArray(L.tiles))A=((f=L.tiles)!==null&&f!==void 0?f:[]).map(p=>D.parse(p,h));else for(let p in L.tiles)A.push(D.parse({...L.tiles[p],id:+p},h));return h.tiles=A,h.firstGid=L.firstgid,h.tileWidth=L.tilewidth,h.tileHeight=L.tileheight,h.tileCount=L.tilecount,h.tileOffset=L.tileoffset,h.tiledVersion=L.tiledversion,h.backgroundColor=L.backgroundcolor,h.transparentColor=L.transparentcolor,h.wangSets=L.wangsets,h.imageWidth=L.imagewidth,h.imageHeight=L.imageheight,h.objectAlignment=(v=L.objectalignment)!==null&&v!==void 0?v:"unspecified",h.image=L.image,h.spacing=isNaN(L.spacing)?0:L.spacing,h.horizontalFlipTransform=l.Matrix.identity().translate(h.tileWidth,0).scale(-1,1),h.verticalFlipTransform=l.Matrix.identity().translate(0,h.tileHeight).scale(1,-1),h.diagonalFlipTransform=l.Matrix.identity().translate(0,0).rotate(-Math.PI/2).scale(-1,1),h}}class D{hasAnimation(){return!!this.animation}getAnimation(L){var f;if(this.animation){let v=[];for(let h of this.animation)v.push({graphic:L.getSpriteForGid(h.tileid+this.tileset.firstGid),duration:h.duration});return new l.Animation({frames:v,strategy:(f=this.animationStrategy)!==null&&f!==void 0?f:l.AnimationStrategy.Loop})}return null}static parse(L,f){var v,h,A;const p=new D;if(p.id=+L.id,p.image=L.image,p.tileset=f,p.properties=Array.isArray(L.properties)?L.properties:(h=(v=L.properties)===null||v===void 0?void 0:v.property)!==null&&h!==void 0?h:[],L.objectgroup&&(p.objectgroup=C.TiledObjectGroup.parse(L.objectgroup)),L.terrain&&(p.terrain=L.terrain),L.animation&&(p.animation=Array.isArray(L.animation)?L.animation:[...L.animation.frame],p.properties)){const y=(A=(0,Q.getProperty)(p.properties,"animationstrategy"))===null||A===void 0?void 0:A.value;switch(y==null?void 0:y.toLowerCase()){case l.AnimationStrategy.End.toLowerCase():p.animationStrategy=l.AnimationStrategy.End;break;case l.AnimationStrategy.Freeze.toLowerCase():p.animationStrategy=l.AnimationStrategy.Freeze;break;case l.AnimationStrategy.Loop.toLowerCase():p.animationStrategy=l.AnimationStrategy.Loop;break;case l.AnimationStrategy.PingPong.toLowerCase():p.animationStrategy=l.AnimationStrategy.PingPong;break;default:p.animationStrategy=l.AnimationStrategy.Loop}}return p}}const O=(M,L,f)=>{var v,h,A,p,y;const x=(R,E,$=!1)=>{R[E]?(R[E+($?"s":"")]=Array.isArray(R[E])?R[E]:[R[E]],$&&delete R[E]):R[E+($?"s":"")]=[]},I=S.parse(M,{attributeNamePrefix:"",textNodeName:"#text",ignoreAttributes:!1,ignoreNameSpace:!1,allowBooleanAttributes:!0,parseNodeValue:!0,parseAttributeValue:!0,trimValues:!0,parseTrueNumberOnly:!1,arrayMode:!1,stopNodes:["parse-me-as-string"]}).tileset,w=I;w.firstgid=L,w.source=f,w.imagewidth=(v=I.image)===null||v===void 0?void 0:v.width,w.imageheight=(h=I.image)===null||h===void 0?void 0:h.height,w.objectalignment=(A=I.objectalignment)!==null&&A!==void 0?A:"unspecified",w.image=(p=I.image)===null||p===void 0?void 0:p.source,w.spacing=isNaN(I.spacing)?0:I.spacing,x(I,"tile",!0),I.tiles.forEach(R=>{var E;!((E=R.image)===null||E===void 0)&&E.source&&(R.image=R.image.source),R.objectgroup&&(R.objectgroup.type="objectgroup",x(R.objectgroup,"object",!0))}),w.tiles=I.tiles;const U={...w,tiles:[],firstGid:w.firstgid,tileWidth:w.tilewidth,tileHeight:w.tileheight,tileCount:w.tilecount,tileOffset:w.tileoffset,tiledVersion:w.tiledversion,backgroundColor:w.backgroundcolor,transparentColor:w.transparentcolor,wangSets:w.wangsets,imageWidth:w.imagewidth,imageHeight:w.imageheight,objectAlignment:(y=w.objectalignment)!==null&&y!==void 0?y:"unspecified",image:w.image,spacing:isNaN(w.spacing)?0:w.spacing,horizontalFlipTransform:l.Matrix.identity().translate(w.tilewidth,0).scale(-1,1),verticalFlipTransform:l.Matrix.identity().translate(0,w.tileheight).scale(1,-1),diagonalFlipTransform:l.Matrix.identity().translate(w.tilewidth,w.tileheight).rotate(-Math.PI/2).scale(-1,1)};return U.tiles=w.tiles.map(R=>D.parse(R,U)),U},V=(M,L,f)=>{var v,h;let A=[];M.tiles=(v=M.tiles)!==null&&v!==void 0?v:[],(0,l.vec)(M.tilewidth/2,M.tileheight/2);const p={...M,source:f,tiles:A,firstGid:L,tileWidth:M.tilewidth,tileHeight:M.tileheight,tileCount:M.tilecount,tileOffset:M.tileoffset,tiledVersion:M.tiledversion,backgroundColor:M.backgroundcolor,transparentColor:M.transparentcolor,wangSets:M.wangsets,imageWidth:M.imagewidth,imageHeight:M.imageheight,spacing:isNaN(M.spacing)?0:M.spacing,objectAlignment:(h=M.objectalignment)!==null&&h!==void 0?h:"unspecified",image:M.image,horizontalFlipTransform:l.Matrix.identity().translate(M.tilewidth,0).scale(-1,1),verticalFlipTransform:l.Matrix.identity().translate(0,M.tileheight).scale(1,-1),diagonalFlipTransform:l.Matrix.identity().translate(M.tilewidth,M.tileheight).rotate(-Math.PI/2).scale(-1,1)};for(let y in M.tiles)A.push(D.parse({...M.tiles[y],id:+y},p));return p}},"./src/deprecated/tiled-types.ts":(X,k,b)=>{b.r(k)},"./src/parser/tiled-parser.ts":(X,k,b)=>{b.r(k),b.d(k,{TiledMap:()=>ae,TiledParser:()=>F,TiledTemplate:()=>Mt,TiledText:()=>$,TiledTile:()=>Ut,TiledTileLayer:()=>I,TiledTileLayerInfinite:()=>x,TiledTileset:()=>zt,TiledTilesetFile:()=>wt,isCSV:()=>U,isInfiniteLayer:()=>st,isTiledTilesetCollectionOfImages:()=>yt,isTiledTilesetEmbedded:()=>g,isTiledTilesetExternal:()=>it,isTiledTilesetSingleImage:()=>It,needsDecoding:()=>w});var l=b("./node_modules/zod/lib/index.mjs");const S=l.z.object({name:l.z.string(),type:l.z.literal("int"),value:l.z.number().int()}),C=l.z.object({name:l.z.string(),type:l.z.literal("bool"),value:l.z.boolean()}),Q=l.z.object({name:l.z.string(),type:l.z.literal("float"),value:l.z.number()}),B=l.z.object({name:l.z.string(),type:l.z.literal("string"),value:l.z.string()}),D=l.z.object({name:l.z.string(),type:l.z.literal("file"),value:l.z.string()}),O=l.z.object({name:l.z.string(),type:l.z.literal("color"),value:l.z.string()}),V=l.z.object({name:l.z.string(),type:l.z.literal("object"),value:l.z.number()}),M=l.z.discriminatedUnion("type",[S,C,Q,B,D,O,V]),L=l.z.object({name:l.z.string(),type:l.z.literal("tilelayer"),class:l.z.string().optional(),height:l.z.number(),width:l.z.number(),x:l.z.number(),y:l.z.number(),id:l.z.number(),opacity:l.z.number(),properties:l.z.array(M).optional(),visible:l.z.boolean(),tintcolor:l.z.string().optional(),parallaxx:l.z.number().optional(),parallaxy:l.z.number().optional(),offsetx:l.z.number().optional(),offsety:l.z.number().optional()}),f=L.extend({data:l.z.array(l.z.number()),encoding:l.z.literal("csv")}),v=L.extend({data:l.z.array(l.z.number()),encoding:l.z.literal("base64"),compression:l.z.literal("gzip")}),h=L.extend({data:l.z.array(l.z.number()),encoding:l.z.literal("base64"),compression:l.z.literal("zlib")}),A=L.extend({data:l.z.array(l.z.number()),encoding:l.z.literal("base64"),compression:l.z.literal("zstandard")}),p=L.extend({data:l.z.string(),encoding:l.z.literal("base64"),compression:l.z.string()}),y=l.z.object({x:l.z.number(),y:l.z.number(),width:l.z.number(),height:l.z.number(),data:l.z.array(l.z.number())}),x=L.extend({startx:l.z.number(),starty:l.z.number(),chunks:l.z.array(y)}),I=l.z.union([p,f,v,h,A,x]);function w(St){return St.encoding==="base64"}function U(St){return St.encoding==="csv"||Array.isArray(St.data)}const R=l.z.object({x:l.z.number(),y:l.z.number()}),E=l.z.array(R),$=l.z.object({text:l.z.string(),color:l.z.string().optional(),fontfamily:l.z.string().optional(),pixelsize:l.z.number().optional(),wrap:l.z.boolean().optional(),halign:l.z.union([l.z.literal("left"),l.z.literal("center"),l.z.literal("right"),l.z.literal("justify")]).optional(),valign:l.z.union([l.z.literal("top"),l.z.literal("center"),l.z.literal("bottom")]).optional()}),G=l.z.object({id:l.z.number().optional(),name:l.z.string().optional(),type:l.z.string().optional(),x:l.z.number().optional(),y:l.z.number().optional(),rotation:l.z.number().optional(),height:l.z.number().optional(),width:l.z.number().optional(),visible:l.z.boolean().optional(),gid:l.z.number().optional(),text:$.optional(),point:l.z.boolean().optional(),ellipse:l.z.boolean().optional(),polyline:l.z.array(R).optional(),polygon:E.optional(),template:l.z.string().optional(),properties:l.z.array(M).optional()}),K=l.z.object({duration:l.z.number(),tileid:l.z.number()}),m=l.z.object({name:l.z.string(),draworder:l.z.string(),type:l.z.literal("objectgroup"),class:l.z.string().optional(),x:l.z.number(),y:l.z.number(),id:l.z.number(),color:l.z.string().optional(),tintcolor:l.z.string().optional(),parallaxx:l.z.number().optional(),parallaxy:l.z.number().optional(),offsetx:l.z.number().optional(),offsety:l.z.number().optional(),opacity:l.z.number(),properties:l.z.array(M).optional(),visible:l.z.boolean(),objects:l.z.array(G)}),lt=l.z.object({name:l.z.string(),x:l.z.number(),y:l.z.number(),id:l.z.number(),type:l.z.literal("imagelayer"),class:l.z.string().optional(),image:l.z.string().optional(),opacity:l.z.number(),properties:l.z.array(M).optional(),visible:l.z.boolean(),tintcolor:l.z.string().optional(),repeatx:l.z.boolean().optional(),repeaty:l.z.boolean().optional(),parallaxx:l.z.number().optional(),parallaxy:l.z.number().optional(),offsetx:l.z.number().optional(),offsety:l.z.number().optional(),transparentcolor:l.z.string().optional()}),Et=l.z.union([lt,I,m]),dt=l.z.object({draworder:l.z.string(),id:l.z.number().optional(),name:l.z.string(),x:l.z.number(),y:l.z.number(),opacity:l.z.number(),tintcolor:l.z.string().optional(),type:l.z.literal("objectgroup"),visible:l.z.boolean(),objects:l.z.array(G),properties:l.z.array(M).optional()}),Ut=l.z.object({id:l.z.number(),type:l.z.string().optional(),animation:l.z.array(K).optional(),objectgroup:dt.optional(),probability:l.z.number().optional(),properties:l.z.array(M).optional(),image:l.z.string().optional(),imageheight:l.z.number().optional(),imagewidth:l.z.number().optional()}),At=l.z.object({name:l.z.string(),firstgid:l.z.number().optional(),class:l.z.string().optional(),objectalignment:l.z.union([l.z.literal("topleft"),l.z.literal("top"),l.z.literal("topright"),l.z.literal("left"),l.z.literal("center"),l.z.literal("right"),l.z.literal("bottomleft"),l.z.literal("bottom"),l.z.literal("bottomright")]).optional(),image:l.z.string().optional(),imagewidth:l.z.number().optional(),imageheight:l.z.number().optional(),columns:l.z.number(),tileheight:l.z.number(),tilewidth:l.z.number(),tilecount:l.z.number(),grid:l.z.object({height:l.z.number(),width:l.z.number(),orientation:l.z.union([l.z.literal("isometric"),l.z.literal("orthogonal")])}).optional(),tileoffset:R.optional(),spacing:l.z.number(),margin:l.z.number(),tiles:l.z.array(Ut).optional(),properties:l.z.array(M).optional()});function It(St){return!!St.image}function yt(St){return!St.image}const wt=At.extend({tiledversion:l.z.string().optional(),type:l.z.literal("tileset"),version:l.z.string().optional()}),ie=l.z.object({firstgid:l.z.number(),source:l.z.string()}),zt=l.z.union([At,ie]),Mt=l.z.object({object:G.extend({id:l.z.number().optional()}),tileset:ie.optional(),type:l.z.literal("template")}),ae=l.z.object({type:l.z.string(),class:l.z.string().optional(),tiledversion:l.z.string(),version:l.z.string(),width:l.z.number(),height:l.z.number(),tilewidth:l.z.number(),tileheight:l.z.number(),compressionlevel:l.z.number().optional(),infinite:l.z.boolean(),nextlayerid:l.z.number(),nextobjectid:l.z.number(),parallaxoriginx:l.z.number().optional(),parallaxoriginy:l.z.number().optional(),hexsidelength:l.z.number().optional(),staggeraxis:l.z.literal("y").or(l.z.literal("x")).optional(),staggerindex:l.z.literal("odd").or(l.z.literal("even")).optional(),orientation:l.z.union([l.z.literal("isometric"),l.z.literal("orthogonal"),l.z.literal("staggered"),l.z.literal("hexagonal")]),renderorder:l.z.union([l.z.literal("right-down"),l.z.literal("right-up"),l.z.literal("left-down"),l.z.literal("left-up")]),backgroundcolor:l.z.string().optional(),layers:l.z.array(Et),tilesets:l.z.array(zt),properties:l.z.array(M).optional()});function st(St){return!!St.chunks}function g(St){return!St.source}function it(St){return!!St.source}class ut{constructor(gt,pt,ht,ct){this.x=gt,this.y=pt,this.width=ht,this.height=ct}combine(gt){const pt=this.x+this.width,ht=this.y+this.height,ct=gt.x+gt.width,vt=gt.y+gt.height,Qt=Math.max(pt,ct),bt=Math.max(ht,vt);return new ut(Math.min(this.x,gt.x),Math.min(this.y,gt.y),Qt-Math.min(this.x,gt.x),bt-Math.min(this.y,gt.y))}}class F{constructor(){this._largestBounds=new ut(0,0,0,0)}_coerceNumber(gt){return+gt}_coerceBoolean(gt){switch(gt){case"0":case"false":return!1;case"true":return!0;default:return!!gt}}_coerceType(gt,pt){return gt==="bool"?this._coerceBoolean(pt):gt==="int"||gt==="float"||gt==="object"?this._coerceNumber(pt):pt}_parsePropertiesNode(gt,pt){var ht;const ct=[];if(gt)for(let vt of gt.children){const Qt=(ht=vt.getAttribute("type"))!==null&&ht!==void 0?ht:"string";let bt=vt.getAttribute("value");bt||(bt=vt.innerHTML),ct.push({name:vt.getAttribute("name"),type:Qt,value:this._coerceType(Qt,bt)})}pt.properties=ct}_parseAttributes(gt,pt){const ht=["width","height","columns","firstgid","spacing","margin","tilecount","tilewidth","tileheight","opacity","compressionlevel","nextlayerid","nextobjectid","parallaxoriginx","parallaxoriginy","parallaxx","parallaxy","hexsidelength","offsetx","offsety","id","gid","x","y","rotation","probability"],ct=["infinite","visible","repeatx","repeaty"];for(let vt of gt.attributes)ht.indexOf(vt.name)>-1?pt[vt.name]=this._coerceNumber(vt.value):ct.indexOf(vt.name)>-1?pt[vt.name]=this._coerceBoolean(vt.value):pt[vt.name]=vt.value}_parseToDocument(gt){if(typeof DOMParser<"u")return new DOMParser().parseFromString(gt,"application/xml");try{const{JSDOM:ht}=b("jsdom");return new ht(gt,{contentType:"application/xml",encoding:"utf-8"}).window.document}catch{}const pt=new Error("Could not find DOM parser");throw console.error(pt.message,pt),pt}parseObject(gt,pt=!0){var ht,ct;const vt={type:"",x:0,y:0};gt.getAttribute("template")||(vt.visible=!0,vt.name="",vt.rotation=0,vt.height=0,vt.width=0),this._parseAttributes(gt,vt);const Qt=gt.querySelector("properties");Qt&&this._parsePropertiesNode(Qt,vt);const bt=gt.querySelector("text");if(bt){vt.text={text:bt.textContent};const jt=bt.getAttribute("fontfamily");jt&&(vt.text.fontfamily=jt);const le=bt.getAttribute("color");le&&(vt.text.color=le);const _e=bt.getAttribute("pixelsize");_e&&(vt.text.pixelsize=this._coerceNumber(_e));const de=bt.getAttribute("wrap");de&&(vt.text.wrap=this._coerceBoolean(de));const Oe=bt.getAttribute("valign");Oe&&(vt.text.valign=Oe);const Ke=bt.getAttribute("halign");Ke&&(vt.text.halign=Ke)}gt.querySelector("point")&&(vt.point=!0),gt.querySelector("ellipse")&&(vt.ellipse=!0);const Gt=gt.querySelector("polygon");if(Gt){const jt=(ht=Gt.getAttribute("points"))===null||ht===void 0?void 0:ht.split(" ");vt.polygon=[],jt&&jt.forEach(le=>{const _e=le.split(",");vt.polygon.push({x:+_e[0],y:+_e[1]})})}const oe=gt.querySelector("polyline");if(oe){const jt=(ct=oe.getAttribute("points"))===null||ct===void 0?void 0:ct.split(" ");vt.polyline=[],jt&&jt.forEach(le=>{const _e=le.split(",");vt.polyline.push({x:+_e[0],y:+_e[1]})})}if(pt)try{return G.parse(vt)}catch(jt){throw console.error("Could not parse object",vt,jt),jt}return vt}parseTileset(gt,pt=!0){const ht={spacing:0,margin:0};if(this._parseAttributes(gt,ht),ht.source)try{return zt.parse(ht)}catch(ct){console.error("Could not parse external tileset",ht,ct)}for(let ct of gt.children)switch(ct.tagName){case"properties":this._parsePropertiesNode(ct,ht);break;case"tileoffset":{const vt={};this._parseAttributes(ct,vt),ht.tileoffset=vt;break}case"grid":{const vt={};this._parseAttributes(ct,vt),ht.grid=vt;break}case"image":ht.image=ct.getAttribute("source"),ht.imagewidth=this._coerceNumber(ct.getAttribute("width")),ht.imageheight=this._coerceNumber(ct.getAttribute("height"));break;case"tile":{ht.tiles||(ht.tiles=[]);const vt={};this._parseAttributes(ct,vt);for(let Qt of ct.children)switch(Qt.tagName){case"image":vt.image=Qt.getAttribute("source"),vt.imagewidth=this._coerceNumber(Qt.getAttribute("width")),vt.imageheight=this._coerceNumber(Qt.getAttribute("height"));break;case"objectgroup":{const bt={type:"objectgroup",name:"",visible:!0,x:0,y:0,opacity:1,objects:[]};this._parseAttributes(Qt,bt),vt.objectgroup=bt;for(let Gt of Qt.children){const oe=this.parseObject(Gt,pt);bt.objects.push(oe)}break}case"animation":{const bt=[];for(let Gt of Qt.children)bt.push({duration:this._coerceNumber(Gt.getAttribute("duration")),tileid:this._coerceNumber(Gt.getAttribute("tileid"))});vt.animation=bt;break}case"properties":this._parsePropertiesNode(Qt,vt)}if(pt)try{ht.tiles.push(Ut.parse(vt))}catch(Qt){throw console.error("Could not parse Tile",vt,Qt),Qt}else ht.tiles.push(vt);break}}if(pt)try{return zt.parse(ht)}catch(ct){throw console.error("Could not parse Tileset",ht,ct),ct}return ht}parseTileLayer(gt,pt,ht=!0){var ct,vt,Qt;const bt={type:"tilelayer",compression:"",x:0,y:0,opacity:1,visible:!0};this._parseAttributes(gt,bt);for(let Gt of gt.children)switch(Gt.tagName){case"properties":this._parsePropertiesNode(Gt,bt);break;case"data":if(pt){bt.width=0,bt.height=0,bt.chunks=[];let oe=new ut(0,0,0,0);for(let jt of Gt.children)if(jt.tagName==="chunk"){const le={};this._parseAttributes(jt,le),le.data=(ct=jt.textContent)===null||ct===void 0?void 0:ct.split(",").map(de=>+de);const _e=new ut(le.x,le.y,le.width,le.height);oe=oe.combine(_e),bt.chunks.push(le)}bt.width=oe.width,bt.height=oe.height,bt.startx=oe.x,bt.starty=oe.y,this._largestBounds=this._largestBounds.combine(new ut(bt.startx,bt.starty,bt.width,bt.height))}else{const oe=Gt.getAttribute("encoding");bt.encoding=oe;const jt=Gt.getAttribute("compression");switch(jt&&(bt.compression=jt),bt.encoding){case"base64":bt.data=(vt=Gt.textContent)===null||vt===void 0?void 0:vt.trim();break;case"csv":bt.data=(Qt=Gt.textContent)===null||Qt===void 0?void 0:Qt.split(",").map(le=>+le)}}}if(ht)try{return Et.parse(bt)}catch(Gt){throw console.error("Could not parse tiled tile layer",bt,Gt),Gt}return bt}parseObjectGroup(gt,pt=!0){const ht={type:"objectgroup",draworder:"topdown",visible:!0,x:0,y:0,opacity:1,objects:[]};this._parseAttributes(gt,ht);for(let ct of gt.children)switch(ct.tagName){case"properties":this._parsePropertiesNode(ct,ht);break;case"object":{const vt=this.parseObject(ct,pt);ht.objects.push(vt);break}}if(pt)try{return Et.parse(ht)}catch(ct){throw console.error("Could not parse object group",ht,ct),ct}return ht}parseImageLayer(gt,pt=!0){const ht={type:"imagelayer",visible:!0,x:0,y:0,opacity:1},ct=gt.querySelector("image");ht.image=ct==null?void 0:ct.getAttribute("source");const vt=gt.querySelector("properties");vt&&this._parsePropertiesNode(vt,ht);const Qt=ct==null?void 0:ct.getAttribute("trans");if(Qt&&(ht.transparentcolor="#"+Qt),this._parseAttributes(gt,ht),pt)try{return Et.parse(ht)}catch(bt){throw console.error("Could not parse layer",ht,bt),bt}return ht}parseExternalTemplate(gt,pt=!0){const ht=this._parseToDocument(gt).querySelector("template"),ct={type:"template"},vt=ht.querySelector("object");vt&&(ct.object=this.parseObject(vt,pt));const Qt=ht.querySelector("tileset");if(Qt&&(ct.tileset=this.parseTileset(Qt,pt)),pt)try{return Mt.parse(ct)}catch(bt){throw console.error("Could not parse template",ct,bt),bt}return ct}parseExternalTileset(gt,pt=!0){const ht=this._parseToDocument(gt).querySelector("tileset"),ct=this.parseTileset(ht,pt);if(ct.type="tileset",this._parseAttributes(ht,ct),pt)try{return wt.parse(ct)}catch(vt){throw console.error("Could not parse tileset file",ct,vt),vt}return ct}parse(gt,pt=!0){const ht=this._parseToDocument(gt).querySelector("map"),ct={type:"map",compressionlevel:-1,layers:[],tilesets:[]};this._parseAttributes(ht,ct);const vt=(Qt,bt=!0)=>{switch(Qt.tagName){case"group":for(let Gt of Qt.children)vt(Gt,bt);break;case"layer":{const Gt=this.parseTileLayer(Qt,ct.infinite,bt);ct.layers.push(Gt);break}case"properties":this._parsePropertiesNode(Qt,ct);break;case"tileset":{const Gt=this.parseTileset(Qt,bt);ct.tilesets.push(Gt);break}case"objectgroup":{const Gt=this.parseObjectGroup(Qt,bt);ct.layers.push(Gt);break}case"imagelayer":{const Gt=this.parseImageLayer(Qt,bt);ct.layers.push(Gt);break}}};for(let Qt of ht.children)vt(Qt,pt);if(pt)try{return ae.parse(ct)}catch(Qt){throw console.error("Could not parse Tiled map",Qt),Qt}return ct}}},"./src/resource/decoder.ts":(X,k,b)=>{b.r(k),b.d(k,{Decoder:()=>C});var l=b("./node_modules/pako/index.js"),S=b("./node_modules/zstddec/dist/zstddec.modern.js");class C{static decode(B,D){var O,V,M,L,f,v;if(B.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var h=43,A=47,p=48,y=97,x=65,I=45,w=95;function U(G){var K=G.charCodeAt(0);if(K===h||K===I)return 62;if(K===A||K===w)return 63;if(K<p)return-1;if(K<p+10)return K-p+26+26;if(K<x+26)return K-x;if(K<y+26)return K-y+26;throw Error("Could not decode elt")}var R=B.length;f=B.charAt(R-2)==="="?2:B.charAt(R-1)==="="?1:0,v=new Uint8Array(3*B.length/4-f),M=f>0?B.length-4:B.length;var E=0;function $(G){v[E++]=G}for(O=0,V=0;O<M;O+=4,V+=3)$((16711680&(L=U(B.charAt(O))<<18|U(B.charAt(O+1))<<12|U(B.charAt(O+2))<<6|U(B.charAt(O+3))))>>16),$((65280&L)>>8),$(255&L);return f===2?$(255&(L=U(B.charAt(O))<<2|U(B.charAt(O+1))>>4)):f===1&&($((L=U(B.charAt(O))<<10|U(B.charAt(O+1))<<4|U(B.charAt(O+2))>>2)>>8&255),$(255&L)),new Promise(G=>{const K=function(Et){for(var dt=0,Ut=Et.length-1;Ut>=0;Ut--)dt=256*dt+1*Et[Ut];return dt};if(D==="zlib"||D==="gzip"){var m=(v=(0,l.inflate)(v)).length/4,lt=new Array(m);for(O=0;O<m;O++)lt[O]=K(v.slice(4*O,4*O+4));G(lt)}if(D==="zstd"){const Et=new S.ZSTDDecoder;Et.init().then(()=>{var dt=(v=Et.decode(v)).length/4,Ut=new Array(dt);for(O=0;O<dt;O++)Ut[O]=K(v.slice(4*O,4*O+4));G(Ut)})}if(!D){for(m=v.length/4,lt=new Array(m),O=0;O<m;O++)lt[O]=K(v.slice(4*O,4*O+4));G(lt)}})}}},"./src/resource/excalibur-properties.ts":(X,k,b)=>{b.r(k),b.d(k,{ExcaliburTiledProperties:()=>l});const l={TileData:{Tiled:"ex-tiled"},ZIndex:{ZIndex:"zindex"},Camera:{Camera:"camera",Zoom:"zoom"},Animation:{Strategy:"animationstrategy"},Layer:{Solid:"solid"},Collision:{Type:"collisiontype"}}},"./src/resource/file-loader.ts":(X,k,b)=>{b.r(k),b.d(k,{FetchLoader:()=>l});const l=async(S,C)=>{const Q=await fetch(S);switch(C.toLowerCase()){case"xml":default:return await Q.text();case"json":return await Q.json()}}},"./src/resource/filter-util.ts":(X,k,b)=>{b.r(k),b.d(k,{byClassCaseInsensitive:()=>S,byNameCaseInsensitive:()=>l,byPropertyCaseInsensitive:()=>C});const l=Q=>B=>B!=null&&B.name&&Q?B.name.toLocaleLowerCase().localeCompare(Q.toLocaleLowerCase())===0:(B==null?void 0:B.name)===Q,S=Q=>B=>B!=null&&B.class&&Q?B.class.toLocaleLowerCase().localeCompare(Q.toLocaleLowerCase())===0:(B==null?void 0:B.class)===Q,C=(Q,B)=>D=>{const O=(V=>{const M=new Map;for(let[L,f]of V){let v=f;typeof f=="string"&&(v=f.toLocaleLowerCase()),M.set(L.toLocaleLowerCase(),v)}return M})(D.properties);if(B!==void 0){let V=B;return typeof B=="string"&&(V=B.toLocaleLowerCase()),O.get(Q.toLocaleLowerCase())===V}return O.has(Q.toLocaleLowerCase())}},"./src/resource/gid-util.ts":(X,k,b)=>{b.r(k),b.d(k,{FLIPPED_DIAGONALLY_FLAG:()=>C,FLIPPED_HORIZONTALLY_FLAG:()=>l,FLIPPED_VERTICALLY_FLAG:()=>S,getCanonicalGid:()=>O,isFlippedDiagonally:()=>D,isFlippedHorizontally:()=>Q,isFlippedVertically:()=>B});const l=2147483648,S=1073741824,C=536870912,Q=V=>!!(V&l),B=V=>!!(V&S),D=V=>!!(V&C),O=V=>V&~(l|S|C)},"./src/resource/image-layer.ts":(X,k,b)=>{b.r(k),b.d(k,{ImageLayer:()=>Q});var l=b("excalibur"),S=b("./src/resource/properties.ts"),C=b("./src/resource/path-util.ts");class Q{constructor(D,O,V){this.tiledImageLayer=D,this.resource=O,this.order=V,this.properties=new Map,this.image=null,this.imageActor=null,this.name=D.name,this.class=D.class,(0,S.mapProps)(this,D.properties),D.image&&(this.image=new l.ImageSource((0,C.pathRelativeToBase)(this.resource.path,D.image,this.resource.pathMap)))}async load(){var D,O,V,M;const L=this.tiledImageLayer.opacity,f=!!this.tiledImageLayer.tintcolor,v=this.tiledImageLayer.tintcolor?l.Color.fromHex(this.tiledImageLayer.tintcolor):l.Color.White,h=(0,l.vec)((D=this.tiledImageLayer.offsetx)!==null&&D!==void 0?D:0,(O=this.tiledImageLayer.offsety)!==null&&O!==void 0?O:0),A=(V=this.tiledImageLayer.parallaxx)!==null&&V!==void 0?V:1,p=(M=this.tiledImageLayer.parallaxy)!==null&&M!==void 0?M:1;if(this.image){this.resource.headless||await this.image.load(),this.imageActor=new l.Actor({name:this.tiledImageLayer.name,pos:h,anchor:l.Vector.Zero,z:this.order}),this.imageActor.addComponent(new l.ParallaxComponent((0,l.vec)(A,p)));const y=this.image.toSprite();this.imageActor.graphics.use(y),this.imageActor.graphics.visible=this.tiledImageLayer.visible,this.imageActor.graphics.opacity=L,f&&(y.tint=v)}}}},"./src/resource/iso-tile-layer.ts":(X,k,b)=>{b.r(k),b.d(k,{IsoTileLayer:()=>M});var l=b("excalibur"),S=b("./src/resource/properties.ts"),C=b("./src/parser/tiled-parser.ts"),Q=b("./src/resource/decoder.ts"),B=b("./src/resource/gid-util.ts"),D=b("./src/resource/excalibur-properties.ts"),O=b("./src/resource/tiled-layer-component.ts"),V=b("./src/resource/filter-util.ts");class M{constructor(f,v,h){this.tiledTileLayer=f,this.resource=v,this.order=h,this.logger=l.Logger.getInstance(),this.width=0,this.height=0,this.properties=new Map,this.data=[],this._gidToTileInfo=new Map,this.name=f.name,this.class=f.class,this.width=f.width,this.height=f.height,(0,S.mapProps)(this,f.properties)}getTilesByGid(f){var v;return(v=this._gidToTileInfo.get(f))!==null&&v!==void 0?v:[]}getTilesByClassName(f){return this.isometricMap.tiles.filter(v=>{const h=v.data.get(D.ExcaliburTiledProperties.TileData.Tiled);return!!h&&(0,V.byClassCaseInsensitive)(f)(h)}).map(v=>({exTile:v,tiledTile:v.data.get(D.ExcaliburTiledProperties.TileData.Tiled)}))}getTilesByProperty(f,v){return this.isometricMap.tiles.filter(h=>{const A=h.data.get(D.ExcaliburTiledProperties.TileData.Tiled);return!!A&&(0,V.byPropertyCaseInsensitive)(f,v)(A)}).map(h=>({exTile:h,tiledTile:h.data.get(D.ExcaliburTiledProperties.TileData.Tiled)}))}getTileByPoint(f){if(!this.isometricMap)return this.logger.warn("IsometricMap has not yet been loaded! getTileByPoint() will only return null"),null;if(this.isometricMap){const v=this.isometricMap.getTileByPoint(f);if(!v)return null;const h=this.isometricMap.tiles.indexOf(v),A=(0,B.getCanonicalGid)(this.data[h]);return A<=0?null:{tiledTile:this.resource.getTilesetForTileGid(A).getTileByGid(A),exTile:v}}return null}_recordTileData(f,v){let h=this._gidToTileInfo.get(f),A=this.resource.getTilesetForTileGid(f).getTileByGid(f);h?h.push({exTile:v,tiledTile:A}):h=[{exTile:v,tiledTile:A}],this._gidToTileInfo.set(f,h),v.data.set(D.ExcaliburTiledProperties.TileData.Tiled,A)}updateTile(f,v,h,A,p){this._recordTileData(v,f),this.resource.useExcaliburWiring&&p&&(f.solid=!0);const y=f.get(l.IsometricEntityComponent);y&&(y.elevation=this.order);const x=this.resource.getTilesetForTileGid(v);let I=x.getSpriteForGid(v);h&&(I=I.clone(),I.tint=A),f.addGraphic(I,{offset:x.tileOffset});let w=f.pos;if(x.orientation==="orthogonal")w=(0,l.vec)(0,0);else{const E=this.resource.map.tilewidth/2,$=this.resource.map.tileheight;w=(0,l.vec)(E,$)}const U=x.getCollidersForGid(v,{offset:w});for(let E of U)f.addCollider(E);let R=x.getAnimationForGid(v);if(R&&(h&&(R=R.clone(),R.tint=A),f.clearGraphics(),f.addGraphic(R,{offset:x.tileOffset}),this.resource.useExcaliburWiring)){const E=x.getTileByGid(v),$=E==null?void 0:E.properties.get(D.ExcaliburTiledProperties.Animation.Strategy);if($&&typeof $=="string")switch($.toLowerCase()){case l.AnimationStrategy.End.toLowerCase():R.strategy=l.AnimationStrategy.End;break;case l.AnimationStrategy.Freeze.toLowerCase():R.strategy=l.AnimationStrategy.Freeze;break;case l.AnimationStrategy.Loop.toLowerCase():R.strategy=l.AnimationStrategy.Loop;break;case l.AnimationStrategy.PingPong.toLowerCase():R.strategy=l.AnimationStrategy.PingPong;break;default:this.logger.warn(`Unknown animation strategy in tileset ${x.name} on tile gid ${v}: ${$}`)}}}async load(){var f,v,h,A;const p=this.tiledTileLayer,y=!!this.properties.get(D.ExcaliburTiledProperties.Layer.Solid),x=(this.tiledTileLayer.opacity,!!this.tiledTileLayer.tintcolor),I=this.tiledTileLayer.tintcolor?l.Color.fromHex(this.tiledTileLayer.tintcolor):l.Color.Transparent,w=(0,l.vec)((f=p.offsetx)!==null&&f!==void 0?f:0,(v=p.offsety)!==null&&v!==void 0?v:0);(0,C.needsDecoding)(this.tiledTileLayer)?this.data=await Q.Decoder.decode(this.tiledTileLayer.data,this.tiledTileLayer.compression):(0,C.isCSV)(this.tiledTileLayer)&&(this.data=this.tiledTileLayer.data);let U=this.order,R=this.properties.get(D.ExcaliburTiledProperties.ZIndex.ZIndex);if(typeof R=="number"&&(U=R),this.resource.map.infinite&&(0,C.isInfiniteLayer)(this.tiledTileLayer)){const E=this.resource.isometricTiledCoordToWorld(this.tiledTileLayer.startx,this.tiledTileLayer.starty),$=(0,l.vec)(E.x*this.resource.map.tilewidth,E.y*this.resource.map.tileheight);this.isometricMap=new l.IsometricMap({name:this.name,pos:w.add($),tileHeight:this.resource.map.tileheight,tileWidth:this.resource.map.tilewidth,columns:p.width,rows:p.height,elevation:U})}else this.isometricMap=new l.IsometricMap({name:this.name,pos:w,tileWidth:this.resource.map.tilewidth,tileHeight:this.resource.map.tileheight,columns:p.width,rows:p.height,elevation:U});if(this.isometricMap.visible=this.tiledTileLayer.visible,this.isometricMap.opacity=this.tiledTileLayer.opacity,this.isometricMap.addComponent(new O.TiledLayerDataComponent({tiledTileLayer:p})),p.parallaxx||p.parallaxy){const E=(0,l.vec)((h=p.parallaxx)!==null&&h!==void 0?h:1,(A=p.parallaxy)!==null&&A!==void 0?A:1);this.isometricMap.addComponent(new l.ParallaxComponent(E))}if(this.resource.map.infinite&&(0,C.isInfiniteLayer)(this.tiledTileLayer))for(let E of this.tiledTileLayer.chunks)for(let $=0;$<E.data.length;$++){const G=E.data[$];if(G!=0){const K=$%E.width+(E.x-this.tiledTileLayer.startx),m=Math.floor($/E.width)+(E.y-this.tiledTileLayer.starty),lt=this.isometricMap.tiles[K+m*p.width];this.updateTile(lt,G,x,I,y)}}else for(let E=0;E<this.data.length;E++){let $=this.data[E];if($!==0){const G=this.isometricMap.tiles[E];this.updateTile(G,$,x,I,y)}}}}},"./src/resource/layer.ts":(X,k,b)=>{b.r(k)},"./src/resource/loader-cache.ts":(X,k,b)=>{b.r(k),b.d(k,{LoaderCache:()=>l});class l{constructor(C){this.type=C,this._loaded=!1,this.cache=new Map}getOrAdd(...C){let Q=this.cache.get(C.join("+"));return Q||(Q=new this.type(...C),this.cache.set(C.join("+"),Q),Q)}values(){if(this._loaded)return Array.from(this.cache.values());throw new Error("Read through cache not yet loaded! No values to return!")}async load(){const C=Array.from(this.cache.entries()),Q=await Promise.allSettled(C.map(D=>D[1].load()));let B=0;for(let D=0;D<Q.length;D++){const O=Q[D];O.status==="rejected"&&(console.error(`Error loading resource at ${C[D][0]}, is your pathMap correct? or your Tiled map corrupted?`,O.reason),B++)}if(B)throw new Error(`Error loading ${B} resources`);this._loaded=!0}}},"./src/resource/object-layer.ts":(X,k,b)=>{b.r(k),b.d(k,{ObjectLayer:()=>O});var l=b("excalibur"),S=b("./src/resource/objects.ts"),C=b("./src/resource/properties.ts"),Q=b("./src/resource/filter-util.ts"),B=b("./src/resource/excalibur-properties.ts"),D=b("./src/resource/tiled-data-component.ts");class O{constructor(M,L,f){this.tiledObjectLayer=M,this.resource=L,this.order=f,this.logger=l.Logger.getInstance(),this.properties=new Map,this.objects=[],this.entities=[],this._objectToEntity=new Map,this._entityToObject=new Map,this._loaded=!1,this.name=M.name,this.class=M.class,(0,C.mapProps)(this,M.properties)}_logLoadedWarning(M){this.logger.warn(`ObjectLayer ${this.name} is not yet loaded, ${M}() will always be empty!`)}getObjectsByName(M){return this._loaded||this._logLoadedWarning("getObjectsByName"),this.objects.filter((0,Q.byNameCaseInsensitive)(M))}getEntitiesByName(M){return this._loaded||this._logLoadedWarning("getEntitiesByName"),this.entities.filter((0,Q.byNameCaseInsensitive)(M))}getEntityByObject(M){return this._loaded||this._logLoadedWarning("getEntityByObject"),this._objectToEntity.get(M)}getObjectByEntity(M){return this._loaded||this._logLoadedWarning("getObjectByEntity"),this._entityToObject.get(M)}getObjectsByProperty(M,L){return this._loaded||this._logLoadedWarning("getObjectsByProperty"),this.objects.filter((0,Q.byPropertyCaseInsensitive)(M,L))}getEntitiesByProperty(M,L){return this._loaded||this._logLoadedWarning("getEntitiesByProperty"),this.getObjectsByProperty(M,L).map(f=>this._objectToEntity.get(f)).filter(f=>!!f)}getObjectsByClassName(M){return this._loaded||this._logLoadedWarning("getObjectsByClassName"),this.objects.filter((0,Q.byClassCaseInsensitive)(M))}getEntitiesByClassName(M){return this._loaded||this._logLoadedWarning("getEntitiesByClassName"),this.getObjectsByClassName(M).map(L=>this._objectToEntity.get(L)).filter(L=>!!L)}getTemplates(){return this._loaded||this._logLoadedWarning("getTemplates"),this.objects.filter(M=>M instanceof S.TemplateObject)}runFactory(M){var L,f,v,h;const A=(0,l.vec)((L=this.tiledObjectLayer.offsetx)!==null&&L!==void 0?L:0,(f=this.tiledObjectLayer.offsety)!==null&&f!==void 0?f:0),p=this.objects.slice();for(let y of p){let x=y.class;if(y instanceof S.TemplateObject&&(x=x||y.template.object.class),M!==x)continue;let I=(0,l.vec)(((v=y.x)!==null&&v!==void 0?v:0)+A.x,((h=y.y)!==null&&h!==void 0?h:0)+A.y);this.resource.map.orientation==="isometric"&&(I=this.resource.isometricTiledCoordToWorld(I.x,I.y));const w=this.resource.factories.get(M);if(w){const U=w({worldPos:I,name:y.name,class:x,layer:this,object:y,properties:y.properties});U&&this._recordObjectEntityMapping(y,U)}}}_actorFromObject(M,L,f){var v,h,A,p,y,x;const I=this.resource.headless,w=!!this.tiledObjectLayer.tintcolor,U=this.tiledObjectLayer.tintcolor?l.Color.fromHex(this.tiledObjectLayer.tintcolor):l.Color.White;if(M instanceof S.InsertedTile&&f){const R=this.resource.map.orientation==="isometric"&&f.orientation==="orthogonal"?"bottom":void 0,E=f.getTilesetAlignmentAnchor(R);L.anchor=E;const $=((v=M.tiledObject.width)!==null&&v!==void 0?v:this.resource.map.tilewidth)/this.resource.map.tilewidth,G=((h=M.tiledObject.width)!==null&&h!==void 0?h:this.resource.map.tilewidth)/this.resource.map.tilewidth,K=(0,l.vec)($,G);if(!I){const wt=f.getSpriteForGid(M.gid).clone();wt.destSize.width=(A=M.tiledObject.width)!==null&&A!==void 0?A:wt.width,wt.destSize.height=(p=M.tiledObject.height)!==null&&p!==void 0?p:wt.height,w&&(wt.tint=U),L.graphics.use(wt),L.graphics.offset=f.tileOffset;const ie=f.getAnimationForGid(M.gid);if(ie){const zt=ie.clone();zt.scale=K,w&&(zt.tint=U),L.graphics.use(zt),L.graphics.offset=f.tileOffset}}const m=(y=M.tiledObject.width)!==null&&y!==void 0?y:0,lt=(x=M.tiledObject.height)!==null&&x!==void 0?x:0,Et=-m*E.x,dt=-lt*E.y,Ut=this.resource.map.tilewidth/2,At=this.resource.map.tileheight;let It=(0,l.vec)(Et,dt);this.resource.map.orientation==="isometric"&&(It=(0,l.vec)(Et+Ut,dt+At),f.orientation==="orthogonal"&&(It=It.sub((0,l.vec)(Ut,At))));const yt=f.getCollidersForGid(M.gid,{anchor:l.Vector.Zero,scale:K,offset:It});if(yt.length)L.collider.useCompositeCollider(yt);else{let wt=M.width,ie=M.height;if(this.resource.map.orientation==="isometric"){const Mt=M.height/2;wt=Mt,ie=Mt}let zt=l.Shape.Box(wt,ie,this.resource.map.orientation==="isometric"?(0,l.vec)(1,1):(0,l.vec)(0,1));this.resource.map.orientation==="isometric"&&(zt.points=zt.points.map(Mt=>this.resource.isometricTiledCoordToWorld(Mt.x,Mt.y))),L.collider.set(zt)}}if(M instanceof S.Text&&L.graphics.use(M.text),M instanceof S.Polygon){let R=(0,l.vec)(M.x,M.y),E=M.localPoints;this.resource.map.orientation==="isometric"&&(R=this.resource.isometricTiledCoordToWorld(R.x,R.y),E=E.map(G=>this.resource.isometricTiledCoordToWorld(G.x,G.y))),L.anchor=(0,l.vec)(0,1),L.pos=R;const $=l.Shape.Polygon(E,l.Vector.Zero,!0);$.isConvex()?L.collider.set($):L.collider.set($.triangulate())}if(M instanceof S.Rectangle){L.anchor=M.anchor;let R=l.Shape.Box(M.width,M.height,M.anchor);this.resource.map.orientation==="isometric"&&(R.points=R.points.map(E=>this.resource.isometricTiledCoordToWorld(E.x,E.y))),L.collider.set(R)}M instanceof S.Ellipse&&L.collider.useCircleCollider(Math.min(M.width,M.height)/2)}async load(){var M,L,f,v,h;const A=this.tiledObjectLayer.opacity,p=(0,l.vec)((M=this.tiledObjectLayer.offsetx)!==null&&M!==void 0?M:0,(L=this.tiledObjectLayer.offsety)!==null&&L!==void 0?L:0),y=(0,S.parseObjects)(this.tiledObjectLayer,this.resource);for(let x of y){let I=(0,l.vec)(((f=x.x)!==null&&f!==void 0?f:0)+p.x,((v=x.y)!==null&&v!==void 0?v:0)+p.y);this.resource.map.orientation==="isometric"&&(I=this.resource.isometricTiledCoordToWorld(I.x,I.y));let w,U=x.class;if(x instanceof S.TemplateObject&&(U=U||x.template.object.class),U){const G=this.resource.factories.get(U);if(G){const K=G({worldPos:I,name:x.name,class:U,layer:this,object:x,properties:x.properties});K&&this._recordObjectEntityMapping(x,K);continue}}let R=this.properties.get(B.ExcaliburTiledProperties.ZIndex.ZIndex);typeof R=="number"&&(w=R);const E=new l.Actor({name:x.tiledObject.name,pos:I,anchor:l.Vector.Zero,rotation:(0,l.toRadians)((h=x.tiledObject.rotation)!==null&&h!==void 0?h:0),z:w}),$=E.get(l.GraphicsComponent);if($&&($.visible=this.tiledObjectLayer.visible&&(x.tiledObject.visible===void 0||!!x.tiledObject.visible),$.opacity=A),this.resource.map.orientation==="isometric"){const G=new l.IsometricEntityComponent({rows:this.resource.map.height,columns:this.resource.map.width,tileWidth:this.resource.map.tilewidth,tileHeight:this.resource.map.tileheight});G.elevation=w??this.order,E.addComponent(G)}if(this.resource.useExcaliburWiring){const G=x.properties.get(B.ExcaliburTiledProperties.Collision.Type);if(G&&typeof G=="string")switch(G.toLowerCase()){case l.CollisionType.Active.toLowerCase():E.body.collisionType=l.CollisionType.Active;break;case l.CollisionType.Fixed.toLowerCase():E.body.collisionType=l.CollisionType.Fixed;break;case l.CollisionType.Passive.toLowerCase():E.body.collisionType=l.CollisionType.Passive;break;case l.CollisionType.PreventCollision.toLowerCase():E.body.collisionType=l.CollisionType.PreventCollision;break;default:this.logger.warn(`Unknown collision type in layer ${this.name}, for object id ${x.id} and name ${x.name}: ${G}`)}}if(x instanceof S.TemplateObject){const G=x.template.tileset;x.template.object&&this._actorFromObject(x.template.object,E,G)}else{let G;x instanceof S.InsertedTile&&(G=this.resource.getTilesetForTileGid(x.gid)),this._actorFromObject(x,E,G)}this._recordObjectEntityMapping(x,E)}this._loaded=!0}_recordObjectEntityMapping(M,L){L.addComponent(new D.TiledDataComponent({tiledObject:M})),this.objects.push(M),this.entities.push(L),this._objectToEntity.set(M,L),this._entityToObject.set(L,M)}}},"./src/resource/objects.ts":(X,k,b)=>{b.r(k),b.d(k,{Ellipse:()=>M,InsertedTile:()=>D,PluginObject:()=>Q,Point:()=>O,Polygon:()=>f,Polyline:()=>v,Rectangle:()=>L,TemplateObject:()=>B,Text:()=>V,parseObject:()=>h,parseObjects:()=>A});var l=b("excalibur"),S=b("./src/resource/properties.ts"),C=b("./src/resource/path-util.ts");class Q{constructor(y){var x,I,w;this.properties=new Map,this.tiledObject=y.tiledObject,this.name=this.tiledObject.name,this.class=this.tiledObject.type,this.id=(x=this.tiledObject.id)!==null&&x!==void 0?x:-1,this.x=(I=this.tiledObject.x)!==null&&I!==void 0?I:0,this.y=(w=this.tiledObject.y)!==null&&w!==void 0?w:0}}class B extends Q{constructor(y,x){if(super({tiledObject:y}),!y.template)throw new Error("Invalid template");if(this.source=y.template,this.tiledTemplate=y,this.template=x,x.object){this.name=this.name||x.object.name,this.class=this.class||x.object.class;for(const[I,w]of x.object.properties.entries())this.properties.has(I)||this.properties.set(I,w)}if(x.tileset&&x.object.tiledObject.gid){const I=x.tileset.getTileByGid(x.object.tiledObject.gid);if(I){this.class=this.class||I.class;for(const[w,U]of I.properties.entries())this.properties.has(w)||this.properties.set(w,U)}}}}class D extends Q{constructor(y,x,I,w){super({tiledObject:y}),this.gid=x,this.width=I,this.height=w}}class O extends Q{}class V extends Q{constructor(y,x,I,w){var U,R,E;super({tiledObject:y}),this.font=new l.Font({family:(U=x.fontfamily)!==null&&U!==void 0?U:"sans-serif",color:x.color?l.Color.fromHex(x.color):l.Color.Black,size:(R=x.pixelsize)!==null&&R!==void 0?R:16,unit:l.FontUnit.Px,textAlign:this._textAlignFromTiled(x.halign),baseAlign:this._textBaselineFromTiled(x.valign),quality:w});const $=(E=x.wrap)!==null&&E!==void 0&&E;this.text=new l.Text({text:x.text,font:this.font,...$?{maxWidth:I+10}:{}})}_textBaselineFromTiled(y){switch(y){case"bottom":return l.BaseAlign.Bottom;case"center":return l.BaseAlign.Middle;default:return l.BaseAlign.Top}}_textAlignFromTiled(y){switch(y){case"left":default:return l.TextAlign.Left;case"center":return l.TextAlign.Center;case"right":return l.TextAlign.Right;case"justify":return l.TextAlign.Start}}}class M extends Q{constructor(y,x,I){super({tiledObject:y}),this.width=x,this.height=I}}class L extends Q{constructor(y,x,I,w){super({tiledObject:y}),this.width=x,this.height=I,this.anchor=w}}class f extends Q{constructor(y,x){super({tiledObject:y}),this.points=[],this.localPoints=[],this.localPoints=x.map(I=>(0,l.vec)(I.x,I.y)),this.points=x.map(I=>(0,l.vec)(I.x,I.y).add((0,l.vec)(this.x,this.y)))}}class v extends Q{constructor(y,x){super({tiledObject:y}),this.points=[],this.points=x.map(I=>(0,l.vec)(I.x,I.y))}}function h(p,y){var x,I,w,U;let R;if(p.point)R=new O({tiledObject:p});else if(p.ellipse)p.width&&p.height?(R=new M(p,p.width,p.height),R.x+=p.width/2,R.y+=p.height/2):R=new M(p,20,20);else if(p.polygon)R=new f(p,p.polygon);else if(p.polyline)R=new v(p,p.polyline);else if(p.text)R=new V(p,p.text,(x=p.width)!==null&&x!==void 0?x:0,(I=y==null?void 0:y.textQuality)!==null&&I!==void 0?I:4);else if(p.gid){R=new D(p,p.gid,(w=p.width)!==null&&w!==void 0?w:0,(U=p.height)!==null&&U!==void 0?U:0);const E=y==null?void 0:y.getTilesetForTileGid(p.gid);let $=p.type;if(E){const G=E==null?void 0:E.getTileByGid(p.gid);if($=$||(G==null?void 0:G.class),G==null?void 0:G.properties)for(const[K,m]of G.properties.entries())R.properties.has(K)||R.properties.set(K,m)}R.class=$}else if(p.template&&y){const E=y.templates.find($=>(0,C.filenameFromPath)($.templatePath)===(0,C.filenameFromPath)(p.template));if(!E)throw new Error(`Template object id ${p.id} with name ${p.name} is missing a loaded template file, there should be one loaded from ${p.template}! Is your tiled map or template corrupted?`);R=new B(p,E)}else R=p.width&&p.height?new L(p,p.width,p.height,l.Vector.Zero):new L(p,20,20,l.Vector.Half);return(0,S.mapProps)(R,p.properties),R}function A(p,y){const x=[];for(const I of p.objects){let w=h(I,y);x.push(w)}return x}},"./src/resource/path-util.ts":(X,k,b)=>{function l(B){const D=B.match(/[^/\\&\?]+\.\w{2,4}(?=([\#\?&].*$|$))/gi);if(D)return D[0];throw new Error(`Could not locate filename from path: ${B}`)}function S(B,D){for(const{path:O,output:V}of D)if(typeof O=="string"){if(B.includes(O))return V}else{const M=B.match(O);if(M)return V.replace("[match]",M[0])}return B}function C(B,D){if(!D)return!1;for(const{path:O,output:V}of D)if(typeof O=="string"){if(B.includes(O))return!0}else if(B.match(O))return!0;return!1}function Q(B,D,O){if(C(D,O)&&O)return S(D,O);if(D.indexOf("/")===0)return D;const V=B.split("/"),M=D.split("/");return V[V.length-1].includes(".")&&V.pop(),V.concat(M).join("/")}b.r(k),b.d(k,{filenameFromPath:()=>l,mapPath:()=>S,pathInMap:()=>C,pathRelativeToBase:()=>Q})},"./src/resource/properties.ts":(X,k,b)=>{function l(S,C){try{if(C)for(const Q of C){let B=Q.value;typeof Q.value=="string"&&(B=Q.value.toLocaleLowerCase()),S.properties.set(Q.name.toLocaleLowerCase(),B)}}catch(Q){console.error(`Unable to map properties onto ${S}`,Q)}}b.r(k),b.d(k,{mapProps:()=>l})},"./src/resource/template-resource.ts":(X,k,b)=>{b.r(k),b.d(k,{TemplateResource:()=>M});var l=b("excalibur"),S=b("./src/parser/tiled-parser.ts"),C=b("./src/resource/file-loader.ts"),Q=b("./src/resource/loader-cache.ts"),B=b("./src/resource/objects.ts"),D=b("./src/resource/path-util.ts"),O=b("./src/resource/template.ts"),V=b("./src/resource/tileset-resource.ts");class M{constructor(f,v){this.templatePath=f,this.headless=!1,this.strict=!0,this.fileLoader=C.FetchLoader;const{fileLoader:h,parser:A,pathMap:p,imageLoader:y,strict:x,headless:I}={...v};this.headless=I??this.headless,this.strict=x??this.strict,this.fileLoader=h??this.fileLoader,this.imageLoader=y??new Q.LoaderCache(l.ImageSource),this.parser=A??new S.TiledParser,this.pathMap=p}isLoaded(){return!!this.data}async load(){const f=this.templatePath.includes(".tx")?"xml":"json";try{const v=await this.fileLoader(this.templatePath,f);let h;h=f==="xml"?this.parser.parseExternalTemplate(v,this.strict):this.strict?S.TiledTemplate.parse(v):v;const A=h,p=(0,B.parseObject)(h.object);let y;if(h.tileset){const x=(0,D.pathRelativeToBase)(this.templatePath,h.tileset.source,this.pathMap);y=await new V.TilesetResource(x,h.tileset.firstgid,{headless:this.headless,strict:this.strict,fileLoader:this.fileLoader,imageLoader:this.imageLoader,parser:this.parser,pathMap:this.pathMap}).load()}return this.data=new O.Template({templatePath:this.templatePath,tiledTemplate:A,object:p,tileset:y})}catch(v){throw console.error(`Could not load template at ${this.templatePath}, check to see if your pathMap is correct or if you're Tiled map is corrupted`),v}}}},"./src/resource/template.ts":(X,k,b)=>{b.r(k),b.d(k,{Template:()=>l});class l{constructor(C){const{templatePath:Q,object:B,tiledTemplate:D,tileset:O}=C;this.templatePath=Q,this.object=B,this.tiledTemplate=D,this.tileset=O}}},"./src/resource/tile-layer.ts":(X,k,b)=>{b.r(k),b.d(k,{TileLayer:()=>M});var l=b("excalibur"),S=b("./src/resource/properties.ts"),C=b("./src/parser/tiled-parser.ts"),Q=b("./src/resource/decoder.ts"),B=b("./src/resource/gid-util.ts"),D=b("./src/resource/excalibur-properties.ts"),O=b("./src/resource/tiled-layer-component.ts"),V=b("./src/resource/filter-util.ts");class M{getTilesByGid(f){var v;return(v=this._gidToTileInfo.get(f))!==null&&v!==void 0?v:[]}getTilesByClassName(f){return this.tilemap.tiles.filter(v=>{const h=v.data.get(D.ExcaliburTiledProperties.TileData.Tiled);return!!h&&(0,V.byClassCaseInsensitive)(f)(h)}).map(v=>({exTile:v,tiledTile:v.data.get(D.ExcaliburTiledProperties.TileData.Tiled)}))}getTilesByProperty(f,v){return this.tilemap.tiles.filter(h=>{const A=h.data.get(D.ExcaliburTiledProperties.TileData.Tiled);return!!A&&(0,V.byPropertyCaseInsensitive)(f,v)(A)}).map(h=>({exTile:h,tiledTile:h.data.get(D.ExcaliburTiledProperties.TileData.Tiled)}))}getTileByPoint(f){if(!this.tilemap)return this.logger.warn("Tilemap has not yet been loaded! getTileByPoint() will only return null"),null;if(this.tilemap){const v=this.tilemap.getTileByPoint(f);if(!v)return null;const h=this.tilemap.tiles.indexOf(v),A=(0,B.getCanonicalGid)(this.data[h]);return A<=0?null:{tiledTile:this.resource.getTilesetForTileGid(A).getTileByGid(A),exTile:v}}return null}getTileByCoordinate(f,v){if(!this.tilemap)return this.logger.warn("Tilemap has not yet been loaded! getTileByCoordinate() will only return null"),null;if(this.tilemap){const h=this.tilemap.getTile(f,v),A=this.tilemap.tiles.indexOf(h),p=(0,B.getCanonicalGid)(this.data[A]);return p<=0?null:{tiledTile:this.resource.getTilesetForTileGid(p).getTileByGid(p),exTile:h}}return null}constructor(f,v,h){this.tiledTileLayer=f,this.resource=v,this.order=h,this.logger=l.Logger.getInstance(),this.width=0,this.height=0,this.properties=new Map,this.data=[],this._gidToTileInfo=new Map,this.name=f.name,this.class=f.class,this.width=f.width,this.height=f.height,(0,S.mapProps)(this,f.properties)}_recordTileData(f,v){let h=this._gidToTileInfo.get(f),A=this.resource.getTilesetForTileGid(f).getTileByGid(f);h?h.push({exTile:v,tiledTile:A}):h=[{exTile:v,tiledTile:A}],this._gidToTileInfo.set(f,h),v.data.set(D.ExcaliburTiledProperties.TileData.Tiled,A)}updateTile(f,v,h,A,p){this._recordTileData(v,f),this.resource.useExcaliburWiring&&p&&(f.solid=!0);const y=this.resource.getTilesetForTileGid(v),x=this.resource.headless;if(!x){let U=y.getSpriteForGid(v);h&&(U=U.clone(),U.tint=A),f.addGraphic(U,{offset:y.tileOffset})}const I=y.getCollidersForGid(v);for(let U of I)f.addCollider(U);let w=x?null:y.getAnimationForGid(v);if(w&&(h&&(w=w.clone(),w.tint=A),f.clearGraphics(),f.addGraphic(w,{offset:y.tileOffset}),this.resource.useExcaliburWiring)){const U=y.getTileByGid(v),R=U==null?void 0:U.properties.get(D.ExcaliburTiledProperties.Animation.Strategy);if(R&&typeof R=="string")switch(R.toLowerCase()){case l.AnimationStrategy.End.toLowerCase():w.strategy=l.AnimationStrategy.End;break;case l.AnimationStrategy.Freeze.toLowerCase():w.strategy=l.AnimationStrategy.Freeze;break;case l.AnimationStrategy.Loop.toLowerCase():w.strategy=l.AnimationStrategy.Loop;break;case l.AnimationStrategy.PingPong.toLowerCase():w.strategy=l.AnimationStrategy.PingPong;break;default:this.logger.warn(`Unknown animation strategy in tileset ${y.name} on tile gid ${v}: ${R}`)}}}async load(){var f,v,h,A;const p=this.tiledTileLayer.opacity,y=!!this.tiledTileLayer.tintcolor,x=this.tiledTileLayer.tintcolor?l.Color.fromHex(this.tiledTileLayer.tintcolor):l.Color.Transparent,I=!!this.properties.get(D.ExcaliburTiledProperties.Layer.Solid),w=this.tiledTileLayer,U=(0,l.vec)((f=w.offsetx)!==null&&f!==void 0?f:0,(v=w.offsety)!==null&&v!==void 0?v:0);if((0,C.needsDecoding)(this.tiledTileLayer)?this.data=await Q.Decoder.decode(this.tiledTileLayer.data,this.tiledTileLayer.compression):(0,C.isCSV)(this.tiledTileLayer)&&(this.data=this.tiledTileLayer.data),this.resource.map.infinite&&(0,C.isInfiniteLayer)(this.tiledTileLayer)){const $=(0,l.vec)(this.tiledTileLayer.startx*this.resource.map.tilewidth,this.tiledTileLayer.starty*this.resource.map.tileheight);this.tilemap=new l.TileMap({name:this.name,pos:U.add($),tileHeight:this.resource.map.tileheight,tileWidth:this.resource.map.tilewidth,columns:w.width,rows:w.height})}else this.tilemap=new l.TileMap({name:this.name,pos:U,tileWidth:this.resource.map.tilewidth,tileHeight:this.resource.map.tileheight,columns:w.width,rows:w.height});this.tilemap.addComponent(new O.TiledLayerDataComponent({tiledTileLayer:w}));const R=this.tilemap.get(l.TransformComponent);if(R){R.z=this.order;let $=this.properties.get(D.ExcaliburTiledProperties.ZIndex.ZIndex);typeof $=="number"&&(R.z=$)}const E=this.tilemap.get(l.GraphicsComponent);if(E&&(E.visible=this.tiledTileLayer.visible,E.opacity=p),w.parallaxx||w.parallaxy){const $=(0,l.vec)((h=w.parallaxx)!==null&&h!==void 0?h:1,(A=w.parallaxy)!==null&&A!==void 0?A:1);this.tilemap.addComponent(new l.ParallaxComponent($))}if(this.resource.map.infinite&&(0,C.isInfiniteLayer)(this.tiledTileLayer))for(let $ of this.tiledTileLayer.chunks)for(let G=0;G<$.data.length;G++){const K=$.data[G];if(K!=0){const m=G%$.width+($.x-this.tiledTileLayer.startx),lt=Math.floor(G/$.width)+($.y-this.tiledTileLayer.starty),Et=this.tilemap.tiles[m+lt*w.width];this.updateTile(Et,K,y,x,I)}}else for(let $=0;$<this.data.length;$++){let G=this.data[$];if(G!==0){const K=this.tilemap.tiles[$];this.updateTile(K,G,y,x,I)}}}}},"./src/resource/tiled-data-component.ts":(X,k,b)=>{b.r(k),b.d(k,{TiledDataComponent:()=>S});var l=b("excalibur");class S extends l.Component{constructor(Q){super();const{tiledObject:B}=Q;this.tiledObject=B}}},"./src/resource/tiled-layer-component.ts":(X,k,b)=>{b.r(k),b.d(k,{TiledLayerDataComponent:()=>S});var l=b("excalibur");class S extends l.Component{constructor(Q){super();const{tiledTileLayer:B}=Q;this.tiledTileLayer=B}}},"./src/resource/tiled-resource.ts":(X,k,b)=>{b.r(k),b.d(k,{TiledResource:()=>x});var l=b("excalibur"),S=b("./src/parser/tiled-parser.ts"),C=b("./src/resource/tileset.ts"),Q=b("./src/resource/iso-tile-layer.ts"),B=b("./src/resource/tile-layer.ts"),D=b("./src/resource/object-layer.ts"),O=b("./node_modules/compare-versions/lib/esm/compare.js"),V=b("./src/resource/gid-util.ts"),M=b("./src/resource/path-util.ts"),L=b("./src/resource/filter-util.ts"),f=b("./src/resource/excalibur-properties.ts"),v=b("./src/resource/file-loader.ts"),h=b("./src/resource/tileset-resource.ts"),A=b("./src/resource/loader-cache.ts"),p=b("./src/resource/template-resource.ts"),y=b("./src/resource/image-layer.ts");class x{constructor(w,U){this.path=w,this.logger=l.Logger.getInstance(),this.tilesets=[],this.templates=[],this.layers=[],this.mapFormat="TMX",this.strict=!0,this.factories=new Map,this.parser=new S.TiledParser,this.fileLoader=v.FetchLoader,this.startZIndex=0,this.textQuality=4,this.useExcaliburWiring=!0,this.useMapBackgroundColor=!1,this.useTilemapCameraStrategy=!1,this.headless=!1,this._imageLoader=new A.LoaderCache(l.ImageSource),this._tilesetLoader=new A.LoaderCache(h.TilesetResource),this._templateLoader=new A.LoaderCache(p.TemplateResource);const{mapFormatOverride:R,textQuality:E,entityClassNameFactories:$,useExcaliburWiring:G,useTilemapCameraStrategy:K,useMapBackgroundColor:m,pathMap:lt,fileLoader:Et,strict:dt,headless:Ut,startZIndex:At}={...U};this.strict=dt??this.strict,this.headless=Ut??this.headless,this.useExcaliburWiring=G??this.useExcaliburWiring,this.useTilemapCameraStrategy=K??this.useTilemapCameraStrategy,this.useMapBackgroundColor=m??this.useMapBackgroundColor,this.textQuality=E??this.textQuality,this.startZIndex=At??this.startZIndex,this.fileLoader=Et??this.fileLoader,this.pathMap=lt;for(const It in $)this.registerEntityFactory(It,$[It]);this.mapFormat=R??(w.includes(".tmx")?"TMX":"TMJ")}registerEntityFactory(w,U){if(this.factories.has(w)&&console.warn(`Another factory has already been registered for tiled class/type "${w}", this is probably a bug.`),this.factories.set(w,U),this.isLoaded())for(let R of this.getObjectLayers())R.runFactory(w)}unregisterEntityFactory(w){this.factories.has(w)||console.warn(`No factory has been registered for tiled class/type "${w}", cannot unregister!`),this.factories.delete(w)}getTilesetForTileGid(w){const U=(0,V.getCanonicalGid)(w);if(this.tilesets){for(let R of this.tilesets)if(U>=R.firstGid&&U<=R.firstGid+R.tileCount-1)return R}throw Error(`No tileset exists for tiled gid [${w}] normalized [${U}]!`)}getTilesetByName(w){return this.tilesets.filter((0,L.byNameCaseInsensitive)(w))}getTilesetByClassName(w){return this.tilesets.filter((0,L.byClassCaseInsensitive)(w))}getTilesetByProperty(w,U){return this.tilesets.filter((0,L.byPropertyCaseInsensitive)(w,U))}getTileMetadataByClassName(w){let U=[];for(let R of this.tilesets)U=U.concat(R.tiles.filter((0,L.byClassCaseInsensitive)(w)));return U}getTileMetadataByProperty(w,U){let R=[];for(let E of this.tilesets)R=R.concat(E.tiles.filter((0,L.byPropertyCaseInsensitive)(w,U)));return R}getTilesByGid(w){if(this.map.orientation==="orthogonal"){let U=[];for(let R of this.getTileLayers())U=U.concat(R.getTilesByGid(w));return U}{let U=[];for(let R of this.getIsoTileLayers())U=U.concat(R.getTilesByGid(w));return U}}getTilesByClassName(w){if(this.map.orientation==="orthogonal"){let U=[];for(let R of this.getTileLayers())U=U.concat(R.getTilesByClassName(w));return U}{let U=[];for(let R of this.getIsoTileLayers())U=U.concat(R.getTilesByClassName(w));return U}}getTilesByProperty(w,U){if(this.map.orientation==="orthogonal"){let R=[];for(let E of this.getTileLayers())R=R.concat(E.getTilesByProperty(w,U));return R}{let R=[];for(let E of this.getIsoTileLayers())R=R.concat(E.getTilesByProperty(w,U));return R}}getTileByPoint(w,U){if(this.map.orientation==="isometric"){const R=this.getIsoTileLayers().find((0,L.byNameCaseInsensitive)(w));if(R)return R.getTileByPoint(U)}else{const R=this.getTileLayers().find((0,L.byNameCaseInsensitive)(w));if(R)return R.getTileByPoint(U)}return null}getTilesByPoint(w){if(this.map.orientation==="orthogonal"){let U=[];for(let R of this.getTileLayers()){const E=R.getTileByPoint(w);E&&U.push(E)}return U}{let U=[];for(let R of this.getIsoTileLayers()){const E=R.getTileByPoint(w);E&&U.push(E)}return U}}getObjectsByName(w){let U=[];for(let R of this.getObjectLayers())U=U.concat(R.getObjectsByName(w));return U}getEntitiesByName(w){let U=[];for(let R of this.getObjectLayers())U=U.concat(R.getEntitiesByName(w));return U}getEntityByObject(w){for(let U of this.getObjectLayers()){const R=U.getEntityByObject(w);if(R)return R}}getObjectByEntity(w){for(let U of this.getObjectLayers()){const R=U.getObjectByEntity(w);if(R)return R}}getObjectsByProperty(w,U){let R=[];for(let E of this.getObjectLayers())R=R.concat(E.getObjectsByProperty(w,U));return R}getEntitiesByProperty(w,U){let R=[];for(let E of this.getObjectLayers())R=R.concat(E.getEntitiesByProperty(w,U));return R}getObjectsByClassName(w){let U=[];for(let R of this.getObjectLayers())U=U.concat(R.getObjectsByClassName(w));return U}getEntitiesByClassName(w){let U=[];for(let R of this.getObjectLayers())U=U.concat(R.getEntitiesByClassName(w));return U}getTileByCoordinate(w,U,R){const E=this.getTileLayers().find((0,L.byNameCaseInsensitive)(w));return E?E.getTileByCoordinate(U,R):null}getImageLayers(w){const U=this.layers.filter(R=>R instanceof y.ImageLayer);return w?U.filter((0,L.byNameCaseInsensitive)(w)):U}getTileLayers(w){const U=this.layers.filter(R=>R instanceof B.TileLayer);return w?U.filter((0,L.byNameCaseInsensitive)(w)):U}getIsoTileLayers(w){const U=this.layers.filter(R=>R instanceof Q.IsoTileLayer);return w?U.filter((0,L.byNameCaseInsensitive)(w)):U}getObjectLayers(w){const U=this.layers.filter(R=>R instanceof D.ObjectLayer);return w?U.filter((0,L.byNameCaseInsensitive)(w)):U}getLayersByName(w){return this.layers.filter((0,L.byNameCaseInsensitive)(w))}getLayersByClassName(w){return this.layers.filter((0,L.byClassCaseInsensitive)(w))}getLayersByProperty(w,U){return this.layers.filter((0,L.byPropertyCaseInsensitive)(w,U))}_parseMap(w){return this.mapFormat==="TMX"?this.parser.parse(w,this.strict):w}async load(){var w;const U=await this.fileLoader(this.path,this.mapFormat==="TMX"?"xml":"json");let R;if(this.strict)try{R=this._parseMap(U)}catch(G){throw console.error(`Could not parse tiled map from location ${this.path}, attempted to interpret as ${this.mapFormat}.
Excalibur only supports the latest version of Tiled formats as of the plugin's release.`),console.error("Is your map file corrupted or being interpreted as the wrong type?"),G}else R=this._parseMap(U);(0,O.compare)(x.supportedTiledVersion,(w=R.tiledversion)!==null&&w!==void 0?w:"0.0.0",">")&&console.warn(`The excalibur tiled plugin officially supports ${x.supportedTiledVersion}+, the current map has tiled version ${R.tiledversion}`),this.map=R,this._collectTilesets(),this._collectTemplates(),await Promise.all([this._tilesetLoader.load(),this.headless?Promise.resolve():this._imageLoader.load(),this._templateLoader.load()]),this.tilesets=[...this.tilesets,...this._tilesetLoader.values().map(G=>G.data)],this.templates=this._templateLoader.values().map(G=>G.data);let E=[],$=this.startZIndex;for(const G of this.map.layers){if(G.type==="tilelayer"){if(this.map.orientation==="isometric"){const K=new Q.IsoTileLayer(G,this,$);E.push(K)}if(this.map.orientation==="orthogonal"){const K=new B.TileLayer(G,this,$);E.push(K)}}if(G.type==="objectgroup"){const K=new D.ObjectLayer(G,this,$);E.push(K)}if(G.type==="imagelayer"){const K=new y.ImageLayer(G,this,$);E.push(K)}$++}await Promise.all(E.map(G=>G.load())),this.layers=E}_collectTilesets(){for(const w of this.map.tilesets){if((0,S.isTiledTilesetEmbedded)(w)){if((0,S.isTiledTilesetSingleImage)(w)){const U=(0,M.pathRelativeToBase)(this.path,w.image,this.pathMap),R=this._imageLoader.getOrAdd(U),E=new C.Tileset({name:w.name,tiledTileset:w,image:R,firstGid:w.firstgid});this.tilesets.push(E)}if((0,S.isTiledTilesetCollectionOfImages)(w)){const U=new Map;if(w.tiles){for(let E of w.tiles)if(E.image){const $=(0,M.pathRelativeToBase)(this.path,E.image,this.pathMap),G=this._imageLoader.getOrAdd($);U.set(E,G)}}const R=new C.Tileset({name:w.name,tiledTileset:w,tileToImage:U,firstGid:w.firstgid});this.tilesets.push(R)}}if((0,S.isTiledTilesetExternal)(w)){const U=(0,M.pathRelativeToBase)(this.path,w.source,this.pathMap);this._tilesetLoader.getOrAdd(U,w.firstgid,{strict:this.strict,headless:this.headless,parser:this.parser,fileLoader:this.fileLoader,imageLoader:this._imageLoader,pathMap:this.pathMap})}}}_collectTemplates(){let w=[];for(const R of this.map.layers)if(R.type==="objectgroup"){let E=R.objects.filter($=>$.template).map($=>$.template);w=w.concat(E)}const U=w.filter((R,E,$)=>$.findIndex(G=>G===R)===E);for(const R of U){const E=(0,M.pathRelativeToBase)(this.path,R,this.pathMap);this._templateLoader.getOrAdd(E,{strict:this.strict,headless:this.headless,parser:this.parser,fileLoader:this.fileLoader,imageLoader:this._imageLoader,pathMap:this.pathMap})}}addToScene(w,U){if(!this.isLoaded())return void this.logger.warn(`TiledResource ${this.path} is not loaded! Nothing will be wired into excalibur!`);const R={pos:(0,l.vec)(0,0)},{pos:E}={...R,...U};for(const $ of this.layers){if($ instanceof B.TileLayer&&($.tilemap.pos=$.tilemap.pos.add(E),w.add($.tilemap)),$ instanceof Q.IsoTileLayer&&w.add($.isometricMap),$ instanceof D.ObjectLayer)for(const G of $.entities){const K=G.get(l.TransformComponent);K&&(K.pos=K.pos.add(E)),w.add(G)}$ instanceof y.ImageLayer&&$.imageActor&&($.imageActor.pos=$.imageActor.pos.add(E),w.add($.imageActor))}if(this.useExcaliburWiring){const $=this.getObjectsByProperty(f.ExcaliburTiledProperties.Camera.Camera,!0);if($&&$.length){const G=$[0];let K=1;const m=G.properties.get(f.ExcaliburTiledProperties.Camera.Zoom);m&&typeof m=="number"&&(K=m),this.map.orientation==="isometric"?w.camera.pos=this.isometricTiledCoordToWorld(G.x,G.y):w.camera.pos=(0,l.vec)(G.x,G.y),w.camera.zoom=K}}if(this.useTilemapCameraStrategy){const $=this.getTileLayers()[0];if($){const G=l.BoundingBox.fromDimension(this.map.width*this.map.tilewidth,this.map.height*this.map.tileheight,l.Vector.Zero,E.add($.tilemap.pos));w.camera.strategy.limitCameraBounds(G)}}this.useMapBackgroundColor&&this.map.backgroundcolor&&(w.backgroundColor=l.Color.fromHex(this.map.backgroundcolor))}isometricTiledCoordToWorld(w,U){const R=this.map.tilewidth,E=this.map.tileheight,$=U/E,G=w/E;return(0,l.vec)((G-$)*R/2+0,(G+$)*E/2)}isLoaded(){return!!this.map}}x.supportedTiledVersion="1.10.1"},"./src/resource/tileset-resource.ts":(X,k,b)=>{b.r(k),b.d(k,{TilesetResource:()=>O});var l=b("excalibur"),S=b("./src/resource/tileset.ts"),C=b("./src/parser/tiled-parser.ts"),Q=b("./src/resource/file-loader.ts"),B=b("./src/resource/path-util.ts"),D=b("./src/resource/loader-cache.ts");class O{constructor(M,L,f){this.path=M,this.strict=!0,this.headless=!1,this.orientation="orthogonal",this.fileLoader=Q.FetchLoader;const{fileLoader:v,parser:h,pathMap:A,imageLoader:p,strict:y,headless:x,orientation:I}={...f};this.headless=x??this.headless,this.orientation=I??this.orientation,this.strict=y??this.strict,this.fileLoader=v??this.fileLoader,this.imageLoader=p??new D.LoaderCache(l.ImageSource),this.parser=h??new C.TiledParser,this.firstGid=L,this.pathMap=A}async load(){const M=this.path.includes(".tsx")?"xml":"json";try{const L=await this.fileLoader(this.path,M);let f;if(f=M==="json"?this.strict?C.TiledTilesetFile.parse(L):L:this.parser.parseExternalTileset(L,this.strict),(0,C.isTiledTilesetSingleImage)(f)){const v=(0,B.pathRelativeToBase)(this.path,f.image,this.pathMap),h=this.headless?void 0:this.imageLoader.getOrAdd(v);this.data=new S.Tileset({name:f.name,tiledTileset:f,firstGid:this.firstGid,image:h})}if((0,C.isTiledTilesetCollectionOfImages)(f)){const v=this.headless?void 0:new Map;if(v){const h=[];if(f.tiles){for(let A of f.tiles)if(A.image){const p=(0,B.pathRelativeToBase)(this.path,A.image,this.pathMap),y=this.imageLoader.getOrAdd(p);v.set(A,y),h.push(y)}}}f.firstgid=this.firstGid,this.data=new S.Tileset({name:f.name,tiledTileset:f,firstGid:this.firstGid,tileToImage:v})}if(this.headless||await this.imageLoader.load(),this.data)return this.data}catch(L){throw console.error(`Could not load tileset at path ${this.path}`),L}throw new Error(`No tileset at path ${this.path}`)}isLoaded(){return!!this.data}}},"./src/resource/tileset.ts":(X,k,b)=>{b.r(k),b.d(k,{Tile:()=>O,Tileset:()=>V});var l=b("excalibur"),S=b("./src/resource/gid-util.ts"),C=b("./src/parser/tiled-parser.ts"),Q=b("./src/resource/objects.ts"),B=b("./src/resource/properties.ts"),D=b("./src/resource/filter-util.ts");class O{constructor(L){this.objects=[],this.colliders=[],this.animation=[],this.properties=new Map;const{id:f,tileset:v,tiledTile:h}=L;this.id=f,this.tileset=v,this.tiledTile=h,this.class=h.type,(0,B.mapProps)(this,h.properties),h.objectgroup&&h.objectgroup.objects&&(this.objects=(0,Q.parseObjects)(h.objectgroup)),h.animation&&(this.animation=h.animation)}}class V{constructor(L){var f,v,h,A,p,y,x,I,w,U;this.firstGid=-1,this.tileCount=0,this.tileWidth=0,this.tileHeight=0,this.tileOffset=(0,l.vec)(0,0),this.tiles=[],this.objectalignment="bottomleft",this.orientation="orthogonal",this.properties=new Map;const{name:R,tiledTileset:E,image:$,tileToImage:G,firstGid:K}=L;if(this.name=R,this.tiledTileset=E,this.firstGid=K,(0,C.isTiledTilesetSingleImage)(E)){(0,B.mapProps)(this,E.properties);const m=E.spacing,lt=Math.floor((E.imagewidth+m)/(E.tilewidth+m)),Et=Math.floor((E.imageheight+m)/(E.tileheight+m));if(this.class=E.class,this.orientation=(v=(f=E.grid)===null||f===void 0?void 0:f.orientation)!==null&&v!==void 0?v:"orthogonal",this.horizontalFlipTransform=l.AffineMatrix.identity().translate(E.tilewidth,0).scale(-1,1),this.verticalFlipTransform=l.AffineMatrix.identity().translate(0,E.tileheight).scale(1,-1),this.diagonalFlipTransform=l.AffineMatrix.identity().translate(0,0).rotate(-Math.PI/2).scale(-1,1),this.objectalignment=(h=E.objectalignment)!==null&&h!==void 0?h:this.orientation==="orthogonal"?"bottomleft":"bottom",$&&(this.spritesheet=l.SpriteSheet.fromImageSource({image:$,grid:{rows:Et,columns:lt,spriteWidth:E.tilewidth,spriteHeight:E.tileheight},spacing:{originOffset:{x:(A=E.margin)!==null&&A!==void 0?A:0,y:(p=E.margin)!==null&&p!==void 0?p:0},margin:{x:(y=E.spacing)!==null&&y!==void 0?y:0,y:(x=E.spacing)!==null&&x!==void 0?x:0}}})),this.tileCount=E.tilecount,this.tileWidth=E.tilewidth,this.tileHeight=E.tileheight,E.tileoffset&&(this.tileOffset=(0,l.vec)(E.tileoffset.x,E.tileoffset.y)),E.tiles)for(const dt of E.tiles)this.tiles.push(new O({id:dt.id,tileset:this,tiledTile:dt,image:$}))}if((0,C.isTiledTilesetCollectionOfImages)(E)&&E.firstgid!==void 0){this.horizontalFlipTransform=l.AffineMatrix.identity().translate(E.tilewidth,0).scale(-1,1),this.verticalFlipTransform=l.AffineMatrix.identity().translate(0,E.tileheight).scale(1,-1),this.diagonalFlipTransform=l.AffineMatrix.identity().translate(0,0).rotate(-Math.PI/2).scale(-1,1),this.objectalignment=(I=E.objectalignment)!==null&&I!==void 0?I:this.orientation==="orthogonal"?"bottomleft":"bottom",this.orientation=(U=(w=E.grid)===null||w===void 0?void 0:w.orientation)!==null&&U!==void 0?U:"orthogonal",this.tileCount=E.tilecount,this.tileWidth=E.tilewidth,this.tileHeight=E.tileheight,E.tileoffset&&(this.tileOffset=(0,l.vec)(E.tileoffset.x,E.tileoffset.y));let m=[];if(E.tiles)for(const lt of E.tiles){const Et=G==null?void 0:G.get(lt);Et&&m.push(Et.toSprite()),this.tiles.push(new O({id:lt.id,tileset:this,tiledTile:lt,image:Et}))}G&&(this.spritesheet=new l.SpriteSheet({sprites:m}))}}getTilesetAlignmentAnchor(L){switch(L??this.objectalignment){case"topleft":return(0,l.vec)(0,0);case"top":return(0,l.vec)(.5,0);case"topright":return(0,l.vec)(1,0);case"left":return(0,l.vec)(0,.5);case"center":return(0,l.vec)(.5,.5);case"right":return(0,l.vec)(1,.5);case"bottomleft":default:return(0,l.vec)(0,1);case"bottom":return(0,l.vec)(.5,1);case"bottomright":return(0,l.vec)(1,1)}}getTileByGid(L){const f=(0,S.getCanonicalGid)(L)-this.firstGid;return this.tiles.find(v=>v.id===f)}getTilesByClassName(L){return this.tiles.filter((0,D.byClassCaseInsensitive)(L))}getTilesByProperty(L,f){return this.tiles.filter((0,D.byPropertyCaseInsensitive)(L,f))}getSpriteForGid(L){const f=(0,S.isFlippedHorizontally)(L),v=(0,S.isFlippedVertically)(L),h=(0,S.isFlippedDiagonally)(L),A=(0,S.getCanonicalGid)(L),p=A-this.firstGid;if(this.spritesheet){let y=this.spritesheet.sprites[p];return(h||f||v)&&(y=y.clone()),h&&(y.rotation=-Math.PI/2,y.scale=(0,l.vec)(-1,1)),f&&(y.scale=(0,l.vec)((h?1:-1)*y.scale.x,(h?-1:1)*y.scale.y)),v&&(y.scale=(0,l.vec)((h?-1:1)*y.scale.x,(h?1:-1)*y.scale.y)),y}throw new Error(`Tileset: [${this.name}] Could not find sprite for gid: [${L}] normalized gid: [${A}]`)}_isometricTiledCoordToWorld(L){const f=this.tileWidth,v=this.tileHeight/2,h=L.y/v,A=L.x/v;return(0,l.vec)((A-h)*f/2+0,(A+h)*v/2)}getCollidersForGid(L,f){let{anchor:v,scale:h,orientationOverride:A,offset:p}={anchor:l.Vector.Zero,scale:l.Vector.One,offset:l.Vector.Zero,orientationOverride:void 0,...f};const y=A??this.orientation,x=this.getTileByGid(L),I=[];if(x&&x.objects)for(let w of x.objects){if(w instanceof Q.Polygon){let U=w.points.map(E=>E.scale(h));U=this._applyFlipsToPoints(U,L),y==="isometric"&&(U=U.map(E=>this._isometricTiledCoordToWorld(E))),U=U.map(E=>E.add(p));let R=l.Shape.Polygon(U,l.Vector.Zero,!0);R.isConvex()?I.push(R):I.push(R.triangulate())}if(w instanceof Q.Rectangle){let U=l.BoundingBox.fromDimension(w.width*h.x,w.height*h.y,v).getPoints().map(E=>E.add((0,l.vec)(w.x,w.y)));y==="isometric"&&(U=U.map(E=>this._isometricTiledCoordToWorld(E))),U=this._applyFlipsToPoints(U,L),U=U.map(E=>E.add(p));const R=l.Shape.Polygon(U);I.push(R)}if(w instanceof Q.Ellipse){let U=(0,l.vec)(w.x,w.y);y==="isometric"&&(U=this._isometricTiledCoordToWorld(U)),U=U.add(p);const R=Math.min(w.width/2,w.height/2),E=l.Shape.Circle(R,U.scale(h));I.push(E)}}return I}_applyFlipsToPoints(L,f){const v=(0,S.isFlippedHorizontally)(f),h=(0,S.isFlippedVertically)(f);return(0,S.isFlippedDiagonally)(f)&&(L=L.map(A=>this.diagonalFlipTransform.multiply(A))),v&&(L=L.map(A=>this.horizontalFlipTransform.multiply(A))),h&&(L=L.map(A=>this.verticalFlipTransform.multiply(A))),L}getAnimationForGid(L){var f;const v=this.getTileByGid(L);if(v&&(!((f=v.animation)===null||f===void 0)&&f.length)){let h=[];for(let A of v.animation)h.push({graphic:this.getSpriteForGid(A.tileid+this.firstGid),duration:A.duration});return new l.Animation({frames:h,strategy:l.AnimationStrategy.Loop})}return null}}},excalibur:X=>{X.exports=W},jsdom:X=>{if(d===void 0){var k=new Error("Cannot find module 'jsdom'");throw k.code="MODULE_NOT_FOUND",k}X.exports=d},"./node_modules/zod/lib/index.mjs":(X,k,b)=>{var l,S;b.r(k),b.d(k,{BRAND:()=>Fi,DIRTY:()=>x,EMPTY_PATH:()=>h,INVALID:()=>y,NEVER:()=>ai,OK:()=>I,ParseStatus:()=>p,Schema:()=>lt,ZodAny:()=>gt,ZodArray:()=>vt,ZodBigInt:()=>st,ZodBoolean:()=>g,ZodBranded:()=>Ms,ZodCatch:()=>Ui,ZodDate:()=>it,ZodDefault:()=>Pi,ZodDiscriminatedUnion:()=>jt,ZodEffects:()=>Ne,ZodEnum:()=>xe,ZodError:()=>O,ZodFirstPartyTypeKind:()=>Zt,ZodFunction:()=>ii,ZodIntersection:()=>_e,ZodIssueCode:()=>B,ZodLazy:()=>si,ZodLiteral:()=>Ae,ZodMap:()=>Ke,ZodNaN:()=>ji,ZodNativeEnum:()=>he,ZodNever:()=>ht,ZodNull:()=>St,ZodNullable:()=>gi,ZodNumber:()=>ae,ZodObject:()=>bt,ZodOptional:()=>ri,ZodParsedType:()=>C,ZodPipeline:()=>Mi,ZodPromise:()=>Ii,ZodReadonly:()=>Hi,ZodRecord:()=>Oe,ZodSchema:()=>lt,ZodSet:()=>$e,ZodString:()=>zt,ZodSymbol:()=>ut,ZodTransformer:()=>Ne,ZodTuple:()=>de,ZodType:()=>lt,ZodUndefined:()=>F,ZodUnion:()=>Gt,ZodUnknown:()=>pt,ZodVoid:()=>ct,addIssueToContext:()=>A,any:()=>ni,array:()=>we,bigint:()=>dr,boolean:()=>Ns,coerce:()=>ws,custom:()=>Ls,date:()=>Gs,default:()=>li,defaultErrorMap:()=>V,discriminatedUnion:()=>Ei,effect:()=>Li,enum:()=>te,function:()=>Yi,getErrorMap:()=>f,getParsedType:()=>Q,instanceof:()=>cr,intersection:()=>pr,isAborted:()=>w,isAsync:()=>E,isDirty:()=>U,isValid:()=>R,late:()=>hr,lazy:()=>js,literal:()=>qi,makeIssue:()=>v,map:()=>Zi,nan:()=>Os,nativeEnum:()=>Vi,never:()=>Ar,null:()=>ur,nullable:()=>fs,number:()=>zs,object:()=>ds,objectUtil:()=>S,oboolean:()=>vs,onumber:()=>ms,optional:()=>ps,ostring:()=>_s,pipeline:()=>Si,preprocess:()=>Ti,promise:()=>gs,quotelessJson:()=>D,record:()=>Bi,set:()=>As,setErrorMap:()=>L,strictObject:()=>gr,string:()=>Rs,symbol:()=>Us,transformer:()=>Li,tuple:()=>pi,undefined:()=>ee,union:()=>us,unknown:()=>ge,util:()=>l,void:()=>Wi,z:()=>li}),function(j){j.assertEqual=c=>c,j.assertIs=function(c){},j.assertNever=function(c){throw new Error},j.arrayToEnum=c=>{const _={};for(const z of c)_[z]=z;return _},j.getValidEnumValues=c=>{const _=j.objectKeys(c).filter(tt=>typeof c[c[tt]]!="number"),z={};for(const tt of _)z[tt]=c[tt];return j.objectValues(z)},j.objectValues=c=>j.objectKeys(c).map(function(_){return c[_]}),j.objectKeys=typeof Object.keys=="function"?c=>Object.keys(c):c=>{const _=[];for(const z in c)Object.prototype.hasOwnProperty.call(c,z)&&_.push(z);return _},j.find=(c,_)=>{for(const z of c)if(_(z))return z},j.isInteger=typeof Number.isInteger=="function"?c=>Number.isInteger(c):c=>typeof c=="number"&&isFinite(c)&&Math.floor(c)===c,j.joinValues=function(c,_=" | "){return c.map(z=>typeof z=="string"?`'${z}'`:z).join(_)},j.jsonStringifyReplacer=(c,_)=>typeof _=="bigint"?_.toString():_}(l||(l={})),function(j){j.mergeShapes=(c,_)=>({...c,..._})}(S||(S={}));const C=l.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Q=j=>{switch(typeof j){case"undefined":return C.undefined;case"string":return C.string;case"number":return isNaN(j)?C.nan:C.number;case"boolean":return C.boolean;case"function":return C.function;case"bigint":return C.bigint;case"symbol":return C.symbol;case"object":return Array.isArray(j)?C.array:j===null?C.null:j.then&&typeof j.then=="function"&&j.catch&&typeof j.catch=="function"?C.promise:typeof Map<"u"&&j instanceof Map?C.map:typeof Set<"u"&&j instanceof Set?C.set:typeof Date<"u"&&j instanceof Date?C.date:C.object;default:return C.unknown}},B=l.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),D=j=>JSON.stringify(j,null,2).replace(/"([^"]+)":/g,"$1:");class O extends Error{constructor(c){super(),this.issues=[],this.addIssue=z=>{this.issues=[...this.issues,z]},this.addIssues=(z=[])=>{this.issues=[...this.issues,...z]};const _=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,_):this.__proto__=_,this.name="ZodError",this.issues=c}get errors(){return this.issues}format(c){const _=c||function(Pt){return Pt.message},z={_errors:[]},tt=Pt=>{for(const kt of Pt.issues)if(kt.code==="invalid_union")kt.unionErrors.map(tt);else if(kt.code==="invalid_return_type")tt(kt.returnTypeError);else if(kt.code==="invalid_arguments")tt(kt.argumentsError);else if(kt.path.length===0)z._errors.push(_(kt));else{let mt=z,Lt=0;for(;Lt<kt.path.length;){const Nt=kt.path[Lt];Lt===kt.path.length-1?(mt[Nt]=mt[Nt]||{_errors:[]},mt[Nt]._errors.push(_(kt))):mt[Nt]=mt[Nt]||{_errors:[]},mt=mt[Nt],Lt++}}};return tt(this),z}toString(){return this.message}get message(){return JSON.stringify(this.issues,l.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(c=_=>_.message){const _={},z=[];for(const tt of this.issues)tt.path.length>0?(_[tt.path[0]]=_[tt.path[0]]||[],_[tt.path[0]].push(c(tt))):z.push(c(tt));return{formErrors:z,fieldErrors:_}}get formErrors(){return this.flatten()}}O.create=j=>new O(j);const V=(j,c)=>{let _;switch(j.code){case B.invalid_type:_=j.received===C.undefined?"Required":`Expected ${j.expected}, received ${j.received}`;break;case B.invalid_literal:_=`Invalid literal value, expected ${JSON.stringify(j.expected,l.jsonStringifyReplacer)}`;break;case B.unrecognized_keys:_=`Unrecognized key(s) in object: ${l.joinValues(j.keys,", ")}`;break;case B.invalid_union:_="Invalid input";break;case B.invalid_union_discriminator:_=`Invalid discriminator value. Expected ${l.joinValues(j.options)}`;break;case B.invalid_enum_value:_=`Invalid enum value. Expected ${l.joinValues(j.options)}, received '${j.received}'`;break;case B.invalid_arguments:_="Invalid function arguments";break;case B.invalid_return_type:_="Invalid function return type";break;case B.invalid_date:_="Invalid date";break;case B.invalid_string:typeof j.validation=="object"?"includes"in j.validation?(_=`Invalid input: must include "${j.validation.includes}"`,typeof j.validation.position=="number"&&(_=`${_} at one or more positions greater than or equal to ${j.validation.position}`)):"startsWith"in j.validation?_=`Invalid input: must start with "${j.validation.startsWith}"`:"endsWith"in j.validation?_=`Invalid input: must end with "${j.validation.endsWith}"`:l.assertNever(j.validation):_=j.validation!=="regex"?`Invalid ${j.validation}`:"Invalid";break;case B.too_small:_=j.type==="array"?`Array must contain ${j.exact?"exactly":j.inclusive?"at least":"more than"} ${j.minimum} element(s)`:j.type==="string"?`String must contain ${j.exact?"exactly":j.inclusive?"at least":"over"} ${j.minimum} character(s)`:j.type==="number"?`Number must be ${j.exact?"exactly equal to ":j.inclusive?"greater than or equal to ":"greater than "}${j.minimum}`:j.type==="date"?`Date must be ${j.exact?"exactly equal to ":j.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(j.minimum))}`:"Invalid input";break;case B.too_big:_=j.type==="array"?`Array must contain ${j.exact?"exactly":j.inclusive?"at most":"less than"} ${j.maximum} element(s)`:j.type==="string"?`String must contain ${j.exact?"exactly":j.inclusive?"at most":"under"} ${j.maximum} character(s)`:j.type==="number"?`Number must be ${j.exact?"exactly":j.inclusive?"less than or equal to":"less than"} ${j.maximum}`:j.type==="bigint"?`BigInt must be ${j.exact?"exactly":j.inclusive?"less than or equal to":"less than"} ${j.maximum}`:j.type==="date"?`Date must be ${j.exact?"exactly":j.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(j.maximum))}`:"Invalid input";break;case B.custom:_="Invalid input";break;case B.invalid_intersection_types:_="Intersection results could not be merged";break;case B.not_multiple_of:_=`Number must be a multiple of ${j.multipleOf}`;break;case B.not_finite:_="Number must be finite";break;default:_=c.defaultError,l.assertNever(j)}return{message:_}};let M=V;function L(j){M=j}function f(){return M}const v=j=>{const{data:c,path:_,errorMaps:z,issueData:tt}=j,Pt=[..._,...tt.path||[]],kt={...tt,path:Pt};let mt="";const Lt=z.filter(Nt=>!!Nt).slice().reverse();for(const Nt of Lt)mt=Nt(kt,{data:c,defaultError:mt}).message;return{...tt,path:Pt,message:tt.message||mt}},h=[];function A(j,c){const _=v({issueData:c,data:j.data,path:j.path,errorMaps:[j.common.contextualErrorMap,j.schemaErrorMap,f(),V].filter(z=>!!z)});j.common.issues.push(_)}class p{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(c,_){const z=[];for(const tt of _){if(tt.status==="aborted")return y;tt.status==="dirty"&&c.dirty(),z.push(tt.value)}return{status:c.value,value:z}}static async mergeObjectAsync(c,_){const z=[];for(const tt of _)z.push({key:await tt.key,value:await tt.value});return p.mergeObjectSync(c,z)}static mergeObjectSync(c,_){const z={};for(const tt of _){const{key:Pt,value:kt}=tt;if(Pt.status==="aborted"||kt.status==="aborted")return y;Pt.status==="dirty"&&c.dirty(),kt.status==="dirty"&&c.dirty(),Pt.value==="__proto__"||kt.value===void 0&&!tt.alwaysSet||(z[Pt.value]=kt.value)}return{status:c.value,value:z}}}const y=Object.freeze({status:"aborted"}),x=j=>({status:"dirty",value:j}),I=j=>({status:"valid",value:j}),w=j=>j.status==="aborted",U=j=>j.status==="dirty",R=j=>j.status==="valid",E=j=>typeof Promise<"u"&&j instanceof Promise;var $;(function(j){j.errToObj=c=>typeof c=="string"?{message:c}:c||{},j.toString=c=>typeof c=="string"?c:c==null?void 0:c.message})($||($={}));class G{constructor(c,_,z,tt){this._cachedPath=[],this.parent=c,this.data=_,this._path=z,this._key=tt}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const K=(j,c)=>{if(R(c))return{success:!0,data:c.value};if(!j.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const _=new O(j.common.issues);return this._error=_,this._error}}};function m(j){if(!j)return{};const{errorMap:c,invalid_type_error:_,required_error:z,description:tt}=j;if(c&&(_||z))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return c?{errorMap:c,description:tt}:{errorMap:(Pt,kt)=>Pt.code!=="invalid_type"?{message:kt.defaultError}:kt.data===void 0?{message:z??kt.defaultError}:{message:_??kt.defaultError},description:tt}}class lt{constructor(c){this.spa=this.safeParseAsync,this._def=c,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(c){return Q(c.data)}_getOrReturnCtx(c,_){return _||{common:c.parent.common,data:c.data,parsedType:Q(c.data),schemaErrorMap:this._def.errorMap,path:c.path,parent:c.parent}}_processInputParams(c){return{status:new p,ctx:{common:c.parent.common,data:c.data,parsedType:Q(c.data),schemaErrorMap:this._def.errorMap,path:c.path,parent:c.parent}}}_parseSync(c){const _=this._parse(c);if(E(_))throw new Error("Synchronous parse encountered promise.");return _}_parseAsync(c){const _=this._parse(c);return Promise.resolve(_)}parse(c,_){const z=this.safeParse(c,_);if(z.success)return z.data;throw z.error}safeParse(c,_){var z;const tt={common:{issues:[],async:(z=_==null?void 0:_.async)!==null&&z!==void 0&&z,contextualErrorMap:_==null?void 0:_.errorMap},path:(_==null?void 0:_.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:c,parsedType:Q(c)},Pt=this._parseSync({data:c,path:tt.path,parent:tt});return K(tt,Pt)}async parseAsync(c,_){const z=await this.safeParseAsync(c,_);if(z.success)return z.data;throw z.error}async safeParseAsync(c,_){const z={common:{issues:[],contextualErrorMap:_==null?void 0:_.errorMap,async:!0},path:(_==null?void 0:_.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:c,parsedType:Q(c)},tt=this._parse({data:c,path:z.path,parent:z}),Pt=await(E(tt)?tt:Promise.resolve(tt));return K(z,Pt)}refine(c,_){const z=tt=>typeof _=="string"||_===void 0?{message:_}:typeof _=="function"?_(tt):_;return this._refinement((tt,Pt)=>{const kt=c(tt),mt=()=>Pt.addIssue({code:B.custom,...z(tt)});return typeof Promise<"u"&&kt instanceof Promise?kt.then(Lt=>!!Lt||(mt(),!1)):!!kt||(mt(),!1)})}refinement(c,_){return this._refinement((z,tt)=>!!c(z)||(tt.addIssue(typeof _=="function"?_(z,tt):_),!1))}_refinement(c){return new Ne({schema:this,typeName:Zt.ZodEffects,effect:{type:"refinement",refinement:c}})}superRefine(c){return this._refinement(c)}optional(){return ri.create(this,this._def)}nullable(){return gi.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return vt.create(this,this._def)}promise(){return Ii.create(this,this._def)}or(c){return Gt.create([this,c],this._def)}and(c){return _e.create(this,c,this._def)}transform(c){return new Ne({...m(this._def),schema:this,typeName:Zt.ZodEffects,effect:{type:"transform",transform:c}})}default(c){const _=typeof c=="function"?c:()=>c;return new Pi({...m(this._def),innerType:this,defaultValue:_,typeName:Zt.ZodDefault})}brand(){return new Ms({typeName:Zt.ZodBranded,type:this,...m(this._def)})}catch(c){const _=typeof c=="function"?c:()=>c;return new Ui({...m(this._def),innerType:this,catchValue:_,typeName:Zt.ZodCatch})}describe(c){return new this.constructor({...this._def,description:c})}pipe(c){return Mi.create(this,c)}readonly(){return Hi.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Et=/^c[^\s-]{8,}$/i,dt=/^[a-z][a-z0-9]*$/,Ut=/^[0-9A-HJKMNP-TV-Z]{26}$/,At=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,It=/^(?!\.)(?!.*\.\.)([A-Z0-9_+-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let yt;const wt=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,ie=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/;class zt extends lt{_parse(c){if(this._def.coerce&&(c.data=String(c.data)),this._getType(c)!==C.string){const mt=this._getOrReturnCtx(c);return A(mt,{code:B.invalid_type,expected:C.string,received:mt.parsedType}),y}const _=new p;let z;for(const mt of this._def.checks)if(mt.kind==="min")c.data.length<mt.value&&(z=this._getOrReturnCtx(c,z),A(z,{code:B.too_small,minimum:mt.value,type:"string",inclusive:!0,exact:!1,message:mt.message}),_.dirty());else if(mt.kind==="max")c.data.length>mt.value&&(z=this._getOrReturnCtx(c,z),A(z,{code:B.too_big,maximum:mt.value,type:"string",inclusive:!0,exact:!1,message:mt.message}),_.dirty());else if(mt.kind==="length"){const Lt=c.data.length>mt.value,Nt=c.data.length<mt.value;(Lt||Nt)&&(z=this._getOrReturnCtx(c,z),Lt?A(z,{code:B.too_big,maximum:mt.value,type:"string",inclusive:!0,exact:!0,message:mt.message}):Nt&&A(z,{code:B.too_small,minimum:mt.value,type:"string",inclusive:!0,exact:!0,message:mt.message}),_.dirty())}else if(mt.kind==="email")It.test(c.data)||(z=this._getOrReturnCtx(c,z),A(z,{validation:"email",code:B.invalid_string,message:mt.message}),_.dirty());else if(mt.kind==="emoji")yt||(yt=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),yt.test(c.data)||(z=this._getOrReturnCtx(c,z),A(z,{validation:"emoji",code:B.invalid_string,message:mt.message}),_.dirty());else if(mt.kind==="uuid")At.test(c.data)||(z=this._getOrReturnCtx(c,z),A(z,{validation:"uuid",code:B.invalid_string,message:mt.message}),_.dirty());else if(mt.kind==="cuid")Et.test(c.data)||(z=this._getOrReturnCtx(c,z),A(z,{validation:"cuid",code:B.invalid_string,message:mt.message}),_.dirty());else if(mt.kind==="cuid2")dt.test(c.data)||(z=this._getOrReturnCtx(c,z),A(z,{validation:"cuid2",code:B.invalid_string,message:mt.message}),_.dirty());else if(mt.kind==="ulid")Ut.test(c.data)||(z=this._getOrReturnCtx(c,z),A(z,{validation:"ulid",code:B.invalid_string,message:mt.message}),_.dirty());else if(mt.kind==="url")try{new URL(c.data)}catch{z=this._getOrReturnCtx(c,z),A(z,{validation:"url",code:B.invalid_string,message:mt.message}),_.dirty()}else mt.kind==="regex"?(mt.regex.lastIndex=0,mt.regex.test(c.data)||(z=this._getOrReturnCtx(c,z),A(z,{validation:"regex",code:B.invalid_string,message:mt.message}),_.dirty())):mt.kind==="trim"?c.data=c.data.trim():mt.kind==="includes"?c.data.includes(mt.value,mt.position)||(z=this._getOrReturnCtx(c,z),A(z,{code:B.invalid_string,validation:{includes:mt.value,position:mt.position},message:mt.message}),_.dirty()):mt.kind==="toLowerCase"?c.data=c.data.toLowerCase():mt.kind==="toUpperCase"?c.data=c.data.toUpperCase():mt.kind==="startsWith"?c.data.startsWith(mt.value)||(z=this._getOrReturnCtx(c,z),A(z,{code:B.invalid_string,validation:{startsWith:mt.value},message:mt.message}),_.dirty()):mt.kind==="endsWith"?c.data.endsWith(mt.value)||(z=this._getOrReturnCtx(c,z),A(z,{code:B.invalid_string,validation:{endsWith:mt.value},message:mt.message}),_.dirty()):mt.kind==="datetime"?((kt=mt).precision?kt.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${kt.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${kt.precision}}Z$`):kt.precision===0?kt.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):kt.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$")).test(c.data)||(z=this._getOrReturnCtx(c,z),A(z,{code:B.invalid_string,validation:"datetime",message:mt.message}),_.dirty()):mt.kind==="ip"?(tt=c.data,((Pt=mt.version)!=="v4"&&Pt||!wt.test(tt))&&(Pt!=="v6"&&Pt||!ie.test(tt))&&(z=this._getOrReturnCtx(c,z),A(z,{validation:"ip",code:B.invalid_string,message:mt.message}),_.dirty())):l.assertNever(mt);var tt,Pt,kt;return{status:_.value,value:c.data}}_regex(c,_,z){return this.refinement(tt=>c.test(tt),{validation:_,code:B.invalid_string,...$.errToObj(z)})}_addCheck(c){return new zt({...this._def,checks:[...this._def.checks,c]})}email(c){return this._addCheck({kind:"email",...$.errToObj(c)})}url(c){return this._addCheck({kind:"url",...$.errToObj(c)})}emoji(c){return this._addCheck({kind:"emoji",...$.errToObj(c)})}uuid(c){return this._addCheck({kind:"uuid",...$.errToObj(c)})}cuid(c){return this._addCheck({kind:"cuid",...$.errToObj(c)})}cuid2(c){return this._addCheck({kind:"cuid2",...$.errToObj(c)})}ulid(c){return this._addCheck({kind:"ulid",...$.errToObj(c)})}ip(c){return this._addCheck({kind:"ip",...$.errToObj(c)})}datetime(c){var _;return typeof c=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,message:c}):this._addCheck({kind:"datetime",precision:(c==null?void 0:c.precision)===void 0?null:c==null?void 0:c.precision,offset:(_=c==null?void 0:c.offset)!==null&&_!==void 0&&_,...$.errToObj(c==null?void 0:c.message)})}regex(c,_){return this._addCheck({kind:"regex",regex:c,...$.errToObj(_)})}includes(c,_){return this._addCheck({kind:"includes",value:c,position:_==null?void 0:_.position,...$.errToObj(_==null?void 0:_.message)})}startsWith(c,_){return this._addCheck({kind:"startsWith",value:c,...$.errToObj(_)})}endsWith(c,_){return this._addCheck({kind:"endsWith",value:c,...$.errToObj(_)})}min(c,_){return this._addCheck({kind:"min",value:c,...$.errToObj(_)})}max(c,_){return this._addCheck({kind:"max",value:c,...$.errToObj(_)})}length(c,_){return this._addCheck({kind:"length",value:c,...$.errToObj(_)})}nonempty(c){return this.min(1,$.errToObj(c))}trim(){return new zt({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new zt({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new zt({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(c=>c.kind==="datetime")}get isEmail(){return!!this._def.checks.find(c=>c.kind==="email")}get isURL(){return!!this._def.checks.find(c=>c.kind==="url")}get isEmoji(){return!!this._def.checks.find(c=>c.kind==="emoji")}get isUUID(){return!!this._def.checks.find(c=>c.kind==="uuid")}get isCUID(){return!!this._def.checks.find(c=>c.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(c=>c.kind==="cuid2")}get isULID(){return!!this._def.checks.find(c=>c.kind==="ulid")}get isIP(){return!!this._def.checks.find(c=>c.kind==="ip")}get minLength(){let c=null;for(const _ of this._def.checks)_.kind==="min"&&(c===null||_.value>c)&&(c=_.value);return c}get maxLength(){let c=null;for(const _ of this._def.checks)_.kind==="max"&&(c===null||_.value<c)&&(c=_.value);return c}}function Mt(j,c){const _=(j.toString().split(".")[1]||"").length,z=(c.toString().split(".")[1]||"").length,tt=_>z?_:z;return parseInt(j.toFixed(tt).replace(".",""))%parseInt(c.toFixed(tt).replace(".",""))/Math.pow(10,tt)}zt.create=j=>{var c;return new zt({checks:[],typeName:Zt.ZodString,coerce:(c=j==null?void 0:j.coerce)!==null&&c!==void 0&&c,...m(j)})};class ae extends lt{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(c){if(this._def.coerce&&(c.data=Number(c.data)),this._getType(c)!==C.number){const tt=this._getOrReturnCtx(c);return A(tt,{code:B.invalid_type,expected:C.number,received:tt.parsedType}),y}let _;const z=new p;for(const tt of this._def.checks)tt.kind==="int"?l.isInteger(c.data)||(_=this._getOrReturnCtx(c,_),A(_,{code:B.invalid_type,expected:"integer",received:"float",message:tt.message}),z.dirty()):tt.kind==="min"?(tt.inclusive?c.data<tt.value:c.data<=tt.value)&&(_=this._getOrReturnCtx(c,_),A(_,{code:B.too_small,minimum:tt.value,type:"number",inclusive:tt.inclusive,exact:!1,message:tt.message}),z.dirty()):tt.kind==="max"?(tt.inclusive?c.data>tt.value:c.data>=tt.value)&&(_=this._getOrReturnCtx(c,_),A(_,{code:B.too_big,maximum:tt.value,type:"number",inclusive:tt.inclusive,exact:!1,message:tt.message}),z.dirty()):tt.kind==="multipleOf"?Mt(c.data,tt.value)!==0&&(_=this._getOrReturnCtx(c,_),A(_,{code:B.not_multiple_of,multipleOf:tt.value,message:tt.message}),z.dirty()):tt.kind==="finite"?Number.isFinite(c.data)||(_=this._getOrReturnCtx(c,_),A(_,{code:B.not_finite,message:tt.message}),z.dirty()):l.assertNever(tt);return{status:z.value,value:c.data}}gte(c,_){return this.setLimit("min",c,!0,$.toString(_))}gt(c,_){return this.setLimit("min",c,!1,$.toString(_))}lte(c,_){return this.setLimit("max",c,!0,$.toString(_))}lt(c,_){return this.setLimit("max",c,!1,$.toString(_))}setLimit(c,_,z,tt){return new ae({...this._def,checks:[...this._def.checks,{kind:c,value:_,inclusive:z,message:$.toString(tt)}]})}_addCheck(c){return new ae({...this._def,checks:[...this._def.checks,c]})}int(c){return this._addCheck({kind:"int",message:$.toString(c)})}positive(c){return this._addCheck({kind:"min",value:0,inclusive:!1,message:$.toString(c)})}negative(c){return this._addCheck({kind:"max",value:0,inclusive:!1,message:$.toString(c)})}nonpositive(c){return this._addCheck({kind:"max",value:0,inclusive:!0,message:$.toString(c)})}nonnegative(c){return this._addCheck({kind:"min",value:0,inclusive:!0,message:$.toString(c)})}multipleOf(c,_){return this._addCheck({kind:"multipleOf",value:c,message:$.toString(_)})}finite(c){return this._addCheck({kind:"finite",message:$.toString(c)})}safe(c){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:$.toString(c)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:$.toString(c)})}get minValue(){let c=null;for(const _ of this._def.checks)_.kind==="min"&&(c===null||_.value>c)&&(c=_.value);return c}get maxValue(){let c=null;for(const _ of this._def.checks)_.kind==="max"&&(c===null||_.value<c)&&(c=_.value);return c}get isInt(){return!!this._def.checks.find(c=>c.kind==="int"||c.kind==="multipleOf"&&l.isInteger(c.value))}get isFinite(){let c=null,_=null;for(const z of this._def.checks){if(z.kind==="finite"||z.kind==="int"||z.kind==="multipleOf")return!0;z.kind==="min"?(_===null||z.value>_)&&(_=z.value):z.kind==="max"&&(c===null||z.value<c)&&(c=z.value)}return Number.isFinite(_)&&Number.isFinite(c)}}ae.create=j=>new ae({checks:[],typeName:Zt.ZodNumber,coerce:(j==null?void 0:j.coerce)||!1,...m(j)});class st extends lt{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(c){if(this._def.coerce&&(c.data=BigInt(c.data)),this._getType(c)!==C.bigint){const tt=this._getOrReturnCtx(c);return A(tt,{code:B.invalid_type,expected:C.bigint,received:tt.parsedType}),y}let _;const z=new p;for(const tt of this._def.checks)tt.kind==="min"?(tt.inclusive?c.data<tt.value:c.data<=tt.value)&&(_=this._getOrReturnCtx(c,_),A(_,{code:B.too_small,type:"bigint",minimum:tt.value,inclusive:tt.inclusive,message:tt.message}),z.dirty()):tt.kind==="max"?(tt.inclusive?c.data>tt.value:c.data>=tt.value)&&(_=this._getOrReturnCtx(c,_),A(_,{code:B.too_big,type:"bigint",maximum:tt.value,inclusive:tt.inclusive,message:tt.message}),z.dirty()):tt.kind==="multipleOf"?c.data%tt.value!==BigInt(0)&&(_=this._getOrReturnCtx(c,_),A(_,{code:B.not_multiple_of,multipleOf:tt.value,message:tt.message}),z.dirty()):l.assertNever(tt);return{status:z.value,value:c.data}}gte(c,_){return this.setLimit("min",c,!0,$.toString(_))}gt(c,_){return this.setLimit("min",c,!1,$.toString(_))}lte(c,_){return this.setLimit("max",c,!0,$.toString(_))}lt(c,_){return this.setLimit("max",c,!1,$.toString(_))}setLimit(c,_,z,tt){return new st({...this._def,checks:[...this._def.checks,{kind:c,value:_,inclusive:z,message:$.toString(tt)}]})}_addCheck(c){return new st({...this._def,checks:[...this._def.checks,c]})}positive(c){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:$.toString(c)})}negative(c){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:$.toString(c)})}nonpositive(c){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:$.toString(c)})}nonnegative(c){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:$.toString(c)})}multipleOf(c,_){return this._addCheck({kind:"multipleOf",value:c,message:$.toString(_)})}get minValue(){let c=null;for(const _ of this._def.checks)_.kind==="min"&&(c===null||_.value>c)&&(c=_.value);return c}get maxValue(){let c=null;for(const _ of this._def.checks)_.kind==="max"&&(c===null||_.value<c)&&(c=_.value);return c}}st.create=j=>{var c;return new st({checks:[],typeName:Zt.ZodBigInt,coerce:(c=j==null?void 0:j.coerce)!==null&&c!==void 0&&c,...m(j)})};class g extends lt{_parse(c){if(this._def.coerce&&(c.data=!!c.data),this._getType(c)!==C.boolean){const _=this._getOrReturnCtx(c);return A(_,{code:B.invalid_type,expected:C.boolean,received:_.parsedType}),y}return I(c.data)}}g.create=j=>new g({typeName:Zt.ZodBoolean,coerce:(j==null?void 0:j.coerce)||!1,...m(j)});class it extends lt{_parse(c){if(this._def.coerce&&(c.data=new Date(c.data)),this._getType(c)!==C.date){const tt=this._getOrReturnCtx(c);return A(tt,{code:B.invalid_type,expected:C.date,received:tt.parsedType}),y}if(isNaN(c.data.getTime()))return A(this._getOrReturnCtx(c),{code:B.invalid_date}),y;const _=new p;let z;for(const tt of this._def.checks)tt.kind==="min"?c.data.getTime()<tt.value&&(z=this._getOrReturnCtx(c,z),A(z,{code:B.too_small,message:tt.message,inclusive:!0,exact:!1,minimum:tt.value,type:"date"}),_.dirty()):tt.kind==="max"?c.data.getTime()>tt.value&&(z=this._getOrReturnCtx(c,z),A(z,{code:B.too_big,message:tt.message,inclusive:!0,exact:!1,maximum:tt.value,type:"date"}),_.dirty()):l.assertNever(tt);return{status:_.value,value:new Date(c.data.getTime())}}_addCheck(c){return new it({...this._def,checks:[...this._def.checks,c]})}min(c,_){return this._addCheck({kind:"min",value:c.getTime(),message:$.toString(_)})}max(c,_){return this._addCheck({kind:"max",value:c.getTime(),message:$.toString(_)})}get minDate(){let c=null;for(const _ of this._def.checks)_.kind==="min"&&(c===null||_.value>c)&&(c=_.value);return c!=null?new Date(c):null}get maxDate(){let c=null;for(const _ of this._def.checks)_.kind==="max"&&(c===null||_.value<c)&&(c=_.value);return c!=null?new Date(c):null}}it.create=j=>new it({checks:[],coerce:(j==null?void 0:j.coerce)||!1,typeName:Zt.ZodDate,...m(j)});class ut extends lt{_parse(c){if(this._getType(c)!==C.symbol){const _=this._getOrReturnCtx(c);return A(_,{code:B.invalid_type,expected:C.symbol,received:_.parsedType}),y}return I(c.data)}}ut.create=j=>new ut({typeName:Zt.ZodSymbol,...m(j)});class F extends lt{_parse(c){if(this._getType(c)!==C.undefined){const _=this._getOrReturnCtx(c);return A(_,{code:B.invalid_type,expected:C.undefined,received:_.parsedType}),y}return I(c.data)}}F.create=j=>new F({typeName:Zt.ZodUndefined,...m(j)});class St extends lt{_parse(c){if(this._getType(c)!==C.null){const _=this._getOrReturnCtx(c);return A(_,{code:B.invalid_type,expected:C.null,received:_.parsedType}),y}return I(c.data)}}St.create=j=>new St({typeName:Zt.ZodNull,...m(j)});class gt extends lt{constructor(){super(...arguments),this._any=!0}_parse(c){return I(c.data)}}gt.create=j=>new gt({typeName:Zt.ZodAny,...m(j)});class pt extends lt{constructor(){super(...arguments),this._unknown=!0}_parse(c){return I(c.data)}}pt.create=j=>new pt({typeName:Zt.ZodUnknown,...m(j)});class ht extends lt{_parse(c){const _=this._getOrReturnCtx(c);return A(_,{code:B.invalid_type,expected:C.never,received:_.parsedType}),y}}ht.create=j=>new ht({typeName:Zt.ZodNever,...m(j)});class ct extends lt{_parse(c){if(this._getType(c)!==C.undefined){const _=this._getOrReturnCtx(c);return A(_,{code:B.invalid_type,expected:C.void,received:_.parsedType}),y}return I(c.data)}}ct.create=j=>new ct({typeName:Zt.ZodVoid,...m(j)});class vt extends lt{_parse(c){const{ctx:_,status:z}=this._processInputParams(c),tt=this._def;if(_.parsedType!==C.array)return A(_,{code:B.invalid_type,expected:C.array,received:_.parsedType}),y;if(tt.exactLength!==null){const kt=_.data.length>tt.exactLength.value,mt=_.data.length<tt.exactLength.value;(kt||mt)&&(A(_,{code:kt?B.too_big:B.too_small,minimum:mt?tt.exactLength.value:void 0,maximum:kt?tt.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:tt.exactLength.message}),z.dirty())}if(tt.minLength!==null&&_.data.length<tt.minLength.value&&(A(_,{code:B.too_small,minimum:tt.minLength.value,type:"array",inclusive:!0,exact:!1,message:tt.minLength.message}),z.dirty()),tt.maxLength!==null&&_.data.length>tt.maxLength.value&&(A(_,{code:B.too_big,maximum:tt.maxLength.value,type:"array",inclusive:!0,exact:!1,message:tt.maxLength.message}),z.dirty()),_.common.async)return Promise.all([..._.data].map((kt,mt)=>tt.type._parseAsync(new G(_,kt,_.path,mt)))).then(kt=>p.mergeArray(z,kt));const Pt=[..._.data].map((kt,mt)=>tt.type._parseSync(new G(_,kt,_.path,mt)));return p.mergeArray(z,Pt)}get element(){return this._def.type}min(c,_){return new vt({...this._def,minLength:{value:c,message:$.toString(_)}})}max(c,_){return new vt({...this._def,maxLength:{value:c,message:$.toString(_)}})}length(c,_){return new vt({...this._def,exactLength:{value:c,message:$.toString(_)}})}nonempty(c){return this.min(1,c)}}function Qt(j){if(j instanceof bt){const c={};for(const _ in j.shape){const z=j.shape[_];c[_]=ri.create(Qt(z))}return new bt({...j._def,shape:()=>c})}return j instanceof vt?new vt({...j._def,type:Qt(j.element)}):j instanceof ri?ri.create(Qt(j.unwrap())):j instanceof gi?gi.create(Qt(j.unwrap())):j instanceof de?de.create(j.items.map(c=>Qt(c))):j}vt.create=(j,c)=>new vt({type:j,minLength:null,maxLength:null,exactLength:null,typeName:Zt.ZodArray,...m(c)});class bt extends lt{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const c=this._def.shape(),_=l.objectKeys(c);return this._cached={shape:c,keys:_}}_parse(c){if(this._getType(c)!==C.object){const Lt=this._getOrReturnCtx(c);return A(Lt,{code:B.invalid_type,expected:C.object,received:Lt.parsedType}),y}const{status:_,ctx:z}=this._processInputParams(c),{shape:tt,keys:Pt}=this._getCached(),kt=[];if(!(this._def.catchall instanceof ht&&this._def.unknownKeys==="strip"))for(const Lt in z.data)Pt.includes(Lt)||kt.push(Lt);const mt=[];for(const Lt of Pt){const Nt=tt[Lt],ue=z.data[Lt];mt.push({key:{status:"valid",value:Lt},value:Nt._parse(new G(z,ue,z.path,Lt)),alwaysSet:Lt in z.data})}if(this._def.catchall instanceof ht){const Lt=this._def.unknownKeys;if(Lt==="passthrough")for(const Nt of kt)mt.push({key:{status:"valid",value:Nt},value:{status:"valid",value:z.data[Nt]}});else if(Lt==="strict")kt.length>0&&(A(z,{code:B.unrecognized_keys,keys:kt}),_.dirty());else if(Lt!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const Lt=this._def.catchall;for(const Nt of kt){const ue=z.data[Nt];mt.push({key:{status:"valid",value:Nt},value:Lt._parse(new G(z,ue,z.path,Nt)),alwaysSet:Nt in z.data})}}return z.common.async?Promise.resolve().then(async()=>{const Lt=[];for(const Nt of mt){const ue=await Nt.key;Lt.push({key:ue,value:await Nt.value,alwaysSet:Nt.alwaysSet})}return Lt}).then(Lt=>p.mergeObjectSync(_,Lt)):p.mergeObjectSync(_,mt)}get shape(){return this._def.shape()}strict(c){return $.errToObj,new bt({...this._def,unknownKeys:"strict",...c!==void 0?{errorMap:(_,z)=>{var tt,Pt,kt,mt;const Lt=(kt=(Pt=(tt=this._def).errorMap)===null||Pt===void 0?void 0:Pt.call(tt,_,z).message)!==null&&kt!==void 0?kt:z.defaultError;return _.code==="unrecognized_keys"?{message:(mt=$.errToObj(c).message)!==null&&mt!==void 0?mt:Lt}:{message:Lt}}}:{}})}strip(){return new bt({...this._def,unknownKeys:"strip"})}passthrough(){return new bt({...this._def,unknownKeys:"passthrough"})}extend(c){return new bt({...this._def,shape:()=>({...this._def.shape(),...c})})}merge(c){return new bt({unknownKeys:c._def.unknownKeys,catchall:c._def.catchall,shape:()=>({...this._def.shape(),...c._def.shape()}),typeName:Zt.ZodObject})}setKey(c,_){return this.augment({[c]:_})}catchall(c){return new bt({...this._def,catchall:c})}pick(c){const _={};return l.objectKeys(c).forEach(z=>{c[z]&&this.shape[z]&&(_[z]=this.shape[z])}),new bt({...this._def,shape:()=>_})}omit(c){const _={};return l.objectKeys(this.shape).forEach(z=>{c[z]||(_[z]=this.shape[z])}),new bt({...this._def,shape:()=>_})}deepPartial(){return Qt(this)}partial(c){const _={};return l.objectKeys(this.shape).forEach(z=>{const tt=this.shape[z];c&&!c[z]?_[z]=tt:_[z]=tt.optional()}),new bt({...this._def,shape:()=>_})}required(c){const _={};return l.objectKeys(this.shape).forEach(z=>{if(c&&!c[z])_[z]=this.shape[z];else{let tt=this.shape[z];for(;tt instanceof ri;)tt=tt._def.innerType;_[z]=tt}}),new bt({...this._def,shape:()=>_})}keyof(){return ke(l.objectKeys(this.shape))}}bt.create=(j,c)=>new bt({shape:()=>j,unknownKeys:"strip",catchall:ht.create(),typeName:Zt.ZodObject,...m(c)}),bt.strictCreate=(j,c)=>new bt({shape:()=>j,unknownKeys:"strict",catchall:ht.create(),typeName:Zt.ZodObject,...m(c)}),bt.lazycreate=(j,c)=>new bt({shape:j,unknownKeys:"strip",catchall:ht.create(),typeName:Zt.ZodObject,...m(c)});class Gt extends lt{_parse(c){const{ctx:_}=this._processInputParams(c),z=this._def.options;if(_.common.async)return Promise.all(z.map(async tt=>{const Pt={..._,common:{..._.common,issues:[]},parent:null};return{result:await tt._parseAsync({data:_.data,path:_.path,parent:Pt}),ctx:Pt}})).then(function(tt){for(const kt of tt)if(kt.result.status==="valid")return kt.result;for(const kt of tt)if(kt.result.status==="dirty")return _.common.issues.push(...kt.ctx.common.issues),kt.result;const Pt=tt.map(kt=>new O(kt.ctx.common.issues));return A(_,{code:B.invalid_union,unionErrors:Pt}),y});{let tt;const Pt=[];for(const mt of z){const Lt={..._,common:{..._.common,issues:[]},parent:null},Nt=mt._parseSync({data:_.data,path:_.path,parent:Lt});if(Nt.status==="valid")return Nt;Nt.status!=="dirty"||tt||(tt={result:Nt,ctx:Lt}),Lt.common.issues.length&&Pt.push(Lt.common.issues)}if(tt)return _.common.issues.push(...tt.ctx.common.issues),tt.result;const kt=Pt.map(mt=>new O(mt));return A(_,{code:B.invalid_union,unionErrors:kt}),y}}get options(){return this._def.options}}Gt.create=(j,c)=>new Gt({options:j,typeName:Zt.ZodUnion,...m(c)});const oe=j=>j instanceof si?oe(j.schema):j instanceof Ne?oe(j.innerType()):j instanceof Ae?[j.value]:j instanceof xe?j.options:j instanceof he?Object.keys(j.enum):j instanceof Pi?oe(j._def.innerType):j instanceof F?[void 0]:j instanceof St?[null]:null;class jt extends lt{_parse(c){const{ctx:_}=this._processInputParams(c);if(_.parsedType!==C.object)return A(_,{code:B.invalid_type,expected:C.object,received:_.parsedType}),y;const z=this.discriminator,tt=_.data[z],Pt=this.optionsMap.get(tt);return Pt?_.common.async?Pt._parseAsync({data:_.data,path:_.path,parent:_}):Pt._parseSync({data:_.data,path:_.path,parent:_}):(A(_,{code:B.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[z]}),y)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(c,_,z){const tt=new Map;for(const Pt of _){const kt=oe(Pt.shape[c]);if(!kt)throw new Error(`A discriminator value for key \`${c}\` could not be extracted from all schema options`);for(const mt of kt){if(tt.has(mt))throw new Error(`Discriminator property ${String(c)} has duplicate value ${String(mt)}`);tt.set(mt,Pt)}}return new jt({typeName:Zt.ZodDiscriminatedUnion,discriminator:c,options:_,optionsMap:tt,...m(z)})}}function le(j,c){const _=Q(j),z=Q(c);if(j===c)return{valid:!0,data:j};if(_===C.object&&z===C.object){const tt=l.objectKeys(c),Pt=l.objectKeys(j).filter(mt=>tt.indexOf(mt)!==-1),kt={...j,...c};for(const mt of Pt){const Lt=le(j[mt],c[mt]);if(!Lt.valid)return{valid:!1};kt[mt]=Lt.data}return{valid:!0,data:kt}}if(_===C.array&&z===C.array){if(j.length!==c.length)return{valid:!1};const tt=[];for(let Pt=0;Pt<j.length;Pt++){const kt=le(j[Pt],c[Pt]);if(!kt.valid)return{valid:!1};tt.push(kt.data)}return{valid:!0,data:tt}}return _===C.date&&z===C.date&&+j==+c?{valid:!0,data:j}:{valid:!1}}class _e extends lt{_parse(c){const{status:_,ctx:z}=this._processInputParams(c),tt=(Pt,kt)=>{if(w(Pt)||w(kt))return y;const mt=le(Pt.value,kt.value);return mt.valid?((U(Pt)||U(kt))&&_.dirty(),{status:_.value,value:mt.data}):(A(z,{code:B.invalid_intersection_types}),y)};return z.common.async?Promise.all([this._def.left._parseAsync({data:z.data,path:z.path,parent:z}),this._def.right._parseAsync({data:z.data,path:z.path,parent:z})]).then(([Pt,kt])=>tt(Pt,kt)):tt(this._def.left._parseSync({data:z.data,path:z.path,parent:z}),this._def.right._parseSync({data:z.data,path:z.path,parent:z}))}}_e.create=(j,c,_)=>new _e({left:j,right:c,typeName:Zt.ZodIntersection,...m(_)});class de extends lt{_parse(c){const{status:_,ctx:z}=this._processInputParams(c);if(z.parsedType!==C.array)return A(z,{code:B.invalid_type,expected:C.array,received:z.parsedType}),y;if(z.data.length<this._def.items.length)return A(z,{code:B.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),y;!this._def.rest&&z.data.length>this._def.items.length&&(A(z,{code:B.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),_.dirty());const tt=[...z.data].map((Pt,kt)=>{const mt=this._def.items[kt]||this._def.rest;return mt?mt._parse(new G(z,Pt,z.path,kt)):null}).filter(Pt=>!!Pt);return z.common.async?Promise.all(tt).then(Pt=>p.mergeArray(_,Pt)):p.mergeArray(_,tt)}get items(){return this._def.items}rest(c){return new de({...this._def,rest:c})}}de.create=(j,c)=>{if(!Array.isArray(j))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new de({items:j,typeName:Zt.ZodTuple,rest:null,...m(c)})};class Oe extends lt{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(c){const{status:_,ctx:z}=this._processInputParams(c);if(z.parsedType!==C.object)return A(z,{code:B.invalid_type,expected:C.object,received:z.parsedType}),y;const tt=[],Pt=this._def.keyType,kt=this._def.valueType;for(const mt in z.data)tt.push({key:Pt._parse(new G(z,mt,z.path,mt)),value:kt._parse(new G(z,z.data[mt],z.path,mt))});return z.common.async?p.mergeObjectAsync(_,tt):p.mergeObjectSync(_,tt)}get element(){return this._def.valueType}static create(c,_,z){return new Oe(_ instanceof lt?{keyType:c,valueType:_,typeName:Zt.ZodRecord,...m(z)}:{keyType:zt.create(),valueType:c,typeName:Zt.ZodRecord,...m(_)})}}class Ke extends lt{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(c){const{status:_,ctx:z}=this._processInputParams(c);if(z.parsedType!==C.map)return A(z,{code:B.invalid_type,expected:C.map,received:z.parsedType}),y;const tt=this._def.keyType,Pt=this._def.valueType,kt=[...z.data.entries()].map(([mt,Lt],Nt)=>({key:tt._parse(new G(z,mt,z.path,[Nt,"key"])),value:Pt._parse(new G(z,Lt,z.path,[Nt,"value"]))}));if(z.common.async){const mt=new Map;return Promise.resolve().then(async()=>{for(const Lt of kt){const Nt=await Lt.key,ue=await Lt.value;if(Nt.status==="aborted"||ue.status==="aborted")return y;Nt.status!=="dirty"&&ue.status!=="dirty"||_.dirty(),mt.set(Nt.value,ue.value)}return{status:_.value,value:mt}})}{const mt=new Map;for(const Lt of kt){const Nt=Lt.key,ue=Lt.value;if(Nt.status==="aborted"||ue.status==="aborted")return y;Nt.status!=="dirty"&&ue.status!=="dirty"||_.dirty(),mt.set(Nt.value,ue.value)}return{status:_.value,value:mt}}}}Ke.create=(j,c,_)=>new Ke({valueType:c,keyType:j,typeName:Zt.ZodMap,...m(_)});class $e extends lt{_parse(c){const{status:_,ctx:z}=this._processInputParams(c);if(z.parsedType!==C.set)return A(z,{code:B.invalid_type,expected:C.set,received:z.parsedType}),y;const tt=this._def;tt.minSize!==null&&z.data.size<tt.minSize.value&&(A(z,{code:B.too_small,minimum:tt.minSize.value,type:"set",inclusive:!0,exact:!1,message:tt.minSize.message}),_.dirty()),tt.maxSize!==null&&z.data.size>tt.maxSize.value&&(A(z,{code:B.too_big,maximum:tt.maxSize.value,type:"set",inclusive:!0,exact:!1,message:tt.maxSize.message}),_.dirty());const Pt=this._def.valueType;function kt(Lt){const Nt=new Set;for(const ue of Lt){if(ue.status==="aborted")return y;ue.status==="dirty"&&_.dirty(),Nt.add(ue.value)}return{status:_.value,value:Nt}}const mt=[...z.data.values()].map((Lt,Nt)=>Pt._parse(new G(z,Lt,z.path,Nt)));return z.common.async?Promise.all(mt).then(Lt=>kt(Lt)):kt(mt)}min(c,_){return new $e({...this._def,minSize:{value:c,message:$.toString(_)}})}max(c,_){return new $e({...this._def,maxSize:{value:c,message:$.toString(_)}})}size(c,_){return this.min(c,_).max(c,_)}nonempty(c){return this.min(1,c)}}$e.create=(j,c)=>new $e({valueType:j,minSize:null,maxSize:null,typeName:Zt.ZodSet,...m(c)});class ii extends lt{constructor(){super(...arguments),this.validate=this.implement}_parse(c){const{ctx:_}=this._processInputParams(c);if(_.parsedType!==C.function)return A(_,{code:B.invalid_type,expected:C.function,received:_.parsedType}),y;function z(mt,Lt){return v({data:mt,path:_.path,errorMaps:[_.common.contextualErrorMap,_.schemaErrorMap,f(),V].filter(Nt=>!!Nt),issueData:{code:B.invalid_arguments,argumentsError:Lt}})}function tt(mt,Lt){return v({data:mt,path:_.path,errorMaps:[_.common.contextualErrorMap,_.schemaErrorMap,f(),V].filter(Nt=>!!Nt),issueData:{code:B.invalid_return_type,returnTypeError:Lt}})}const Pt={errorMap:_.common.contextualErrorMap},kt=_.data;if(this._def.returns instanceof Ii){const mt=this;return I(async function(...Lt){const Nt=new O([]),ue=await mt._def.args.parseAsync(Lt,Pt).catch(Ri=>{throw Nt.addIssue(z(Lt,Ri)),Nt}),hi=await Reflect.apply(kt,this,ue);return await mt._def.returns._def.type.parseAsync(hi,Pt).catch(Ri=>{throw Nt.addIssue(tt(hi,Ri)),Nt})})}{const mt=this;return I(function(...Lt){const Nt=mt._def.args.safeParse(Lt,Pt);if(!Nt.success)throw new O([z(Lt,Nt.error)]);const ue=Reflect.apply(kt,this,Nt.data),hi=mt._def.returns.safeParse(ue,Pt);if(!hi.success)throw new O([tt(ue,hi.error)]);return hi.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...c){return new ii({...this._def,args:de.create(c).rest(pt.create())})}returns(c){return new ii({...this._def,returns:c})}implement(c){return this.parse(c)}strictImplement(c){return this.parse(c)}static create(c,_,z){return new ii({args:c||de.create([]).rest(pt.create()),returns:_||pt.create(),typeName:Zt.ZodFunction,...m(z)})}}class si extends lt{get schema(){return this._def.getter()}_parse(c){const{ctx:_}=this._processInputParams(c);return this._def.getter()._parse({data:_.data,path:_.path,parent:_})}}si.create=(j,c)=>new si({getter:j,typeName:Zt.ZodLazy,...m(c)});class Ae extends lt{_parse(c){if(c.data!==this._def.value){const _=this._getOrReturnCtx(c);return A(_,{received:_.data,code:B.invalid_literal,expected:this._def.value}),y}return{status:"valid",value:c.data}}get value(){return this._def.value}}function ke(j,c){return new xe({values:j,typeName:Zt.ZodEnum,...m(c)})}Ae.create=(j,c)=>new Ae({value:j,typeName:Zt.ZodLiteral,...m(c)});class xe extends lt{_parse(c){if(typeof c.data!="string"){const _=this._getOrReturnCtx(c),z=this._def.values;return A(_,{expected:l.joinValues(z),received:_.parsedType,code:B.invalid_type}),y}if(this._def.values.indexOf(c.data)===-1){const _=this._getOrReturnCtx(c),z=this._def.values;return A(_,{received:_.data,code:B.invalid_enum_value,options:z}),y}return I(c.data)}get options(){return this._def.values}get enum(){const c={};for(const _ of this._def.values)c[_]=_;return c}get Values(){const c={};for(const _ of this._def.values)c[_]=_;return c}get Enum(){const c={};for(const _ of this._def.values)c[_]=_;return c}extract(c){return xe.create(c)}exclude(c){return xe.create(this.options.filter(_=>!c.includes(_)))}}xe.create=ke;class he extends lt{_parse(c){const _=l.getValidEnumValues(this._def.values),z=this._getOrReturnCtx(c);if(z.parsedType!==C.string&&z.parsedType!==C.number){const tt=l.objectValues(_);return A(z,{expected:l.joinValues(tt),received:z.parsedType,code:B.invalid_type}),y}if(_.indexOf(c.data)===-1){const tt=l.objectValues(_);return A(z,{received:z.data,code:B.invalid_enum_value,options:tt}),y}return I(c.data)}get enum(){return this._def.values}}he.create=(j,c)=>new he({values:j,typeName:Zt.ZodNativeEnum,...m(c)});class Ii extends lt{unwrap(){return this._def.type}_parse(c){const{ctx:_}=this._processInputParams(c);if(_.parsedType!==C.promise&&_.common.async===!1)return A(_,{code:B.invalid_type,expected:C.promise,received:_.parsedType}),y;const z=_.parsedType===C.promise?_.data:Promise.resolve(_.data);return I(z.then(tt=>this._def.type.parseAsync(tt,{path:_.path,errorMap:_.common.contextualErrorMap})))}}Ii.create=(j,c)=>new Ii({type:j,typeName:Zt.ZodPromise,...m(c)});class Ne extends lt{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Zt.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(c){const{status:_,ctx:z}=this._processInputParams(c),tt=this._def.effect||null,Pt={addIssue:kt=>{A(z,kt),kt.fatal?_.abort():_.dirty()},get path(){return z.path}};if(Pt.addIssue=Pt.addIssue.bind(Pt),tt.type==="preprocess"){const kt=tt.transform(z.data,Pt);return z.common.issues.length?{status:"dirty",value:z.data}:z.common.async?Promise.resolve(kt).then(mt=>this._def.schema._parseAsync({data:mt,path:z.path,parent:z})):this._def.schema._parseSync({data:kt,path:z.path,parent:z})}if(tt.type==="refinement"){const kt=mt=>{const Lt=tt.refinement(mt,Pt);if(z.common.async)return Promise.resolve(Lt);if(Lt instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return mt};if(z.common.async===!1){const mt=this._def.schema._parseSync({data:z.data,path:z.path,parent:z});return mt.status==="aborted"?y:(mt.status==="dirty"&&_.dirty(),kt(mt.value),{status:_.value,value:mt.value})}return this._def.schema._parseAsync({data:z.data,path:z.path,parent:z}).then(mt=>mt.status==="aborted"?y:(mt.status==="dirty"&&_.dirty(),kt(mt.value).then(()=>({status:_.value,value:mt.value}))))}if(tt.type==="transform"){if(z.common.async===!1){const kt=this._def.schema._parseSync({data:z.data,path:z.path,parent:z});if(!R(kt))return kt;const mt=tt.transform(kt.value,Pt);if(mt instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:_.value,value:mt}}return this._def.schema._parseAsync({data:z.data,path:z.path,parent:z}).then(kt=>R(kt)?Promise.resolve(tt.transform(kt.value,Pt)).then(mt=>({status:_.value,value:mt})):kt)}l.assertNever(tt)}}Ne.create=(j,c,_)=>new Ne({schema:j,typeName:Zt.ZodEffects,effect:c,...m(_)}),Ne.createWithPreprocess=(j,c,_)=>new Ne({schema:c,effect:{type:"preprocess",transform:j},typeName:Zt.ZodEffects,...m(_)});class ri extends lt{_parse(c){return this._getType(c)===C.undefined?I(void 0):this._def.innerType._parse(c)}unwrap(){return this._def.innerType}}ri.create=(j,c)=>new ri({innerType:j,typeName:Zt.ZodOptional,...m(c)});class gi extends lt{_parse(c){return this._getType(c)===C.null?I(null):this._def.innerType._parse(c)}unwrap(){return this._def.innerType}}gi.create=(j,c)=>new gi({innerType:j,typeName:Zt.ZodNullable,...m(c)});class Pi extends lt{_parse(c){const{ctx:_}=this._processInputParams(c);let z=_.data;return _.parsedType===C.undefined&&(z=this._def.defaultValue()),this._def.innerType._parse({data:z,path:_.path,parent:_})}removeDefault(){return this._def.innerType}}Pi.create=(j,c)=>new Pi({innerType:j,typeName:Zt.ZodDefault,defaultValue:typeof c.default=="function"?c.default:()=>c.default,...m(c)});class Ui extends lt{_parse(c){const{ctx:_}=this._processInputParams(c),z={..._,common:{..._.common,issues:[]}},tt=this._def.innerType._parse({data:z.data,path:z.path,parent:{...z}});return E(tt)?tt.then(Pt=>({status:"valid",value:Pt.status==="valid"?Pt.value:this._def.catchValue({get error(){return new O(z.common.issues)},input:z.data})})):{status:"valid",value:tt.status==="valid"?tt.value:this._def.catchValue({get error(){return new O(z.common.issues)},input:z.data})}}removeCatch(){return this._def.innerType}}Ui.create=(j,c)=>new Ui({innerType:j,typeName:Zt.ZodCatch,catchValue:typeof c.catch=="function"?c.catch:()=>c.catch,...m(c)});class ji extends lt{_parse(c){if(this._getType(c)!==C.nan){const _=this._getOrReturnCtx(c);return A(_,{code:B.invalid_type,expected:C.nan,received:_.parsedType}),y}return{status:"valid",value:c.data}}}ji.create=j=>new ji({typeName:Zt.ZodNaN,...m(j)});const Fi=Symbol("zod_brand");class Ms extends lt{_parse(c){const{ctx:_}=this._processInputParams(c),z=_.data;return this._def.type._parse({data:z,path:_.path,parent:_})}unwrap(){return this._def.type}}class Mi extends lt{_parse(c){const{status:_,ctx:z}=this._processInputParams(c);if(z.common.async)return(async()=>{const tt=await this._def.in._parseAsync({data:z.data,path:z.path,parent:z});return tt.status==="aborted"?y:tt.status==="dirty"?(_.dirty(),x(tt.value)):this._def.out._parseAsync({data:tt.value,path:z.path,parent:z})})();{const tt=this._def.in._parseSync({data:z.data,path:z.path,parent:z});return tt.status==="aborted"?y:tt.status==="dirty"?(_.dirty(),{status:"dirty",value:tt.value}):this._def.out._parseSync({data:tt.value,path:z.path,parent:z})}}static create(c,_){return new Mi({in:c,out:_,typeName:Zt.ZodPipeline})}}class Hi extends lt{_parse(c){const _=this._def.innerType._parse(c);return R(_)&&(_.value=Object.freeze(_.value)),_}}Hi.create=(j,c)=>new Hi({innerType:j,typeName:Zt.ZodReadonly,...m(c)});const Ls=(j,c={},_)=>j?gt.create().superRefine((z,tt)=>{var Pt,kt;if(!j(z)){const mt=typeof c=="function"?c(z):typeof c=="string"?{message:c}:c,Lt=(kt=(Pt=mt.fatal)!==null&&Pt!==void 0?Pt:_)===null||kt===void 0||kt,Nt=typeof mt=="string"?{message:mt}:mt;tt.addIssue({code:"custom",...Nt,fatal:Lt})}}):gt.create(),hr={object:bt.lazycreate};var Zt;(function(j){j.ZodString="ZodString",j.ZodNumber="ZodNumber",j.ZodNaN="ZodNaN",j.ZodBigInt="ZodBigInt",j.ZodBoolean="ZodBoolean",j.ZodDate="ZodDate",j.ZodSymbol="ZodSymbol",j.ZodUndefined="ZodUndefined",j.ZodNull="ZodNull",j.ZodAny="ZodAny",j.ZodUnknown="ZodUnknown",j.ZodNever="ZodNever",j.ZodVoid="ZodVoid",j.ZodArray="ZodArray",j.ZodObject="ZodObject",j.ZodUnion="ZodUnion",j.ZodDiscriminatedUnion="ZodDiscriminatedUnion",j.ZodIntersection="ZodIntersection",j.ZodTuple="ZodTuple",j.ZodRecord="ZodRecord",j.ZodMap="ZodMap",j.ZodSet="ZodSet",j.ZodFunction="ZodFunction",j.ZodLazy="ZodLazy",j.ZodLiteral="ZodLiteral",j.ZodEnum="ZodEnum",j.ZodEffects="ZodEffects",j.ZodNativeEnum="ZodNativeEnum",j.ZodOptional="ZodOptional",j.ZodNullable="ZodNullable",j.ZodDefault="ZodDefault",j.ZodCatch="ZodCatch",j.ZodPromise="ZodPromise",j.ZodBranded="ZodBranded",j.ZodPipeline="ZodPipeline",j.ZodReadonly="ZodReadonly"})(Zt||(Zt={}));const cr=(j,c={message:`Input not instance of ${j.name}`})=>Ls(_=>_ instanceof j,c),Rs=zt.create,zs=ae.create,Os=ji.create,dr=st.create,Ns=g.create,Gs=it.create,Us=ut.create,ee=F.create,ur=St.create,ni=gt.create,ge=pt.create,Ar=ht.create,Wi=ct.create,we=vt.create,ds=bt.create,gr=bt.strictCreate,us=Gt.create,Ei=jt.create,pr=_e.create,pi=de.create,Bi=Oe.create,Zi=Ke.create,As=$e.create,Yi=ii.create,js=si.create,qi=Ae.create,te=xe.create,Vi=he.create,gs=Ii.create,Li=Ne.create,ps=ri.create,fs=gi.create,Ti=Ne.createWithPreprocess,Si=Mi.create,_s=()=>Rs().optional(),ms=()=>zs().optional(),vs=()=>Ns().optional(),ws={string:j=>zt.create({...j,coerce:!0}),number:j=>ae.create({...j,coerce:!0}),boolean:j=>g.create({...j,coerce:!0}),bigint:j=>st.create({...j,coerce:!0}),date:j=>it.create({...j,coerce:!0})},ai=y;var li=Object.freeze({__proto__:null,defaultErrorMap:V,setErrorMap:L,getErrorMap:f,makeIssue:v,EMPTY_PATH:h,addIssueToContext:A,ParseStatus:p,INVALID:y,DIRTY:x,OK:I,isAborted:w,isDirty:U,isValid:R,isAsync:E,get util(){return l},get objectUtil(){return S},ZodParsedType:C,getParsedType:Q,ZodType:lt,ZodString:zt,ZodNumber:ae,ZodBigInt:st,ZodBoolean:g,ZodDate:it,ZodSymbol:ut,ZodUndefined:F,ZodNull:St,ZodAny:gt,ZodUnknown:pt,ZodNever:ht,ZodVoid:ct,ZodArray:vt,ZodObject:bt,ZodUnion:Gt,ZodDiscriminatedUnion:jt,ZodIntersection:_e,ZodTuple:de,ZodRecord:Oe,ZodMap:Ke,ZodSet:$e,ZodFunction:ii,ZodLazy:si,ZodLiteral:Ae,ZodEnum:xe,ZodNativeEnum:he,ZodPromise:Ii,ZodEffects:Ne,ZodTransformer:Ne,ZodOptional:ri,ZodNullable:gi,ZodDefault:Pi,ZodCatch:Ui,ZodNaN:ji,BRAND:Fi,ZodBranded:Ms,ZodPipeline:Mi,ZodReadonly:Hi,custom:Ls,Schema:lt,ZodSchema:lt,late:hr,get ZodFirstPartyTypeKind(){return Zt},coerce:ws,any:ni,array:we,bigint:dr,boolean:Ns,date:Gs,discriminatedUnion:Ei,effect:Li,enum:te,function:Yi,instanceof:cr,intersection:pr,lazy:js,literal:qi,map:Zi,nan:Os,nativeEnum:Vi,never:Ar,null:ur,nullable:fs,number:zs,object:ds,oboolean:vs,onumber:ms,optional:ps,ostring:_s,pipeline:Si,preprocess:Ti,promise:gs,record:Bi,set:As,strictObject:gr,string:Rs,symbol:Us,transformer:Li,tuple:pi,undefined:ee,union:us,unknown:ge,void:Wi,NEVER:ai,ZodIssueCode:B,quotelessJson:D,ZodError:O})},"./node_modules/zstddec/dist/zstddec.modern.js":(X,k,b)=>{let l,S,C;b.r(k),b.d(k,{ZSTDDecoder:()=>B});const Q={env:{emscripten_notify_memory_growth:function(O){C=new Uint8Array(S.exports.memory.buffer)}}};class B{init(){return l||(l=typeof fetch<"u"?fetch("data:application/wasm;base64,"+D).then(V=>V.arrayBuffer()).then(V=>WebAssembly.instantiate(V,Q)).then(this._init):WebAssembly.instantiate(Buffer.from(D,"base64"),Q).then(this._init),l)}_init(V){S=V.instance,Q.env.emscripten_notify_memory_growth(0)}decode(V,M=0){if(!S)throw new Error("ZSTDDecoder: Await .init() before decoding.");const L=V.byteLength,f=S.exports.malloc(L);C.set(V,f),M=M||Number(S.exports.ZSTD_findDecompressedSize(f,L));const v=S.exports.malloc(M),h=S.exports.ZSTD_decompress(v,M,f,L),A=C.slice(v,v+h);return S.exports.free(f),S.exports.free(v),A}}const D="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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"}},Z={};function Y(X){var k=Z[X];if(k!==void 0)return k.exports;var b=Z[X]={exports:{}};return q[X](b,b.exports,Y),b.exports}Y.n=X=>{var k=X&&X.__esModule?()=>X.default:()=>X;return Y.d(k,{a:k}),k},Y.d=(X,k)=>{for(var b in k)Y.o(k,b)&&!Y.o(X,b)&&Object.defineProperty(X,b,{enumerable:!0,get:k[b]})},Y.o=(X,k)=>Object.prototype.hasOwnProperty.call(X,k),Y.r=X=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(X,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(X,"__esModule",{value:!0})};var et={};return(()=>{Y.r(et),Y.d(et,{Decoder:()=>k.Decoder,Deprecated:()=>p,Ellipse:()=>B.Ellipse,ExcaliburTiledProperties:()=>b.ExcaliburTiledProperties,FLIPPED_DIAGONALLY_FLAG:()=>C.FLIPPED_DIAGONALLY_FLAG,FLIPPED_HORIZONTALLY_FLAG:()=>C.FLIPPED_HORIZONTALLY_FLAG,FLIPPED_VERTICALLY_FLAG:()=>C.FLIPPED_VERTICALLY_FLAG,FetchLoader:()=>l.FetchLoader,InsertedTile:()=>B.InsertedTile,LoaderCache:()=>Q.LoaderCache,PluginObject:()=>B.PluginObject,Point:()=>B.Point,Polygon:()=>B.Polygon,Polyline:()=>B.Polyline,Rectangle:()=>B.Rectangle,Template:()=>M.Template,TemplateObject:()=>B.TemplateObject,TemplateResource:()=>V.TemplateResource,Text:()=>B.Text,Tile:()=>A.Tile,TiledDataComponent:()=>L.TiledDataComponent,TiledLayerDataComponent:()=>f.TiledLayerDataComponent,TiledMap:()=>X.TiledMap,TiledParser:()=>X.TiledParser,TiledResource:()=>v.TiledResource,TiledTemplate:()=>X.TiledTemplate,TiledText:()=>X.TiledText,TiledTile:()=>X.TiledTile,TiledTileLayer:()=>X.TiledTileLayer,TiledTileLayerInfinite:()=>X.TiledTileLayerInfinite,TiledTileset:()=>X.TiledTileset,TiledTilesetFile:()=>X.TiledTilesetFile,Tileset:()=>A.Tileset,TilesetResource:()=>h.TilesetResource,byClassCaseInsensitive:()=>S.byClassCaseInsensitive,byNameCaseInsensitive:()=>S.byNameCaseInsensitive,byPropertyCaseInsensitive:()=>S.byPropertyCaseInsensitive,filenameFromPath:()=>D.filenameFromPath,getCanonicalGid:()=>C.getCanonicalGid,isCSV:()=>X.isCSV,isFlippedDiagonally:()=>C.isFlippedDiagonally,isFlippedHorizontally:()=>C.isFlippedHorizontally,isFlippedVertically:()=>C.isFlippedVertically,isInfiniteLayer:()=>X.isInfiniteLayer,isTiledTilesetCollectionOfImages:()=>X.isTiledTilesetCollectionOfImages,isTiledTilesetEmbedded:()=>X.isTiledTilesetEmbedded,isTiledTilesetExternal:()=>X.isTiledTilesetExternal,isTiledTilesetSingleImage:()=>X.isTiledTilesetSingleImage,mapPath:()=>D.mapPath,mapProps:()=>O.mapProps,needsDecoding:()=>X.needsDecoding,parseObject:()=>B.parseObject,parseObjects:()=>B.parseObjects,pathInMap:()=>D.pathInMap,pathRelativeToBase:()=>D.pathRelativeToBase});var X=Y("./src/parser/tiled-parser.ts"),k=Y("./src/resource/decoder.ts"),b=Y("./src/resource/excalibur-properties.ts"),l=Y("./src/resource/file-loader.ts"),S=Y("./src/resource/filter-util.ts"),C=Y("./src/resource/gid-util.ts"),Q=(Y("./src/resource/layer.ts"),Y("./src/resource/loader-cache.ts")),B=Y("./src/resource/objects.ts"),D=Y("./src/resource/path-util.ts"),O=Y("./src/resource/properties.ts"),V=Y("./src/resource/template-resource.ts"),M=Y("./src/resource/template.ts"),L=Y("./src/resource/tiled-data-component.ts"),f=Y("./src/resource/tiled-layer-component.ts"),v=Y("./src/resource/tiled-resource.ts"),h=Y("./src/resource/tileset-resource.ts"),A=Y("./src/resource/tileset.ts"),p=Y("./src/deprecated.ts")})(),et})())})(Jo);var HA=Jo.exports;const Wt={Fish:new Jt("images/fish.png"),Startdialogue:new Jt("images/startdialogue.png"),StartScreen:new Jt("images/startscreen.png"),GoodEndScreen:new Jt("images/good-endscreen.png"),BadEndScreen:new Jt("images/badending.png"),Endscreen:new Jt("images/endscreen.png"),Backbutton:new Jt("images/backbutton.png"),Congratulations:new Jt("images/congratulations.png"),Youdidit:new Jt("images/youdidit.png"),Map:new HA.TiledResource("map/tilemap.tmx"),PlayerM:new Jt("images/mees-mystkeeper.png"),PlayerF:new Jt("images/alice-mystkeeper.png"),Wout:new Jt("images/boswachter-wout.png"),Dirk:new Jt("images/dirk-zeebries.png"),Elara:new Jt("images/elara-mystveil.png"),Lithorock:new Jt("images/lithorock.png"),Themesong:new qo("sounds/themesong.mp3"),Earthartifact:new Jt("images/earthartifact.png"),Waterartifact:new Jt("images/waterartifact.png"),Rockartifact:new Jt("images/rockartifact.png"),Mysteryartifact:new Jt("images/mysteryartifact.png"),WoutBG:new Jt("images/woutbg.png"),ML1:new Jt("images/characters/ML1.png"),ML2:new Jt("images/characters/ML2.png"),ML3:new Jt("images/characters/ML3.png"),MR1:new Jt("images/characters/MR1.png"),MR2:new Jt("images/characters/MR2.png"),MR3:new Jt("images/characters/MR3.png"),MF1:new Jt("images/characters/MF1.png"),MF2:new Jt("images/characters/MF2.png"),MF3:new Jt("images/characters/MF3.png"),MB1:new Jt("images/characters/MB1.png"),MB2:new Jt("images/characters/MB2.png"),MB3:new Jt("images/characters/MB3.png"),FL1:new Jt("images/characters/FL1.png"),FL2:new Jt("images/characters/FL2.png"),FL3:new Jt("images/characters/FL3.png"),FR1:new Jt("images/characters/FR1.png"),FR2:new Jt("images/characters/FR2.png"),FR3:new Jt("images/characters/FR3.png"),FF1:new Jt("images/characters/FF1.png"),FF2:new Jt("images/characters/FF2.png"),FF3:new Jt("images/characters/FF3.png"),FB1:new Jt("images/characters/FB1.png"),FB2:new Jt("images/characters/FB2.png"),FB3:new Jt("images/characters/FB3.png")},Ko=new Yo;for(let rt of Object.values(Wt))Ko.addResource(rt);class WA extends Ci{onActivate(ot){const d=new hs({image:Wt.StartScreen,destSize:{width:1280,height:720}}),W=new qt({pos:new Ft(640,360),width:1280,height:720});W.graphics.use(d),this.add(W),this.startLabel=new Be({text:'Press "Start"',pos:new Ft(470,325),color:Yt.Orange,font:new Ee({size:50,bold:!0})}),this.startLabel.on("pointerup",()=>{this.engine.goToScene("startdialogue")}),this.add(this.startLabel),Wt.Themesong.stop(),Wt.Themesong.play(),Wt.Themesong.loop=!0}onPreUpdate(ot){ot.input.gamepads.at(0).isButtonPressed(Rr.Start)&&this.engine.goToScene("startdialogue")}}class ZA extends Ci{constructor(){super(),this.currentDialogueIndex=0,this.bg=null;const ot=new hs({image:Wt.Startdialogue,destSize:{width:1280,height:720}});this.bg=new qt({pos:new Ft(640,360),width:1280,height:720}),this.bg.graphics.use(ot),this.add(this.bg);const d=new Date,W=new Date(d.getTime()+10*6e4),q=String(W.getHours()).padStart(2,"0"),Z=String(W.getMinutes()).padStart(2,"0");this.deadlineTime=`${q}:${Z}`,this.dialogues=[{name:"Mysterieuze Stem",text:"Hier ben ik, in de wind die fluistert, in het water dat stroomt... Jij bent uitverkoren."},{name:"Mysterieuze Stem",text:"Je bent gekomen omdat je geroepen werd. Er rust een taak op jouw schouders, een taak van groot belang."},{name:"Mysterieuze Stem",text:"Je moet vier artefacten vinden, verborgen rondom deze wateren en bossen. Ze zijn sleutels tot het voorkomen van het einde."},{name:"Mysterieuze Stem",text:"Je zult begrijpen wanneer de tijd rijp is. Vind het, en de weg zal zich vervolgen."},{name:"Mysterieuze Stem",text:"Die antwoorden komen als je gehoor geeft aan de roep van het onbekende."},{name:"Mysterieuze Stem",text:`Het einde zal zich ergens plaatsvinden rond ${this.deadlineTime}. Dus ongeveer 10 minuten vanaf nu.`},{name:"Mysterieuze Stem",text:"(Note: dialogue neemt geen tijd in beslag)"},{name:"Mysterieuze Stem",text:"Ga reiziger, ontdek en voorkom het einde."}],this.startDialogueScreen=new hs({image:Wt.Startdialogue,destSize:{width:1280,height:720}});const Y=new qt({pos:new Ft(640,360),width:1280,height:720});Y.graphics.use(this.startDialogueScreen),this.add(Y)}onInitialize(ot){super.onInitialize(ot),this.engine=ot,this.createNameBox(),this.showCurrentDialogue(),console.log(this.engine),ot.input.keyboard.on("press",d=>{d.key===Kt.Keys.Space&&this.nextDialogue()})}onPreUpdate(ot,d){super.onPreUpdate(ot,d);const W=ot.input.gamepads.at(0);W&&W.isButtonPressed(Kt.Buttons.Face1)&&!this.gamepadCooldown&&(this.nextDialogue(),this.gamepadCooldown=!0,setTimeout(()=>{this.gamepadCooldown=!1},400))}createNameBox(){this.nameBox&&this.nameBox.kill(),this.nameLabel&&this.nameLabel.kill();const ot=this.dialogues[this.currentDialogueIndex].name,d=new qt({pos:new Ft(450,510),width:ot.length*11+26,height:46,color:Yt.White});this.add(d),this.nameBox=new qt({pos:new Ft(450,510),width:ot.length*11+20,height:40,color:Yt.Black}),this.add(this.nameBox),this.nameLabel=new Be({text:ot,pos:new Ft(375,500),font:new Ee({size:20,family:"Arial"}),color:Yt.White}),this.add(this.nameLabel)}showCurrentDialogue(){const d=this.dialogues[this.currentDialogueIndex].text,W=600,q=this.splitTextIntoLines(d,W);let Z=550;const Y=25,et=q.length*Y+40,X=W+40,k=Z-20,b=new qt({pos:new Ft(650,k+et/2),width:X+6,height:et+6,color:Yt.White});this.add(b);const l=new qt({pos:new Ft(650,k+et/2),width:X,height:et,color:Yt.Black});this.add(l),q.forEach(S=>{if(S.includes(this.deadlineTime)){const C=S.split(this.deadlineTime),Q=C[0],B=C[1],D=new Be({text:Q,pos:new Ft(375,Z),font:new Ee({size:20,family:"Arial"}),color:Yt.White}),O=new Be({text:this.deadlineTime,pos:new Ft(768,Z),font:new Ee({size:20,family:"Arial"}),color:Yt.Red}),V=new Be({text:B,pos:new Ft(817,Z),font:new Ee({size:20,family:"Arial"}),color:Yt.White});this.add(D),this.add(O),this.add(V)}else{const C=new Be({text:S,pos:new Ft(375,Z),font:new Ee({size:20,family:"Arial"}),color:Yt.White});this.add(C)}Z+=Y})}splitTextIntoLines(ot,d){const W=ot.split(" "),q=[];let Z=W[0];for(let Y=1;Y<W.length;Y++){const et=W[Y];this.getTextWidth(Z+" "+et)<d?Z+=" "+et:(q.push(Z),Z=et)}return q.push(Z),q}getTextWidth(ot){return ot.length*10}nextDialogue(){this.actors.forEach(ot=>{ot!==this.nameBox&&ot!==this.nameLabel&&ot!==this.bg&&ot.kill()}),this.currentDialogueIndex++,this.currentDialogueIndex<this.dialogues.length?(this.createNameBox(),this.showCurrentDialogue()):(this.engine.input.keyboard.off("press"),this.engine.goToScene("map"))}}class YA extends Ci{constructor(){super();ne(this,"choiseOption",!1);ne(this,"dialogue",1);ne(this,"options",1);ne(this,"enddialogue",1);ne(this,"showdialogue",1);this.currentDialogueIndex=0,this.choiceMade=!1,this.dialogues=[{name:"Elara Mystveil?",text:"Hé, jij daar! Mijn naam is Elara Mystveil..."},{name:"Elara Mystveil?",text:"Denk ik."},{name:"Elara Mystveil?",text:"Wat een toeval dat je hier bent."},{name:"Elara Mystveil?",text:"Ik bedoel, ik denk dat het toeval is."},{name:"Elara Mystveil?",text:"Of niet?"},{name:"Elara Mystveil?",text:"Wie weet."}],this.respawnCoordinates={x:183,y:526},this.lastButtonPressTime=0,this.cooldown=1e3}onInitialize(d){super.onInitialize(d),this.showCurrentDialogue(),d.input.keyboard.on("press",W=>{W.key===Kt.Keys.Space&&(this.currentDialogueIndex<this.dialogues.length-1?this.nextDialogue():(this.removeDialogues(),this.choiceMade||this.showChoiceOptions1()))})}onPreUpdate(d,W,q){super.onPreUpdate(d,W);const Z=d.input.gamepads.at(0),Y=Date.now();if(Z&&Z.isButtonPressed(Kt.Buttons.Face1)&&!this.gamepadCooldown&&(this.currentDialogueIndex<this.dialogues.length-1?(this.nextDialogue(),this.gamepadCooldown=!0,console.log("Face1 Pressed"),setTimeout(()=>{this.gamepadCooldown=!1},400)):(this.removeDialogues(),console.log("else"),(!this.choiceMade||!this.gamepadCooldown)&&(this.OptionSelection(),setTimeout(()=>{this.gamepadCooldown=!1},400)))),Z&&(Z.isButtonPressed(Kt.Buttons.Face2)||Z.isButtonPressed(Kt.Buttons.Face3)||Z.isButtonPressed(Kt.Buttons.Face4)&&this.choiseOption==!0&&!this.gamepadCooldown)&&Y-this.lastButtonPressTime>this.cooldown){this.lastButtonPressTime=Y,this.dialogue++,this.removeDialogues(),this.choiceMade=!0;const et=`showDialogue${this.dialogue}`;typeof this[et]=="function"&&!this.gamepadCooldown?this[et]():this.gamepadCooldown||(this.endDialogueScene(),console.warn(`Method ${et} does not exist`))}}OptionSelection(){this.gamepadCooldown||(this.gamepadCooldown=!0,this.enddialogue==1?(console.log(this.dialogue),this.enddialogue++,this.showChoiceOptions1(),console.log("showChoiceOptions1")):this.enddialogue==2?(console.log(this.dialogue),this.enddialogue++,this.showChoiceOptions2(),console.log("showChoiceOptions2")):this.enddialogue==3?(console.log(this.dialogue),this.enddialogue++,this.showChoiceOptions3(),console.log("showChoiceOptions3")):this.enddialogue==4?(console.log(this.dialogue),this.enddialogue++,this.showChoiceOptions4(),console.log("showChoiceOptions4")):this.enddialogue==5?(console.log(this.dialogue),this.enddialogue++,this.showChoiceOptions5(),console.log("showChoiceOptions5")):this.enddialogue==6?(console.log(this.dialogue),this.enddialogue++,this.showChoiceOptions6(),console.log("showChoiceOptions6")):this.enddialogue==7?(console.log(this.dialogue),this.enddialogue++,this.showChoiceOptions7(),console.log("showChoiceOptions7")):this.enddialogue==8?(console.log(this.dialogue),this.enddialogue++,this.showChoiceOptions8(),console.log("showChoiceOptions8")):this.endDialogueScene(),setTimeout(()=>{this.gamepadCooldown=!1},400))}createDialogueBox(d,W){const Z=this.splitTextIntoLines(d,600);let Y=550;const et=25,X=Z.length*et+40,k=640,b=Y-20,l=new qt({pos:new Ft(650,b+X/2),width:k+6,height:X+6,color:Yt.White});this.add(l);const S=new qt({pos:new Ft(650,b+X/2),width:k,height:X,color:Yt.Black});this.add(S),Z.forEach(C=>{const Q=new Be({text:C,pos:new Ft(375,Y),font:new Ee({size:20,family:"Arial"}),color:Yt.White});this.add(Q),Y+=et}),this.createNameBox(W)}createNameBox(d){this.nameBox&&this.nameBox.kill(),this.nameLabel&&this.nameLabel.kill();const W=d.length*11+20,q=540-W/2,Z=new qt({pos:new Ft(q,507),width:W+6,height:46,color:Yt.White});this.add(Z),this.nameBox=new qt({pos:new Ft(q,507),width:W,height:40,color:Yt.Black}),this.add(this.nameBox),this.nameLabel=new Be({text:d,pos:new Ft(375,497),font:new Ee({size:20,family:"Arial"}),color:Yt.White}),this.add(this.nameLabel)}showCurrentDialogue(){this.removeDialogues();const d=this.dialogues[this.currentDialogueIndex];this.createDialogueBox(d.text,d.name)}splitTextIntoLines(d,W){const q=d.split(" "),Z=[];let Y=q[0];for(let et=1;et<q.length;et++){const X=q[et];this.getTextWidth(Y+" "+X)<W?Y+=" "+X:(Z.push(Y),Y=X)}return Z.push(Y),Z}getTextWidth(d){return d.length*10}nextDialogue(){this.currentDialogueIndex<this.dialogues.length-1?(this.currentDialogueIndex++,this.showCurrentDialogue()):this.dialogues.length>this.currentDialogueIndex+1||(this.choiceMade||this.showChoiceOptions1(),this.removeDialogues())}showChoiceOptions1(){this.removeDialogues();const d=["Toeval is een vreemd iets. Soms vind ik koekjes in mijn zak waarvan ik zeker weet dat ik ze er niet gestopt heb.","Misschien is het lot. Of gewoon een goede timing. Wie zal het zeggen?","Ik ben hier eigenlijk omdat mijn kaart verdwaald is. Maar misschien is dat ook toeval."];this.showOptions(d,this.showDialogue2)}showOptions(d,W){this.choiseOption=!0;let q=500;const Z=650,Y=2,et=10,X=[["❑","X"],["Δ","Y"],["O","B"]];d.forEach((k,b)=>{let l=X[b%X.length],S=`${l[0]} / ${l[1]} `;b===0||b===1||b===2?S+=this.wrapText(k,Z):S+=k;const C=this.getTextHeight(S,Z);new qt({pos:new Ft(375,q+C/2),width:Z+et*2,height:C+et*2,color:Yt.Black});const Q=new qt({pos:new Ft(650,q+C/2),width:Z+et*2+Y*2,height:C+et*2+Y*2,color:Yt.White,anchor:Ft.Half}),B=new qt({pos:new Ft(650,q+C/2),width:Z+et*2,height:C+et*2,color:Yt.Black}),D=new Be({text:S,pos:new Ft(330,q),font:new Ee({size:20,family:"Arial"}),color:Yt.White});D.on("pointerdown",()=>{this.removeDialogues(),this.choiceMade=!0,W.call(this)}),this.add(Q),this.add(B),this.add(D),q+=C+et*2+Y*2})}wrapText(d,W){const q=d.split(" ");let Z="",Y=[];return q.forEach(et=>{this.getTextWidth(Z+" "+et)<W?Z+=" "+et:(Y.push(Z),Z=et)}),Y.push(Z),Y.join(`
`)}getTextHeight(d,W){return d.split(`
`).length*25}removeDialogues(){this.actors.forEach(d=>{d.kill()})}showDialogue2(){this.choiceMade=!1,this.dialogues=[{name:"Elara Mystveil?",text:"Luister, ik heb gehoord dat je op zoek bent naar wat informatie over het Mystery Artifact, toch?"}],this.currentDialogueIndex=0,this.showCurrentDialogue(),this.engine.input.keyboard.off("press"),this.engine.input.keyboard.on("press",d=>{d.key===Kt.Keys.Space&&(this.currentDialogueIndex<this.dialogues.length-1?this.nextDialogue():this.choiceMade||this.showChoiceOptions2())})}showChoiceOptions2(){this.removeDialogues();const d=["Eerlijk gezegd wist ik niet eens dat ik op zoek was, maar laten we gaan met 'ja'.","Ja, ik zoek wat hints over dat mysterieuze ding.","Inderdaad, ik probeer wat meer te weten te komen over dat Artifact."];this.showOptions(d,this.showDialogue3)}showDialogue3(){this.choiceMade=!1,this.dialogues=[{name:"Elara Mystveil?",text:"Het Mystery Artifact..."},{name:"Elara Mystveil?",text:"Het is best wel een raar ding."},{name:"Elara Mystveil?",text:"Weet je."},{name:"Elara Mystveil?",text:"En oud."},{name:"Elara Mystveil?",text:"Echt oud."},{name:"Elara Mystveil?",text:"Alsof het uit een tijd komt waar zelfs de bomen nog baby's waren."}],this.currentDialogueIndex=0,this.showCurrentDialogue(),this.engine.input.keyboard.off("press"),this.engine.input.keyboard.on("press",d=>{d.key===Kt.Keys.Space&&(this.currentDialogueIndex<this.dialogues.length-1?this.nextDialogue():this.choiceMade||this.showChoiceOptions3())})}showChoiceOptions3(){this.removeDialogues();const d=["Raar en oud klinkt intrigerend. Heb je ooit een oudere boom dan een babyboom gezien?","Oud en raar... net als mijn favoriete sokken. Maar laten we het hebben over dat Artifact.","Ik heb altijd al een ding voor mysterieuze, oude voorwerpen gehad. Vertel me meer!"];this.showOptions(d,this.showDialogue4)}showDialogue4(){this.choiceMade=!1,this.dialogues=[{name:"Elara Mystveil?",text:"Eh ja oke."},{name:"Elara Mystveil?",text:"Dus, wat wil je weten?"}],this.currentDialogueIndex=0,this.showCurrentDialogue(),this.engine.input.keyboard.off("press"),this.engine.input.keyboard.on("press",d=>{d.key===Kt.Keys.Space&&(this.currentDialogueIndex<this.dialogues.length-1?this.nextDialogue():this.choiceMade||this.showChoiceOptions4())})}showChoiceOptions4(){this.removeDialogues();const d=["Heeft het Artifact speciale eigenschappen waarvan we moeten weten?","Waar werd het Mystery Artifact precies gevonden? Misschien moet ik daar eens gaan kijken.","Vertel me, heeft het Mystery Artifact echt de kracht om de tijd te beïnvloeden?"];this.showOptions(d,this.showDialogue5)}showDialogue5(){this.choiceMade=!1,this.dialogues=[{name:"Elara Mystveil?",text:"Oh, wacht, voordat je begint..."},{name:"Elara Mystveil?",text:"Heb je ooit gemerkt hoe wolken soms lijken op draken?"},{name:"Elara Mystveil?",text:"Of ligt dat aan mij?"}],this.currentDialogueIndex=0,this.showCurrentDialogue(),this.engine.input.keyboard.off("press"),this.engine.input.keyboard.on("press",d=>{d.key===Kt.Keys.Space&&(this.currentDialogueIndex<this.dialogues.length-1?this.nextDialogue():this.choiceMade||this.showChoiceOptions5())})}showChoiceOptions5(){this.removeDialogues();const d=["Drakenwolken? Misschien heb je gelijk. Maar laten we teruggaan naar het Mystery Artifact.","Nu je het zegt, soms lijken ze inderdaad op draken. Misschien zijn het wel drakenwolken.","Ik heb altijd gedacht dat ze meer op gigantische kippen leken, maar draken klinken cooler."];this.showOptions(d,this.showDialogue6)}showDialogue6(){this.choiceMade=!1,this.dialogues=[{name:"Elara Mystveil?",text:"Sorry, afdwalen."},{name:"Elara Mystveil?",text:"Dus, het Mystery Artifact."},{name:"Elara Mystveil?",text:"Ja, dat ding."},{name:"Elara Mystveil?",text:"Waar zal ik beginnen?"}],this.currentDialogueIndex=0,this.showCurrentDialogue(),this.engine.input.keyboard.off("press"),this.engine.input.keyboard.on("press",d=>{d.key===Kt.Keys.Space&&(this.currentDialogueIndex<this.dialogues.length-1?this.nextDialogue():this.choiceMade||this.showChoiceOptions6())})}showChoiceOptions6(){this.removeDialogues();const d=["Ah, begin maar bij het begin. Hoe werd het Artifact ontdekt?","Heb je zelf ooit interactie gehad met het Artifact?","Vertel me meer over de krachten van het Mystery Artifact."];this.showOptions(d,this.showDialogue7)}showDialogue7(){this.choiceMade=!1,this.dialogues=[{name:"Elara Mystveil?",text:"Ah ja, ooit, lang geleden, toen de wereld nog jong was..."},{name:"Elara Mystveil?",text:"Of misschien niet zo jong,"},{name:"Elara Mystveil?",text:"Wie weet eigenlijk,"},{name:"Elara Mystveil?",text:"Werd het Mystery Artifact ontdekt door..."},{name:"Elara Mystveil?",text:"Eh, door iemand."},{name:"Elara Mystveil?",text:"Ja, door iemand met avontuurlijke handen"},{name:"Elara Mystveil?",text:"Denk ik."},{name:"Elara Mystveil?",text:"..."},{name:"Elara Mystveil?",text:"Het was een hele ontdekking, geloof me."},{name:"Elara Mystveil?",text:"Verborgen diep onder de wortels van een oude boom, in een grot vol..."},{name:"Elara Mystveil?",text:"Nou ja,"},{name:"Elara Mystveil?",text:"Mysteries,"},{name:"Elara Mystveil?",text:"Denk ik."},{name:"Elara Mystveil?",text:"..."},{name:"Elara Mystveil?",text:"Maar goed, genoeg over de ontdekking."},{name:"Elara Mystveil?",text:"Het belangrijkste is dat het ding krachten heeft."},{name:"Elara Mystveil?",text:"Grote, enge krachten."},{name:"Elara Mystveil?",text:"Soms denk ik dat het Artifact zelf niet eens weet wat het doet."},{name:"Elara Mystveil?",text:"Het ligt hier gewoon rond te hangen,"},{name:"Elara Mystveil?",text:"Weet je,"},{name:"Elara Mystveil?",text:"Alsof het wacht op een goede gelegenheid om iets te doen."},{name:"Elara Mystveil?",text:"Heb je ooit iets gehad dat gewoon..."},{name:"Elara Mystveil?",text:"Rondhangt en wacht?"},{name:"Elara Mystveil?",text:"Nee?"},{name:"Elara Mystveil?",text:"Misschien ben ik gewoon raar."},{name:"Elara Mystveil?",text:"..."},{name:"Elara Mystveil?",text:"Hoe dan ook, mensen zeggen dat het Mystery Artifact mysterieuze dingen kan doen."},{name:"Elara Mystveil?",text:"Zoals de tijd buigen, de ruimte verdraaien, en misschien zelfs je sokken laten verdwijnen als je niet oppast."},{name:"Elara Mystveil?",text:"Maar wie gelooft er nu in legendes, toch?"},{name:"Elara Mystveil?",text:"Dus ja, dat is het verhaal van het Mystery Artifact."},{name:"Elara Mystveil?",text:"Spannend, hè?"},{name:"Elara Mystveil?",text:"Oh kijk..."},{name:"Elara Mystveil?",text:"Een eekhoorn!"},{name:"Elara Mystveil?",text:"Waar waren we ook alweer?"}],this.currentDialogueIndex=0,this.showCurrentDialogue(),this.engine.input.keyboard.off("press"),this.engine.input.keyboard.on("press",d=>{d.key===Kt.Keys.Space&&(this.currentDialogueIndex<this.dialogues.length-1?this.nextDialogue():this.choiceMade||this.showChoiceOptions7())})}showChoiceOptions7(){this.removeDialogues();const d=["We waren verdwaald in het verhaal van het Mystery Artifact, geloof ik.","Ik denk dat we bij het deel waren waar je mysterieus verdwijnt, toch?","Eekhoorns zijn echt meesters in het verstoren van gesprekken, nietwaar?"];this.showOptions(d,this.showDialogue8)}showDialogue8(){this.choiceMade=!1,this.dialogues=[{name:"Elara Mystveil?",text:"Hoe dan ook, als je nog meer wilt weten..."},{name:"Elara Mystveil?",text:"Nou ja..."},{name:"Elara Mystveil?",text:"Dan moet je maar verder zoeken."},{name:"Elara Mystveil?",text:"Of niet."},{name:"Elara Mystveil?",text:"Het is jouw avontuur, toch?"}],this.currentDialogueIndex=0,this.showCurrentDialogue(),this.engine.input.keyboard.off("press"),this.engine.input.keyboard.on("press",d=>{d.key===Kt.Keys.Space&&(this.currentDialogueIndex<this.dialogues.length-1?this.nextDialogue():this.choiceMade||this.showChoiceOptions8())})}showChoiceOptions8(){this.removeDialogues();const d=["Misschien kom ik je later weer tegen. Bedankt voor je hulp, Elara!","Ik denk dat ik verder op onderzoek ga. Bedankt voor alle info!","Ik zal zeker verder op ontdekking gaan. Tot ziens, Elara!"];this.showOptions(d,this.showDialogue9)}showDialogue9(){this.choiceMade=!1,this.dialogues=[{name:"Elara Mystveil?",text:"Nou, ik denk dat ik maar weer eens verdwijn, net als die eekhoorn."},{name:"Elara Mystveil?",text:"Misschien kom ik je later weer tegen,"},{name:"Elara Mystveil?",text:"Wie weet?"},{name:"Elara Mystveil?",text:"Dag, avonturier!"},{name:"Elara Mystveil?",text:"En..."},{name:"Elara Mystveil?",text:"Eh..."},{name:"Elara Mystveil?",text:"Veel succes..."},{name:"Elara Mystveil?",text:"Denk ik..."}],this.currentDialogueIndex=0,this.showCurrentDialogue(),this.engine.input.keyboard.off("press"),this.engine.input.keyboard.on("press",d=>{d.key===Kt.Keys.Space&&(this.currentDialogueIndex<this.dialogues.length-1?this.nextDialogue():this.choiceMade||this.endDialogueScene())})}endDialogueScene(){const d=new Re;d.pos.x=this.respawnCoordinates.x,d.pos.y=this.respawnCoordinates.y,this.engine.input.keyboard.off("press"),this.engine.goToScene("map")}}class $o extends qt{constructor(){super({pos:new Ft(0,0),width:32,height:32,collisionType:cs.Fixed});const ot=lr.fromImageSource({image:Wt.Elara,grid:{rows:1,columns:2,spriteWidth:498,spriteHeight:504}}),d=[0,1],W=ar.fromSpriteSheet(ot,d,500);W.scale=new Ft(32/498,32/504),this.graphics.add("idle",W),this.graphics.use("idle")}onInitialize(ot){this.pos=new Ft(183,526),this.vel=new Ft(0,0)}onPreUpdate(ot){}}class ta extends qt{constructor(){super({pos:new Ft(0,0),width:32,height:32,collisionType:cs.Fixed});const ot=lr.fromImageSource({image:Wt.Wout,grid:{rows:1,columns:2,spriteWidth:498,spriteHeight:498}}),d=[0,1],W=ar.fromSpriteSheet(ot,d,500);W.scale=new Ft(32/498,32/498),this.graphics.add("idle",W),this.graphics.use("idle")}onInitialize(ot){this.pos=new Ft(1455,440),this.vel=new Ft(0,0)}onPreUpdate(ot){}}class ea extends qt{constructor(){super({pos:new Ft(0,0),width:32,height:32,collisionType:cs.Fixed});const ot=lr.fromImageSource({image:Wt.Dirk,grid:{rows:1,columns:2,spriteWidth:498,spriteHeight:498}}),d=[0,1],W=ar.fromSpriteSheet(ot,d,500);W.scale=new Ft(32/498,32/498),this.graphics.add("idle",W),this.graphics.use("idle")}onInitialize(ot){this.pos=new Ft(755,1280),this.vel=new Ft(0,0)}onPreUpdate(ot){}}class qA extends Ci{constructor(){super();ne(this,"choiseOption",!1);ne(this,"dialogue",1);ne(this,"options",1);ne(this,"enddialogue",1);ne(this,"showdialogue",1);this.currentDialogueIndex=0,this.choiceMade=!1,this.dialogues=[{name:"Wout de Boswachter",text:"Ah, daar ben je! Welkom in het Kralingse Bos. Mijn naam is Wout de Boswachter."},{name:"Wout de Boswachter",text:"Dit is een plek vol wonderen en mysteries. Heb je ooit gehoord van het Earth Artifact?"}],this.respawnCoordinates={x:1455,y:440},this.lastButtonPressTime=0,this.cooldown=1e3,this.WoutBGScreen=new hs({image:Wt.WoutBG,destSize:{width:1280,height:720}}),this.bg=new qt({pos:new Ft(640,360),width:1280,height:720}),this.bg.graphics.use(this.WoutBGScreen),this.add(this.bg)}onInitialize(d){super.onInitialize(d),this.showCurrentDialogue(),d.input.keyboard.on("press",W=>{W.key===Kt.Keys.Space&&(this.currentDialogueIndex<this.dialogues.length-1?this.nextDialogue():(this.removeDialogues(),this.choiceMade||this.showChoiceOptions1()))})}onPreUpdate(d,W,q){super.onPreUpdate(d,W);const Z=d.input.gamepads.at(0),Y=Date.now();if(Z&&Z.isButtonPressed(Kt.Buttons.Face1)&&!this.gamepadCooldown&&(this.currentDialogueIndex<this.dialogues.length-1?(this.nextDialogue(),this.gamepadCooldown=!0,console.log("Face1 Pressed"),setTimeout(()=>{this.gamepadCooldown=!1},400)):(this.removeDialogues(),console.log("else"),(!this.choiceMade||!this.gamepadCooldown)&&(this.OptionSelection(),setTimeout(()=>{this.gamepadCooldown=!1},400)))),Z&&(Z.isButtonPressed(Kt.Buttons.Face2)||Z.isButtonPressed(Kt.Buttons.Face3)||Z.isButtonPressed(Kt.Buttons.Face4)&&this.choiseOption==!0&&!this.gamepadCooldown)&&Y-this.lastButtonPressTime>this.cooldown){this.lastButtonPressTime=Y,this.dialogue++,this.removeDialogues(),this.choiceMade=!0;const et=`showDialogue${this.dialogue}`;typeof this[et]=="function"&&!this.gamepadCooldown?this[et]():this.gamepadCooldown||(this.endDialogueScene(),console.warn(`Method ${et} does not exist`))}}OptionSelection(){this.gamepadCooldown||(this.gamepadCooldown=!0,this.enddialogue==1?(console.log(this.dialogue),this.enddialogue++,this.showChoiceOptions1(),console.log("showChoiceOptions1")):this.enddialogue==2?(console.log(this.dialogue),this.enddialogue++,this.showChoiceOptions2(),console.log("showChoiceOptions2")):this.enddialogue==3?(console.log(this.dialogue),this.enddialogue++,this.showChoiceOptions3(),console.log("showChoiceOptions3")):this.enddialogue==4?(console.log(this.dialogue),this.enddialogue++,this.showChoiceOptions4(),console.log("showChoiceOptions4")):this.enddialogue==5?(console.log(this.dialogue),this.enddialogue++,this.showChoiceOptions5(),console.log("showChoiceOptions5")):this.endDialogueScene(),setTimeout(()=>{this.gamepadCooldown=!1},400))}createDialogueBox(d,W){const Z=this.splitTextIntoLines(d,600);let Y=550;const et=25,X=Z.length*et+40,k=640,b=Y-20,l=new qt({pos:new Ft(650,b+X/2),width:k+6,height:X+6,color:Yt.White});this.add(l);const S=new qt({pos:new Ft(650,b+X/2),width:k,height:X,color:Yt.Black});this.add(S),Z.forEach(C=>{const Q=new Be({text:C,pos:new Ft(375,Y),font:new Ee({size:20,family:"Arial"}),color:Yt.White});this.add(Q),Y+=et}),this.createNameBox(W)}createNameBox(d){this.nameBox&&this.nameBox.kill(),this.nameLabel&&this.nameLabel.kill();const W=d.length*11+20,q=575-W/2,Z=new qt({pos:new Ft(q,507),width:W+6,height:46,color:Yt.White});this.add(Z),this.nameBox=new qt({pos:new Ft(q,507),width:W,height:40,color:Yt.Black}),this.add(this.nameBox),this.nameLabel=new Be({text:d,pos:new Ft(375,497),font:new Ee({size:20,family:"Arial"}),color:Yt.White}),this.add(this.nameLabel)}showCurrentDialogue(){this.removeDialogues();const d=this.dialogues[this.currentDialogueIndex];this.createDialogueBox(d.text,d.name)}splitTextIntoLines(d,W){const q=d.split(" "),Z=[];let Y=q[0];for(let et=1;et<q.length;et++){const X=q[et];this.getTextWidth(Y+" "+X)<W?Y+=" "+X:(Z.push(Y),Y=X)}return Z.push(Y),Z}getTextWidth(d){return d.length*10}nextDialogue(){this.currentDialogueIndex<this.dialogues.length-1?(this.currentDialogueIndex++,this.showCurrentDialogue()):this.dialogues.length>this.currentDialogueIndex+1||(this.choiceMade||this.showChoiceOptions1(),this.removeDialogues())}showChoiceOptions1(){this.removeDialogues();const d=["Ja, ik heb erover gelezen! Vertel me er meer over.","Nee, wat is dat precies?","Huh wat? Aardappelgratin?"];this.showOptions(d,this.showDialogue2)}showOptions(d,W){this.choiseOption=!0;let q=500;const Z=650,Y=2,et=10,X=[["❑","X"],["Δ","Y"],["O","B"]];d.forEach((k,b)=>{let l=X[b%X.length],S=`${l[0]} / ${l[1]} `;b===0||b===1||b===2?S+=this.wrapText(k,Z):S+=k;const C=this.getTextHeight(S,Z);new qt({pos:new Ft(375,q+C/2),width:Z+et*2,height:C+et*2,color:Yt.Black});const Q=new qt({pos:new Ft(650,q+C/2),width:Z+et*2+Y*2,height:C+et*2+Y*2,color:Yt.White,anchor:Ft.Half}),B=new qt({pos:new Ft(650,q+C/2),width:Z+et*2,height:C+et*2,color:Yt.Black}),D=new Be({text:S,pos:new Ft(330,q),font:new Ee({size:20,family:"Arial"}),color:Yt.White});D.on("pointerdown",()=>{this.removeDialogues(),this.choiceMade=!0,W.call(this)}),this.add(Q),this.add(B),this.add(D),q+=C+et*2+Y*2})}wrapText(d,W){const q=d.split(" ");let Z="",Y=[];return q.forEach(et=>{this.getTextWidth(Z+" "+et)<W?Z+=" "+et:(Y.push(Z),Z=et)}),Y.push(Z),Y.join(`
`)}getTextHeight(d,W){return d.split(`
`).length*25}removeDialogues(){this.actors.forEach(d=>{d.kill()})}showDialogue2(){this.choiceMade=!1,this.dialogues=[{name:"Wout de Boswachter",text:"Het Earth Artifact is een eeuwenoud voorwerp, doordrenkt met de krachten van de aarde zelf."},{name:"Wout de Boswachter",text:"Het wordt gezegd dat het werd gemaakt door een oude beschaving die hier lang geleden woonde."},{name:"Wout de Boswachter",text:"Deze mensen waren diep verbonden met de natuur en gebruikten het artifact om de balans en harmonie van het bos te bewaren."},{name:"Wout de Boswachter",text:"Lang geleden, toen de mensen van deze beschaving merkten dat hun krachten afnamen, besloten ze hun kennis en magie op te sluiten in het Earth Artifact."},{name:"Wout de Boswachter",text:"Ze geloofden dat alleen degenen die waardig en in harmonie met de natuur waren, het zouden kunnen gebruiken."}],this.currentDialogueIndex=0,this.showCurrentDialogue(),this.engine.input.keyboard.off("press"),this.engine.input.keyboard.on("press",d=>{d.key===Kt.Keys.Space&&(this.currentDialogueIndex<this.dialogues.length-1?this.nextDialogue():this.choiceMade||this.showChoiceOptions2())})}showChoiceOptions2(){this.removeDialogues();const d=["Hoe kon deze beschaving zo’n krachtige artefact maken?","Dus een steen met glitters?","Wat gebeurde er met de beschaving die het maakte?"];this.showOptions(d,this.showDialogue3)}showDialogue3(){this.choiceMade=!1,this.dialogues=[{name:"Wout de Boswachter",text:"Deze beschaving was heel speciaal."},{name:"Wout de Boswachter",text:"Ze hadden een diep begrip van de natuur en haar krachten."},{name:"Wout de Boswachter",text:"Ze werkten samen met de elementen, gebruikten oude rituelen en kennis die nu verloren is gegaan."},{name:"Wout de Boswachter",text:"Het artifact was hun meesterwerk, een symbool van hun verbinding met de aarde."},{name:"Wout de Boswachter",text:"Helaas, zoals bij veel oude beschavingen, ging hun kennis verloren door de tijd."},{name:"Wout de Boswachter",text:"Sommigen zeggen dat ze werden opgeslokt door de natuur zelf, anderen geloven dat ze eenvoudigweg verdwenen."},{name:"Wout de Boswachter",text:"Maar hun nalatenschap leeft voort in het Earth Artifact."}],this.currentDialogueIndex=0,this.showCurrentDialogue(),this.engine.input.keyboard.off("press"),this.engine.input.keyboard.on("press",d=>{d.key===Kt.Keys.Space&&(this.currentDialogueIndex<this.dialogues.length-1?this.nextDialogue():this.choiceMade||this.showChoiceOptions3())})}showChoiceOptions3(){this.removeDialogues();const d=["Wat kan het artifact precies doen?","Is het te koop op Ebay?","Zijn er legenden over mensen die het artifact gebruikten?"];this.showOptions(d,this.showDialogue4)}showDialogue4(){this.choiceMade=!1,this.dialogues=[{name:"Wout de Boswachter",text:"Het Earth Artifact heeft de kracht om het evenwicht in de natuur te herstellen."},{name:"Wout de Boswachter",text:"Het kan gewassen laten groeien, ziektes genezen en zelfs het weer beïnvloeden."},{name:"Wout de Boswachter",text:"Maar de kracht komt niet zonder verantwoordelijkheid."},{name:"Wout de Boswachter",text:"Alleen degenen die pure intenties hebben en het welzijn van het bos vooropstellen, kunnen de volledige kracht van het artifact benutten."},{name:"Wout de Boswachter",text:"Er zijn verhalen van mensen die hebzuchtig waren en het artifact voor hun eigen gewin wilden gebruiken."},{name:"Wout de Boswachter",text:"Ze werden altijd afgestraft door de krachten van de natuur zelf."},{name:"Wout de Boswachter",text:"Het is een krachtige herinnering dat we respect moeten hebben voor de aarde en alles wat ze ons geeft."}],this.currentDialogueIndex=0,this.showCurrentDialogue(),this.engine.input.keyboard.off("press"),this.engine.input.keyboard.on("press",d=>{d.key===Kt.Keys.Space&&(this.currentDialogueIndex<this.dialogues.length-1?this.nextDialogue():this.choiceMade||this.showChoiceOptions4())})}showChoiceOptions4(){this.removeDialogues();const d=["Ik ben een bomenknuffelaar, is dat goed genoeg?","Zijn er recentelijk nog mensen geweest die het geprobeerd hebben?","Hoe weet je of iemand waardig is om het artifact te gebruiken?"];this.showOptions(d,this.showDialogue5)}showDialogue5(){this.choiceMade=!1,this.dialogues=[{name:"Wout de Boswachter",text:"Dat is een goede vraag."},{name:"Wout de Boswachter",text:"Er zijn oude rituelen en proeven die men moet doorstaan om de waardigheid te bewijzen."},{name:"Wout de Boswachter",text:"Deze rituelen zijn zorgvuldig bewaard gebleven door de boswachters en wijzen van het Kralingse Bos."},{name:"Wout de Boswachter",text:"Alleen zij kennen de geheimen en kunnen de testen afnemen."},{name:"Wout de Boswachter",text:"En ja, er zijn inderdaad mensen geweest die het geprobeerd hebben."},{name:"Wout de Boswachter",text:"Sommigen van hen hebben hun leven gewijd aan het beschermen van het bos, terwijl anderen faalden en de kracht van het artifact niet konden bevatten."},{name:"Wout de Boswachter",text:"Het blijft een mysterie wie echt waardig zal zijn."}],this.currentDialogueIndex=0,this.showCurrentDialogue(),this.engine.input.keyboard.off("press"),this.engine.input.keyboard.on("press",d=>{d.key===Kt.Keys.Space&&(this.currentDialogueIndex<this.dialogues.length-1?this.nextDialogue():this.choiceMade||this.showChoiceOptions5())})}showChoiceOptions5(){this.removeDialogues();const d=["Denk je dat ik het kan proberen?","Hoe word ik een van die beschermers van het bos?","Nog waardiger dan ik al ben?"];this.showOptions(d,this.showDialogue6)}showDialogue6(){this.choiceMade=!1,this.dialogues=[{name:"Wout de Boswachter",text:"Wie weet? Misschien zit het lot wel in jouw handen."},{name:"Wout de Boswachter",text:"Maar onthoud, het gaat niet om de kracht, maar om de intentie waarmee je handelt."},{name:"Wout de Boswachter",text:"Als je echt het bos en de natuur wilt beschermen, zou je wel eens waardig kunnen zijn."},{name:"Wout de Boswachter",text:"Het begint allemaal met respect en liefde voor de natuur."},{name:"Wout de Boswachter",text:"Door te zorgen voor het bos, de dieren en alles wat hierin leeft, bewijs je je waarde."},{name:"Wout de Boswachter",text:"Wie weet, misschien zal het Earth Artifact op een dag voor je openen en je zijn geheimen onthullen."}],this.currentDialogueIndex=0,this.showCurrentDialogue(),this.engine.input.keyboard.off("press"),this.engine.input.keyboard.on("press",d=>{d.key===Kt.Keys.Space&&(this.currentDialogueIndex<this.dialogues.length-1?this.nextDialogue():this.choiceMade||this.showChoiceOptions6())})}showChoiceOptions6(){this.removeDialogues();const d=["Dank je, Wout. Ik zal mijn best doen!","Weet je, ik denk dat bomen echt mijn vrienden zijn.","Ik ben klaar voor het avontuur. Waar moet ik beginnen?"];this.showOptions(d,this.showDialogue7)}showDialogue7(){this.choiceMade=!1,this.dialogues=[{name:"Wout de Boswachter",text:"Dat is de geest! Ga, ontdek en bescherm."},{name:"Wout de Boswachter",text:"Het Kralingse Bos heeft altijd behoefte aan meer dappere zielen zoals jij."},{name:"Wout de Boswachter",text:"Vergeet niet, de natuur is je bondgenoot en zal je leiden op je pad."},{name:"Wout de Boswachter",text:"Veel succes, en moge het Earth Artifact ooit zijn geheimen aan je onthullen."}],this.currentDialogueIndex=0,this.showCurrentDialogue(),this.engine.input.keyboard.off("press"),this.engine.input.keyboard.on("press",d=>{d.key===Kt.Keys.Space&&(this.currentDialogueIndex<this.dialogues.length-1?this.nextDialogue():this.choiceMade||this.endDialogueScene())})}endDialogueScene(){const d=new Re;d.pos.x=this.respawnCoordinates.x,d.pos.y=this.respawnCoordinates.y,this.engine.goToScene("map")}}class VA extends Ci{constructor(){super();ne(this,"choiseOption",!1);ne(this,"dialogue",1);ne(this,"options",1);ne(this,"enddialogue",1);ne(this,"showdialogue",1);this.currentDialogueIndex=0,this.choiceMade=!1,this.dialogues=[{name:"Dirk Zeebries",text:"Yo, een reiziger! Kom dichterbij, man."},{name:"Dirk Zeebries",text:"Het lijkt erop dat je iets zoekt, nietwaar?"},{name:"Dirk Zeebries",text:"Yo, je hebt geluk dat je mij hebt gevonden."},{name:"Dirk Zeebries",text:"Ik ben Dirk Zeebries, kenner van de geheimen van dit bos."},{name:"Dirk Zeebries",text:"Yo, wat wil je weten, dude?"}],this.respawnCoordinates={x:755,y:1280},this.lastButtonPressTime=0,this.cooldown=1e3}onInitialize(d){super.onInitialize(d),this.showCurrentDialogue(),d.input.keyboard.on("press",W=>{W.key===Kt.Keys.Space&&(this.currentDialogueIndex<this.dialogues.length-1?this.nextDialogue():(this.removeDialogues(),this.choiceMade||this.showChoiceOptions1()))})}onPreUpdate(d,W,q){super.onPreUpdate(d,W);const Z=d.input.gamepads.at(0),Y=Date.now();if(Z&&Z.isButtonPressed(Kt.Buttons.Face1)&&!this.gamepadCooldown&&(this.currentDialogueIndex<this.dialogues.length-1?(this.nextDialogue(),this.gamepadCooldown=!0,console.log("Face1 Pressed"),setTimeout(()=>{this.gamepadCooldown=!1},400)):(this.removeDialogues(),console.log("else"),(!this.choiceMade||!this.gamepadCooldown)&&(this.OptionSelection(),setTimeout(()=>{this.gamepadCooldown=!1},400)))),Z&&(Z.isButtonPressed(Kt.Buttons.Face2)||Z.isButtonPressed(Kt.Buttons.Face3)||Z.isButtonPressed(Kt.Buttons.Face4)&&this.choiseOption==!0&&!this.gamepadCooldown)&&Y-this.lastButtonPressTime>this.cooldown){this.lastButtonPressTime=Y,this.dialogue++,this.removeDialogues(),this.choiceMade=!0;const et=`showDialogue${this.dialogue}`;typeof this[et]=="function"&&!this.gamepadCooldown?this[et]():this.gamepadCooldown||(this.endDialogueScene(),console.warn(`Method ${et} does not exist`))}}OptionSelection(){this.gamepadCooldown||(this.gamepadCooldown=!0,this.enddialogue==1?(console.log(this.dialogue),this.enddialogue++,this.showChoiceOptions1(),console.log("showChoiceOptions1")):this.enddialogue==2?(console.log(this.dialogue),this.enddialogue++,this.showChoiceOptions2(),console.log("showChoiceOptions2")):this.enddialogue==3?(console.log(this.dialogue),this.enddialogue++,this.showChoiceOptions3(),console.log("showChoiceOptions3")):this.enddialogue==4?(console.log(this.dialogue),this.enddialogue++,this.showChoiceOptions4(),console.log("showChoiceOptions4")):this.endDialogueScene(),setTimeout(()=>{this.gamepadCooldown=!1},400))}createDialogueBox(d,W){const Z=this.splitTextIntoLines(d,600);let Y=550;const et=25,X=Z.length*et+40,k=640,b=Y-20,l=new qt({pos:new Ft(650,b+X/2),width:k+6,height:X+6,color:Yt.White});this.add(l);const S=new qt({pos:new Ft(650,b+X/2),width:k,height:X,color:Yt.Black});this.add(S),Z.forEach(C=>{const Q=new Be({text:C,pos:new Ft(375,Y),font:new Ee({size:20,family:"Arial"}),color:Yt.White});this.add(Q),Y+=et}),this.createNameBox(W)}createNameBox(d){this.nameBox&&this.nameBox.kill(),this.nameLabel&&this.nameLabel.kill();const W=d.length*11+20,q=520-W/2,Z=new qt({pos:new Ft(q,507),width:W+6,height:46,color:Yt.White});this.add(Z),this.nameBox=new qt({pos:new Ft(q,507),width:W,height:40,color:Yt.Black}),this.add(this.nameBox),this.nameLabel=new Be({text:d,pos:new Ft(375,497),font:new Ee({size:20,family:"Arial"}),color:Yt.White}),this.add(this.nameLabel)}showCurrentDialogue(){this.removeDialogues();const d=this.dialogues[this.currentDialogueIndex];this.createDialogueBox(d.text,d.name)}splitTextIntoLines(d,W){const q=d.split(" "),Z=[];let Y=q[0];for(let et=1;et<q.length;et++){const X=q[et];this.getTextWidth(Y+" "+X)<W?Y+=" "+X:(Z.push(Y),Y=X)}return Z.push(Y),Z}getTextWidth(d){return d.length*10}nextDialogue(){this.currentDialogueIndex<this.dialogues.length-1?(this.currentDialogueIndex++,this.showCurrentDialogue()):this.dialogues.length>this.currentDialogueIndex+1||(this.choiceMade||this.showChoiceOptions1(),this.removeDialogues())}showChoiceOptions1(){this.showdialogue++,this.removeDialogues();const d=["Yo Dirk, vertel me alles over dat water artifact.","Yo, ben jij de baas van die mysterieuze waterkracht?","Yo, heb je ooit een vis met een water artifact zien zwemmen?"];this.showOptions(d,this.showDialogue2)}showOptions(d,W){this.choiseOption=!0;let q=500;const Z=650,Y=2,et=10,X=[["□","✕"],["△","Y"],["◯","B"]];d.forEach((k,b)=>{let l=X[b%X.length],S=`${l[0]} / ${l[1]} `;b<3?S+=this.wrapText(k,Z):S+=k;const C=this.getTextHeight(S,Z);new qt({pos:new Ft(375,q+C/2),width:Z+et*2,height:C+et*2,color:Yt.Black});const Q=new qt({pos:new Ft(650,q+C/2),width:Z+et*2+Y*2,height:C+et*2+Y*2,color:Yt.White,anchor:Ft.Half}),B=new qt({pos:new Ft(650,q+C/2),width:Z+et*2,height:C+et*2,color:Yt.Black}),D=new Be({text:S,pos:new Ft(330,q),font:new Ee({size:20,family:"Arial"}),color:Yt.White});b===0?D.on("pointerdown",()=>{this.removeDialogues(),this.choiceMade=!0,W.call(this)}):b===1?D.on("pointerdown",()=>{this.removeDialogues(),this.choiceMade=!0,W.call(this)}):b===2&&D.on("pointerdown",()=>{this.removeDialogues(),this.choiceMade=!0,W.call(this)}),this.add(Q),this.add(B),this.add(D),q+=C+et*2+Y*2})}wrapText(d,W){const q=d.split(" ");let Z="",Y=[];return q.forEach(et=>{this.getTextWidth(Z+" "+et)<W?Z+=" "+et:(Y.push(Z),Z=et)}),Y.push(Z),Y.join(`
`)}getTextHeight(d,W){return d.split(`
`).length*25}removeDialogues(){this.actors.forEach(d=>{d.kill()})}showDialogue2(){this.choiceMade=!1,this.dialogues=[{name:"Dirk Zeebries",text:"Yo, het water artifact, dat is een chill verhaal, man!"},{name:"Dirk Zeebries",text:"Luister goed, want dit is een verhaal dat teruggaat tot de tijd dat de wereld nog jong was."},{name:"Dirk Zeebries",text:"Het artifact werd gecreëerd door de oude watermagiërs, meesters van de elementaire krachten."},{name:"Dirk Zeebries",text:"Yo, zij putten hun energie uit de diepe wateren van de Kralingse Plas, waar het artifact tot op de dag van vandaag verborgen ligt, dude."},{name:"Dirk Zeebries",text:"Yo, het artifact zelf is gemaakt van een zeldzaam kristal, doordrenkt met de essentie van zuiver water."},{name:"Dirk Zeebries",text:"Die magiërs dachten dat dit kristal de kracht had om water te manipuleren en zelfs leven te schenken aan de dorre aarde."},{name:"Dirk Zeebries",text:"Maar yo, met zo'n kracht komt ook gevaar."},{name:"Dirk Zeebries",text:"Velen hebben geprobeerd het artifact te pakken te krijgen, maar slechts weinigen zijn geslaagd, man."}],this.currentDialogueIndex=0,this.showCurrentDialogue(),this.engine.input.keyboard.off("press"),this.engine.input.keyboard.on("press",d=>{d.key===Kt.Keys.Space&&(this.currentDialogueIndex<this.dialogues.length-1?this.nextDialogue():this.choiceMade||this.showChoiceOptions2())})}showChoiceOptions2(){this.removeDialogues();const d=["Vergelijkbaar met Finding Nemo?","Zijn er gevaren die dat artifact beschermen?","Yo, wie heeft dat ding voor het laatst gezien?"];this.showOptions(d,this.showDialogue3)}showDialogue3(){this.choiceMade=!1,this.dialogues=[{name:"Dirk Zeebries",text:"Yo, inderdaad, de laatste persoon die het artifact heeft gezien, was een machtige magiër genaamd Elvira de Aquatische."},{name:"Dirk Zeebries",text:"Zij wist de ware potentie van het artifact te benutten en gebruikte het om haar volk te beschermen tegen een grote droogte."},{name:"Dirk Zeebries",text:"Maar yo, Elvira verdween op mysterieuze wijze, en met haar verdween ook het artifact."},{name:"Dirk Zeebries",text:"Sommigen zeggen dat ze is opgenomen in het water zelf en dat haar geest nog ergens rondzwemt, dude."},{name:"Dirk Zeebries",text:"Yo, wat betreft de gevaren, ja, die zijn er volop."},{name:"Dirk Zeebries",text:"Het artifact wordt bewaakt door oude beschermers, watergeesten die loyaler zijn dan de trouwste wachter."},{name:"Dirk Zeebries",text:"Yo, ze zullen alles doen om te voorkomen dat onwaardige handen het artifact bemachtigen."},{name:"Dirk Zeebries",text:"Er wordt gezegd dat de plas zelf je zal opslokken als je te dichtbij komt zonder de juiste voorbereidingen, man."}],this.currentDialogueIndex=0,this.showCurrentDialogue(),this.engine.input.keyboard.off("press"),this.engine.input.keyboard.on("press",d=>{d.key===Kt.Keys.Space&&(this.currentDialogueIndex<this.dialogues.length-1?this.nextDialogue():this.choiceMade||this.showChoiceOptions3())})}showChoiceOptions3(){this.removeDialogues();const d=["Hoe kan ik me voorbereiden om dat artifact te vinden?","Moet ik een snorkel meenemen?","Zijn er aanwijzingen in het bos die naar dat artifact leiden?"];this.showOptions(d,this.showDialogue4)}showDialogue4(){this.choiceMade=!1,this.dialogues=[{name:"Dirk Zeebries",text:"Yo, voorbereiding is de sleutel, dude."},{name:"Dirk Zeebries",text:"Yo, maar pas op, niet alles is wat het lijkt in dit bos."},{name:"Dirk Zeebries",text:"De geesten van de plas kunnen je ook misleiden als ze denken dat je kwade bedoelingen hebt."},{name:"Dirk Zeebries",text:"Yo, wees respectvol en voorzichtig in je zoektocht, en misschien, heel misschien, zal het artifact zichzelf aan je onthullen, dude."}],this.currentDialogueIndex=0,this.showCurrentDialogue(),this.engine.input.keyboard.off("press"),this.engine.input.keyboard.on("press",d=>{d.key===Kt.Keys.Space&&(this.currentDialogueIndex<this.dialogues.length-1?this.nextDialogue():this.choiceMade||this.showChoiceOptions4())})}showChoiceOptions4(){this.removeDialogues();const d=["Tijd om de golven te temmen, yo!","Thanks, Dirk. Ik ga je advies volgen.","Yo, dit klinkt als een avontuur dat ik niet kan missen."];this.showOptions(d,this.showDialogue5)}showDialogue5(){this.choiceMade=!1,this.dialogues=[{name:"Dirk Zeebries",text:"Yo, heel goed, reiziger. Moge de krachten van het water je leiden en beschermen."},{name:"Dirk Zeebries",text:"En vergeet niet, soms is het antwoord dat je zoekt dichterbij dan je denkt."},{name:"Dirk Zeebries",text:"Yo, het artifact wacht op degene die het waard is."},{name:"Dirk Zeebries",text:"Veel geluk, en moge de stroom je gunstig gezind zijn, man."}],this.currentDialogueIndex=0,this.showCurrentDialogue(),this.engine.input.keyboard.off("press"),this.engine.input.keyboard.on("press",d=>{d.key===Kt.Keys.Space&&(this.currentDialogueIndex<this.dialogues.length-1?this.nextDialogue():this.choiceMade||this.endDialogueScene())})}endDialogueScene(){const d=new Re;d.pos.x=this.respawnCoordinates.x,d.pos.y=this.respawnCoordinates.y,this.engine.input.keyboard.off("press"),this.engine.goToScene("map")}}class ia extends qt{constructor(){super({pos:new Ft(0,0),width:32,height:32,collisionType:cs.Fixed});const ot=lr.fromImageSource({image:Wt.Lithorock,grid:{rows:1,columns:2,spriteWidth:498,spriteHeight:504}}),d=[0,1],W=ar.fromSpriteSheet(ot,d,500);W.scale=new Ft(32/498,32/504),this.graphics.add("idle",W),this.graphics.use("idle")}onInitialize(ot){this.pos=new Ft(2662,1875),this.vel=new Ft(0,0)}onPreUpdate(ot){}}class XA extends qt{constructor(){super({width:Wt.Earthartifact.width,height:Wt.Earthartifact.height})}onInitialize(ot){this.graphics.use(Wt.Earthartifact.toSprite()),this.pos=new Ft(310,1243),this.scale=new Ft(16/Wt.Earthartifact.width,16/Wt.Earthartifact.height),this.on("collisionstart",d=>{d.other instanceof Re&&(console.log("Earth artifact collected"),this.emit("collected"),this.kill())})}}class JA extends qt{constructor(){super({width:Wt.Waterartifact.width,height:Wt.Waterartifact.height})}onInitialize(ot){this.graphics.use(Wt.Waterartifact.toSprite()),this.pos=new Ft(2365,2304),this.scale=new Ft(16/Wt.Waterartifact.width,16/Wt.Waterartifact.height),this.on("collisionstart",d=>{d.other instanceof Re&&(console.log("Water artifact collected"),this.emit("collected"),this.kill())})}}class KA extends qt{constructor(){super({width:Wt.Rockartifact.width,height:Wt.Rockartifact.height})}onInitialize(ot){this.graphics.use(Wt.Rockartifact.toSprite()),this.pos=new Ft(2233,3142),this.scale=new Ft(16/Wt.Rockartifact.width,16/Wt.Rockartifact.height),this.on("collisionstart",d=>{d.other instanceof Re&&(console.log("Rock artifact collected"),this.emit("collected"),this.kill())})}}class $A extends qt{constructor(){super({width:Wt.Mysteryartifact.width,height:Wt.Mysteryartifact.height})}onInitialize(ot){this.graphics.use(Wt.Mysteryartifact.toSprite()),this.pos=new Ft(3090,120),this.scale=new Ft(16/Wt.Mysteryartifact.width,16/Wt.Mysteryartifact.height),this.on("collisionstart",d=>{d.other instanceof Re&&(console.log("Mystery artifact collected"),this.emit("collected"),this.kill())})}}class Re extends qt{constructor(d,W){super({pos:new Ft(d,W),width:16,height:16,collisionType:cs.Active});ne(this,"leftcurrentFrame",0);ne(this,"rightcurrentFrame",0);ne(this,"frontcurrentFrame",0);ne(this,"backcurrentFrame",0);ne(this,"animationSpeed",.08);ne(this,"leftanimationFrames",[Wt.ML1,Wt.ML2,Wt.ML3,Wt.ML2]);ne(this,"rightanimationFrames",[Wt.MR1,Wt.MR2,Wt.MR3,Wt.MR2]);ne(this,"frontanimationFrames",[Wt.MF1,Wt.MF2,Wt.MF3,Wt.MF2]);ne(this,"backanimationFrames",[Wt.MB1,Wt.MB2,Wt.MB3,Wt.MB2]);ne(this,"sprite");ne(this,"dialogueStartedMap",new Map);this.isGrounded=!1}onInitialize(d){this.sprite=Wt.MF2.toSprite(),this.graphics.use(this.sprite),this.scale=new Ft(.5,.5),this.on("collisionstart",W=>this.onCollide(W))}onCollide(d){const W=d.other;W instanceof $o&&!this.dialogueStartedMap.has("elara")?(console.log("Collision with Elara detected"),this.startDialogue("elaraDialogue"),this.dialogueStartedMap.set("elara",!0)):W instanceof ta&&!this.dialogueStartedMap.has("wout")?(console.log("Collision with Wout detected"),this.startDialogue("woutDialogue"),this.dialogueStartedMap.set("wout",!0)):W instanceof ea&&!this.dialogueStartedMap.has("dirk")?(console.log("Collision with Dirk detected"),this.startDialogue("dirkDialogue"),this.dialogueStartedMap.set("dirk",!0)):W instanceof ia&&!this.dialogueStartedMap.has("lithorock")&&(console.log("Collision with Lithorock detected"),this.startDialogue("lithorockDialogue"),this.dialogueStartedMap.set("lithorock",!0))}startDialogue(d){var W;(W=this.scene)==null||W.engine.goToScene(d)}onPreUpdate(d,W){let q=0,Z=0;const Y=d.input.keyboard,et=d.input.gamepads;(Y.isHeld(Qi.W)||Y.isHeld(Qi.Up)||et.at(0).getAxes(or.LeftStickY)<-.5)&&(Z=-150,this.animateBack()),(Y.isHeld(Qi.S)||Y.isHeld(Qi.Down)||et.at(0).getAxes(or.LeftStickY)>.5)&&(Z=150,this.animateFront()),(Y.isHeld(Qi.D)||Y.isHeld(Qi.Right)||et.at(0).getAxes(or.LeftStickX)>.5)&&(q=150,this.animateRight()),(Y.isHeld(Qi.A)||Y.isHeld(Qi.Left)||et.at(0).getAxes(or.LeftStickX)<-.5)&&(q=-150,this.animateLeft()),this.vel=new Ft(q,Z)}animateLeft(){this.leftcurrentFrame=(this.leftcurrentFrame+this.animationSpeed)%this.leftanimationFrames.length,this.leftcurrentFrame>=this.leftanimationFrames.length&&(this.leftcurrentFrame=0);const d=this.leftanimationFrames[Math.floor(this.leftcurrentFrame)].toSprite();this.graphics.use(d)}animateRight(){this.rightcurrentFrame=(this.rightcurrentFrame+this.animationSpeed)%this.rightanimationFrames.length,this.rightcurrentFrame>=this.rightanimationFrames.length&&(this.rightcurrentFrame=0);const d=this.rightanimationFrames[Math.floor(this.rightcurrentFrame)].toSprite();this.graphics.use(d)}animateFront(){this.frontcurrentFrame=(this.frontcurrentFrame+this.animationSpeed)%this.frontanimationFrames.length,this.frontcurrentFrame>=this.frontanimationFrames.length&&(this.frontcurrentFrame=0);const d=this.frontanimationFrames[Math.floor(this.frontcurrentFrame)].toSprite();this.graphics.use(d)}animateBack(){this.backcurrentFrame=(this.backcurrentFrame+this.animationSpeed)%this.backanimationFrames.length,this.backcurrentFrame>=this.backanimationFrames.length&&(this.backcurrentFrame=0);const d=this.backanimationFrames[Math.floor(this.backcurrentFrame)].toSprite();this.graphics.use(d)}}class Lr extends qt{constructor(ot,d,W,q){super({pos:new Ft(ot,d),width:W,height:q,color:Yt.Transparent}),this.body.collisionType=cs.Fixed}}class tg extends Zo{constructor(){super(),this.artifacts=new Set}addArtifact(ot){console.log("Adding artifact:",ot),this.artifacts.add(ot),ot.on("collected",()=>{this.removeArtifact(ot)})}removeArtifact(ot){console.log("Removing artifact:",ot),this.artifacts.delete(ot),this.emit("artifactCollected")}allCollected(){const ot=this.artifacts.size===0;return console.log("All artifacts collected:",ot),ot}}let eg=class extends Ci{constructor(){super();ne(this,"earth",!1);ne(this,"water",!1);ne(this,"rock",!1);ne(this,"mystery",!1);this.countdownTimer=null,this.artifactmanager=new tg}onInitialize(d){console.log("start de game! bla"),Wt.Map.addToScene(this);const W=new Re;W.pos=new Ft(440,2530),this.add(W);const q=new ta;this.add(q);const Z=new ea;this.add(Z);const Y=new $o;this.add(Y);const et=new ia;this.add(et);const X=new XA;X.on("collisionstart",M=>{M.other instanceof Re&&(this.earth=!0,console.log(this.earth))});const k=new JA;k.on("collisionstart",M=>{M.other instanceof Re&&(this.water=!0,console.log(this.water))});const b=new KA;b.on("collisionstart",M=>{M.other instanceof Re&&(this.rock=!0,console.log(this.rock))});const l=new $A;l.on("collisionstart",M=>{M.other instanceof Re&&(this.mystery=!0,console.log(this.mystery))}),q.on("collisionstart",M=>{M.other instanceof Re&&!this.earth&&(this.add(X),X.pos=new Ft(310,1243),console.log("Earth Artifact spawned!"))}),Z.on("collisionstart",M=>{M.other instanceof Re&&!this.water&&(this.add(k),k.pos=new Ft(2365,2304),console.log("Water Artifact spawned!"))}),Y.on("collisionstart",M=>{M.other instanceof Re&&!this.mystery&&(this.add(l),l.pos=new Ft(3090,120),console.log("Mystery Artifact spawned!"))}),et.on("collisionstart",M=>{M.other instanceof Re&&!this.rock&&(this.add(b),b.pos=new Ft(2233,3142),console.log("Rock Artifact spawned!"))}),d.currentScene.camera.strategy.lockToActor(W),d.currentScene.camera.zoom=2.5;const S=3200,C=3200,Q=50,B=new Lr(S/2,-Q/2,S,Q),D=new Lr(S/2,C+Q/2,S,Q),O=new Lr(-Q/2,C/2,Q,C),V=new Lr(S+Q/2,C/2,Q,C);this.add(B),this.add(D),this.add(O),this.add(V),this.countdownTimer=new Vo({fcn:()=>this.onTimerEnd(d),interval:600*1e3,repeats:!1}),this.add(this.countdownTimer),this.countdownTimer.start(),this.artifactmanager.on("artifactCollected",()=>{this.artifactmanager.allCollected()&&this.switchScene()})}onTimerEnd(d){d.goToScene("badending")}addArtifact(d){this.artifactmanager.addArtifact(d),this.add(d)}switchScene(){this.engine.goToScene("end")}onPreUpdate(){this.earth===!0&&this.water===!0&&this.rock===!0&&this.mystery===!0&&this.engine.goToScene("goodending")}};class ig extends Ci{constructor(){super(),this.congratulations=null,this.youdidit=null,this.Backbutton=null}onInitialize(ot){const d=new hs({image:Wt.BadEndScreen,destSize:{width:1280,height:720}}),W=new qt({pos:new Ft(640,360),width:1280,height:720});W.graphics.use(d),this.add(W),this.spawnBackbutton(),this.Backbutton&&this.Backbutton.on("pointerup",()=>{window.location.reload()})}spawnBackbutton(){this.Backbutton=new qt,this.Backbutton.graphics.use(Wt.Backbutton.toSprite()),this.Backbutton.pos=new Ft(600,450),this.add(this.Backbutton)}onPreUpdate(ot){ot.input.gamepads.at(0).isButtonPressed(Rr.Start)&&window.location.reload()}}class sg extends Ci{constructor(){super();ne(this,"choiseOption",!1);ne(this,"dialogue",1);ne(this,"options",1);ne(this,"enddialogue",1);ne(this,"showdialogue",1);this.currentDialogueIndex=0,this.choiceMade=!1,this.dialogues=[{name:"Lithorock",text:"Ah, een avonturier! Welkom in het Kralingse Bos."},{name:"Lithorock",text:"Mijn naam is Lithorck. Wat brengt je hier vandaag?"}],this.respawnCoordinates={x:2662,y:1875},this.lastButtonPressTime=0,this.cooldown=1e3}onInitialize(d){super.onInitialize(d),this.showCurrentDialogue(),d.input.keyboard.on("press",W=>{W.key===Kt.Keys.Space&&(this.currentDialogueIndex<this.dialogues.length-1?this.nextDialogue():(this.removeDialogues(),this.choiceMade||this.showChoiceOptions1()))})}onPreUpdate(d,W,q){super.onPreUpdate(d,W);const Z=d.input.gamepads.at(0),Y=Date.now();if(Z&&Z.isButtonPressed(Kt.Buttons.Face1)&&!this.gamepadCooldown&&(this.currentDialogueIndex<this.dialogues.length-1?(this.nextDialogue(),this.gamepadCooldown=!0,console.log("Face1 Pressed"),setTimeout(()=>{this.gamepadCooldown=!1},400)):(this.removeDialogues(),console.log("else"),(!this.choiceMade||!this.gamepadCooldown)&&(this.OptionSelection(),setTimeout(()=>{this.gamepadCooldown=!1},400)))),Z&&(Z.isButtonPressed(Kt.Buttons.Face2)||Z.isButtonPressed(Kt.Buttons.Face3)||Z.isButtonPressed(Kt.Buttons.Face4)&&this.choiseOption==!0&&!this.gamepadCooldown)&&Y-this.lastButtonPressTime>this.cooldown){this.lastButtonPressTime=Y,this.dialogue++,this.removeDialogues(),this.choiceMade=!0;const et=`showDialogue${this.dialogue}`;typeof this[et]=="function"&&!this.gamepadCooldown?this[et]():this.gamepadCooldown||(this.endDialogueScene(),console.warn(`Method ${et} does not exist`))}}OptionSelection(){this.gamepadCooldown||(this.gamepadCooldown=!0,this.enddialogue==1?(console.log(this.dialogue),this.enddialogue++,this.showChoiceOptions1(),console.log("showChoiceOptions1")):this.enddialogue==2?(console.log(this.dialogue),this.enddialogue++,this.showChoiceOptions2(),console.log("showChoiceOptions2")):this.enddialogue==3?(console.log(this.dialogue),this.enddialogue++,this.showChoiceOptions3(),console.log("showChoiceOptions3")):this.enddialogue==4?(console.log(this.dialogue),this.enddialogue++,this.showChoiceOptions4(),console.log("showChoiceOptions4")):this.endDialogueScene(),setTimeout(()=>{this.gamepadCooldown=!1},400))}createDialogueBox(d,W){const Z=this.splitTextIntoLines(d,600);let Y=550;const et=25,X=Z.length*et+40,k=640,b=Y-20,l=new qt({pos:new Ft(650,b+X/2),width:k+6,height:X+6,color:Yt.White});this.add(l);const S=new qt({pos:new Ft(650,b+X/2),width:k,height:X,color:Yt.Black});this.add(S),Z.forEach(C=>{const Q=new Be({text:C,pos:new Ft(375,Y),font:new Ee({size:20,family:"Arial"}),color:Yt.White});this.add(Q),Y+=et}),this.createNameBox(W)}createNameBox(d){this.nameBox&&this.nameBox.kill(),this.nameLabel&&this.nameLabel.kill();const W=d.length*11+20,q=475-W/2,Z=new qt({pos:new Ft(q,507),width:W+6,height:46,color:Yt.White});this.add(Z),this.nameBox=new qt({pos:new Ft(q,507),width:W,height:40,color:Yt.Black}),this.add(this.nameBox),this.nameLabel=new Be({text:d,pos:new Ft(375,497),font:new Ee({size:20,family:"Arial"}),color:Yt.White}),this.add(this.nameLabel)}showCurrentDialogue(){this.removeDialogues();const d=this.dialogues[this.currentDialogueIndex];this.createDialogueBox(d.text,d.name)}splitTextIntoLines(d,W){const q=d.split(" "),Z=[];let Y=q[0];for(let et=1;et<q.length;et++){const X=q[et];this.getTextWidth(Y+" "+X)<W?Y+=" "+X:(Z.push(Y),Y=X)}return Z.push(Y),Z}getTextWidth(d){return d.length*10}nextDialogue(){this.currentDialogueIndex<this.dialogues.length-1?(this.currentDialogueIndex++,this.showCurrentDialogue()):this.dialogues.length>this.currentDialogueIndex+1||(this.choiceMade||this.showChoiceOptions1(),this.removeDialogues())}showChoiceOptions1(){this.removeDialogues();const d=["Ik ben op zoek naar informatie over het stone artifact.","Mooie plek hier, maar ik hoorde dat je iets weet over een speciaal artefact?","Hoi! Heb je toevallig een steenrijke tip voor mij?"];this.showOptions(d,this.showDialogue2)}showOptions(d,W){this.choiseOption=!0;let q=500;const Z=650,Y=2,et=10,X=[["❑","X"],["Δ","Y"],["O","B"]];d.forEach((k,b)=>{let l=X[b%X.length],S=`${l[0]} / ${l[1]} `;b===0||b===1||b===2?S+=this.wrapText(k,Z):S+=k;const C=this.getTextHeight(S,Z);new qt({pos:new Ft(375,q+C/2),width:Z+et*2,height:C+et*2,color:Yt.Black});const Q=new qt({pos:new Ft(650,q+C/2),width:Z+et*2+Y*2,height:C+et*2+Y*2,color:Yt.White,anchor:Ft.Half}),B=new qt({pos:new Ft(650,q+C/2),width:Z+et*2,height:C+et*2,color:Yt.Black}),D=new Be({text:S,pos:new Ft(330,q),font:new Ee({size:20,family:"Arial"}),color:Yt.White});D.on("pointerdown",()=>{this.removeDialogues(),this.choiceMade=!0,W.call(this)}),this.add(Q),this.add(B),this.add(D),q+=C+et*2+Y*2})}wrapText(d,W){const q=d.split(" ");let Z="",Y=[];return q.forEach(et=>{this.getTextWidth(Z+" "+et)<W?Z+=" "+et:(Y.push(Z),Z=et)}),Y.push(Z),Y.join(`
`)}getTextHeight(d,W){return d.split(`
`).length*25}removeDialogues(){this.actors.forEach(d=>{d.kill()})}showDialogue2(){this.choiceMade=!1,this.dialogues=[{name:"Lithorock",text:"Een goede vraag! Je bent vast geïnteresseerd in het stone artifact, nietwaar?"},{name:"Lithorock",text:"Het is een fascinerend onderwerp. Laten we eens diep in de geschiedenis duiken, net zoals je een schat zou opgraven."},{name:"Lithorock",text:"En zeg eens, waarom zijn rotsen zo goed in wiskunde?"},{name:"Lithorock",text:"Ze hebben altijd de juiste 'angle'!"},{name:"Lithorock",text:"Lang geleden, in de vroege dagen van deze regio, toen het Kralingse Bos nog jong was en de bomen zich uitstrekten als de armen van reuzen, leefde er een stam van bekwame steenbewerkers."},{name:"Lithorock",text:"Ze geloofden dat elke steen een ziel had en dat sommige stenen magische krachten bezaten."},{name:"Lithorock",text:"Ze noemden deze bijzondere stenen levensstenen."},{name:"Lithorock",text:"De stam ontdekte een enorm rotsblok aan de oever van de Kralingse Plas."},{name:"Lithorock",text:"Het was geen gewone steen; het had een vreemde, bijna etherische gloed."},{name:"Lithorock",text:"Ze besloten dat deze steen iets speciaals moest zijn, een geschenk van de aarde zelf."},{name:"Lithorock",text:"Ze begonnen het rotsblok zorgvuldig te bewerken, met rituelen en gebeden, en na jaren van toewijding ontstond het stone artifact."}],this.currentDialogueIndex=0,this.showCurrentDialogue(),this.engine.input.keyboard.off("press"),this.engine.input.keyboard.on("press",d=>{d.key===Kt.Keys.Space&&(this.currentDialogueIndex<this.dialogues.length-1?this.nextDialogue():this.choiceMade||this.showChoiceOptions2())})}showChoiceOptions2(){this.removeDialogues();const d=["Als ze die steen verkeerd hakte, hadden ze dan rotsen in hun maag?","Dat klinkt ongelooflijk! Wat voor rituelen voerden ze uit?","Wacht even, je zegt dat stenen zielen hebben? Hoe werkt dat precies?"];this.showOptions(d,this.showDialogue3)}showDialogue3(){this.choiceMade=!1,this.dialogues=[{name:"Lithorock",text:"Rituelen die dagen duurden!"},{name:"Lithorock",text:"Ze geloofden dat door te zingen en te dansen rond de steen, ze de geest van de steen konden oproepen en zijn magische krachten konden activeren."},{name:"Lithorock",text:"Er werd gezegd dat het artefact voorspellende krachten had, en dat het de stam kon beschermen tegen kwade geesten en rampen."},{name:"Lithorock",text:"En weet je waarom ze de steen nooit kwijtraakten?"},{name:"Lithorock",text:"Hij was altijd rotsvast op zijn plaats!"},{name:"Lithorock",text:"De stamhoofden gebruikten het artefact tijdens belangrijke ceremonies."},{name:"Lithorock",text:"Ze hielden het vast en er werd gezegd dat het hen visioenen gaf van de toekomst."},{name:"Lithorock",text:"De legende vertelt dat toen een grote vloed dreigde, de stam het artefact raadpleegde en zo op tijd wist te evacueren."}],this.currentDialogueIndex=0,this.showCurrentDialogue(),this.engine.input.keyboard.off("press"),this.engine.input.keyboard.on("press",d=>{d.key===Kt.Keys.Space&&(this.currentDialogueIndex<this.dialogues.length-1?this.nextDialogue():this.choiceMade||this.showChoiceOptions3())})}showChoiceOptions3(){this.removeDialogues();const d=["Heeft iemand ooit geprobeerd het artefact te stelen?","Stel je voor, een steen die je toekomst kan vertellen! Dat is pas een rotsvast verhaal.","Fascinerend! Wat is er uiteindelijk met de stam en het artefact gebeurd?"];this.showOptions(d,this.showDialogue4)}showDialogue4(){this.choiceMade=!1,this.dialogues=[{name:"Lithorock",text:"Na vele jaren van voorspoed gebeurde er iets onverwachts."},{name:"Lithorock",text:"Een rivaliserende stam, jaloers op de macht en rijkdom die het artefact bracht, probeerde het te stelen."},{name:"Lithorock",text:"Nu wacht het op iemand die het waardig is om zijn krachten opnieuw te ontketenen."},{name:"Lithorock",text:"De oorspronkelijke stam verdween langzaam, verslagen en zonder hun kostbare artefact."},{name:"Lithorock",text:"Maar hun verhalen leven voort, en de magie van de steen wordt nog steeds gevreesd en gerespecteerd."},{name:"Lithorock",text:"En weet je wat ze zeggen over het artefact?"},{name:"Lithorock",text:"Het is geen gewoon verhaal, het is steen voor steen opgebouwd!"}],this.currentDialogueIndex=0,this.showCurrentDialogue(),this.engine.input.keyboard.off("press"),this.engine.input.keyboard.on("press",d=>{d.key===Kt.Keys.Space&&(this.currentDialogueIndex<this.dialogues.length-1?this.nextDialogue():this.choiceMade||this.showChoiceOptions4())})}showChoiceOptions4(){this.removeDialogues();const d=["Wat een verhaal! Denk je dat het artefact nog steeds kracht heeft?","Heb je ooit iemand ontmoet die beweert het artefact te hebben gezien?","Dus ik kan een steengoed souvenir vinden?"];this.showOptions(d,this.showDialogue5)}showDialogue5(){this.choiceMade=!1,this.dialogues=[{name:"Lithorock",text:"Misschien wel! Het zou een zeer speciaal souvenir zijn, dat kan ik je verzekeren."},{name:"Lithorock",text:"Wat betreft de kracht van het artefact, wie weet?"},{name:"Lithorock",text:"Magie is een vreemd en mysterieus iets. Het kan sluimeren, wachtend op de juiste persoon om het weer te wekken."},{name:"Lithorock",text:"En ja, er zijn altijd verhalen van mensen die zeggen dat ze iets ongewoons hebben gezien in de plas, maar bewijs is er nooit."},{name:"Lithorock",text:"Misschien ben jij degene die het artefact zal vinden en zijn geheimen zal onthullen."},{name:"Lithorock",text:"Dus, als je ooit een steentje in je schoen voelt terwijl je in het bos wandelt, wees niet boos."},{name:"Lithorock",text:"Het zou wel eens het begin kunnen zijn van een groot avontuur."}],this.currentDialogueIndex=0,this.showCurrentDialogue(),this.engine.input.keyboard.off("press"),this.engine.input.keyboard.on("press",d=>{d.key===Kt.Keys.Space&&(this.currentDialogueIndex<this.dialogues.length-1?this.nextDialogue():this.choiceMade||this.endDialogueScene())})}endDialogueScene(){const d=new Re;d.pos.x=this.respawnCoordinates.x,d.pos.y=this.respawnCoordinates.y,this.engine.input.keyboard.off("press"),this.engine.goToScene("map")}}class rg extends Ci{constructor(){super(),this.congratulations=null,this.youdidit=null,this.Backbutton=null}onInitialize(ot){const d=new hs({image:Wt.GoodEndScreen,destSize:{width:1280,height:720}}),W=new qt({pos:new Ft(640,360),width:1280,height:720});W.graphics.use(d),this.add(W),this.spawnBackbutton(),this.Backbutton&&this.Backbutton.on("pointerup",()=>{window.location.reload()})}spawnBackbutton(){this.Backbutton=new qt,this.Backbutton.graphics.use(Wt.Backbutton.toSprite()),this.Backbutton.pos=new Ft(650,500),this.add(this.Backbutton)}onPreUpdate(ot){ot.input.gamepads.at(0).isButtonPressed(Rr.Start)&&window.location.reload()}}class ng extends Wo{constructor(){super({width:1280,height:720,maxFps:60,displayMode:Ho.FitScreen}),this.start(Ko).then(()=>this.startGame())}startGame(){this.add("start",new WA),this.add("startdialogue",new ZA),this.add("map",new eg),this.add("badending",new ig),this.add("goodending",new rg),this.add("woutDialogue",new qA),this.add("dirkDialogue",new VA),this.add("lithorockDialogue",new sg),this.add("elaraDialogue",new YA),this.goToScene("start")}}new ng;
